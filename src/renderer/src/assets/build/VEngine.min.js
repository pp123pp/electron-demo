(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".vengine-adsorb-icon{position:absolute;left:0;top:0;display:none;pointer-events:none;z-index:9}.measure-Label-background{background-color:#377dff}.measure-Label{width:Hug (77px) px;height:Hug (24px) px;gap:10px;padding:3px 8px;position:absolute;color:#f0f8ff;-webkit-user-select:none;user-select:none}.elevationLabel-text{background-color:#377dff;padding:3px 8px}.fill{background-repeat:no-repeat;gap:10px;position:absolute;color:#f0f8ff;-webkit-user-select:none;user-select:none}.rect-select,.vengine-box-selection{position:absolute;z-index:999;pointer-events:none;border:1px solid rgba(26,230,245,.8);display:none}.vengine-viewer{position:relative;margin:0;padding:0;width:100%;height:100%;overflow:hidden;touch-action:none;-webkit-user-select:none;user-select:none}.vengine-viewer-stats{position:absolute;left:0;top:0;cursor:pointer;opacity:.9;z-index:1;-webkit-user-select:none;user-select:none}.vengine-fps-controller{position:absolute;z-index:999;left:4%;bottom:10%;width:100px;height:100px}.vengine-virtual-mouse{position:absolute;display:none;z-index:99;top:50%;left:50%;touch-action:none;-webkit-user-select:none;user-select:none}")),document.head.appendChild(e)}}catch(n){console.error("vite-plugin-css-injected-by-js",n)}})();
(function(yr,wn){typeof exports=="object"&&typeof module<"u"?module.exports=wn():typeof define=="function"&&define.amd?define(wn):(yr=typeof globalThis<"u"?globalThis:yr||self,yr.VEngine=wn())})(this,function(){"use strict";var vV=Object.defineProperty;var yV=(yr,wn,Qo)=>wn in yr?vV(yr,wn,{enumerable:!0,configurable:!0,writable:!0,value:Qo}):yr[wn]=Qo;var f=(yr,wn,Qo)=>(yV(yr,typeof wn!="symbol"?wn+"":wn,Qo),Qo);var yr=document.createElement("style");yr.textContent=`.vengine-adsorb-icon{position:absolute;left:0;top:0;display:none;pointer-events:none;z-index:9}.measure-Label-background{background-color:#377dff}.measure-Label{width:Hug (77px) px;height:Hug (24px) px;gap:10px;padding:3px 8px;position:absolute;color:#f0f8ff;-webkit-user-select:none;user-select:none}.elevationLabel-text{background-color:#377dff;padding:3px 8px}.fill{background-repeat:no-repeat;gap:10px;position:absolute;color:#f0f8ff;-webkit-user-select:none;user-select:none}.rect-select,.vengine-box-selection{position:absolute;z-index:999;pointer-events:none;border:1px solid rgba(26,230,245,.8);display:none}.vengine-viewer{position:relative;margin:0;padding:0;width:100%;height:100%;overflow:hidden;touch-action:none;-webkit-user-select:none;user-select:none}.vengine-viewer-stats{position:absolute;left:0;top:0;cursor:pointer;opacity:.9;z-index:1;-webkit-user-select:none;user-select:none}.vengine-fps-controller{position:absolute;z-index:999;left:4%;bottom:10%;width:100px;height:100px}.vengine-virtual-mouse{position:absolute;display:none;z-index:99;top:50%;left:50%;touch-action:none;-webkit-user-select:none;user-select:none}
`,document.head.appendChild(yr);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const wn="170",Qo={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},J1={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Oy=0,Fm=1,Ny=2,eC=3,tC=0,Um=1,By=2,Kr=3,br=0,hn=1,Jn=2,Qr=0,Es=1,km=2,zm=3,Hm=4,Fy=5,Js=100,Uy=101,ky=102,zy=103,Hy=104,Gy=200,Vy=201,Wy=202,Xy=203,Iu=204,Pu=205,Yy=206,jy=207,qy=208,Zy=209,Ky=210,Qy=211,$y=212,Jy=213,eb=214,Ru=0,Du=1,Lu=2,eo=3,Ou=4,Nu=5,Bu=6,Fu=7,rl=0,tb=1,ib=2,xr=0,Uu=1,Gm=2,Vm=3,Vc=4,Wm=5,Xm=6,Ym=7,jm="attached",nb="detached",ku=300,Ts=301,to=302,sl=303,Wc=304,ol=306,io=1e3,or=1001,al=1002,xi=1003,zu=1004,iC=1004,$o=1005,nC=1005,Ei=1006,ll=1007,rC=1007,wr=1008,sC=1008,ar=1009,qm=1010,Zm=1011,Jo=1012,Hu=1013,As=1014,Ii=1015,er=1016,Gu=1017,Vu=1018,ea=1020,Km=35902,Qm=1021,$m=1022,Ti=1023,Jm=1024,eg=1025,no=1026,ta=1027,Wu=1028,Xc=1029,tg=1030,Xu=1031,oC=1032,Yu=1033,Yc=33776,jc=33777,qc=33778,Zc=33779,ju=35840,qu=35841,Zu=35842,Ku=35843,Qu=36196,$u=37492,Ju=37496,ef=37808,tf=37809,nf=37810,rf=37811,sf=37812,of=37813,af=37814,lf=37815,cf=37816,hf=37817,uf=37818,ff=37819,df=37820,pf=37821,Kc=36492,mf=36494,gf=36495,ig=36283,_f=36284,vf=36285,yf=36286,rb=2200,sb=2201,ob=2202,cl=2300,hl=2301,bf=2302,ia=2400,na=2401,Qc=2402,xf=2500,ng=2501,ab=0,rg=1,wf=2,lb=3200,cb=3201,aC=3202,lC=3203,Br=0,hb=1,Ms="",Ai="srgb",sn="srgb-linear",$c="linear",mi="srgb",cC=0,ra=7680,hC=7681,uC=7682,fC=7683,dC=34055,pC=34056,mC=5386,gC=512,_C=513,vC=514,yC=515,bC=516,xC=517,wC=518,sg=519,ub=512,fb=513,db=514,og=515,pb=516,mb=517,gb=518,_b=519,un=35044,SC=35048,vb=35040,EC=35045,TC=35049,AC=35041,MC=35046,CC=35050,IC=35042,PC="100",Sf="300 es",$r=2e3,Jc=2001;let Jr=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const Sn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let yb=1234567;const sa=Math.PI/180,ul=180/Math.PI;function lr(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Sn[n&255]+Sn[n>>8&255]+Sn[n>>16&255]+Sn[n>>24&255]+"-"+Sn[e&255]+Sn[e>>8&255]+"-"+Sn[e>>16&15|64]+Sn[e>>24&255]+"-"+Sn[t&63|128]+Sn[t>>8&255]+"-"+Sn[t>>16&255]+Sn[t>>24&255]+Sn[i&255]+Sn[i>>8&255]+Sn[i>>16&255]+Sn[i>>24&255]).toLowerCase()}function Fi(n,e,t){return Math.max(e,Math.min(t,n))}function ag(n,e){return(n%e+e)%e}function RC(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function DC(n,e,t){return n!==e?(t-n)/(e-n):0}function eh(n,e,t){return(1-t)*n+t*e}function LC(n,e,t,i){return eh(n,e,1-Math.exp(-t*i))}function OC(n,e=1){return e-Math.abs(ag(n,e*2)-e)}function NC(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function BC(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function FC(n,e){return n+Math.floor(Math.random()*(e-n+1))}function UC(n,e){return n+Math.random()*(e-n)}function kC(n){return n*(.5-Math.random())}function zC(n){n!==void 0&&(yb=n);let e=yb+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function HC(n){return n*sa}function GC(n){return n*ul}function VC(n){return(n&n-1)===0&&n!==0}function WC(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function XC(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function YC(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+i)/2),u=o((e+i)/2),d=s((e-i)/2),p=o((e-i)/2),g=s((i-e)/2),_=o((i-e)/2);switch(r){case"XYX":n.set(a*u,l*d,l*p,a*c);break;case"YZY":n.set(l*p,a*u,l*d,a*c);break;case"ZXZ":n.set(l*d,l*p,a*u,a*c);break;case"XZX":n.set(a*u,l*_,l*g,a*c);break;case"YXY":n.set(l*g,a*u,l*_,a*c);break;case"ZYZ":n.set(l*_,l*g,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Un(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Ut(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const kn={DEG2RAD:sa,RAD2DEG:ul,generateUUID:lr,clamp:Fi,euclideanModulo:ag,mapLinear:RC,inverseLerp:DC,lerp:eh,damp:LC,pingpong:OC,smoothstep:NC,smootherstep:BC,randInt:FC,randFloat:UC,randFloatSpread:kC,seededRandom:zC,degToRad:HC,radToDeg:GC,isPowerOfTwo:VC,ceilPowerOfTwo:WC,floorPowerOfTwo:XC,setQuaternionFromProperEuler:YC,normalize:Ut,denormalize:Un};let xe=class W1{constructor(e=0,t=0){W1.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Fi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},kt=class X1{constructor(e,t,i,r,s,o,a,l,c){X1.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c)}set(e,t,i,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],d=i[7],p=i[2],g=i[5],_=i[8],x=r[0],b=r[3],y=r[6],M=r[1],E=r[4],w=r[7],I=r[2],B=r[5],N=r[8];return s[0]=o*x+a*M+l*I,s[3]=o*b+a*E+l*B,s[6]=o*y+a*w+l*N,s[1]=c*x+u*M+d*I,s[4]=c*b+u*E+d*B,s[7]=c*y+u*w+d*N,s[2]=p*x+g*M+_*I,s[5]=p*b+g*E+_*B,s[8]=p*y+g*w+_*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-i*s*u+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,p=a*l-u*s,g=c*s-o*l,_=t*d+i*p+r*g;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/_;return e[0]=d*x,e[1]=(r*c-u*i)*x,e[2]=(a*i-r*o)*x,e[3]=p*x,e[4]=(u*t-r*l)*x,e[5]=(r*s-a*t)*x,e[6]=g*x,e[7]=(i*l-c*t)*x,e[8]=(o*t-i*s)*x,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(lg.makeScale(e,t)),this}rotate(e){return this.premultiply(lg.makeRotation(-e)),this}translate(e,t){return this.premultiply(lg.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const lg=new kt;function bb(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const jC={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function fl(n,e){return new jC[n](e)}function th(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function xb(){const n=th("canvas");return n.style.display="block",n}const wb={};function ih(n){n in wb||(wb[n]=!0,console.warn(n))}function qC(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}function ZC(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function KC(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Xt={enabled:!0,workingColorSpace:sn,spaces:{},convert:function(n,e,t){return this.enabled===!1||e===t||!e||!t||(this.spaces[e].transfer===mi&&(n.r=Cs(n.r),n.g=Cs(n.g),n.b=Cs(n.b)),this.spaces[e].primaries!==this.spaces[t].primaries&&(n.applyMatrix3(this.spaces[e].toXYZ),n.applyMatrix3(this.spaces[t].fromXYZ)),this.spaces[t].transfer===mi&&(n.r=dl(n.r),n.g=dl(n.g),n.b=dl(n.b))),n},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===Ms?$c:this.spaces[n].transfer},getLuminanceCoefficients:function(n,e=this.workingColorSpace){return n.fromArray(this.spaces[e].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,e,t){return n.copy(this.spaces[e].toXYZ).multiply(this.spaces[t].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}};function Cs(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function dl(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const Sb=[.64,.33,.3,.6,.15,.06],Eb=[.2126,.7152,.0722],Tb=[.3127,.329],Ab=new kt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Mb=new kt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Xt.define({[sn]:{primaries:Sb,whitePoint:Tb,transfer:$c,toXYZ:Ab,fromXYZ:Mb,luminanceCoefficients:Eb,workingColorSpaceConfig:{unpackColorSpace:Ai},outputColorSpaceConfig:{drawingBufferColorSpace:Ai}},[Ai]:{primaries:Sb,whitePoint:Tb,transfer:mi,toXYZ:Ab,fromXYZ:Mb,luminanceCoefficients:Eb,outputColorSpaceConfig:{drawingBufferColorSpace:Ai}}});let pl;class Cb{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{pl===void 0&&(pl=th("canvas")),pl.width=e.width,pl.height=e.height;const i=pl.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=pl}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=th("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Cs(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Cs(t[i]/255)*255):t[i]=Cs(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let QC=0;class oa{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:QC++}),this.uuid=lr(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(cg(r[o].image)):s.push(cg(r[o]))}else s=cg(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function cg(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Cb.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let $C=0;class yi extends Jr{constructor(e=yi.DEFAULT_IMAGE,t=yi.DEFAULT_MAPPING,i=or,r=or,s=Ei,o=wr,a=Ti,l=ar,c=yi.DEFAULT_ANISOTROPY,u=Ms){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:$C++}),this.uuid=lr(),this.name="",this.source=new oa(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new xe(0,0),this.repeat=new xe(1,1),this.center=new xe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ku)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case io:e.x=e.x-Math.floor(e.x);break;case or:e.x=e.x<0?0:1;break;case al:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case io:e.y=e.y-Math.floor(e.y);break;case or:e.y=e.y<0?0:1;break;case al:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}yi.DEFAULT_IMAGE=null,yi.DEFAULT_MAPPING=ku,yi.DEFAULT_ANISOTROPY=1;let Gt=class Y1{constructor(e=0,t=0,i=0,r=1){Y1.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],u=l[4],d=l[8],p=l[1],g=l[5],_=l[9],x=l[2],b=l[6],y=l[10];if(Math.abs(u-p)<.01&&Math.abs(d-x)<.01&&Math.abs(_-b)<.01){if(Math.abs(u+p)<.1&&Math.abs(d+x)<.1&&Math.abs(_+b)<.1&&Math.abs(c+g+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const E=(c+1)/2,w=(g+1)/2,I=(y+1)/2,B=(u+p)/4,N=(d+x)/4,L=(_+b)/4;return E>w&&E>I?E<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(E),r=B/i,s=N/i):w>I?w<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(w),i=B/r,s=L/r):I<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(I),i=N/s,r=L/s),this.set(i,r,s,t),this}let M=Math.sqrt((b-_)*(b-_)+(d-x)*(d-x)+(p-u)*(p-u));return Math.abs(M)<.001&&(M=1),this.x=(b-_)/M,this.y=(d-x)/M,this.z=(p-u)/M,this.w=Math.acos((c+g+y-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class Ib extends Jr{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Gt(0,0,e,t),this.scissorTest=!1,this.viewport=new Gt(0,0,e,t);const r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ei,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new yi(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new oa(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ji extends Ib{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class Ef extends yi{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=xi,this.minFilter=xi,this.wrapR=or,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class JC extends ji{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Ef(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class hg extends yi{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=xi,this.minFilter=xi,this.wrapR=or,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class eI extends ji{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new hg(null,e,t,i),this.texture.isRenderTargetTexture=!0}}let Li=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],u=i[r+2],d=i[r+3];const p=s[o+0],g=s[o+1],_=s[o+2],x=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=p,e[t+1]=g,e[t+2]=_,e[t+3]=x;return}if(d!==x||l!==p||c!==g||u!==_){let b=1-a;const y=l*p+c*g+u*_+d*x,M=y>=0?1:-1,E=1-y*y;if(E>Number.EPSILON){const I=Math.sqrt(E),B=Math.atan2(I,y*M);b=Math.sin(b*B)/I,a=Math.sin(a*B)/I}const w=a*M;if(l=l*b+p*w,c=c*b+g*w,u=u*b+_*w,d=d*b+x*w,b===1-a){const I=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=I,c*=I,u*=I,d*=I}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],d=s[o],p=s[o+1],g=s[o+2],_=s[o+3];return e[t]=a*_+u*d+l*g-c*p,e[t+1]=l*_+u*p+c*d-a*g,e[t+2]=c*_+u*g+a*p-l*d,e[t+3]=u*_-a*d-l*p-c*g,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),d=a(s/2),p=l(i/2),g=l(r/2),_=l(s/2);switch(o){case"XYZ":this._x=p*u*d+c*g*_,this._y=c*g*d-p*u*_,this._z=c*u*_+p*g*d,this._w=c*u*d-p*g*_;break;case"YXZ":this._x=p*u*d+c*g*_,this._y=c*g*d-p*u*_,this._z=c*u*_-p*g*d,this._w=c*u*d+p*g*_;break;case"ZXY":this._x=p*u*d-c*g*_,this._y=c*g*d+p*u*_,this._z=c*u*_+p*g*d,this._w=c*u*d-p*g*_;break;case"ZYX":this._x=p*u*d-c*g*_,this._y=c*g*d+p*u*_,this._z=c*u*_-p*g*d,this._w=c*u*d+p*g*_;break;case"YZX":this._x=p*u*d+c*g*_,this._y=c*g*d+p*u*_,this._z=c*u*_-p*g*d,this._w=c*u*d-p*g*_;break;case"XZY":this._x=p*u*d-c*g*_,this._y=c*g*d-p*u*_,this._z=c*u*_+p*g*d,this._w=c*u*d+p*g*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],p=i+a+d;if(p>0){const g=.5/Math.sqrt(p+1);this._w=.25/g,this._x=(u-l)*g,this._y=(s-c)*g,this._z=(o-r)*g}else if(i>a&&i>d){const g=2*Math.sqrt(1+i-a-d);this._w=(u-l)/g,this._x=.25*g,this._y=(r+o)/g,this._z=(s+c)/g}else if(a>d){const g=2*Math.sqrt(1+a-i-d);this._w=(s-c)/g,this._x=(r+o)/g,this._y=.25*g,this._z=(l+u)/g}else{const g=2*Math.sqrt(1+d-i-a);this._w=(o-r)/g,this._x=(s+c)/g,this._y=(l+u)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Fi(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-i*c,this._z=s*u+o*c+i*l-r*a,this._w=o*u-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const g=1-t;return this._w=g*o+t*this._w,this._x=g*i+t*this._x,this._y=g*r+t*this._y,this._z=g*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;return this._w=o*d+this._w*p,this._x=i*d+this._x*p,this._y=r*d+this._y*p,this._z=s*d+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},q=class j1{constructor(e=0,t=0,i=0){j1.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Pb.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Pb.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*i),u=2*(a*t-s*r),d=2*(s*i-o*t);return this.x=t+l*c+o*d-a*u,this.y=i+l*u+a*c-s*d,this.z=r+l*d+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return ug.copy(this).projectOnVector(e),this.sub(ug)}reflect(e){return this.sub(ug.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Fi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const ug=new q,Pb=new Li;class Vi{constructor(e=new q(1/0,1/0,1/0),t=new q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Fr.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Fr.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Fr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Fr):Fr.fromBufferAttribute(s,o),Fr.applyMatrix4(e.matrixWorld),this.expandByPoint(Fr);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Tf.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Tf.copy(i.boundingBox)),Tf.applyMatrix4(e.matrixWorld),this.union(Tf)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Fr),Fr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(nh),Af.subVectors(this.max,nh),ml.subVectors(e.a,nh),gl.subVectors(e.b,nh),_l.subVectors(e.c,nh),ro.subVectors(gl,ml),so.subVectors(_l,gl),aa.subVectors(ml,_l);let t=[0,-ro.z,ro.y,0,-so.z,so.y,0,-aa.z,aa.y,ro.z,0,-ro.x,so.z,0,-so.x,aa.z,0,-aa.x,-ro.y,ro.x,0,-so.y,so.x,0,-aa.y,aa.x,0];return!fg(t,ml,gl,_l,Af)||(t=[1,0,0,0,1,0,0,0,1],!fg(t,ml,gl,_l,Af))?!1:(Mf.crossVectors(ro,so),t=[Mf.x,Mf.y,Mf.z],fg(t,ml,gl,_l,Af))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Fr).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Fr).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Is[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Is[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Is[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Is[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Is[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Is[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Is[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Is[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Is),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Is=[new q,new q,new q,new q,new q,new q,new q,new q],Fr=new q,Tf=new Vi,ml=new q,gl=new q,_l=new q,ro=new q,so=new q,aa=new q,nh=new q,Af=new q,Mf=new q,la=new q;function fg(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){la.fromArray(n,s);const a=r.x*Math.abs(la.x)+r.y*Math.abs(la.y)+r.z*Math.abs(la.z),l=e.dot(la),c=t.dot(la),u=i.dot(la);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const tI=new Vi,rh=new q,dg=new q;class qi{constructor(e=new q,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):tI.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;rh.subVectors(e,this.center);const t=rh.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(rh,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(dg.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(rh.copy(e.center).add(dg)),this.expandByPoint(rh.copy(e.center).sub(dg))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ps=new q,pg=new q,Cf=new q,oo=new q,mg=new q,If=new q,gg=new q;let ca=class{constructor(e=new q,t=new q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ps)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ps.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ps.copy(this.origin).addScaledVector(this.direction,t),Ps.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){pg.copy(e).add(t).multiplyScalar(.5),Cf.copy(t).sub(e).normalize(),oo.copy(this.origin).sub(pg);const s=e.distanceTo(t)*.5,o=-this.direction.dot(Cf),a=oo.dot(this.direction),l=-oo.dot(Cf),c=oo.lengthSq(),u=Math.abs(1-o*o);let d,p,g,_;if(u>0)if(d=o*l-a,p=o*a-l,_=s*u,d>=0)if(p>=-_)if(p<=_){const x=1/u;d*=x,p*=x,g=d*(d+o*p+2*a)+p*(o*d+p+2*l)+c}else p=s,d=Math.max(0,-(o*p+a)),g=-d*d+p*(p+2*l)+c;else p=-s,d=Math.max(0,-(o*p+a)),g=-d*d+p*(p+2*l)+c;else p<=-_?(d=Math.max(0,-(-o*s+a)),p=d>0?-s:Math.min(Math.max(-s,-l),s),g=-d*d+p*(p+2*l)+c):p<=_?(d=0,p=Math.min(Math.max(-s,-l),s),g=p*(p+2*l)+c):(d=Math.max(0,-(o*s+a)),p=d>0?s:Math.min(Math.max(-s,-l),s),g=-d*d+p*(p+2*l)+c);else p=o>0?-s:s,d=Math.max(0,-(o*p+a)),g=-d*d+p*(p+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),r&&r.copy(pg).addScaledVector(Cf,p),g}intersectSphere(e,t){Ps.subVectors(e.center,this.origin);const i=Ps.dot(this.direction),r=Ps.dot(Ps)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,p=this.origin;return c>=0?(i=(e.min.x-p.x)*c,r=(e.max.x-p.x)*c):(i=(e.max.x-p.x)*c,r=(e.min.x-p.x)*c),u>=0?(s=(e.min.y-p.y)*u,o=(e.max.y-p.y)*u):(s=(e.max.y-p.y)*u,o=(e.min.y-p.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),d>=0?(a=(e.min.z-p.z)*d,l=(e.max.z-p.z)*d):(a=(e.max.z-p.z)*d,l=(e.min.z-p.z)*d),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Ps)!==null}intersectTriangle(e,t,i,r,s){mg.subVectors(t,e),If.subVectors(i,e),gg.crossVectors(mg,If);let o=this.direction.dot(gg),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;oo.subVectors(this.origin,e);const l=a*this.direction.dot(If.crossVectors(oo,If));if(l<0)return null;const c=a*this.direction.dot(mg.cross(oo));if(c<0||l+c>o)return null;const u=-a*oo.dot(gg);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Mt=class Ly{constructor(e,t,i,r,s,o,a,l,c,u,d,p,g,_,x,b){Ly.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c,u,d,p,g,_,x,b)}set(e,t,i,r,s,o,a,l,c,u,d,p,g,_,x,b){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=r,y[1]=s,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=u,y[10]=d,y[14]=p,y[3]=g,y[7]=_,y[11]=x,y[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ly().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/vl.setFromMatrixColumn(e,0).length(),s=1/vl.setFromMatrixColumn(e,1).length(),o=1/vl.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const p=o*u,g=o*d,_=a*u,x=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=g+_*c,t[5]=p-x*c,t[9]=-a*l,t[2]=x-p*c,t[6]=_+g*c,t[10]=o*l}else if(e.order==="YXZ"){const p=l*u,g=l*d,_=c*u,x=c*d;t[0]=p+x*a,t[4]=_*a-g,t[8]=o*c,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=g*a-_,t[6]=x+p*a,t[10]=o*l}else if(e.order==="ZXY"){const p=l*u,g=l*d,_=c*u,x=c*d;t[0]=p-x*a,t[4]=-o*d,t[8]=_+g*a,t[1]=g+_*a,t[5]=o*u,t[9]=x-p*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const p=o*u,g=o*d,_=a*u,x=a*d;t[0]=l*u,t[4]=_*c-g,t[8]=p*c+x,t[1]=l*d,t[5]=x*c+p,t[9]=g*c-_,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const p=o*l,g=o*c,_=a*l,x=a*c;t[0]=l*u,t[4]=x-p*d,t[8]=_*d+g,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=g*d+_,t[10]=p-x*d}else if(e.order==="XZY"){const p=o*l,g=o*c,_=a*l,x=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=p*d+x,t[5]=o*u,t[9]=g*d-_,t[2]=_*d-g,t[6]=a*u,t[10]=x*d+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(iI,e,nI)}lookAt(e,t,i){const r=this.elements;return cr.subVectors(e,t),cr.lengthSq()===0&&(cr.z=1),cr.normalize(),ao.crossVectors(i,cr),ao.lengthSq()===0&&(Math.abs(i.z)===1?cr.x+=1e-4:cr.z+=1e-4,cr.normalize(),ao.crossVectors(i,cr)),ao.normalize(),Pf.crossVectors(cr,ao),r[0]=ao.x,r[4]=Pf.x,r[8]=cr.x,r[1]=ao.y,r[5]=Pf.y,r[9]=cr.y,r[2]=ao.z,r[6]=Pf.z,r[10]=cr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],d=i[5],p=i[9],g=i[13],_=i[2],x=i[6],b=i[10],y=i[14],M=i[3],E=i[7],w=i[11],I=i[15],B=r[0],N=r[4],L=r[8],P=r[12],R=r[1],U=r[5],j=r[9],A=r[13],D=r[2],k=r[6],G=r[10],ee=r[14],J=r[3],re=r[7],oe=r[11],me=r[15];return s[0]=o*B+a*R+l*D+c*J,s[4]=o*N+a*U+l*k+c*re,s[8]=o*L+a*j+l*G+c*oe,s[12]=o*P+a*A+l*ee+c*me,s[1]=u*B+d*R+p*D+g*J,s[5]=u*N+d*U+p*k+g*re,s[9]=u*L+d*j+p*G+g*oe,s[13]=u*P+d*A+p*ee+g*me,s[2]=_*B+x*R+b*D+y*J,s[6]=_*N+x*U+b*k+y*re,s[10]=_*L+x*j+b*G+y*oe,s[14]=_*P+x*A+b*ee+y*me,s[3]=M*B+E*R+w*D+I*J,s[7]=M*N+E*U+w*k+I*re,s[11]=M*L+E*j+w*G+I*oe,s[15]=M*P+E*A+w*ee+I*me,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],p=e[10],g=e[14],_=e[3],x=e[7],b=e[11],y=e[15];return _*(+s*l*d-r*c*d-s*a*p+i*c*p+r*a*g-i*l*g)+x*(+t*l*g-t*c*p+s*o*p-r*o*g+r*c*u-s*l*u)+b*(+t*c*d-t*a*g-s*o*d+i*o*g+s*a*u-i*c*u)+y*(-r*a*u-t*l*d+t*a*p+r*o*d-i*o*p+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],g=e[11],_=e[12],x=e[13],b=e[14],y=e[15],M=d*b*c-x*p*c+x*l*g-a*b*g-d*l*y+a*p*y,E=_*p*c-u*b*c-_*l*g+o*b*g+u*l*y-o*p*y,w=u*x*c-_*d*c+_*a*g-o*x*g-u*a*y+o*d*y,I=_*d*l-u*x*l-_*a*p+o*x*p+u*a*b-o*d*b,B=t*M+i*E+r*w+s*I;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const N=1/B;return e[0]=M*N,e[1]=(x*p*s-d*b*s-x*r*g+i*b*g+d*r*y-i*p*y)*N,e[2]=(a*b*s-x*l*s+x*r*c-i*b*c-a*r*y+i*l*y)*N,e[3]=(d*l*s-a*p*s-d*r*c+i*p*c+a*r*g-i*l*g)*N,e[4]=E*N,e[5]=(u*b*s-_*p*s+_*r*g-t*b*g-u*r*y+t*p*y)*N,e[6]=(_*l*s-o*b*s-_*r*c+t*b*c+o*r*y-t*l*y)*N,e[7]=(o*p*s-u*l*s+u*r*c-t*p*c-o*r*g+t*l*g)*N,e[8]=w*N,e[9]=(_*d*s-u*x*s-_*i*g+t*x*g+u*i*y-t*d*y)*N,e[10]=(o*x*s-_*a*s+_*i*c-t*x*c-o*i*y+t*a*y)*N,e[11]=(u*a*s-o*d*s-u*i*c+t*d*c+o*i*g-t*a*g)*N,e[12]=I*N,e[13]=(u*x*r-_*d*r+_*i*p-t*x*p-u*i*b+t*d*b)*N,e[14]=(_*a*r-o*x*r-_*i*l+t*x*l+o*i*b-t*a*b)*N,e[15]=(o*d*r-u*a*r+u*i*l-t*d*l-o*i*p+t*a*p)*N,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,d=a+a,p=s*c,g=s*u,_=s*d,x=o*u,b=o*d,y=a*d,M=l*c,E=l*u,w=l*d,I=i.x,B=i.y,N=i.z;return r[0]=(1-(x+y))*I,r[1]=(g+w)*I,r[2]=(_-E)*I,r[3]=0,r[4]=(g-w)*B,r[5]=(1-(p+y))*B,r[6]=(b+M)*B,r[7]=0,r[8]=(_+E)*N,r[9]=(b-M)*N,r[10]=(1-(p+x))*N,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=vl.set(r[0],r[1],r[2]).length();const o=vl.set(r[4],r[5],r[6]).length(),a=vl.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Ur.copy(this);const c=1/s,u=1/o,d=1/a;return Ur.elements[0]*=c,Ur.elements[1]*=c,Ur.elements[2]*=c,Ur.elements[4]*=u,Ur.elements[5]*=u,Ur.elements[6]*=u,Ur.elements[8]*=d,Ur.elements[9]*=d,Ur.elements[10]*=d,t.setFromRotationMatrix(Ur),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=$r){const l=this.elements,c=2*s/(t-e),u=2*s/(i-r),d=(t+e)/(t-e),p=(i+r)/(i-r);let g,_;if(a===$r)g=-(o+s)/(o-s),_=-2*o*s/(o-s);else if(a===Jc)g=-o/(o-s),_=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=g,l[14]=_,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=$r){const l=this.elements,c=1/(t-e),u=1/(i-r),d=1/(o-s),p=(t+e)*c,g=(i+r)*u;let _,x;if(a===$r)_=(o+s)*d,x=-2*d;else if(a===Jc)_=s*d,x=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-g,l[2]=0,l[6]=0,l[10]=x,l[14]=-_,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const vl=new q,Ur=new Mt,iI=new q(0,0,0),nI=new q(1,1,1),ao=new q,Pf=new q,cr=new q,Rb=new Mt,Db=new Li;class Oi{constructor(e=0,t=0,i=0,r=Oi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],d=r[2],p=r[6],g=r[10];switch(t){case"XYZ":this._y=Math.asin(Fi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,g),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Fi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,g),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(Fi(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-d,g),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Fi(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(p,g),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Fi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(a,g));break;case"XZY":this._z=Math.asin(-Fi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Rb.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Rb,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Db.setFromEuler(this),this.setFromQuaternion(Db,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Oi.DEFAULT_ORDER="XYZ";class Rf{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let rI=0;const Lb=new q,yl=new Li,Rs=new Mt,Df=new q,sh=new q,sI=new q,oI=new Li,Ob=new q(1,0,0),Nb=new q(0,1,0),Bb=new q(0,0,1),Fb={type:"added"},aI={type:"removed"},bl={type:"childadded",child:null},_g={type:"childremoved",child:null};class Dt extends Jr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:rI++}),this.uuid=lr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Dt.DEFAULT_UP.clone();const e=new q,t=new Oi,i=new Li,r=new q(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Mt},normalMatrix:{value:new kt}}),this.matrix=new Mt,this.matrixWorld=new Mt,this.matrixAutoUpdate=Dt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Dt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Rf,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return yl.setFromAxisAngle(e,t),this.quaternion.multiply(yl),this}rotateOnWorldAxis(e,t){return yl.setFromAxisAngle(e,t),this.quaternion.premultiply(yl),this}rotateX(e){return this.rotateOnAxis(Ob,e)}rotateY(e){return this.rotateOnAxis(Nb,e)}rotateZ(e){return this.rotateOnAxis(Bb,e)}translateOnAxis(e,t){return Lb.copy(e).applyQuaternion(this.quaternion),this.position.add(Lb.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ob,e)}translateY(e){return this.translateOnAxis(Nb,e)}translateZ(e){return this.translateOnAxis(Bb,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Rs.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Df.copy(e):Df.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),sh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Rs.lookAt(sh,Df,this.up):Rs.lookAt(Df,sh,this.up),this.quaternion.setFromRotationMatrix(Rs),r&&(Rs.extractRotation(r.matrixWorld),yl.setFromRotationMatrix(Rs),this.quaternion.premultiply(yl.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Fb),bl.child=e,this.dispatchEvent(bl),bl.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(aI),_g.child=e,this.dispatchEvent(_g),_g.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Rs.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Rs.multiply(e.parent.matrixWorld)),e.applyMatrix4(Rs),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Fb),bl.child=e,this.dispatchEvent(bl),bl.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(sh,e,sI),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(sh,oI,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const d=l[c];s(e.shapes,d)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),d=o(e.shapes),p=o(e.skeletons),g=o(e.animations),_=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),u.length>0&&(i.images=u),d.length>0&&(i.shapes=d),p.length>0&&(i.skeletons=p),g.length>0&&(i.animations=g),_.length>0&&(i.nodes=_)}return i.object=r,i;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Dt.DEFAULT_UP=new q(0,1,0),Dt.DEFAULT_MATRIX_AUTO_UPDATE=!0,Dt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const kr=new q,Ds=new q,vg=new q,Ls=new q,xl=new q,wl=new q,Ub=new q,yg=new q,bg=new q,xg=new q,wg=new Gt,Sg=new Gt,Eg=new Gt;class $i{constructor(e=new q,t=new q,i=new q){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),kr.subVectors(e,t),r.cross(kr);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){kr.subVectors(r,t),Ds.subVectors(i,t),vg.subVectors(e,t);const o=kr.dot(kr),a=kr.dot(Ds),l=kr.dot(vg),c=Ds.dot(Ds),u=Ds.dot(vg),d=o*c-a*a;if(d===0)return s.set(0,0,0),null;const p=1/d,g=(c*l-a*u)*p,_=(o*u-a*l)*p;return s.set(1-g-_,_,g)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Ls)===null?!1:Ls.x>=0&&Ls.y>=0&&Ls.x+Ls.y<=1}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,Ls)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Ls.x),l.addScaledVector(o,Ls.y),l.addScaledVector(a,Ls.z),l)}static getInterpolatedAttribute(e,t,i,r,s,o){return wg.setScalar(0),Sg.setScalar(0),Eg.setScalar(0),wg.fromBufferAttribute(e,t),Sg.fromBufferAttribute(e,i),Eg.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(wg,s.x),o.addScaledVector(Sg,s.y),o.addScaledVector(Eg,s.z),o}static isFrontFacing(e,t,i,r){return kr.subVectors(i,t),Ds.subVectors(e,t),kr.cross(Ds).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return kr.subVectors(this.c,this.b),Ds.subVectors(this.a,this.b),kr.cross(Ds).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $i.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $i.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return $i.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return $i.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $i.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;xl.subVectors(r,i),wl.subVectors(s,i),yg.subVectors(e,i);const l=xl.dot(yg),c=wl.dot(yg);if(l<=0&&c<=0)return t.copy(i);bg.subVectors(e,r);const u=xl.dot(bg),d=wl.dot(bg);if(u>=0&&d<=u)return t.copy(r);const p=l*d-u*c;if(p<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(i).addScaledVector(xl,o);xg.subVectors(e,s);const g=xl.dot(xg),_=wl.dot(xg);if(_>=0&&g<=_)return t.copy(s);const x=g*c-l*_;if(x<=0&&c>=0&&_<=0)return a=c/(c-_),t.copy(i).addScaledVector(wl,a);const b=u*_-g*d;if(b<=0&&d-u>=0&&g-_>=0)return Ub.subVectors(s,r),a=(d-u)/(d-u+(g-_)),t.copy(r).addScaledVector(Ub,a);const y=1/(b+x+p);return o=x*y,a=p*y,t.copy(i).addScaledVector(xl,o).addScaledVector(wl,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const kb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},lo={h:0,s:0,l:0},Lf={h:0,s:0,l:0};function Tg(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let ve=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ai){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Xt.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Xt.workingColorSpace){return this.r=e,this.g=t,this.b=i,Xt.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Xt.workingColorSpace){if(e=ag(e,1),t=Fi(t,0,1),i=Fi(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=Tg(o,s,e+1/3),this.g=Tg(o,s,e),this.b=Tg(o,s,e-1/3)}return Xt.toWorkingColorSpace(this,r),this}setStyle(e,t=Ai){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ai){const i=kb[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Cs(e.r),this.g=Cs(e.g),this.b=Cs(e.b),this}copyLinearToSRGB(e){return this.r=dl(e.r),this.g=dl(e.g),this.b=dl(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ai){return Xt.fromWorkingColorSpace(En.copy(this),e),Math.round(Fi(En.r*255,0,255))*65536+Math.round(Fi(En.g*255,0,255))*256+Math.round(Fi(En.b*255,0,255))}getHexString(e=Ai){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Xt.workingColorSpace){Xt.fromWorkingColorSpace(En.copy(this),t);const i=En.r,r=En.g,s=En.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=u<=.5?d/(o+a):d/(2-o-a),o){case i:l=(r-s)/d+(r<s?6:0);break;case r:l=(s-i)/d+2;break;case s:l=(i-r)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Xt.workingColorSpace){return Xt.fromWorkingColorSpace(En.copy(this),t),e.r=En.r,e.g=En.g,e.b=En.b,e}getStyle(e=Ai){Xt.fromWorkingColorSpace(En.copy(this),e);const t=En.r,i=En.g,r=En.b;return e!==Ai?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(lo),this.setHSL(lo.h+e,lo.s+t,lo.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(lo),e.getHSL(Lf);const i=eh(lo.h,Lf.h,t),r=eh(lo.s,Lf.s,t),s=eh(lo.l,Lf.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const En=new ve;ve.NAMES=kb;let lI=0;class Ji extends Jr{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:lI++}),this.uuid=lr(),this.name="",this.blending=Es,this.side=br,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Iu,this.blendDst=Pu,this.blendEquation=Js,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ve(0,0,0),this.blendAlpha=0,this.depthFunc=eo,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=sg,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ra,this.stencilZFail=ra,this.stencilZPass=ra,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Es&&(i.blending=this.blending),this.side!==br&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Iu&&(i.blendSrc=this.blendSrc),this.blendDst!==Pu&&(i.blendDst=this.blendDst),this.blendEquation!==Js&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==eo&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==sg&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ra&&(i.stencilFail=this.stencilFail),this.stencilZFail!==ra&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==ra&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Pi extends Ji{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Oi,this.combine=rl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Os=cI();function cI(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function tr(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Fi(n,-65504,65504),Os.floatView[0]=n;const e=Os.uint32View[0],t=e>>23&511;return Os.baseTable[t]+((e&8388607)>>Os.shiftTable[t])}function oh(n){const e=n>>10;return Os.uint32View[0]=Os.mantissaTable[Os.offsetTable[e]+(n&1023)]+Os.exponentTable[e],Os.floatView[0]}const ah={toHalfFloat:tr,fromHalfFloat:oh},Zi=new q,Of=new xe;class Jt{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=un,this.updateRanges=[],this.gpuType=Ii,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Of.fromBufferAttribute(this,t),Of.applyMatrix3(e),this.setXY(t,Of.x,Of.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Zi.fromBufferAttribute(this,t),Zi.applyMatrix3(e),this.setXYZ(t,Zi.x,Zi.y,Zi.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Zi.fromBufferAttribute(this,t),Zi.applyMatrix4(e),this.setXYZ(t,Zi.x,Zi.y,Zi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Zi.fromBufferAttribute(this,t),Zi.applyNormalMatrix(e),this.setXYZ(t,Zi.x,Zi.y,Zi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Zi.fromBufferAttribute(this,t),Zi.transformDirection(e),this.setXYZ(t,Zi.x,Zi.y,Zi.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Un(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Ut(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Un(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Un(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Un(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Un(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),r=Ut(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),r=Ut(r,this.array),s=Ut(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==un&&(e.usage=this.usage),e}}class hI extends Jt{constructor(e,t,i){super(new Int8Array(e),t,i)}}class uI extends Jt{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class fI extends Jt{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class dI extends Jt{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Ag extends Jt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class pI extends Jt{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Mg extends Jt{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class mI extends Jt{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=oh(this.array[e*this.itemSize]);return this.normalized&&(t=Un(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize]=tr(t),this}getY(e){let t=oh(this.array[e*this.itemSize+1]);return this.normalized&&(t=Un(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+1]=tr(t),this}getZ(e){let t=oh(this.array[e*this.itemSize+2]);return this.normalized&&(t=Un(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+2]=tr(t),this}getW(e){let t=oh(this.array[e*this.itemSize+3]);return this.normalized&&(t=Un(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+3]=tr(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array)),this.array[e+0]=tr(t),this.array[e+1]=tr(i),this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),r=Ut(r,this.array)),this.array[e+0]=tr(t),this.array[e+1]=tr(i),this.array[e+2]=tr(r),this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),r=Ut(r,this.array),s=Ut(s,this.array)),this.array[e+0]=tr(t),this.array[e+1]=tr(i),this.array[e+2]=tr(r),this.array[e+3]=tr(s),this}}class $e extends Jt{constructor(e,t,i){super(new Float32Array(e),t,i)}}let gI=0;const Sr=new Mt,Cg=new Dt,Sl=new q,hr=new Vi,lh=new Vi,on=new q;class Tt extends Jr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gI++}),this.uuid=lr(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(bb(e)?Mg:Ag)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new kt().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Sr.makeRotationFromQuaternion(e),this.applyMatrix4(Sr),this}rotateX(e){return Sr.makeRotationX(e),this.applyMatrix4(Sr),this}rotateY(e){return Sr.makeRotationY(e),this.applyMatrix4(Sr),this}rotateZ(e){return Sr.makeRotationZ(e),this.applyMatrix4(Sr),this}translate(e,t,i){return Sr.makeTranslation(e,t,i),this.applyMatrix4(Sr),this}scale(e,t,i){return Sr.makeScale(e,t,i),this.applyMatrix4(Sr),this}lookAt(e){return Cg.lookAt(e),Cg.updateMatrix(),this.applyMatrix4(Cg.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Sl).negate(),this.translate(Sl.x,Sl.y,Sl.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new $e(i,3))}else{for(let i=0,r=t.count;i<r;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Vi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new q(-1/0,-1/0,-1/0),new q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];hr.setFromBufferAttribute(s),this.morphTargetsRelative?(on.addVectors(this.boundingBox.min,hr.min),this.boundingBox.expandByPoint(on),on.addVectors(this.boundingBox.max,hr.max),this.boundingBox.expandByPoint(on)):(this.boundingBox.expandByPoint(hr.min),this.boundingBox.expandByPoint(hr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new q,1/0);return}if(e){const i=this.boundingSphere.center;if(hr.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];lh.setFromBufferAttribute(a),this.morphTargetsRelative?(on.addVectors(hr.min,lh.min),hr.expandByPoint(on),on.addVectors(hr.max,lh.max),hr.expandByPoint(on)):(hr.expandByPoint(lh.min),hr.expandByPoint(lh.max))}hr.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)on.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(on));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)on.fromBufferAttribute(a,c),l&&(Sl.fromBufferAttribute(e,c),on.add(Sl)),r=Math.max(r,i.distanceToSquared(on))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Jt(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let L=0;L<i.count;L++)a[L]=new q,l[L]=new q;const c=new q,u=new q,d=new q,p=new xe,g=new xe,_=new xe,x=new q,b=new q;function y(L,P,R){c.fromBufferAttribute(i,L),u.fromBufferAttribute(i,P),d.fromBufferAttribute(i,R),p.fromBufferAttribute(s,L),g.fromBufferAttribute(s,P),_.fromBufferAttribute(s,R),u.sub(c),d.sub(c),g.sub(p),_.sub(p);const U=1/(g.x*_.y-_.x*g.y);isFinite(U)&&(x.copy(u).multiplyScalar(_.y).addScaledVector(d,-g.y).multiplyScalar(U),b.copy(d).multiplyScalar(g.x).addScaledVector(u,-_.x).multiplyScalar(U),a[L].add(x),a[P].add(x),a[R].add(x),l[L].add(b),l[P].add(b),l[R].add(b))}let M=this.groups;M.length===0&&(M=[{start:0,count:e.count}]);for(let L=0,P=M.length;L<P;++L){const R=M[L],U=R.start,j=R.count;for(let A=U,D=U+j;A<D;A+=3)y(e.getX(A+0),e.getX(A+1),e.getX(A+2))}const E=new q,w=new q,I=new q,B=new q;function N(L){I.fromBufferAttribute(r,L),B.copy(I);const P=a[L];E.copy(P),E.sub(I.multiplyScalar(I.dot(P))).normalize(),w.crossVectors(B,P);const U=w.dot(l[L])<0?-1:1;o.setXYZW(L,E.x,E.y,E.z,U)}for(let L=0,P=M.length;L<P;++L){const R=M[L],U=R.start,j=R.count;for(let A=U,D=U+j;A<D;A+=3)N(e.getX(A+0)),N(e.getX(A+1)),N(e.getX(A+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Jt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let p=0,g=i.count;p<g;p++)i.setXYZ(p,0,0,0);const r=new q,s=new q,o=new q,a=new q,l=new q,c=new q,u=new q,d=new q;if(e)for(let p=0,g=e.count;p<g;p+=3){const _=e.getX(p+0),x=e.getX(p+1),b=e.getX(p+2);r.fromBufferAttribute(t,_),s.fromBufferAttribute(t,x),o.fromBufferAttribute(t,b),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),a.fromBufferAttribute(i,_),l.fromBufferAttribute(i,x),c.fromBufferAttribute(i,b),a.add(u),l.add(u),c.add(u),i.setXYZ(_,a.x,a.y,a.z),i.setXYZ(x,l.x,l.y,l.z),i.setXYZ(b,c.x,c.y,c.z)}else for(let p=0,g=t.count;p<g;p+=3)r.fromBufferAttribute(t,p+0),s.fromBufferAttribute(t,p+1),o.fromBufferAttribute(t,p+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(p+0,u.x,u.y,u.z),i.setXYZ(p+1,u.x,u.y,u.z),i.setXYZ(p+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)on.fromBufferAttribute(e,t),on.normalize(),e.setXYZ(t,on.x,on.y,on.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,p=new c.constructor(l.length*u);let g=0,_=0;for(let x=0,b=l.length;x<b;x++){a.isInterleavedBufferAttribute?g=l[x]*a.data.stride+a.offset:g=l[x]*u;for(let y=0;y<u;y++)p[_++]=c[g++]}return new Jt(p,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Tt,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,d=c.length;u<d;u++){const p=c[u],g=e(p,i);l.push(g)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,p=c.length;d<p;d++){const g=c[d];u.push(g.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],d=s[c];for(let p=0,g=d.length;p<g;p++)u.push(d[p].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const zb=new Mt,ha=new ca,Nf=new qi,Hb=new q,Bf=new q,Ff=new q,Uf=new q,Ig=new q,kf=new q,Gb=new q,zf=new q;class pt extends Dt{constructor(e=new Tt,t=new Pi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){kf.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],d=s[l];u!==0&&(Ig.fromBufferAttribute(d,e),o?kf.addScaledVector(Ig,u):kf.addScaledVector(Ig.sub(t),u))}t.add(kf)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Nf.copy(i.boundingSphere),Nf.applyMatrix4(s),ha.copy(e.ray).recast(e.near),!(Nf.containsPoint(ha.origin)===!1&&(ha.intersectSphere(Nf,Hb)===null||ha.origin.distanceToSquared(Hb)>(e.far-e.near)**2))&&(zb.copy(s).invert(),ha.copy(e.ray).applyMatrix4(zb),!(i.boundingBox!==null&&ha.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,ha)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,p=s.groups,g=s.drawRange;if(a!==null)if(Array.isArray(o))for(let _=0,x=p.length;_<x;_++){const b=p[_],y=o[b.materialIndex],M=Math.max(b.start,g.start),E=Math.min(a.count,Math.min(b.start+b.count,g.start+g.count));for(let w=M,I=E;w<I;w+=3){const B=a.getX(w),N=a.getX(w+1),L=a.getX(w+2);r=Hf(this,y,e,i,c,u,d,B,N,L),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=b.materialIndex,t.push(r))}}else{const _=Math.max(0,g.start),x=Math.min(a.count,g.start+g.count);for(let b=_,y=x;b<y;b+=3){const M=a.getX(b),E=a.getX(b+1),w=a.getX(b+2);r=Hf(this,o,e,i,c,u,d,M,E,w),r&&(r.faceIndex=Math.floor(b/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let _=0,x=p.length;_<x;_++){const b=p[_],y=o[b.materialIndex],M=Math.max(b.start,g.start),E=Math.min(l.count,Math.min(b.start+b.count,g.start+g.count));for(let w=M,I=E;w<I;w+=3){const B=w,N=w+1,L=w+2;r=Hf(this,y,e,i,c,u,d,B,N,L),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=b.materialIndex,t.push(r))}}else{const _=Math.max(0,g.start),x=Math.min(l.count,g.start+g.count);for(let b=_,y=x;b<y;b+=3){const M=b,E=b+1,w=b+2;r=Hf(this,o,e,i,c,u,d,M,E,w),r&&(r.faceIndex=Math.floor(b/3),t.push(r))}}}}function _I(n,e,t,i,r,s,o,a){let l;if(e.side===hn?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===br,a),l===null)return null;zf.copy(a),zf.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(zf);return c<t.near||c>t.far?null:{distance:c,point:zf.clone(),object:n}}function Hf(n,e,t,i,r,s,o,a,l,c){n.getVertexPosition(a,Bf),n.getVertexPosition(l,Ff),n.getVertexPosition(c,Uf);const u=_I(n,e,t,i,Bf,Ff,Uf,Gb);if(u){const d=new q;$i.getBarycoord(Gb,Bf,Ff,Uf,d),r&&(u.uv=$i.getInterpolatedAttribute(r,a,l,c,d,new xe)),s&&(u.uv1=$i.getInterpolatedAttribute(s,a,l,c,d,new xe)),o&&(u.normal=$i.getInterpolatedAttribute(o,a,l,c,d,new q),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const p={a,b:l,c,normal:new q,materialIndex:0};$i.getNormal(Bf,Ff,Uf,p.normal),u.face=p,u.barycoord=d}return u}let zr=class q1 extends Tt{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],d=[];let p=0,g=0;_("z","y","x",-1,-1,i,t,e,o,s,0),_("z","y","x",1,-1,i,t,-e,o,s,1),_("x","z","y",1,1,e,i,t,r,o,2),_("x","z","y",1,-1,e,i,-t,r,o,3),_("x","y","z",1,-1,e,t,i,r,s,4),_("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new $e(c,3)),this.setAttribute("normal",new $e(u,3)),this.setAttribute("uv",new $e(d,2));function _(x,b,y,M,E,w,I,B,N,L,P){const R=w/N,U=I/L,j=w/2,A=I/2,D=B/2,k=N+1,G=L+1;let ee=0,J=0;const re=new q;for(let oe=0;oe<G;oe++){const me=oe*U-A;for(let Le=0;Le<k;Le++){const Ge=Le*R-j;re[x]=Ge*M,re[b]=me*E,re[y]=D,c.push(re.x,re.y,re.z),re[x]=0,re[b]=0,re[y]=B>0?1:-1,u.push(re.x,re.y,re.z),d.push(Le/N),d.push(1-oe/L),ee+=1}}for(let oe=0;oe<L;oe++)for(let me=0;me<N;me++){const Le=p+me+k*oe,Ge=p+me+k*(oe+1),pe=p+(me+1)+k*(oe+1),Te=p+(me+1)+k*oe;l.push(Le,Ge,Te),l.push(Ge,pe,Te),J+=6}a.addGroup(g,J,P),g+=J,p+=ee}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new q1(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function El(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function zn(n){const e={};for(let t=0;t<n.length;t++){const i=El(n[t]);for(const r in i)e[r]=i[r]}return e}function vI(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function Vb(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Xt.workingColorSpace}const Tn={clone:El,merge:zn};var yI=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,bI=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class wi extends Ji{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=yI,this.fragmentShader=bI,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=El(e.uniforms),this.uniformsGroups=vI(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Gf extends Dt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Mt,this.projectionMatrix=new Mt,this.projectionMatrixInverse=new Mt,this.coordinateSystem=$r}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const co=new q,Wb=new xe,Xb=new xe;class en extends Gf{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ul*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(sa*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ul*2*Math.atan(Math.tan(sa*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){co.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(co.x,co.y).multiplyScalar(-e/co.z),co.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(co.x,co.y).multiplyScalar(-e/co.z)}getViewSize(e,t){return this.getViewBounds(e,Wb,Xb),t.subVectors(Xb,Wb)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(sa*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Tl=-90,Al=1;class Yb extends Dt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new en(Tl,Al,e,t);r.layers=this.layers,this.add(r);const s=new en(Tl,Al,e,t);s.layers=this.layers,this.add(s);const o=new en(Tl,Al,e,t);o.layers=this.layers,this.add(o);const a=new en(Tl,Al,e,t);a.layers=this.layers,this.add(a);const l=new en(Tl,Al,e,t);l.layers=this.layers,this.add(l);const c=new en(Tl,Al,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===$r)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Jc)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,d=e.getRenderTarget(),p=e.getActiveCubeFace(),g=e.getActiveMipmapLevel(),_=e.xr.enabled;e.xr.enabled=!1;const x=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,o),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,c),i.texture.generateMipmaps=x,e.setRenderTarget(i,5,r),e.render(t,u),e.setRenderTarget(d,p,g),e.xr.enabled=_,i.texture.needsPMREMUpdate=!0}}class ch extends yi{constructor(e,t,i,r,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:Ts,super(e,t,i,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class jb extends ji{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new ch(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ei}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new zr(5,5,5),s=new wi({name:"CubemapFromEquirect",uniforms:El(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:hn,blending:Qr});s.uniforms.tEquirect.value=t;const o=new pt(r,s),a=t.minFilter;return t.minFilter===wr&&(t.minFilter=Ei),new Yb(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}const Pg=new q,xI=new q,wI=new kt;let es=class{constructor(e=new q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Pg.subVectors(i,t).cross(xI.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Pg),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||wI.getNormalMatrix(e),r=this.coplanarPoint(Pg).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const ua=new qi,Vf=new q;class fa{constructor(e=new es,t=new es,i=new es,r=new es,s=new es,o=new es){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=$r){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],d=r[6],p=r[7],g=r[8],_=r[9],x=r[10],b=r[11],y=r[12],M=r[13],E=r[14],w=r[15];if(i[0].setComponents(l-s,p-c,b-g,w-y).normalize(),i[1].setComponents(l+s,p+c,b+g,w+y).normalize(),i[2].setComponents(l+o,p+u,b+_,w+M).normalize(),i[3].setComponents(l-o,p-u,b-_,w-M).normalize(),i[4].setComponents(l-a,p-d,b-x,w-E).normalize(),t===$r)i[5].setComponents(l+a,p+d,b+x,w+E).normalize();else if(t===Jc)i[5].setComponents(a,d,x,E).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ua.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ua.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ua)}intersectsSprite(e){return ua.center.set(0,0,0),ua.radius=.7071067811865476,ua.applyMatrix4(e.matrixWorld),this.intersectsSphere(ua)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(Vf.x=r.normal.x>0?e.max.x:e.min.x,Vf.y=r.normal.y>0?e.max.y:e.min.y,Vf.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Vf)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function qb(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function SI(n){const e=new WeakMap;function t(a,l){const c=a.array,u=a.usage,d=c.byteLength,p=n.createBuffer();n.bindBuffer(l,p),n.bufferData(l,c,u),a.onUploadCallback();let g;if(c instanceof Float32Array)g=n.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?g=n.HALF_FLOAT:g=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)g=n.SHORT;else if(c instanceof Uint32Array)g=n.UNSIGNED_INT;else if(c instanceof Int32Array)g=n.INT;else if(c instanceof Int8Array)g=n.BYTE;else if(c instanceof Uint8Array)g=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)g=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:p,type:g,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:d}}function i(a,l,c){const u=l.array,d=l.updateRanges;if(n.bindBuffer(c,a),d.length===0)n.bufferSubData(c,0,u);else{d.sort((g,_)=>g.start-_.start);let p=0;for(let g=1;g<d.length;g++){const _=d[p],x=d[g];x.start<=_.start+_.count+1?_.count=Math.max(_.count,x.start+x.count-_.start):(++p,d[p]=x)}d.length=p+1;for(let g=0,_=d.length;g<_;g++){const x=d[g];n.bufferSubData(c,x.start*u.BYTES_PER_ELEMENT,u,x.start,x.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:r,remove:s,update:o}}class Er extends Tt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,u=l+1,d=e/a,p=t/l,g=[],_=[],x=[],b=[];for(let y=0;y<u;y++){const M=y*p-o;for(let E=0;E<c;E++){const w=E*d-s;_.push(w,-M,0),x.push(0,0,1),b.push(E/a),b.push(1-y/l)}}for(let y=0;y<l;y++)for(let M=0;M<a;M++){const E=M+c*y,w=M+c*(y+1),I=M+1+c*(y+1),B=M+1+c*y;g.push(E,w,B),g.push(w,I,B)}this.setIndex(g),this.setAttribute("position",new $e(_,3)),this.setAttribute("normal",new $e(x,3)),this.setAttribute("uv",new $e(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Er(e.width,e.height,e.widthSegments,e.heightSegments)}}var EI=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,TI=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,AI=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,MI=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,CI=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,II=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,PI=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,RI=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,DI=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,LI=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,OI=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,NI=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,BI=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,FI=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,UI=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,kI=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,zI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,HI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,GI=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,VI=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,WI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,XI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,YI=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,jI=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,qI=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,ZI=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,KI=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,QI=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,$I=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,JI=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,eP="gl_FragColor = linearToOutputTexel( gl_FragColor );",tP=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,iP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,nP=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,rP=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,sP=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,oP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,aP=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,lP=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,cP=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,hP=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,uP=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,fP=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,dP=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,pP=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,mP=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,gP=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,_P=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,vP=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,yP=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,bP=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,xP=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,wP=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,SP=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,EP=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,TP=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,AP=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,MP=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,CP=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,IP=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,PP=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,RP=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,DP=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,LP=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,OP=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,NP=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,BP=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,FP=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,UP=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,kP=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,zP=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,HP=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,GP=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,VP=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,WP=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,XP=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,YP=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,jP=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,qP=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,ZP=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,KP=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,QP=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,$P=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,JP=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,eR=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,tR=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,iR=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,nR=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,rR=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,sR=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,oR=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,aR=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,lR=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,cR=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,hR=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,uR=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,fR=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,dR=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,pR=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,mR=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,gR=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,_R=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,vR=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,yR=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bR=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,xR=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,wR=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Ft={alphahash_fragment:EI,alphahash_pars_fragment:TI,alphamap_fragment:AI,alphamap_pars_fragment:MI,alphatest_fragment:CI,alphatest_pars_fragment:II,aomap_fragment:PI,aomap_pars_fragment:RI,batching_pars_vertex:DI,batching_vertex:LI,begin_vertex:OI,beginnormal_vertex:NI,bsdfs:BI,iridescence_fragment:FI,bumpmap_pars_fragment:UI,clipping_planes_fragment:kI,clipping_planes_pars_fragment:zI,clipping_planes_pars_vertex:HI,clipping_planes_vertex:GI,color_fragment:VI,color_pars_fragment:WI,color_pars_vertex:XI,color_vertex:YI,common:jI,cube_uv_reflection_fragment:qI,defaultnormal_vertex:ZI,displacementmap_pars_vertex:KI,displacementmap_vertex:QI,emissivemap_fragment:$I,emissivemap_pars_fragment:JI,colorspace_fragment:eP,colorspace_pars_fragment:tP,envmap_fragment:iP,envmap_common_pars_fragment:nP,envmap_pars_fragment:rP,envmap_pars_vertex:sP,envmap_physical_pars_fragment:gP,envmap_vertex:oP,fog_vertex:aP,fog_pars_vertex:lP,fog_fragment:cP,fog_pars_fragment:hP,gradientmap_pars_fragment:uP,lightmap_pars_fragment:fP,lights_lambert_fragment:dP,lights_lambert_pars_fragment:pP,lights_pars_begin:mP,lights_toon_fragment:_P,lights_toon_pars_fragment:vP,lights_phong_fragment:yP,lights_phong_pars_fragment:bP,lights_physical_fragment:xP,lights_physical_pars_fragment:wP,lights_fragment_begin:SP,lights_fragment_maps:EP,lights_fragment_end:TP,logdepthbuf_fragment:AP,logdepthbuf_pars_fragment:MP,logdepthbuf_pars_vertex:CP,logdepthbuf_vertex:IP,map_fragment:PP,map_pars_fragment:RP,map_particle_fragment:DP,map_particle_pars_fragment:LP,metalnessmap_fragment:OP,metalnessmap_pars_fragment:NP,morphinstance_vertex:BP,morphcolor_vertex:FP,morphnormal_vertex:UP,morphtarget_pars_vertex:kP,morphtarget_vertex:zP,normal_fragment_begin:HP,normal_fragment_maps:GP,normal_pars_fragment:VP,normal_pars_vertex:WP,normal_vertex:XP,normalmap_pars_fragment:YP,clearcoat_normal_fragment_begin:jP,clearcoat_normal_fragment_maps:qP,clearcoat_pars_fragment:ZP,iridescence_pars_fragment:KP,opaque_fragment:QP,packing:$P,premultiplied_alpha_fragment:JP,project_vertex:eR,dithering_fragment:tR,dithering_pars_fragment:iR,roughnessmap_fragment:nR,roughnessmap_pars_fragment:rR,shadowmap_pars_fragment:sR,shadowmap_pars_vertex:oR,shadowmap_vertex:aR,shadowmask_pars_fragment:lR,skinbase_vertex:cR,skinning_pars_vertex:hR,skinning_vertex:uR,skinnormal_vertex:fR,specularmap_fragment:dR,specularmap_pars_fragment:pR,tonemapping_fragment:mR,tonemapping_pars_fragment:gR,transmission_fragment:_R,transmission_pars_fragment:vR,uv_pars_fragment:yR,uv_pars_vertex:bR,uv_vertex:xR,worldpos_vertex:wR,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},He={common:{diffuse:{value:new ve(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new kt},alphaMap:{value:null},alphaMapTransform:{value:new kt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new kt}},envmap:{envMap:{value:null},envMapRotation:{value:new kt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new kt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new kt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new kt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new kt},normalScale:{value:new xe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new kt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new kt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new kt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new kt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ve(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ve(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new kt},alphaTest:{value:0},uvTransform:{value:new kt}},sprite:{diffuse:{value:new ve(16777215)},opacity:{value:1},center:{value:new xe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new kt},alphaMap:{value:null},alphaMapTransform:{value:new kt},alphaTest:{value:0}}},Ni={basic:{uniforms:zn([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.fog]),vertexShader:Ft.meshbasic_vert,fragmentShader:Ft.meshbasic_frag},lambert:{uniforms:zn([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new ve(0)}}]),vertexShader:Ft.meshlambert_vert,fragmentShader:Ft.meshlambert_frag},phong:{uniforms:zn([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new ve(0)},specular:{value:new ve(1118481)},shininess:{value:30}}]),vertexShader:Ft.meshphong_vert,fragmentShader:Ft.meshphong_frag},standard:{uniforms:zn([He.common,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.roughnessmap,He.metalnessmap,He.fog,He.lights,{emissive:{value:new ve(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag},toon:{uniforms:zn([He.common,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.gradientmap,He.fog,He.lights,{emissive:{value:new ve(0)}}]),vertexShader:Ft.meshtoon_vert,fragmentShader:Ft.meshtoon_frag},matcap:{uniforms:zn([He.common,He.bumpmap,He.normalmap,He.displacementmap,He.fog,{matcap:{value:null}}]),vertexShader:Ft.meshmatcap_vert,fragmentShader:Ft.meshmatcap_frag},points:{uniforms:zn([He.points,He.fog]),vertexShader:Ft.points_vert,fragmentShader:Ft.points_frag},dashed:{uniforms:zn([He.common,He.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ft.linedashed_vert,fragmentShader:Ft.linedashed_frag},depth:{uniforms:zn([He.common,He.displacementmap]),vertexShader:Ft.depth_vert,fragmentShader:Ft.depth_frag},normal:{uniforms:zn([He.common,He.bumpmap,He.normalmap,He.displacementmap,{opacity:{value:1}}]),vertexShader:Ft.meshnormal_vert,fragmentShader:Ft.meshnormal_frag},sprite:{uniforms:zn([He.sprite,He.fog]),vertexShader:Ft.sprite_vert,fragmentShader:Ft.sprite_frag},background:{uniforms:{uvTransform:{value:new kt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ft.background_vert,fragmentShader:Ft.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new kt}},vertexShader:Ft.backgroundCube_vert,fragmentShader:Ft.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ft.cube_vert,fragmentShader:Ft.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ft.equirect_vert,fragmentShader:Ft.equirect_frag},distanceRGBA:{uniforms:zn([He.common,He.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ft.distanceRGBA_vert,fragmentShader:Ft.distanceRGBA_frag},shadow:{uniforms:zn([He.lights,He.fog,{color:{value:new ve(0)},opacity:{value:1}}]),vertexShader:Ft.shadow_vert,fragmentShader:Ft.shadow_frag}};Ni.physical={uniforms:zn([Ni.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new kt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new kt},clearcoatNormalScale:{value:new xe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new kt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new kt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new kt},sheen:{value:0},sheenColor:{value:new ve(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new kt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new kt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new kt},transmissionSamplerSize:{value:new xe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new kt},attenuationDistance:{value:0},attenuationColor:{value:new ve(0)},specularColor:{value:new ve(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new kt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new kt},anisotropyVector:{value:new xe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new kt}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag};const Wf={r:0,b:0,g:0},da=new Oi,SR=new Mt;function ER(n,e,t,i,r,s,o){const a=new ve(0);let l=s===!0?0:1,c,u,d=null,p=0,g=null;function _(M){let E=M.isScene===!0?M.background:null;return E&&E.isTexture&&(E=(M.backgroundBlurriness>0?t:e).get(E)),E}function x(M){let E=!1;const w=_(M);w===null?y(a,l):w&&w.isColor&&(y(w,1),E=!0);const I=n.xr.getEnvironmentBlendMode();I==="additive"?i.buffers.color.setClear(0,0,0,1,o):I==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||E)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function b(M,E){const w=_(E);w&&(w.isCubeTexture||w.mapping===ol)?(u===void 0&&(u=new pt(new zr(1,1,1),new wi({name:"BackgroundCubeMaterial",uniforms:El(Ni.backgroundCube.uniforms),vertexShader:Ni.backgroundCube.vertexShader,fragmentShader:Ni.backgroundCube.fragmentShader,side:hn,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(I,B,N){this.matrixWorld.copyPosition(N.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),da.copy(E.backgroundRotation),da.x*=-1,da.y*=-1,da.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(da.y*=-1,da.z*=-1),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(SR.makeRotationFromEuler(da)),u.material.toneMapped=Xt.getTransfer(w.colorSpace)!==mi,(d!==w||p!==w.version||g!==n.toneMapping)&&(u.material.needsUpdate=!0,d=w,p=w.version,g=n.toneMapping),u.layers.enableAll(),M.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(c===void 0&&(c=new pt(new Er(2,2),new wi({name:"BackgroundMaterial",uniforms:El(Ni.background.uniforms),vertexShader:Ni.background.vertexShader,fragmentShader:Ni.background.fragmentShader,side:br,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=w,c.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,c.material.toneMapped=Xt.getTransfer(w.colorSpace)!==mi,w.matrixAutoUpdate===!0&&w.updateMatrix(),c.material.uniforms.uvTransform.value.copy(w.matrix),(d!==w||p!==w.version||g!==n.toneMapping)&&(c.material.needsUpdate=!0,d=w,p=w.version,g=n.toneMapping),c.layers.enableAll(),M.unshift(c,c.geometry,c.material,0,0,null))}function y(M,E){M.getRGB(Wf,Vb(n)),i.buffers.color.setClear(Wf.r,Wf.g,Wf.b,E,o)}return{getClearColor:function(){return a},setClearColor:function(M,E=1){a.set(M),l=E,y(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(M){l=M,y(a,l)},render:x,addToRenderList:b}}function TR(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=p(null);let s=r,o=!1;function a(R,U,j,A,D){let k=!1;const G=d(A,j,U);s!==G&&(s=G,c(s.object)),k=g(R,A,j,D),k&&_(R,A,j,D),D!==null&&e.update(D,n.ELEMENT_ARRAY_BUFFER),(k||o)&&(o=!1,w(R,U,j,A),D!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(D).buffer))}function l(){return n.createVertexArray()}function c(R){return n.bindVertexArray(R)}function u(R){return n.deleteVertexArray(R)}function d(R,U,j){const A=j.wireframe===!0;let D=i[R.id];D===void 0&&(D={},i[R.id]=D);let k=D[U.id];k===void 0&&(k={},D[U.id]=k);let G=k[A];return G===void 0&&(G=p(l()),k[A]=G),G}function p(R){const U=[],j=[],A=[];for(let D=0;D<t;D++)U[D]=0,j[D]=0,A[D]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:j,attributeDivisors:A,object:R,attributes:{},index:null}}function g(R,U,j,A){const D=s.attributes,k=U.attributes;let G=0;const ee=j.getAttributes();for(const J in ee)if(ee[J].location>=0){const oe=D[J];let me=k[J];if(me===void 0&&(J==="instanceMatrix"&&R.instanceMatrix&&(me=R.instanceMatrix),J==="instanceColor"&&R.instanceColor&&(me=R.instanceColor)),oe===void 0||oe.attribute!==me||me&&oe.data!==me.data)return!0;G++}return s.attributesNum!==G||s.index!==A}function _(R,U,j,A){const D={},k=U.attributes;let G=0;const ee=j.getAttributes();for(const J in ee)if(ee[J].location>=0){let oe=k[J];oe===void 0&&(J==="instanceMatrix"&&R.instanceMatrix&&(oe=R.instanceMatrix),J==="instanceColor"&&R.instanceColor&&(oe=R.instanceColor));const me={};me.attribute=oe,oe&&oe.data&&(me.data=oe.data),D[J]=me,G++}s.attributes=D,s.attributesNum=G,s.index=A}function x(){const R=s.newAttributes;for(let U=0,j=R.length;U<j;U++)R[U]=0}function b(R){y(R,0)}function y(R,U){const j=s.newAttributes,A=s.enabledAttributes,D=s.attributeDivisors;j[R]=1,A[R]===0&&(n.enableVertexAttribArray(R),A[R]=1),D[R]!==U&&(n.vertexAttribDivisor(R,U),D[R]=U)}function M(){const R=s.newAttributes,U=s.enabledAttributes;for(let j=0,A=U.length;j<A;j++)U[j]!==R[j]&&(n.disableVertexAttribArray(j),U[j]=0)}function E(R,U,j,A,D,k,G){G===!0?n.vertexAttribIPointer(R,U,j,D,k):n.vertexAttribPointer(R,U,j,A,D,k)}function w(R,U,j,A){x();const D=A.attributes,k=j.getAttributes(),G=U.defaultAttributeValues;for(const ee in k){const J=k[ee];if(J.location>=0){let re=D[ee];if(re===void 0&&(ee==="instanceMatrix"&&R.instanceMatrix&&(re=R.instanceMatrix),ee==="instanceColor"&&R.instanceColor&&(re=R.instanceColor)),re!==void 0){const oe=re.normalized,me=re.itemSize,Le=e.get(re);if(Le===void 0)continue;const Ge=Le.buffer,pe=Le.type,Te=Le.bytesPerElement,ke=pe===n.INT||pe===n.UNSIGNED_INT||re.gpuType===Hu;if(re.isInterleavedBufferAttribute){const De=re.data,Je=De.stride,lt=re.offset;if(De.isInstancedInterleavedBuffer){for(let rt=0;rt<J.locationSize;rt++)y(J.location+rt,De.meshPerAttribute);R.isInstancedMesh!==!0&&A._maxInstanceCount===void 0&&(A._maxInstanceCount=De.meshPerAttribute*De.count)}else for(let rt=0;rt<J.locationSize;rt++)b(J.location+rt);n.bindBuffer(n.ARRAY_BUFFER,Ge);for(let rt=0;rt<J.locationSize;rt++)E(J.location+rt,me/J.locationSize,pe,oe,Je*Te,(lt+me/J.locationSize*rt)*Te,ke)}else{if(re.isInstancedBufferAttribute){for(let De=0;De<J.locationSize;De++)y(J.location+De,re.meshPerAttribute);R.isInstancedMesh!==!0&&A._maxInstanceCount===void 0&&(A._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let De=0;De<J.locationSize;De++)b(J.location+De);n.bindBuffer(n.ARRAY_BUFFER,Ge);for(let De=0;De<J.locationSize;De++)E(J.location+De,me/J.locationSize,pe,oe,me*Te,me/J.locationSize*De*Te,ke)}}else if(G!==void 0){const oe=G[ee];if(oe!==void 0)switch(oe.length){case 2:n.vertexAttrib2fv(J.location,oe);break;case 3:n.vertexAttrib3fv(J.location,oe);break;case 4:n.vertexAttrib4fv(J.location,oe);break;default:n.vertexAttrib1fv(J.location,oe)}}}}M()}function I(){L();for(const R in i){const U=i[R];for(const j in U){const A=U[j];for(const D in A)u(A[D].object),delete A[D];delete U[j]}delete i[R]}}function B(R){if(i[R.id]===void 0)return;const U=i[R.id];for(const j in U){const A=U[j];for(const D in A)u(A[D].object),delete A[D];delete U[j]}delete i[R.id]}function N(R){for(const U in i){const j=i[U];if(j[R.id]===void 0)continue;const A=j[R.id];for(const D in A)u(A[D].object),delete A[D];delete j[R.id]}}function L(){P(),o=!0,s!==r&&(s=r,c(s.object))}function P(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:L,resetDefaultState:P,dispose:I,releaseStatesOfGeometry:B,releaseStatesOfProgram:N,initAttributes:x,enableAttribute:b,disableUnusedAttributes:M}}function AR(n,e,t){let i;function r(c){i=c}function s(c,u){n.drawArrays(i,c,u),t.update(u,i,1)}function o(c,u,d){d!==0&&(n.drawArraysInstanced(i,c,u,d),t.update(u,i,d))}function a(c,u,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,u,0,d);let g=0;for(let _=0;_<d;_++)g+=u[_];t.update(g,i,1)}function l(c,u,d,p){if(d===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let _=0;_<c.length;_++)o(c[_],u[_],p[_]);else{g.multiDrawArraysInstancedWEBGL(i,c,0,u,0,p,0,d);let _=0;for(let x=0;x<d;x++)_+=u[x]*p[x];t.update(_,i,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function MR(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const N=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(N.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(N){return!(N!==Ti&&i.convert(N)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(N){const L=N===er&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(N!==ar&&i.convert(N)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&N!==Ii&&!L)}function l(N){if(N==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";N="mediump"}return N==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const d=t.logarithmicDepthBuffer===!0,p=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),g=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=n.getParameter(n.MAX_TEXTURE_SIZE),b=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),y=n.getParameter(n.MAX_VERTEX_ATTRIBS),M=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),E=n.getParameter(n.MAX_VARYING_VECTORS),w=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),I=_>0,B=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:d,reverseDepthBuffer:p,maxTextures:g,maxVertexTextures:_,maxTextureSize:x,maxCubemapSize:b,maxAttributes:y,maxVertexUniforms:M,maxVaryings:E,maxFragmentUniforms:w,vertexTextures:I,maxSamples:B}}function CR(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new es,a=new kt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,p){const g=d.length!==0||p||i!==0||r;return r=p,i=d.length,g},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,p){t=u(d,p,0)},this.setState=function(d,p,g){const _=d.clippingPlanes,x=d.clipIntersection,b=d.clipShadows,y=n.get(d);if(!r||_===null||_.length===0||s&&!b)s?u(null):c();else{const M=s?0:i,E=M*4;let w=y.clippingState||null;l.value=w,w=u(_,p,E,g);for(let I=0;I!==E;++I)w[I]=t[I];y.clippingState=w,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=M}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(d,p,g,_){const x=d!==null?d.length:0;let b=null;if(x!==0){if(b=l.value,_!==!0||b===null){const y=g+x*4,M=p.matrixWorldInverse;a.getNormalMatrix(M),(b===null||b.length<y)&&(b=new Float32Array(y));for(let E=0,w=g;E!==x;++E,w+=4)o.copy(d[E]).applyMatrix4(M,a),o.normal.toArray(b,w),b[w+3]=o.constant}l.value=b,l.needsUpdate=!0}return e.numPlanes=x,e.numIntersection=0,b}}function IR(n){let e=new WeakMap;function t(o,a){return a===sl?o.mapping=Ts:a===Wc&&(o.mapping=to),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===sl||a===Wc)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new jb(l.height);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class Ns extends Gf{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Ml=4,Zb=[.125,.215,.35,.446,.526,.582],pa=20,Rg=new Ns,Kb=new ve;let Dg=null,Lg=0,Og=0,Ng=!1;const ma=(1+Math.sqrt(5))/2,Cl=1/ma,Qb=[new q(-ma,Cl,0),new q(ma,Cl,0),new q(-Cl,0,ma),new q(Cl,0,ma),new q(0,ma,-Cl),new q(0,ma,Cl),new q(-1,1,-1),new q(1,1,-1),new q(-1,1,1),new q(1,1,1)];class Bg{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){Dg=this._renderer.getRenderTarget(),Lg=this._renderer.getActiveCubeFace(),Og=this._renderer.getActiveMipmapLevel(),Ng=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=ex(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Jb(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Dg,Lg,Og),this._renderer.xr.enabled=Ng,e.scissorTest=!1,Xf(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ts||e.mapping===to?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Dg=this._renderer.getRenderTarget(),Lg=this._renderer.getActiveCubeFace(),Og=this._renderer.getActiveMipmapLevel(),Ng=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Ei,minFilter:Ei,generateMipmaps:!1,type:er,format:Ti,colorSpace:sn,depthBuffer:!1},r=$b(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=$b(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=PR(s)),this._blurMaterial=RR(s,e,t)}return r}_compileMaterial(e){const t=new pt(this._lodPlanes[0],e);this._renderer.compile(t,Rg)}_sceneToCubeUV(e,t,i,r){const a=new en(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,p=u.toneMapping;u.getClearColor(Kb),u.toneMapping=xr,u.autoClear=!1;const g=new Pi({name:"PMREM.Background",side:hn,depthWrite:!1,depthTest:!1}),_=new pt(new zr,g);let x=!1;const b=e.background;b?b.isColor&&(g.color.copy(b),e.background=null,x=!0):(g.color.copy(Kb),x=!0);for(let y=0;y<6;y++){const M=y%3;M===0?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):M===1?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const E=this._cubeSize;Xf(r,M*E,y>2?E:0,E,E),u.setRenderTarget(r),x&&u.render(_,a),u.render(e,a)}_.geometry.dispose(),_.material.dispose(),u.toneMapping=p,u.autoClear=d,e.background=b}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Ts||e.mapping===to;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=ex()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Jb());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new pt(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Xf(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Rg)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=Qb[(r-s-1)%Qb.length];this._blur(e,s-1,s,o,a)}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new pt(this._lodPlanes[r],c),p=c.uniforms,g=this._sizeLods[i]-1,_=isFinite(s)?Math.PI/(2*g):2*Math.PI/(2*pa-1),x=s/_,b=isFinite(s)?1+Math.floor(u*x):pa;b>pa&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${pa}`);const y=[];let M=0;for(let N=0;N<pa;++N){const L=N/x,P=Math.exp(-L*L/2);y.push(P),N===0?M+=P:N<b&&(M+=2*P)}for(let N=0;N<y.length;N++)y[N]=y[N]/M;p.envMap.value=e.texture,p.samples.value=b,p.weights.value=y,p.latitudinal.value=o==="latitudinal",a&&(p.poleAxis.value=a);const{_lodMax:E}=this;p.dTheta.value=_,p.mipInt.value=E-i;const w=this._sizeLods[r],I=3*w*(r>E-Ml?r-E+Ml:0),B=4*(this._cubeSize-w);Xf(t,I,B,3*w,2*w),l.setRenderTarget(t),l.render(d,Rg)}}function PR(n){const e=[],t=[],i=[];let r=n;const s=n-Ml+1+Zb.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-Ml?l=Zb[o-n+Ml-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),u=-c,d=1+c,p=[u,u,d,u,d,d,u,u,d,d,u,d],g=6,_=6,x=3,b=2,y=1,M=new Float32Array(x*_*g),E=new Float32Array(b*_*g),w=new Float32Array(y*_*g);for(let B=0;B<g;B++){const N=B%3*2/3-1,L=B>2?0:-1,P=[N,L,0,N+2/3,L,0,N+2/3,L+1,0,N,L,0,N+2/3,L+1,0,N,L+1,0];M.set(P,x*_*B),E.set(p,b*_*B);const R=[B,B,B,B,B,B];w.set(R,y*_*B)}const I=new Tt;I.setAttribute("position",new Jt(M,x)),I.setAttribute("uv",new Jt(E,b)),I.setAttribute("faceIndex",new Jt(w,y)),e.push(I),r>Ml&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function $b(n,e,t){const i=new ji(n,e,t);return i.texture.mapping=ol,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Xf(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function RR(n,e,t){const i=new Float32Array(pa),r=new q(0,1,0);return new wi({name:"SphericalGaussianBlur",defines:{n:pa,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Fg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function Jb(){return new wi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Fg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function ex(){return new wi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Fg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Qr,depthTest:!1,depthWrite:!1})}function Fg(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function DR(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===sl||l===Wc,u=l===Ts||l===to;if(c||u){let d=e.get(a);const p=d!==void 0?d.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==p)return t===null&&(t=new Bg(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(d!==void 0)return d.texture;{const g=a.image;return c&&g&&g.height>0||u&&g&&r(g)?(t===null&&(t=new Bg(n)),d=c?t.fromEquirectangular(a):t.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",s),d.texture):null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function LR(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&ih("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function OR(n,e,t,i){const r={},s=new WeakMap;function o(d){const p=d.target;p.index!==null&&e.remove(p.index);for(const _ in p.attributes)e.remove(p.attributes[_]);for(const _ in p.morphAttributes){const x=p.morphAttributes[_];for(let b=0,y=x.length;b<y;b++)e.remove(x[b])}p.removeEventListener("dispose",o),delete r[p.id];const g=s.get(p);g&&(e.remove(g),s.delete(p)),i.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,t.memory.geometries--}function a(d,p){return r[p.id]===!0||(p.addEventListener("dispose",o),r[p.id]=!0,t.memory.geometries++),p}function l(d){const p=d.attributes;for(const _ in p)e.update(p[_],n.ARRAY_BUFFER);const g=d.morphAttributes;for(const _ in g){const x=g[_];for(let b=0,y=x.length;b<y;b++)e.update(x[b],n.ARRAY_BUFFER)}}function c(d){const p=[],g=d.index,_=d.attributes.position;let x=0;if(g!==null){const M=g.array;x=g.version;for(let E=0,w=M.length;E<w;E+=3){const I=M[E+0],B=M[E+1],N=M[E+2];p.push(I,B,B,N,N,I)}}else if(_!==void 0){const M=_.array;x=_.version;for(let E=0,w=M.length/3-1;E<w;E+=3){const I=E+0,B=E+1,N=E+2;p.push(I,B,B,N,N,I)}}else return;const b=new(bb(p)?Mg:Ag)(p,1);b.version=x;const y=s.get(d);y&&e.remove(y),s.set(d,b)}function u(d){const p=s.get(d);if(p){const g=d.index;g!==null&&p.version<g.version&&c(d)}else c(d);return s.get(d)}return{get:a,update:l,getWireframeAttribute:u}}function NR(n,e,t){let i;function r(p){i=p}let s,o;function a(p){s=p.type,o=p.bytesPerElement}function l(p,g){n.drawElements(i,g,s,p*o),t.update(g,i,1)}function c(p,g,_){_!==0&&(n.drawElementsInstanced(i,g,s,p*o,_),t.update(g,i,_))}function u(p,g,_){if(_===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,g,0,s,p,0,_);let b=0;for(let y=0;y<_;y++)b+=g[y];t.update(b,i,1)}function d(p,g,_,x){if(_===0)return;const b=e.get("WEBGL_multi_draw");if(b===null)for(let y=0;y<p.length;y++)c(p[y]/o,g[y],x[y]);else{b.multiDrawElementsInstancedWEBGL(i,g,0,s,p,0,x,0,_);let y=0;for(let M=0;M<_;M++)y+=g[M]*x[M];t.update(y,i,1)}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=d}function BR(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function FR(n,e,t){const i=new WeakMap,r=new Gt;function s(o,a,l){const c=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=u!==void 0?u.length:0;let p=i.get(a);if(p===void 0||p.count!==d){let P=function(){N.dispose(),i.delete(a),a.removeEventListener("dispose",P)};p!==void 0&&p.texture.dispose();const g=a.morphAttributes.position!==void 0,_=a.morphAttributes.normal!==void 0,x=a.morphAttributes.color!==void 0,b=a.morphAttributes.position||[],y=a.morphAttributes.normal||[],M=a.morphAttributes.color||[];let E=0;g===!0&&(E=1),_===!0&&(E=2),x===!0&&(E=3);let w=a.attributes.position.count*E,I=1;w>e.maxTextureSize&&(I=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const B=new Float32Array(w*I*4*d),N=new Ef(B,w,I,d);N.type=Ii,N.needsUpdate=!0;const L=E*4;for(let R=0;R<d;R++){const U=b[R],j=y[R],A=M[R],D=w*I*4*R;for(let k=0;k<U.count;k++){const G=k*L;g===!0&&(r.fromBufferAttribute(U,k),B[D+G+0]=r.x,B[D+G+1]=r.y,B[D+G+2]=r.z,B[D+G+3]=0),_===!0&&(r.fromBufferAttribute(j,k),B[D+G+4]=r.x,B[D+G+5]=r.y,B[D+G+6]=r.z,B[D+G+7]=0),x===!0&&(r.fromBufferAttribute(A,k),B[D+G+8]=r.x,B[D+G+9]=r.y,B[D+G+10]=r.z,B[D+G+11]=A.itemSize===4?r.w:1)}}p={count:d,texture:N,size:new xe(w,I)},i.set(a,p),a.addEventListener("dispose",P)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let g=0;for(let x=0;x<c.length;x++)g+=c[x];const _=a.morphTargetsRelative?1:1-g;l.getUniforms().setValue(n,"morphTargetBaseInfluence",_),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",p.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",p.size)}return{update:s}}function UR(n,e,t,i){let r=new WeakMap;function s(l){const c=i.render.frame,u=l.geometry,d=e.get(l,u);if(r.get(d)!==c&&(e.update(d),r.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const p=l.skeleton;r.get(p)!==c&&(p.update(),r.set(p,c))}return d}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}class Yf extends yi{constructor(e,t,i,r,s,o,a,l,c,u=no){if(u!==no&&u!==ta)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===no&&(i=As),i===void 0&&u===ta&&(i=ea),super(null,r,s,o,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:xi,this.minFilter=l!==void 0?l:xi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const tx=new yi,ix=new Yf(1,1),nx=new Ef,rx=new hg,sx=new ch,ox=[],ax=[],lx=new Float32Array(16),cx=new Float32Array(9),hx=new Float32Array(4);function Il(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=ox[r];if(s===void 0&&(s=new Float32Array(r),ox[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function tn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function nn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function jf(n,e){let t=ax[e];t===void 0&&(t=new Int32Array(e),ax[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function kR(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function zR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(tn(t,e))return;n.uniform2fv(this.addr,e),nn(t,e)}}function HR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(tn(t,e))return;n.uniform3fv(this.addr,e),nn(t,e)}}function GR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(tn(t,e))return;n.uniform4fv(this.addr,e),nn(t,e)}}function VR(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(tn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),nn(t,e)}else{if(tn(t,i))return;hx.set(i),n.uniformMatrix2fv(this.addr,!1,hx),nn(t,i)}}function WR(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(tn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),nn(t,e)}else{if(tn(t,i))return;cx.set(i),n.uniformMatrix3fv(this.addr,!1,cx),nn(t,i)}}function XR(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(tn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),nn(t,e)}else{if(tn(t,i))return;lx.set(i),n.uniformMatrix4fv(this.addr,!1,lx),nn(t,i)}}function YR(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function jR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(tn(t,e))return;n.uniform2iv(this.addr,e),nn(t,e)}}function qR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(tn(t,e))return;n.uniform3iv(this.addr,e),nn(t,e)}}function ZR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(tn(t,e))return;n.uniform4iv(this.addr,e),nn(t,e)}}function KR(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function QR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(tn(t,e))return;n.uniform2uiv(this.addr,e),nn(t,e)}}function $R(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(tn(t,e))return;n.uniform3uiv(this.addr,e),nn(t,e)}}function JR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(tn(t,e))return;n.uniform4uiv(this.addr,e),nn(t,e)}}function eD(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(ix.compareFunction=og,s=ix):s=tx,t.setTexture2D(e||s,r)}function tD(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||rx,r)}function iD(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||sx,r)}function nD(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||nx,r)}function rD(n){switch(n){case 5126:return kR;case 35664:return zR;case 35665:return HR;case 35666:return GR;case 35674:return VR;case 35675:return WR;case 35676:return XR;case 5124:case 35670:return YR;case 35667:case 35671:return jR;case 35668:case 35672:return qR;case 35669:case 35673:return ZR;case 5125:return KR;case 36294:return QR;case 36295:return $R;case 36296:return JR;case 35678:case 36198:case 36298:case 36306:case 35682:return eD;case 35679:case 36299:case 36307:return tD;case 35680:case 36300:case 36308:case 36293:return iD;case 36289:case 36303:case 36311:case 36292:return nD}}function sD(n,e){n.uniform1fv(this.addr,e)}function oD(n,e){const t=Il(e,this.size,2);n.uniform2fv(this.addr,t)}function aD(n,e){const t=Il(e,this.size,3);n.uniform3fv(this.addr,t)}function lD(n,e){const t=Il(e,this.size,4);n.uniform4fv(this.addr,t)}function cD(n,e){const t=Il(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function hD(n,e){const t=Il(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function uD(n,e){const t=Il(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function fD(n,e){n.uniform1iv(this.addr,e)}function dD(n,e){n.uniform2iv(this.addr,e)}function pD(n,e){n.uniform3iv(this.addr,e)}function mD(n,e){n.uniform4iv(this.addr,e)}function gD(n,e){n.uniform1uiv(this.addr,e)}function _D(n,e){n.uniform2uiv(this.addr,e)}function vD(n,e){n.uniform3uiv(this.addr,e)}function yD(n,e){n.uniform4uiv(this.addr,e)}function bD(n,e,t){const i=this.cache,r=e.length,s=jf(t,r);tn(i,s)||(n.uniform1iv(this.addr,s),nn(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||tx,s[o])}function xD(n,e,t){const i=this.cache,r=e.length,s=jf(t,r);tn(i,s)||(n.uniform1iv(this.addr,s),nn(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||rx,s[o])}function wD(n,e,t){const i=this.cache,r=e.length,s=jf(t,r);tn(i,s)||(n.uniform1iv(this.addr,s),nn(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||sx,s[o])}function SD(n,e,t){const i=this.cache,r=e.length,s=jf(t,r);tn(i,s)||(n.uniform1iv(this.addr,s),nn(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||nx,s[o])}function ED(n){switch(n){case 5126:return sD;case 35664:return oD;case 35665:return aD;case 35666:return lD;case 35674:return cD;case 35675:return hD;case 35676:return uD;case 5124:case 35670:return fD;case 35667:case 35671:return dD;case 35668:case 35672:return pD;case 35669:case 35673:return mD;case 5125:return gD;case 36294:return _D;case 36295:return vD;case 36296:return yD;case 35678:case 36198:case 36298:case 36306:case 35682:return bD;case 35679:case 36299:case 36307:return xD;case 35680:case 36300:case 36308:case 36293:return wD;case 36289:case 36303:case 36311:case 36292:return SD}}class TD{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=rD(t.type)}}class AD{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=ED(t.type)}}class MD{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const Ug=/(\w+)(\])?(\[|\.)?/g;function ux(n,e){n.seq.push(e),n.map[e.id]=e}function CD(n,e,t){const i=n.name,r=i.length;for(Ug.lastIndex=0;;){const s=Ug.exec(i),o=Ug.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){ux(t,c===void 0?new TD(a,n,e):new AD(a,n,e));break}else{let d=t.map[a];d===void 0&&(d=new MD(a),ux(t,d)),t=d}}}class qf{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);CD(s,o,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function fx(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const ID=37297;let PD=0;function RD(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}const dx=new kt;function DD(n){Xt._getMatrix(dx,Xt.workingColorSpace,n);const e=`mat3( ${dx.elements.map(t=>t.toFixed(4))} )`;switch(Xt.getTransfer(n)){case $c:return[e,"LinearTransferOETF"];case mi:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function px(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+RD(n.getShaderSource(e),o)}else return r}function LD(n,e){const t=DD(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function OD(n,e){let t;switch(e){case Uu:t="Linear";break;case Gm:t="Reinhard";break;case Vm:t="Cineon";break;case Vc:t="ACESFilmic";break;case Xm:t="AgX";break;case Ym:t="Neutral";break;case Wm:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Zf=new q;function ND(){Xt.getLuminanceCoefficients(Zf);const n=Zf.x.toFixed(4),e=Zf.y.toFixed(4),t=Zf.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function BD(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(hh).join(`
`)}function FD(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function UD(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function hh(n){return n!==""}function mx(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function gx(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const kD=/^[ \t]*#include +<([\w\d./]+)>/gm;function kg(n){return n.replace(kD,HD)}const zD=new Map;function HD(n,e){let t=Ft[e];if(t===void 0){const i=zD.get(e);if(i!==void 0)t=Ft[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return kg(t)}const GD=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _x(n){return n.replace(GD,VD)}function VD(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function vx(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function WD(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Um?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===By?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Kr&&(e="SHADOWMAP_TYPE_VSM"),e}function XD(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ts:case to:e="ENVMAP_TYPE_CUBE";break;case ol:e="ENVMAP_TYPE_CUBE_UV";break}return e}function YD(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case to:e="ENVMAP_MODE_REFRACTION";break}return e}function jD(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case rl:e="ENVMAP_BLENDING_MULTIPLY";break;case tb:e="ENVMAP_BLENDING_MIX";break;case ib:e="ENVMAP_BLENDING_ADD";break}return e}function qD(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function ZD(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=WD(t),c=XD(t),u=YD(t),d=jD(t),p=qD(t),g=BD(t),_=FD(s),x=r.createProgram();let b,y,M=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(hh).join(`
`),b.length>0&&(b+=`
`),y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(hh).join(`
`),y.length>0&&(y+=`
`)):(b=[vx(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(hh).join(`
`),y=[vx(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==xr?"#define TONE_MAPPING":"",t.toneMapping!==xr?Ft.tonemapping_pars_fragment:"",t.toneMapping!==xr?OD("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ft.colorspace_pars_fragment,LD("linearToOutputTexel",t.outputColorSpace),ND(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(hh).join(`
`)),o=kg(o),o=mx(o,t),o=gx(o,t),a=kg(a),a=mx(a,t),a=gx(a,t),o=_x(o),a=_x(a),t.isRawShaderMaterial!==!0&&(M=`#version 300 es
`,b=[g,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,y=["#define varying in",t.glslVersion===Sf?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Sf?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const E=M+b+o,w=M+y+a,I=fx(r,r.VERTEX_SHADER,E),B=fx(r,r.FRAGMENT_SHADER,w);r.attachShader(x,I),r.attachShader(x,B),t.index0AttributeName!==void 0?r.bindAttribLocation(x,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(x,0,"position"),r.linkProgram(x);function N(U){if(n.debug.checkShaderErrors){const j=r.getProgramInfoLog(x).trim(),A=r.getShaderInfoLog(I).trim(),D=r.getShaderInfoLog(B).trim();let k=!0,G=!0;if(r.getProgramParameter(x,r.LINK_STATUS)===!1)if(k=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,x,I,B);else{const ee=px(r,I,"vertex"),J=px(r,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(x,r.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+j+`
`+ee+`
`+J)}else j!==""?console.warn("THREE.WebGLProgram: Program Info Log:",j):(A===""||D==="")&&(G=!1);G&&(U.diagnostics={runnable:k,programLog:j,vertexShader:{log:A,prefix:b},fragmentShader:{log:D,prefix:y}})}r.deleteShader(I),r.deleteShader(B),L=new qf(r,x),P=UD(r,x)}let L;this.getUniforms=function(){return L===void 0&&N(this),L};let P;this.getAttributes=function(){return P===void 0&&N(this),P};let R=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return R===!1&&(R=r.getProgramParameter(x,ID)),R},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(x),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=PD++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=I,this.fragmentShader=B,this}let KD=0;class QD{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new $D(e),t.set(e,i)),i}}class $D{constructor(e){this.id=KD++,this.code=e,this.usedTimes=0}}function JD(n,e,t,i,r,s,o){const a=new Rf,l=new QD,c=new Set,u=[],d=r.logarithmicDepthBuffer,p=r.vertexTextures;let g=r.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(P){return c.add(P),P===0?"uv":`uv${P}`}function b(P,R,U,j,A){const D=j.fog,k=A.geometry,G=P.isMeshStandardMaterial?j.environment:null,ee=(P.isMeshStandardMaterial?t:e).get(P.envMap||G),J=ee&&ee.mapping===ol?ee.image.height:null,re=_[P.type];P.precision!==null&&(g=r.getMaxPrecision(P.precision),g!==P.precision&&console.warn("THREE.WebGLProgram.getParameters:",P.precision,"not supported, using",g,"instead."));const oe=k.morphAttributes.position||k.morphAttributes.normal||k.morphAttributes.color,me=oe!==void 0?oe.length:0;let Le=0;k.morphAttributes.position!==void 0&&(Le=1),k.morphAttributes.normal!==void 0&&(Le=2),k.morphAttributes.color!==void 0&&(Le=3);let Ge,pe,Te,ke;if(re){const ri=Ni[re];Ge=ri.vertexShader,pe=ri.fragmentShader}else Ge=P.vertexShader,pe=P.fragmentShader,l.update(P),Te=l.getVertexShaderID(P),ke=l.getFragmentShaderID(P);const De=n.getRenderTarget(),Je=n.state.buffers.depth.getReversed(),lt=A.isInstancedMesh===!0,rt=A.isBatchedMesh===!0,_t=!!P.map,Ee=!!P.matcap,Oe=!!ee,Q=!!P.aoMap,Ye=!!P.lightMap,Be=!!P.bumpMap,it=!!P.normalMap,ze=!!P.displacementMap,wt=!!P.emissiveMap,et=!!P.metalnessMap,Z=!!P.roughnessMap,V=P.anisotropy>0,de=P.clearcoat>0,Ae=P.dispersion>0,Re=P.iridescence>0,Ce=P.sheen>0,ut=P.transmission>0,je=V&&!!P.anisotropyMap,tt=de&&!!P.clearcoatMap,Ht=de&&!!P.clearcoatNormalMap,Ue=de&&!!P.clearcoatRoughnessMap,ot=Re&&!!P.iridescenceMap,Et=Re&&!!P.iridescenceThicknessMap,At=Ce&&!!P.sheenColorMap,st=Ce&&!!P.sheenRoughnessMap,Yt=!!P.specularMap,Rt=!!P.specularColorMap,hi=!!P.specularIntensityMap,se=ut&&!!P.transmissionMap,Ve=ut&&!!P.thicknessMap,be=!!P.gradientMap,Ie=!!P.alphaMap,Ke=P.alphaTest>0,Qe=!!P.alphaHash,Nt=!!P.extensions;let Si=xr;P.toneMapped&&(De===null||De.isXRRenderTarget===!0)&&(Si=n.toneMapping);const Qi={shaderID:re,shaderType:P.type,shaderName:P.name,vertexShader:Ge,fragmentShader:pe,defines:P.defines,customVertexShaderID:Te,customFragmentShaderID:ke,isRawShaderMaterial:P.isRawShaderMaterial===!0,glslVersion:P.glslVersion,precision:g,batching:rt,batchingColor:rt&&A._colorsTexture!==null,instancing:lt,instancingColor:lt&&A.instanceColor!==null,instancingMorph:lt&&A.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:De===null?n.outputColorSpace:De.isXRRenderTarget===!0?De.texture.colorSpace:sn,alphaToCoverage:!!P.alphaToCoverage,map:_t,matcap:Ee,envMap:Oe,envMapMode:Oe&&ee.mapping,envMapCubeUVHeight:J,aoMap:Q,lightMap:Ye,bumpMap:Be,normalMap:it,displacementMap:p&&ze,emissiveMap:wt,normalMapObjectSpace:it&&P.normalMapType===hb,normalMapTangentSpace:it&&P.normalMapType===Br,metalnessMap:et,roughnessMap:Z,anisotropy:V,anisotropyMap:je,clearcoat:de,clearcoatMap:tt,clearcoatNormalMap:Ht,clearcoatRoughnessMap:Ue,dispersion:Ae,iridescence:Re,iridescenceMap:ot,iridescenceThicknessMap:Et,sheen:Ce,sheenColorMap:At,sheenRoughnessMap:st,specularMap:Yt,specularColorMap:Rt,specularIntensityMap:hi,transmission:ut,transmissionMap:se,thicknessMap:Ve,gradientMap:be,opaque:P.transparent===!1&&P.blending===Es&&P.alphaToCoverage===!1,alphaMap:Ie,alphaTest:Ke,alphaHash:Qe,combine:P.combine,mapUv:_t&&x(P.map.channel),aoMapUv:Q&&x(P.aoMap.channel),lightMapUv:Ye&&x(P.lightMap.channel),bumpMapUv:Be&&x(P.bumpMap.channel),normalMapUv:it&&x(P.normalMap.channel),displacementMapUv:ze&&x(P.displacementMap.channel),emissiveMapUv:wt&&x(P.emissiveMap.channel),metalnessMapUv:et&&x(P.metalnessMap.channel),roughnessMapUv:Z&&x(P.roughnessMap.channel),anisotropyMapUv:je&&x(P.anisotropyMap.channel),clearcoatMapUv:tt&&x(P.clearcoatMap.channel),clearcoatNormalMapUv:Ht&&x(P.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ue&&x(P.clearcoatRoughnessMap.channel),iridescenceMapUv:ot&&x(P.iridescenceMap.channel),iridescenceThicknessMapUv:Et&&x(P.iridescenceThicknessMap.channel),sheenColorMapUv:At&&x(P.sheenColorMap.channel),sheenRoughnessMapUv:st&&x(P.sheenRoughnessMap.channel),specularMapUv:Yt&&x(P.specularMap.channel),specularColorMapUv:Rt&&x(P.specularColorMap.channel),specularIntensityMapUv:hi&&x(P.specularIntensityMap.channel),transmissionMapUv:se&&x(P.transmissionMap.channel),thicknessMapUv:Ve&&x(P.thicknessMap.channel),alphaMapUv:Ie&&x(P.alphaMap.channel),vertexTangents:!!k.attributes.tangent&&(it||V),vertexColors:P.vertexColors,vertexAlphas:P.vertexColors===!0&&!!k.attributes.color&&k.attributes.color.itemSize===4,pointsUvs:A.isPoints===!0&&!!k.attributes.uv&&(_t||Ie),fog:!!D,useFog:P.fog===!0,fogExp2:!!D&&D.isFogExp2,flatShading:P.flatShading===!0,sizeAttenuation:P.sizeAttenuation===!0,logarithmicDepthBuffer:d,reverseDepthBuffer:Je,skinning:A.isSkinnedMesh===!0,morphTargets:k.morphAttributes.position!==void 0,morphNormals:k.morphAttributes.normal!==void 0,morphColors:k.morphAttributes.color!==void 0,morphTargetsCount:me,morphTextureStride:Le,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:P.dithering,shadowMapEnabled:n.shadowMap.enabled&&U.length>0,shadowMapType:n.shadowMap.type,toneMapping:Si,decodeVideoTexture:_t&&P.map.isVideoTexture===!0&&Xt.getTransfer(P.map.colorSpace)===mi,decodeVideoTextureEmissive:wt&&P.emissiveMap.isVideoTexture===!0&&Xt.getTransfer(P.emissiveMap.colorSpace)===mi,premultipliedAlpha:P.premultipliedAlpha,doubleSided:P.side===Jn,flipSided:P.side===hn,useDepthPacking:P.depthPacking>=0,depthPacking:P.depthPacking||0,index0AttributeName:P.index0AttributeName,extensionClipCullDistance:Nt&&P.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Nt&&P.extensions.multiDraw===!0||rt)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:P.customProgramCacheKey()};return Qi.vertexUv1s=c.has(1),Qi.vertexUv2s=c.has(2),Qi.vertexUv3s=c.has(3),c.clear(),Qi}function y(P){const R=[];if(P.shaderID?R.push(P.shaderID):(R.push(P.customVertexShaderID),R.push(P.customFragmentShaderID)),P.defines!==void 0)for(const U in P.defines)R.push(U),R.push(P.defines[U]);return P.isRawShaderMaterial===!1&&(M(R,P),E(R,P),R.push(n.outputColorSpace)),R.push(P.customProgramCacheKey),R.join()}function M(P,R){P.push(R.precision),P.push(R.outputColorSpace),P.push(R.envMapMode),P.push(R.envMapCubeUVHeight),P.push(R.mapUv),P.push(R.alphaMapUv),P.push(R.lightMapUv),P.push(R.aoMapUv),P.push(R.bumpMapUv),P.push(R.normalMapUv),P.push(R.displacementMapUv),P.push(R.emissiveMapUv),P.push(R.metalnessMapUv),P.push(R.roughnessMapUv),P.push(R.anisotropyMapUv),P.push(R.clearcoatMapUv),P.push(R.clearcoatNormalMapUv),P.push(R.clearcoatRoughnessMapUv),P.push(R.iridescenceMapUv),P.push(R.iridescenceThicknessMapUv),P.push(R.sheenColorMapUv),P.push(R.sheenRoughnessMapUv),P.push(R.specularMapUv),P.push(R.specularColorMapUv),P.push(R.specularIntensityMapUv),P.push(R.transmissionMapUv),P.push(R.thicknessMapUv),P.push(R.combine),P.push(R.fogExp2),P.push(R.sizeAttenuation),P.push(R.morphTargetsCount),P.push(R.morphAttributeCount),P.push(R.numDirLights),P.push(R.numPointLights),P.push(R.numSpotLights),P.push(R.numSpotLightMaps),P.push(R.numHemiLights),P.push(R.numRectAreaLights),P.push(R.numDirLightShadows),P.push(R.numPointLightShadows),P.push(R.numSpotLightShadows),P.push(R.numSpotLightShadowsWithMaps),P.push(R.numLightProbes),P.push(R.shadowMapType),P.push(R.toneMapping),P.push(R.numClippingPlanes),P.push(R.numClipIntersection),P.push(R.depthPacking)}function E(P,R){a.disableAll(),R.supportsVertexTextures&&a.enable(0),R.instancing&&a.enable(1),R.instancingColor&&a.enable(2),R.instancingMorph&&a.enable(3),R.matcap&&a.enable(4),R.envMap&&a.enable(5),R.normalMapObjectSpace&&a.enable(6),R.normalMapTangentSpace&&a.enable(7),R.clearcoat&&a.enable(8),R.iridescence&&a.enable(9),R.alphaTest&&a.enable(10),R.vertexColors&&a.enable(11),R.vertexAlphas&&a.enable(12),R.vertexUv1s&&a.enable(13),R.vertexUv2s&&a.enable(14),R.vertexUv3s&&a.enable(15),R.vertexTangents&&a.enable(16),R.anisotropy&&a.enable(17),R.alphaHash&&a.enable(18),R.batching&&a.enable(19),R.dispersion&&a.enable(20),R.batchingColor&&a.enable(21),P.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.reverseDepthBuffer&&a.enable(4),R.skinning&&a.enable(5),R.morphTargets&&a.enable(6),R.morphNormals&&a.enable(7),R.morphColors&&a.enable(8),R.premultipliedAlpha&&a.enable(9),R.shadowMapEnabled&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.transmission&&a.enable(15),R.sheen&&a.enable(16),R.opaque&&a.enable(17),R.pointsUvs&&a.enable(18),R.decodeVideoTexture&&a.enable(19),R.decodeVideoTextureEmissive&&a.enable(20),R.alphaToCoverage&&a.enable(21),P.push(a.mask)}function w(P){const R=_[P.type];let U;if(R){const j=Ni[R];U=Tn.clone(j.uniforms)}else U=P.uniforms;return U}function I(P,R){let U;for(let j=0,A=u.length;j<A;j++){const D=u[j];if(D.cacheKey===R){U=D,++U.usedTimes;break}}return U===void 0&&(U=new ZD(n,R,P,s),u.push(U)),U}function B(P){if(--P.usedTimes===0){const R=u.indexOf(P);u[R]=u[u.length-1],u.pop(),P.destroy()}}function N(P){l.remove(P)}function L(){l.dispose()}return{getParameters:b,getProgramCacheKey:y,getUniforms:w,acquireProgram:I,releaseProgram:B,releaseShaderCache:N,programs:u,dispose:L}}function eL(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function r(o,a,l){n.get(o)[a]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:i,update:r,dispose:s}}function tL(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function yx(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function bx(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function o(d,p,g,_,x,b){let y=n[e];return y===void 0?(y={id:d.id,object:d,geometry:p,material:g,groupOrder:_,renderOrder:d.renderOrder,z:x,group:b},n[e]=y):(y.id=d.id,y.object=d,y.geometry=p,y.material=g,y.groupOrder=_,y.renderOrder=d.renderOrder,y.z=x,y.group=b),e++,y}function a(d,p,g,_,x,b){const y=o(d,p,g,_,x,b);g.transmission>0?i.push(y):g.transparent===!0?r.push(y):t.push(y)}function l(d,p,g,_,x,b){const y=o(d,p,g,_,x,b);g.transmission>0?i.unshift(y):g.transparent===!0?r.unshift(y):t.unshift(y)}function c(d,p){t.length>1&&t.sort(d||tL),i.length>1&&i.sort(p||yx),r.length>1&&r.sort(p||yx)}function u(){for(let d=e,p=n.length;d<p;d++){const g=n[d];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function iL(){let n=new WeakMap;function e(i,r){const s=n.get(i);let o;return s===void 0?(o=new bx,n.set(i,[o])):r>=s.length?(o=new bx,s.push(o)):o=s[r],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function nL(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new q,color:new ve};break;case"SpotLight":t={position:new q,direction:new q,color:new ve,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new q,color:new ve,distance:0,decay:0};break;case"HemisphereLight":t={direction:new q,skyColor:new ve,groundColor:new ve};break;case"RectAreaLight":t={color:new ve,position:new q,halfWidth:new q,halfHeight:new q};break}return n[e.id]=t,t}}}function rL(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xe};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xe};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xe,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let sL=0;function oL(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function aL(n){const e=new nL,t=rL(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new q);const r=new q,s=new Mt,o=new Mt;function a(c){let u=0,d=0,p=0;for(let P=0;P<9;P++)i.probe[P].set(0,0,0);let g=0,_=0,x=0,b=0,y=0,M=0,E=0,w=0,I=0,B=0,N=0;c.sort(oL);for(let P=0,R=c.length;P<R;P++){const U=c[P],j=U.color,A=U.intensity,D=U.distance,k=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)u+=j.r*A,d+=j.g*A,p+=j.b*A;else if(U.isLightProbe){for(let G=0;G<9;G++)i.probe[G].addScaledVector(U.sh.coefficients[G],A);N++}else if(U.isDirectionalLight){const G=e.get(U);if(G.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const ee=U.shadow,J=t.get(U);J.shadowIntensity=ee.intensity,J.shadowBias=ee.bias,J.shadowNormalBias=ee.normalBias,J.shadowRadius=ee.radius,J.shadowMapSize=ee.mapSize,i.directionalShadow[g]=J,i.directionalShadowMap[g]=k,i.directionalShadowMatrix[g]=U.shadow.matrix,M++}i.directional[g]=G,g++}else if(U.isSpotLight){const G=e.get(U);G.position.setFromMatrixPosition(U.matrixWorld),G.color.copy(j).multiplyScalar(A),G.distance=D,G.coneCos=Math.cos(U.angle),G.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),G.decay=U.decay,i.spot[x]=G;const ee=U.shadow;if(U.map&&(i.spotLightMap[I]=U.map,I++,ee.updateMatrices(U),U.castShadow&&B++),i.spotLightMatrix[x]=ee.matrix,U.castShadow){const J=t.get(U);J.shadowIntensity=ee.intensity,J.shadowBias=ee.bias,J.shadowNormalBias=ee.normalBias,J.shadowRadius=ee.radius,J.shadowMapSize=ee.mapSize,i.spotShadow[x]=J,i.spotShadowMap[x]=k,w++}x++}else if(U.isRectAreaLight){const G=e.get(U);G.color.copy(j).multiplyScalar(A),G.halfWidth.set(U.width*.5,0,0),G.halfHeight.set(0,U.height*.5,0),i.rectArea[b]=G,b++}else if(U.isPointLight){const G=e.get(U);if(G.color.copy(U.color).multiplyScalar(U.intensity),G.distance=U.distance,G.decay=U.decay,U.castShadow){const ee=U.shadow,J=t.get(U);J.shadowIntensity=ee.intensity,J.shadowBias=ee.bias,J.shadowNormalBias=ee.normalBias,J.shadowRadius=ee.radius,J.shadowMapSize=ee.mapSize,J.shadowCameraNear=ee.camera.near,J.shadowCameraFar=ee.camera.far,i.pointShadow[_]=J,i.pointShadowMap[_]=k,i.pointShadowMatrix[_]=U.shadow.matrix,E++}i.point[_]=G,_++}else if(U.isHemisphereLight){const G=e.get(U);G.skyColor.copy(U.color).multiplyScalar(A),G.groundColor.copy(U.groundColor).multiplyScalar(A),i.hemi[y]=G,y++}}b>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=He.LTC_FLOAT_1,i.rectAreaLTC2=He.LTC_FLOAT_2):(i.rectAreaLTC1=He.LTC_HALF_1,i.rectAreaLTC2=He.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=d,i.ambient[2]=p;const L=i.hash;(L.directionalLength!==g||L.pointLength!==_||L.spotLength!==x||L.rectAreaLength!==b||L.hemiLength!==y||L.numDirectionalShadows!==M||L.numPointShadows!==E||L.numSpotShadows!==w||L.numSpotMaps!==I||L.numLightProbes!==N)&&(i.directional.length=g,i.spot.length=x,i.rectArea.length=b,i.point.length=_,i.hemi.length=y,i.directionalShadow.length=M,i.directionalShadowMap.length=M,i.pointShadow.length=E,i.pointShadowMap.length=E,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=M,i.pointShadowMatrix.length=E,i.spotLightMatrix.length=w+I-B,i.spotLightMap.length=I,i.numSpotLightShadowsWithMaps=B,i.numLightProbes=N,L.directionalLength=g,L.pointLength=_,L.spotLength=x,L.rectAreaLength=b,L.hemiLength=y,L.numDirectionalShadows=M,L.numPointShadows=E,L.numSpotShadows=w,L.numSpotMaps=I,L.numLightProbes=N,i.version=sL++)}function l(c,u){let d=0,p=0,g=0,_=0,x=0;const b=u.matrixWorldInverse;for(let y=0,M=c.length;y<M;y++){const E=c[y];if(E.isDirectionalLight){const w=i.directional[d];w.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(b),d++}else if(E.isSpotLight){const w=i.spot[g];w.position.setFromMatrixPosition(E.matrixWorld),w.position.applyMatrix4(b),w.direction.setFromMatrixPosition(E.matrixWorld),r.setFromMatrixPosition(E.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(b),g++}else if(E.isRectAreaLight){const w=i.rectArea[_];w.position.setFromMatrixPosition(E.matrixWorld),w.position.applyMatrix4(b),o.identity(),s.copy(E.matrixWorld),s.premultiply(b),o.extractRotation(s),w.halfWidth.set(E.width*.5,0,0),w.halfHeight.set(0,E.height*.5,0),w.halfWidth.applyMatrix4(o),w.halfHeight.applyMatrix4(o),_++}else if(E.isPointLight){const w=i.point[p];w.position.setFromMatrixPosition(E.matrixWorld),w.position.applyMatrix4(b),p++}else if(E.isHemisphereLight){const w=i.hemi[x];w.direction.setFromMatrixPosition(E.matrixWorld),w.direction.transformDirection(b),x++}}}return{setup:a,setupView:l,state:i}}function xx(n){const e=new aL(n),t=[],i=[];function r(u){c.camera=u,t.length=0,i.length=0}function s(u){t.push(u)}function o(u){i.push(u)}function a(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:c,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:o}}function lL(n){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new xx(n),e.set(r,[a])):s>=o.length?(a=new xx(n),o.push(a)):a=o[s],a}function i(){e=new WeakMap}return{get:t,dispose:i}}class zg extends Ji{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=lb,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Hg extends Ji{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const cL=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,hL=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function uL(n,e,t){let i=new fa;const r=new xe,s=new xe,o=new Gt,a=new zg({depthPacking:cb}),l=new Hg,c={},u=t.maxTextureSize,d={[br]:hn,[hn]:br,[Jn]:Jn},p=new wi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new xe},radius:{value:4}},vertexShader:cL,fragmentShader:hL}),g=p.clone();g.defines.HORIZONTAL_PASS=1;const _=new Tt;_.setAttribute("position",new Jt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new pt(_,p),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Um;let y=this.type;this.render=function(B,N,L){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||B.length===0)return;const P=n.getRenderTarget(),R=n.getActiveCubeFace(),U=n.getActiveMipmapLevel(),j=n.state;j.setBlending(Qr),j.buffers.color.setClear(1,1,1,1),j.buffers.depth.setTest(!0),j.setScissorTest(!1);const A=y!==Kr&&this.type===Kr,D=y===Kr&&this.type!==Kr;for(let k=0,G=B.length;k<G;k++){const ee=B[k],J=ee.shadow;if(J===void 0){console.warn("THREE.WebGLShadowMap:",ee,"has no shadow.");continue}if(J.autoUpdate===!1&&J.needsUpdate===!1)continue;r.copy(J.mapSize);const re=J.getFrameExtents();if(r.multiply(re),s.copy(J.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/re.x),r.x=s.x*re.x,J.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/re.y),r.y=s.y*re.y,J.mapSize.y=s.y)),J.map===null||A===!0||D===!0){const me=this.type!==Kr?{minFilter:xi,magFilter:xi}:{};J.map!==null&&J.map.dispose(),J.map=new ji(r.x,r.y,me),J.map.texture.name=ee.name+".shadowMap",J.camera.updateProjectionMatrix()}n.setRenderTarget(J.map),n.clear();const oe=J.getViewportCount();for(let me=0;me<oe;me++){const Le=J.getViewport(me);o.set(s.x*Le.x,s.y*Le.y,s.x*Le.z,s.y*Le.w),j.viewport(o),J.updateMatrices(ee,me),i=J.getFrustum(),w(N,L,J.camera,ee,this.type)}J.isPointLightShadow!==!0&&this.type===Kr&&M(J,L),J.needsUpdate=!1}y=this.type,b.needsUpdate=!1,n.setRenderTarget(P,R,U)};function M(B,N){const L=e.update(x);p.defines.VSM_SAMPLES!==B.blurSamples&&(p.defines.VSM_SAMPLES=B.blurSamples,g.defines.VSM_SAMPLES=B.blurSamples,p.needsUpdate=!0,g.needsUpdate=!0),B.mapPass===null&&(B.mapPass=new ji(r.x,r.y)),p.uniforms.shadow_pass.value=B.map.texture,p.uniforms.resolution.value=B.mapSize,p.uniforms.radius.value=B.radius,n.setRenderTarget(B.mapPass),n.clear(),n.renderBufferDirect(N,null,L,p,x,null),g.uniforms.shadow_pass.value=B.mapPass.texture,g.uniforms.resolution.value=B.mapSize,g.uniforms.radius.value=B.radius,n.setRenderTarget(B.map),n.clear(),n.renderBufferDirect(N,null,L,g,x,null)}function E(B,N,L,P){let R=null;const U=L.isPointLight===!0?B.customDistanceMaterial:B.customDepthMaterial;if(U!==void 0)R=U;else if(R=L.isPointLight===!0?l:a,n.localClippingEnabled&&N.clipShadows===!0&&Array.isArray(N.clippingPlanes)&&N.clippingPlanes.length!==0||N.displacementMap&&N.displacementScale!==0||N.alphaMap&&N.alphaTest>0||N.map&&N.alphaTest>0){const j=R.uuid,A=N.uuid;let D=c[j];D===void 0&&(D={},c[j]=D);let k=D[A];k===void 0&&(k=R.clone(),D[A]=k,N.addEventListener("dispose",I)),R=k}if(R.visible=N.visible,R.wireframe=N.wireframe,P===Kr?R.side=N.shadowSide!==null?N.shadowSide:N.side:R.side=N.shadowSide!==null?N.shadowSide:d[N.side],R.alphaMap=N.alphaMap,R.alphaTest=N.alphaTest,R.map=N.map,R.clipShadows=N.clipShadows,R.clippingPlanes=N.clippingPlanes,R.clipIntersection=N.clipIntersection,R.displacementMap=N.displacementMap,R.displacementScale=N.displacementScale,R.displacementBias=N.displacementBias,R.wireframeLinewidth=N.wireframeLinewidth,R.linewidth=N.linewidth,L.isPointLight===!0&&R.isMeshDistanceMaterial===!0){const j=n.properties.get(R);j.light=L}return R}function w(B,N,L,P,R){if(B.visible===!1)return;if(B.layers.test(N.layers)&&(B.isMesh||B.isLine||B.isPoints)&&(B.castShadow||B.receiveShadow&&R===Kr)&&(!B.frustumCulled||i.intersectsObject(B))){B.modelViewMatrix.multiplyMatrices(L.matrixWorldInverse,B.matrixWorld);const A=e.update(B),D=B.material;if(Array.isArray(D)){const k=A.groups;for(let G=0,ee=k.length;G<ee;G++){const J=k[G],re=D[J.materialIndex];if(re&&re.visible){const oe=E(B,re,P,R);B.onBeforeShadow(n,B,N,L,A,oe,J),n.renderBufferDirect(L,null,A,oe,B,J),B.onAfterShadow(n,B,N,L,A,oe,J)}}}else if(D.visible){const k=E(B,D,P,R);B.onBeforeShadow(n,B,N,L,A,k,null),n.renderBufferDirect(L,null,A,k,B,null),B.onAfterShadow(n,B,N,L,A,k,null)}}const j=B.children;for(let A=0,D=j.length;A<D;A++)w(j[A],N,L,P,R)}function I(B){B.target.removeEventListener("dispose",I);for(const L in c){const P=c[L],R=B.target.uuid;R in P&&(P[R].dispose(),delete P[R])}}}const fL={[Ru]:Du,[Lu]:Bu,[Ou]:Fu,[eo]:Nu,[Du]:Ru,[Bu]:Lu,[Fu]:Ou,[Nu]:eo};function dL(n,e){function t(){let se=!1;const Ve=new Gt;let be=null;const Ie=new Gt(0,0,0,0);return{setMask:function(Ke){be!==Ke&&!se&&(n.colorMask(Ke,Ke,Ke,Ke),be=Ke)},setLocked:function(Ke){se=Ke},setClear:function(Ke,Qe,Nt,Si,Qi){Qi===!0&&(Ke*=Si,Qe*=Si,Nt*=Si),Ve.set(Ke,Qe,Nt,Si),Ie.equals(Ve)===!1&&(n.clearColor(Ke,Qe,Nt,Si),Ie.copy(Ve))},reset:function(){se=!1,be=null,Ie.set(-1,0,0,0)}}}function i(){let se=!1,Ve=!1,be=null,Ie=null,Ke=null;return{setReversed:function(Qe){if(Ve!==Qe){const Nt=e.get("EXT_clip_control");Ve?Nt.clipControlEXT(Nt.LOWER_LEFT_EXT,Nt.ZERO_TO_ONE_EXT):Nt.clipControlEXT(Nt.LOWER_LEFT_EXT,Nt.NEGATIVE_ONE_TO_ONE_EXT);const Si=Ke;Ke=null,this.setClear(Si)}Ve=Qe},getReversed:function(){return Ve},setTest:function(Qe){Qe?De(n.DEPTH_TEST):Je(n.DEPTH_TEST)},setMask:function(Qe){be!==Qe&&!se&&(n.depthMask(Qe),be=Qe)},setFunc:function(Qe){if(Ve&&(Qe=fL[Qe]),Ie!==Qe){switch(Qe){case Ru:n.depthFunc(n.NEVER);break;case Du:n.depthFunc(n.ALWAYS);break;case Lu:n.depthFunc(n.LESS);break;case eo:n.depthFunc(n.LEQUAL);break;case Ou:n.depthFunc(n.EQUAL);break;case Nu:n.depthFunc(n.GEQUAL);break;case Bu:n.depthFunc(n.GREATER);break;case Fu:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Ie=Qe}},setLocked:function(Qe){se=Qe},setClear:function(Qe){Ke!==Qe&&(Ve&&(Qe=1-Qe),n.clearDepth(Qe),Ke=Qe)},reset:function(){se=!1,be=null,Ie=null,Ke=null,Ve=!1}}}function r(){let se=!1,Ve=null,be=null,Ie=null,Ke=null,Qe=null,Nt=null,Si=null,Qi=null;return{setTest:function(ri){se||(ri?De(n.STENCIL_TEST):Je(n.STENCIL_TEST))},setMask:function(ri){Ve!==ri&&!se&&(n.stencilMask(ri),Ve=ri)},setFunc:function(ri,$n,vr){(be!==ri||Ie!==$n||Ke!==vr)&&(n.stencilFunc(ri,$n,vr),be=ri,Ie=$n,Ke=vr)},setOp:function(ri,$n,vr){(Qe!==ri||Nt!==$n||Si!==vr)&&(n.stencilOp(ri,$n,vr),Qe=ri,Nt=$n,Si=vr)},setLocked:function(ri){se=ri},setClear:function(ri){Qi!==ri&&(n.clearStencil(ri),Qi=ri)},reset:function(){se=!1,Ve=null,be=null,Ie=null,Ke=null,Qe=null,Nt=null,Si=null,Qi=null}}}const s=new t,o=new i,a=new r,l=new WeakMap,c=new WeakMap;let u={},d={},p=new WeakMap,g=[],_=null,x=!1,b=null,y=null,M=null,E=null,w=null,I=null,B=null,N=new ve(0,0,0),L=0,P=!1,R=null,U=null,j=null,A=null,D=null;const k=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let G=!1,ee=0;const J=n.getParameter(n.VERSION);J.indexOf("WebGL")!==-1?(ee=parseFloat(/^WebGL (\d)/.exec(J)[1]),G=ee>=1):J.indexOf("OpenGL ES")!==-1&&(ee=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),G=ee>=2);let re=null,oe={};const me=n.getParameter(n.SCISSOR_BOX),Le=n.getParameter(n.VIEWPORT),Ge=new Gt().fromArray(me),pe=new Gt().fromArray(Le);function Te(se,Ve,be,Ie){const Ke=new Uint8Array(4),Qe=n.createTexture();n.bindTexture(se,Qe),n.texParameteri(se,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(se,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Nt=0;Nt<be;Nt++)se===n.TEXTURE_3D||se===n.TEXTURE_2D_ARRAY?n.texImage3D(Ve,0,n.RGBA,1,1,Ie,0,n.RGBA,n.UNSIGNED_BYTE,Ke):n.texImage2D(Ve+Nt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Ke);return Qe}const ke={};ke[n.TEXTURE_2D]=Te(n.TEXTURE_2D,n.TEXTURE_2D,1),ke[n.TEXTURE_CUBE_MAP]=Te(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ke[n.TEXTURE_2D_ARRAY]=Te(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ke[n.TEXTURE_3D]=Te(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),De(n.DEPTH_TEST),o.setFunc(eo),Be(!1),it(Fm),De(n.CULL_FACE),Q(Qr);function De(se){u[se]!==!0&&(n.enable(se),u[se]=!0)}function Je(se){u[se]!==!1&&(n.disable(se),u[se]=!1)}function lt(se,Ve){return d[se]!==Ve?(n.bindFramebuffer(se,Ve),d[se]=Ve,se===n.DRAW_FRAMEBUFFER&&(d[n.FRAMEBUFFER]=Ve),se===n.FRAMEBUFFER&&(d[n.DRAW_FRAMEBUFFER]=Ve),!0):!1}function rt(se,Ve){let be=g,Ie=!1;if(se){be=p.get(Ve),be===void 0&&(be=[],p.set(Ve,be));const Ke=se.textures;if(be.length!==Ke.length||be[0]!==n.COLOR_ATTACHMENT0){for(let Qe=0,Nt=Ke.length;Qe<Nt;Qe++)be[Qe]=n.COLOR_ATTACHMENT0+Qe;be.length=Ke.length,Ie=!0}}else be[0]!==n.BACK&&(be[0]=n.BACK,Ie=!0);Ie&&n.drawBuffers(be)}function _t(se){return _!==se?(n.useProgram(se),_=se,!0):!1}const Ee={[Js]:n.FUNC_ADD,[Uy]:n.FUNC_SUBTRACT,[ky]:n.FUNC_REVERSE_SUBTRACT};Ee[zy]=n.MIN,Ee[Hy]=n.MAX;const Oe={[Gy]:n.ZERO,[Vy]:n.ONE,[Wy]:n.SRC_COLOR,[Iu]:n.SRC_ALPHA,[Ky]:n.SRC_ALPHA_SATURATE,[qy]:n.DST_COLOR,[Yy]:n.DST_ALPHA,[Xy]:n.ONE_MINUS_SRC_COLOR,[Pu]:n.ONE_MINUS_SRC_ALPHA,[Zy]:n.ONE_MINUS_DST_COLOR,[jy]:n.ONE_MINUS_DST_ALPHA,[Qy]:n.CONSTANT_COLOR,[$y]:n.ONE_MINUS_CONSTANT_COLOR,[Jy]:n.CONSTANT_ALPHA,[eb]:n.ONE_MINUS_CONSTANT_ALPHA};function Q(se,Ve,be,Ie,Ke,Qe,Nt,Si,Qi,ri){if(se===Qr){x===!0&&(Je(n.BLEND),x=!1);return}if(x===!1&&(De(n.BLEND),x=!0),se!==Fy){if(se!==b||ri!==P){if((y!==Js||w!==Js)&&(n.blendEquation(n.FUNC_ADD),y=Js,w=Js),ri)switch(se){case Es:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case km:n.blendFunc(n.ONE,n.ONE);break;case zm:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Hm:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",se);break}else switch(se){case Es:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case km:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case zm:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Hm:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",se);break}M=null,E=null,I=null,B=null,N.set(0,0,0),L=0,b=se,P=ri}return}Ke=Ke||Ve,Qe=Qe||be,Nt=Nt||Ie,(Ve!==y||Ke!==w)&&(n.blendEquationSeparate(Ee[Ve],Ee[Ke]),y=Ve,w=Ke),(be!==M||Ie!==E||Qe!==I||Nt!==B)&&(n.blendFuncSeparate(Oe[be],Oe[Ie],Oe[Qe],Oe[Nt]),M=be,E=Ie,I=Qe,B=Nt),(Si.equals(N)===!1||Qi!==L)&&(n.blendColor(Si.r,Si.g,Si.b,Qi),N.copy(Si),L=Qi),b=se,P=!1}function Ye(se,Ve){se.side===Jn?Je(n.CULL_FACE):De(n.CULL_FACE);let be=se.side===hn;Ve&&(be=!be),Be(be),se.blending===Es&&se.transparent===!1?Q(Qr):Q(se.blending,se.blendEquation,se.blendSrc,se.blendDst,se.blendEquationAlpha,se.blendSrcAlpha,se.blendDstAlpha,se.blendColor,se.blendAlpha,se.premultipliedAlpha),o.setFunc(se.depthFunc),o.setTest(se.depthTest),o.setMask(se.depthWrite),s.setMask(se.colorWrite);const Ie=se.stencilWrite;a.setTest(Ie),Ie&&(a.setMask(se.stencilWriteMask),a.setFunc(se.stencilFunc,se.stencilRef,se.stencilFuncMask),a.setOp(se.stencilFail,se.stencilZFail,se.stencilZPass)),wt(se.polygonOffset,se.polygonOffsetFactor,se.polygonOffsetUnits),se.alphaToCoverage===!0?De(n.SAMPLE_ALPHA_TO_COVERAGE):Je(n.SAMPLE_ALPHA_TO_COVERAGE)}function Be(se){R!==se&&(se?n.frontFace(n.CW):n.frontFace(n.CCW),R=se)}function it(se){se!==Oy?(De(n.CULL_FACE),se!==U&&(se===Fm?n.cullFace(n.BACK):se===Ny?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Je(n.CULL_FACE),U=se}function ze(se){se!==j&&(G&&n.lineWidth(se),j=se)}function wt(se,Ve,be){se?(De(n.POLYGON_OFFSET_FILL),(A!==Ve||D!==be)&&(n.polygonOffset(Ve,be),A=Ve,D=be)):Je(n.POLYGON_OFFSET_FILL)}function et(se){se?De(n.SCISSOR_TEST):Je(n.SCISSOR_TEST)}function Z(se){se===void 0&&(se=n.TEXTURE0+k-1),re!==se&&(n.activeTexture(se),re=se)}function V(se,Ve,be){be===void 0&&(re===null?be=n.TEXTURE0+k-1:be=re);let Ie=oe[be];Ie===void 0&&(Ie={type:void 0,texture:void 0},oe[be]=Ie),(Ie.type!==se||Ie.texture!==Ve)&&(re!==be&&(n.activeTexture(be),re=be),n.bindTexture(se,Ve||ke[se]),Ie.type=se,Ie.texture=Ve)}function de(){const se=oe[re];se!==void 0&&se.type!==void 0&&(n.bindTexture(se.type,null),se.type=void 0,se.texture=void 0)}function Ae(){try{n.compressedTexImage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Re(){try{n.compressedTexImage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Ce(){try{n.texSubImage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function ut(){try{n.texSubImage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function je(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function tt(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Ht(){try{n.texStorage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Ue(){try{n.texStorage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function ot(){try{n.texImage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Et(){try{n.texImage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function At(se){Ge.equals(se)===!1&&(n.scissor(se.x,se.y,se.z,se.w),Ge.copy(se))}function st(se){pe.equals(se)===!1&&(n.viewport(se.x,se.y,se.z,se.w),pe.copy(se))}function Yt(se,Ve){let be=c.get(Ve);be===void 0&&(be=new WeakMap,c.set(Ve,be));let Ie=be.get(se);Ie===void 0&&(Ie=n.getUniformBlockIndex(Ve,se.name),be.set(se,Ie))}function Rt(se,Ve){const Ie=c.get(Ve).get(se);l.get(Ve)!==Ie&&(n.uniformBlockBinding(Ve,Ie,se.__bindingPointIndex),l.set(Ve,Ie))}function hi(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},re=null,oe={},d={},p=new WeakMap,g=[],_=null,x=!1,b=null,y=null,M=null,E=null,w=null,I=null,B=null,N=new ve(0,0,0),L=0,P=!1,R=null,U=null,j=null,A=null,D=null,Ge.set(0,0,n.canvas.width,n.canvas.height),pe.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:De,disable:Je,bindFramebuffer:lt,drawBuffers:rt,useProgram:_t,setBlending:Q,setMaterial:Ye,setFlipSided:Be,setCullFace:it,setLineWidth:ze,setPolygonOffset:wt,setScissorTest:et,activeTexture:Z,bindTexture:V,unbindTexture:de,compressedTexImage2D:Ae,compressedTexImage3D:Re,texImage2D:ot,texImage3D:Et,updateUBOMapping:Yt,uniformBlockBinding:Rt,texStorage2D:Ht,texStorage3D:Ue,texSubImage2D:Ce,texSubImage3D:ut,compressedTexSubImage2D:je,compressedTexSubImage3D:tt,scissor:At,viewport:st,reset:hi}}function pL(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function mL(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function gL(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function Gg(n,e,t,i){const r=_L(i);switch(t){case Qm:return n*e;case Jm:return n*e;case eg:return n*e*2;case Wu:return n*e/r.components*r.byteLength;case Xc:return n*e/r.components*r.byteLength;case tg:return n*e*2/r.components*r.byteLength;case Xu:return n*e*2/r.components*r.byteLength;case $m:return n*e*3/r.components*r.byteLength;case Ti:return n*e*4/r.components*r.byteLength;case Yu:return n*e*4/r.components*r.byteLength;case Yc:case jc:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case qc:case Zc:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case qu:case Ku:return Math.max(n,16)*Math.max(e,8)/4;case ju:case Zu:return Math.max(n,8)*Math.max(e,8)/2;case Qu:case $u:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Ju:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case ef:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case tf:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case nf:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case rf:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case sf:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case of:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case af:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case lf:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case cf:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case hf:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case uf:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case ff:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case df:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case pf:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Kc:case mf:case gf:return Math.ceil(n/4)*Math.ceil(e/4)*16;case ig:case _f:return Math.ceil(n/4)*Math.ceil(e/4)*8;case vf:case yf:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function _L(n){switch(n){case ar:case qm:return{byteLength:1,components:1};case Jo:case Zm:case er:return{byteLength:2,components:1};case Gu:case Vu:return{byteLength:2,components:4};case As:case Hu:case Ii:return{byteLength:4,components:1};case Km:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}const vL={contain:pL,cover:mL,fill:gL,getByteLength:Gg};function yL(n,e,t,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new xe,u=new WeakMap;let d;const p=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _(Z,V){return g?new OffscreenCanvas(Z,V):th("canvas")}function x(Z,V,de){let Ae=1;const Re=et(Z);if((Re.width>de||Re.height>de)&&(Ae=de/Math.max(Re.width,Re.height)),Ae<1)if(typeof HTMLImageElement<"u"&&Z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Z instanceof ImageBitmap||typeof VideoFrame<"u"&&Z instanceof VideoFrame){const Ce=Math.floor(Ae*Re.width),ut=Math.floor(Ae*Re.height);d===void 0&&(d=_(Ce,ut));const je=V?_(Ce,ut):d;return je.width=Ce,je.height=ut,je.getContext("2d").drawImage(Z,0,0,Ce,ut),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Re.width+"x"+Re.height+") to ("+Ce+"x"+ut+")."),je}else return"data"in Z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Re.width+"x"+Re.height+")."),Z;return Z}function b(Z){return Z.generateMipmaps}function y(Z){n.generateMipmap(Z)}function M(Z){return Z.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:Z.isWebGL3DRenderTarget?n.TEXTURE_3D:Z.isWebGLArrayRenderTarget||Z.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function E(Z,V,de,Ae,Re=!1){if(Z!==null){if(n[Z]!==void 0)return n[Z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Z+"'")}let Ce=V;if(V===n.RED&&(de===n.FLOAT&&(Ce=n.R32F),de===n.HALF_FLOAT&&(Ce=n.R16F),de===n.UNSIGNED_BYTE&&(Ce=n.R8)),V===n.RED_INTEGER&&(de===n.UNSIGNED_BYTE&&(Ce=n.R8UI),de===n.UNSIGNED_SHORT&&(Ce=n.R16UI),de===n.UNSIGNED_INT&&(Ce=n.R32UI),de===n.BYTE&&(Ce=n.R8I),de===n.SHORT&&(Ce=n.R16I),de===n.INT&&(Ce=n.R32I)),V===n.RG&&(de===n.FLOAT&&(Ce=n.RG32F),de===n.HALF_FLOAT&&(Ce=n.RG16F),de===n.UNSIGNED_BYTE&&(Ce=n.RG8)),V===n.RG_INTEGER&&(de===n.UNSIGNED_BYTE&&(Ce=n.RG8UI),de===n.UNSIGNED_SHORT&&(Ce=n.RG16UI),de===n.UNSIGNED_INT&&(Ce=n.RG32UI),de===n.BYTE&&(Ce=n.RG8I),de===n.SHORT&&(Ce=n.RG16I),de===n.INT&&(Ce=n.RG32I)),V===n.RGB_INTEGER&&(de===n.UNSIGNED_BYTE&&(Ce=n.RGB8UI),de===n.UNSIGNED_SHORT&&(Ce=n.RGB16UI),de===n.UNSIGNED_INT&&(Ce=n.RGB32UI),de===n.BYTE&&(Ce=n.RGB8I),de===n.SHORT&&(Ce=n.RGB16I),de===n.INT&&(Ce=n.RGB32I)),V===n.RGBA_INTEGER&&(de===n.UNSIGNED_BYTE&&(Ce=n.RGBA8UI),de===n.UNSIGNED_SHORT&&(Ce=n.RGBA16UI),de===n.UNSIGNED_INT&&(Ce=n.RGBA32UI),de===n.BYTE&&(Ce=n.RGBA8I),de===n.SHORT&&(Ce=n.RGBA16I),de===n.INT&&(Ce=n.RGBA32I)),V===n.RGB&&de===n.UNSIGNED_INT_5_9_9_9_REV&&(Ce=n.RGB9_E5),V===n.RGBA){const ut=Re?$c:Xt.getTransfer(Ae);de===n.FLOAT&&(Ce=n.RGBA32F),de===n.HALF_FLOAT&&(Ce=n.RGBA16F),de===n.UNSIGNED_BYTE&&(Ce=ut===mi?n.SRGB8_ALPHA8:n.RGBA8),de===n.UNSIGNED_SHORT_4_4_4_4&&(Ce=n.RGBA4),de===n.UNSIGNED_SHORT_5_5_5_1&&(Ce=n.RGB5_A1)}return(Ce===n.R16F||Ce===n.R32F||Ce===n.RG16F||Ce===n.RG32F||Ce===n.RGBA16F||Ce===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Ce}function w(Z,V){let de;return Z?V===null||V===As||V===ea?de=n.DEPTH24_STENCIL8:V===Ii?de=n.DEPTH32F_STENCIL8:V===Jo&&(de=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):V===null||V===As||V===ea?de=n.DEPTH_COMPONENT24:V===Ii?de=n.DEPTH_COMPONENT32F:V===Jo&&(de=n.DEPTH_COMPONENT16),de}function I(Z,V){return b(Z)===!0||Z.isFramebufferTexture&&Z.minFilter!==xi&&Z.minFilter!==Ei?Math.log2(Math.max(V.width,V.height))+1:Z.mipmaps!==void 0&&Z.mipmaps.length>0?Z.mipmaps.length:Z.isCompressedTexture&&Array.isArray(Z.image)?V.mipmaps.length:1}function B(Z){const V=Z.target;V.removeEventListener("dispose",B),L(V),V.isVideoTexture&&u.delete(V)}function N(Z){const V=Z.target;V.removeEventListener("dispose",N),R(V)}function L(Z){const V=i.get(Z);if(V.__webglInit===void 0)return;const de=Z.source,Ae=p.get(de);if(Ae){const Re=Ae[V.__cacheKey];Re.usedTimes--,Re.usedTimes===0&&P(Z),Object.keys(Ae).length===0&&p.delete(de)}i.remove(Z)}function P(Z){const V=i.get(Z);n.deleteTexture(V.__webglTexture);const de=Z.source,Ae=p.get(de);delete Ae[V.__cacheKey],o.memory.textures--}function R(Z){const V=i.get(Z);if(Z.depthTexture&&(Z.depthTexture.dispose(),i.remove(Z.depthTexture)),Z.isWebGLCubeRenderTarget)for(let Ae=0;Ae<6;Ae++){if(Array.isArray(V.__webglFramebuffer[Ae]))for(let Re=0;Re<V.__webglFramebuffer[Ae].length;Re++)n.deleteFramebuffer(V.__webglFramebuffer[Ae][Re]);else n.deleteFramebuffer(V.__webglFramebuffer[Ae]);V.__webglDepthbuffer&&n.deleteRenderbuffer(V.__webglDepthbuffer[Ae])}else{if(Array.isArray(V.__webglFramebuffer))for(let Ae=0;Ae<V.__webglFramebuffer.length;Ae++)n.deleteFramebuffer(V.__webglFramebuffer[Ae]);else n.deleteFramebuffer(V.__webglFramebuffer);if(V.__webglDepthbuffer&&n.deleteRenderbuffer(V.__webglDepthbuffer),V.__webglMultisampledFramebuffer&&n.deleteFramebuffer(V.__webglMultisampledFramebuffer),V.__webglColorRenderbuffer)for(let Ae=0;Ae<V.__webglColorRenderbuffer.length;Ae++)V.__webglColorRenderbuffer[Ae]&&n.deleteRenderbuffer(V.__webglColorRenderbuffer[Ae]);V.__webglDepthRenderbuffer&&n.deleteRenderbuffer(V.__webglDepthRenderbuffer)}const de=Z.textures;for(let Ae=0,Re=de.length;Ae<Re;Ae++){const Ce=i.get(de[Ae]);Ce.__webglTexture&&(n.deleteTexture(Ce.__webglTexture),o.memory.textures--),i.remove(de[Ae])}i.remove(Z)}let U=0;function j(){U=0}function A(){const Z=U;return Z>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Z+" texture units while this GPU supports only "+r.maxTextures),U+=1,Z}function D(Z){const V=[];return V.push(Z.wrapS),V.push(Z.wrapT),V.push(Z.wrapR||0),V.push(Z.magFilter),V.push(Z.minFilter),V.push(Z.anisotropy),V.push(Z.internalFormat),V.push(Z.format),V.push(Z.type),V.push(Z.generateMipmaps),V.push(Z.premultiplyAlpha),V.push(Z.flipY),V.push(Z.unpackAlignment),V.push(Z.colorSpace),V.join()}function k(Z,V){const de=i.get(Z);if(Z.isVideoTexture&&ze(Z),Z.isRenderTargetTexture===!1&&Z.version>0&&de.__version!==Z.version){const Ae=Z.image;if(Ae===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ae.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{pe(de,Z,V);return}}t.bindTexture(n.TEXTURE_2D,de.__webglTexture,n.TEXTURE0+V)}function G(Z,V){const de=i.get(Z);if(Z.version>0&&de.__version!==Z.version){pe(de,Z,V);return}t.bindTexture(n.TEXTURE_2D_ARRAY,de.__webglTexture,n.TEXTURE0+V)}function ee(Z,V){const de=i.get(Z);if(Z.version>0&&de.__version!==Z.version){pe(de,Z,V);return}t.bindTexture(n.TEXTURE_3D,de.__webglTexture,n.TEXTURE0+V)}function J(Z,V){const de=i.get(Z);if(Z.version>0&&de.__version!==Z.version){Te(de,Z,V);return}t.bindTexture(n.TEXTURE_CUBE_MAP,de.__webglTexture,n.TEXTURE0+V)}const re={[io]:n.REPEAT,[or]:n.CLAMP_TO_EDGE,[al]:n.MIRRORED_REPEAT},oe={[xi]:n.NEAREST,[zu]:n.NEAREST_MIPMAP_NEAREST,[$o]:n.NEAREST_MIPMAP_LINEAR,[Ei]:n.LINEAR,[ll]:n.LINEAR_MIPMAP_NEAREST,[wr]:n.LINEAR_MIPMAP_LINEAR},me={[ub]:n.NEVER,[_b]:n.ALWAYS,[fb]:n.LESS,[og]:n.LEQUAL,[db]:n.EQUAL,[gb]:n.GEQUAL,[pb]:n.GREATER,[mb]:n.NOTEQUAL};function Le(Z,V){if(V.type===Ii&&e.has("OES_texture_float_linear")===!1&&(V.magFilter===Ei||V.magFilter===ll||V.magFilter===$o||V.magFilter===wr||V.minFilter===Ei||V.minFilter===ll||V.minFilter===$o||V.minFilter===wr)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(Z,n.TEXTURE_WRAP_S,re[V.wrapS]),n.texParameteri(Z,n.TEXTURE_WRAP_T,re[V.wrapT]),(Z===n.TEXTURE_3D||Z===n.TEXTURE_2D_ARRAY)&&n.texParameteri(Z,n.TEXTURE_WRAP_R,re[V.wrapR]),n.texParameteri(Z,n.TEXTURE_MAG_FILTER,oe[V.magFilter]),n.texParameteri(Z,n.TEXTURE_MIN_FILTER,oe[V.minFilter]),V.compareFunction&&(n.texParameteri(Z,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(Z,n.TEXTURE_COMPARE_FUNC,me[V.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(V.magFilter===xi||V.minFilter!==$o&&V.minFilter!==wr||V.type===Ii&&e.has("OES_texture_float_linear")===!1)return;if(V.anisotropy>1||i.get(V).__currentAnisotropy){const de=e.get("EXT_texture_filter_anisotropic");n.texParameterf(Z,de.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(V.anisotropy,r.getMaxAnisotropy())),i.get(V).__currentAnisotropy=V.anisotropy}}}function Ge(Z,V){let de=!1;Z.__webglInit===void 0&&(Z.__webglInit=!0,V.addEventListener("dispose",B));const Ae=V.source;let Re=p.get(Ae);Re===void 0&&(Re={},p.set(Ae,Re));const Ce=D(V);if(Ce!==Z.__cacheKey){Re[Ce]===void 0&&(Re[Ce]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,de=!0),Re[Ce].usedTimes++;const ut=Re[Z.__cacheKey];ut!==void 0&&(Re[Z.__cacheKey].usedTimes--,ut.usedTimes===0&&P(V)),Z.__cacheKey=Ce,Z.__webglTexture=Re[Ce].texture}return de}function pe(Z,V,de){let Ae=n.TEXTURE_2D;(V.isDataArrayTexture||V.isCompressedArrayTexture)&&(Ae=n.TEXTURE_2D_ARRAY),V.isData3DTexture&&(Ae=n.TEXTURE_3D);const Re=Ge(Z,V),Ce=V.source;t.bindTexture(Ae,Z.__webglTexture,n.TEXTURE0+de);const ut=i.get(Ce);if(Ce.version!==ut.__version||Re===!0){t.activeTexture(n.TEXTURE0+de);const je=Xt.getPrimaries(Xt.workingColorSpace),tt=V.colorSpace===Ms?null:Xt.getPrimaries(V.colorSpace),Ht=V.colorSpace===Ms||je===tt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,V.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,V.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ht);let Ue=x(V.image,!1,r.maxTextureSize);Ue=wt(V,Ue);const ot=s.convert(V.format,V.colorSpace),Et=s.convert(V.type);let At=E(V.internalFormat,ot,Et,V.colorSpace,V.isVideoTexture);Le(Ae,V);let st;const Yt=V.mipmaps,Rt=V.isVideoTexture!==!0,hi=ut.__version===void 0||Re===!0,se=Ce.dataReady,Ve=I(V,Ue);if(V.isDepthTexture)At=w(V.format===ta,V.type),hi&&(Rt?t.texStorage2D(n.TEXTURE_2D,1,At,Ue.width,Ue.height):t.texImage2D(n.TEXTURE_2D,0,At,Ue.width,Ue.height,0,ot,Et,null));else if(V.isDataTexture)if(Yt.length>0){Rt&&hi&&t.texStorage2D(n.TEXTURE_2D,Ve,At,Yt[0].width,Yt[0].height);for(let be=0,Ie=Yt.length;be<Ie;be++)st=Yt[be],Rt?se&&t.texSubImage2D(n.TEXTURE_2D,be,0,0,st.width,st.height,ot,Et,st.data):t.texImage2D(n.TEXTURE_2D,be,At,st.width,st.height,0,ot,Et,st.data);V.generateMipmaps=!1}else Rt?(hi&&t.texStorage2D(n.TEXTURE_2D,Ve,At,Ue.width,Ue.height),se&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ue.width,Ue.height,ot,Et,Ue.data)):t.texImage2D(n.TEXTURE_2D,0,At,Ue.width,Ue.height,0,ot,Et,Ue.data);else if(V.isCompressedTexture)if(V.isCompressedArrayTexture){Rt&&hi&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ve,At,Yt[0].width,Yt[0].height,Ue.depth);for(let be=0,Ie=Yt.length;be<Ie;be++)if(st=Yt[be],V.format!==Ti)if(ot!==null)if(Rt){if(se)if(V.layerUpdates.size>0){const Ke=Gg(st.width,st.height,V.format,V.type);for(const Qe of V.layerUpdates){const Nt=st.data.subarray(Qe*Ke/st.data.BYTES_PER_ELEMENT,(Qe+1)*Ke/st.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,be,0,0,Qe,st.width,st.height,1,ot,Nt)}V.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,be,0,0,0,st.width,st.height,Ue.depth,ot,st.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,be,At,st.width,st.height,Ue.depth,0,st.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Rt?se&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,be,0,0,0,st.width,st.height,Ue.depth,ot,Et,st.data):t.texImage3D(n.TEXTURE_2D_ARRAY,be,At,st.width,st.height,Ue.depth,0,ot,Et,st.data)}else{Rt&&hi&&t.texStorage2D(n.TEXTURE_2D,Ve,At,Yt[0].width,Yt[0].height);for(let be=0,Ie=Yt.length;be<Ie;be++)st=Yt[be],V.format!==Ti?ot!==null?Rt?se&&t.compressedTexSubImage2D(n.TEXTURE_2D,be,0,0,st.width,st.height,ot,st.data):t.compressedTexImage2D(n.TEXTURE_2D,be,At,st.width,st.height,0,st.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Rt?se&&t.texSubImage2D(n.TEXTURE_2D,be,0,0,st.width,st.height,ot,Et,st.data):t.texImage2D(n.TEXTURE_2D,be,At,st.width,st.height,0,ot,Et,st.data)}else if(V.isDataArrayTexture)if(Rt){if(hi&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ve,At,Ue.width,Ue.height,Ue.depth),se)if(V.layerUpdates.size>0){const be=Gg(Ue.width,Ue.height,V.format,V.type);for(const Ie of V.layerUpdates){const Ke=Ue.data.subarray(Ie*be/Ue.data.BYTES_PER_ELEMENT,(Ie+1)*be/Ue.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Ie,Ue.width,Ue.height,1,ot,Et,Ke)}V.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Ue.width,Ue.height,Ue.depth,ot,Et,Ue.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,At,Ue.width,Ue.height,Ue.depth,0,ot,Et,Ue.data);else if(V.isData3DTexture)Rt?(hi&&t.texStorage3D(n.TEXTURE_3D,Ve,At,Ue.width,Ue.height,Ue.depth),se&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Ue.width,Ue.height,Ue.depth,ot,Et,Ue.data)):t.texImage3D(n.TEXTURE_3D,0,At,Ue.width,Ue.height,Ue.depth,0,ot,Et,Ue.data);else if(V.isFramebufferTexture){if(hi)if(Rt)t.texStorage2D(n.TEXTURE_2D,Ve,At,Ue.width,Ue.height);else{let be=Ue.width,Ie=Ue.height;for(let Ke=0;Ke<Ve;Ke++)t.texImage2D(n.TEXTURE_2D,Ke,At,be,Ie,0,ot,Et,null),be>>=1,Ie>>=1}}else if(Yt.length>0){if(Rt&&hi){const be=et(Yt[0]);t.texStorage2D(n.TEXTURE_2D,Ve,At,be.width,be.height)}for(let be=0,Ie=Yt.length;be<Ie;be++)st=Yt[be],Rt?se&&t.texSubImage2D(n.TEXTURE_2D,be,0,0,ot,Et,st):t.texImage2D(n.TEXTURE_2D,be,At,ot,Et,st);V.generateMipmaps=!1}else if(Rt){if(hi){const be=et(Ue);t.texStorage2D(n.TEXTURE_2D,Ve,At,be.width,be.height)}se&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,ot,Et,Ue)}else t.texImage2D(n.TEXTURE_2D,0,At,ot,Et,Ue);b(V)&&y(Ae),ut.__version=Ce.version,V.onUpdate&&V.onUpdate(V)}Z.__version=V.version}function Te(Z,V,de){if(V.image.length!==6)return;const Ae=Ge(Z,V),Re=V.source;t.bindTexture(n.TEXTURE_CUBE_MAP,Z.__webglTexture,n.TEXTURE0+de);const Ce=i.get(Re);if(Re.version!==Ce.__version||Ae===!0){t.activeTexture(n.TEXTURE0+de);const ut=Xt.getPrimaries(Xt.workingColorSpace),je=V.colorSpace===Ms?null:Xt.getPrimaries(V.colorSpace),tt=V.colorSpace===Ms||ut===je?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,V.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,V.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,tt);const Ht=V.isCompressedTexture||V.image[0].isCompressedTexture,Ue=V.image[0]&&V.image[0].isDataTexture,ot=[];for(let Ie=0;Ie<6;Ie++)!Ht&&!Ue?ot[Ie]=x(V.image[Ie],!0,r.maxCubemapSize):ot[Ie]=Ue?V.image[Ie].image:V.image[Ie],ot[Ie]=wt(V,ot[Ie]);const Et=ot[0],At=s.convert(V.format,V.colorSpace),st=s.convert(V.type),Yt=E(V.internalFormat,At,st,V.colorSpace),Rt=V.isVideoTexture!==!0,hi=Ce.__version===void 0||Ae===!0,se=Re.dataReady;let Ve=I(V,Et);Le(n.TEXTURE_CUBE_MAP,V);let be;if(Ht){Rt&&hi&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Ve,Yt,Et.width,Et.height);for(let Ie=0;Ie<6;Ie++){be=ot[Ie].mipmaps;for(let Ke=0;Ke<be.length;Ke++){const Qe=be[Ke];V.format!==Ti?At!==null?Rt?se&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,Ke,0,0,Qe.width,Qe.height,At,Qe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,Ke,Yt,Qe.width,Qe.height,0,Qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Rt?se&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,Ke,0,0,Qe.width,Qe.height,At,st,Qe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,Ke,Yt,Qe.width,Qe.height,0,At,st,Qe.data)}}}else{if(be=V.mipmaps,Rt&&hi){be.length>0&&Ve++;const Ie=et(ot[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Ve,Yt,Ie.width,Ie.height)}for(let Ie=0;Ie<6;Ie++)if(Ue){Rt?se&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,0,0,0,ot[Ie].width,ot[Ie].height,At,st,ot[Ie].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,0,Yt,ot[Ie].width,ot[Ie].height,0,At,st,ot[Ie].data);for(let Ke=0;Ke<be.length;Ke++){const Nt=be[Ke].image[Ie].image;Rt?se&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,Ke+1,0,0,Nt.width,Nt.height,At,st,Nt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,Ke+1,Yt,Nt.width,Nt.height,0,At,st,Nt.data)}}else{Rt?se&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,0,0,0,At,st,ot[Ie]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,0,Yt,At,st,ot[Ie]);for(let Ke=0;Ke<be.length;Ke++){const Qe=be[Ke];Rt?se&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,Ke+1,0,0,At,st,Qe.image[Ie]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,Ke+1,Yt,At,st,Qe.image[Ie])}}}b(V)&&y(n.TEXTURE_CUBE_MAP),Ce.__version=Re.version,V.onUpdate&&V.onUpdate(V)}Z.__version=V.version}function ke(Z,V,de,Ae,Re,Ce){const ut=s.convert(de.format,de.colorSpace),je=s.convert(de.type),tt=E(de.internalFormat,ut,je,de.colorSpace),Ht=i.get(V),Ue=i.get(de);if(Ue.__renderTarget=V,!Ht.__hasExternalTextures){const ot=Math.max(1,V.width>>Ce),Et=Math.max(1,V.height>>Ce);Re===n.TEXTURE_3D||Re===n.TEXTURE_2D_ARRAY?t.texImage3D(Re,Ce,tt,ot,Et,V.depth,0,ut,je,null):t.texImage2D(Re,Ce,tt,ot,Et,0,ut,je,null)}t.bindFramebuffer(n.FRAMEBUFFER,Z),it(V)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ae,Re,Ue.__webglTexture,0,Be(V)):(Re===n.TEXTURE_2D||Re>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Re<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Ae,Re,Ue.__webglTexture,Ce),t.bindFramebuffer(n.FRAMEBUFFER,null)}function De(Z,V,de){if(n.bindRenderbuffer(n.RENDERBUFFER,Z),V.depthBuffer){const Ae=V.depthTexture,Re=Ae&&Ae.isDepthTexture?Ae.type:null,Ce=w(V.stencilBuffer,Re),ut=V.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,je=Be(V);it(V)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,je,Ce,V.width,V.height):de?n.renderbufferStorageMultisample(n.RENDERBUFFER,je,Ce,V.width,V.height):n.renderbufferStorage(n.RENDERBUFFER,Ce,V.width,V.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,ut,n.RENDERBUFFER,Z)}else{const Ae=V.textures;for(let Re=0;Re<Ae.length;Re++){const Ce=Ae[Re],ut=s.convert(Ce.format,Ce.colorSpace),je=s.convert(Ce.type),tt=E(Ce.internalFormat,ut,je,Ce.colorSpace),Ht=Be(V);de&&it(V)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ht,tt,V.width,V.height):it(V)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ht,tt,V.width,V.height):n.renderbufferStorage(n.RENDERBUFFER,tt,V.width,V.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Je(Z,V){if(V&&V.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,Z),!(V.depthTexture&&V.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ae=i.get(V.depthTexture);Ae.__renderTarget=V,(!Ae.__webglTexture||V.depthTexture.image.width!==V.width||V.depthTexture.image.height!==V.height)&&(V.depthTexture.image.width=V.width,V.depthTexture.image.height=V.height,V.depthTexture.needsUpdate=!0),k(V.depthTexture,0);const Re=Ae.__webglTexture,Ce=Be(V);if(V.depthTexture.format===no)it(V)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Re,0,Ce):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Re,0);else if(V.depthTexture.format===ta)it(V)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Re,0,Ce):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Re,0);else throw new Error("Unknown depthTexture format")}function lt(Z){const V=i.get(Z),de=Z.isWebGLCubeRenderTarget===!0;if(V.__boundDepthTexture!==Z.depthTexture){const Ae=Z.depthTexture;if(V.__depthDisposeCallback&&V.__depthDisposeCallback(),Ae){const Re=()=>{delete V.__boundDepthTexture,delete V.__depthDisposeCallback,Ae.removeEventListener("dispose",Re)};Ae.addEventListener("dispose",Re),V.__depthDisposeCallback=Re}V.__boundDepthTexture=Ae}if(Z.depthTexture&&!V.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");Je(V.__webglFramebuffer,Z)}else if(de){V.__webglDepthbuffer=[];for(let Ae=0;Ae<6;Ae++)if(t.bindFramebuffer(n.FRAMEBUFFER,V.__webglFramebuffer[Ae]),V.__webglDepthbuffer[Ae]===void 0)V.__webglDepthbuffer[Ae]=n.createRenderbuffer(),De(V.__webglDepthbuffer[Ae],Z,!1);else{const Re=Z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ce=V.__webglDepthbuffer[Ae];n.bindRenderbuffer(n.RENDERBUFFER,Ce),n.framebufferRenderbuffer(n.FRAMEBUFFER,Re,n.RENDERBUFFER,Ce)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,V.__webglFramebuffer),V.__webglDepthbuffer===void 0)V.__webglDepthbuffer=n.createRenderbuffer(),De(V.__webglDepthbuffer,Z,!1);else{const Ae=Z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Re=V.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,Re),n.framebufferRenderbuffer(n.FRAMEBUFFER,Ae,n.RENDERBUFFER,Re)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function rt(Z,V,de){const Ae=i.get(Z);V!==void 0&&ke(Ae.__webglFramebuffer,Z,Z.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),de!==void 0&&lt(Z)}function _t(Z){const V=Z.texture,de=i.get(Z),Ae=i.get(V);Z.addEventListener("dispose",N);const Re=Z.textures,Ce=Z.isWebGLCubeRenderTarget===!0,ut=Re.length>1;if(ut||(Ae.__webglTexture===void 0&&(Ae.__webglTexture=n.createTexture()),Ae.__version=V.version,o.memory.textures++),Ce){de.__webglFramebuffer=[];for(let je=0;je<6;je++)if(V.mipmaps&&V.mipmaps.length>0){de.__webglFramebuffer[je]=[];for(let tt=0;tt<V.mipmaps.length;tt++)de.__webglFramebuffer[je][tt]=n.createFramebuffer()}else de.__webglFramebuffer[je]=n.createFramebuffer()}else{if(V.mipmaps&&V.mipmaps.length>0){de.__webglFramebuffer=[];for(let je=0;je<V.mipmaps.length;je++)de.__webglFramebuffer[je]=n.createFramebuffer()}else de.__webglFramebuffer=n.createFramebuffer();if(ut)for(let je=0,tt=Re.length;je<tt;je++){const Ht=i.get(Re[je]);Ht.__webglTexture===void 0&&(Ht.__webglTexture=n.createTexture(),o.memory.textures++)}if(Z.samples>0&&it(Z)===!1){de.__webglMultisampledFramebuffer=n.createFramebuffer(),de.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,de.__webglMultisampledFramebuffer);for(let je=0;je<Re.length;je++){const tt=Re[je];de.__webglColorRenderbuffer[je]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,de.__webglColorRenderbuffer[je]);const Ht=s.convert(tt.format,tt.colorSpace),Ue=s.convert(tt.type),ot=E(tt.internalFormat,Ht,Ue,tt.colorSpace,Z.isXRRenderTarget===!0),Et=Be(Z);n.renderbufferStorageMultisample(n.RENDERBUFFER,Et,ot,Z.width,Z.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+je,n.RENDERBUFFER,de.__webglColorRenderbuffer[je])}n.bindRenderbuffer(n.RENDERBUFFER,null),Z.depthBuffer&&(de.__webglDepthRenderbuffer=n.createRenderbuffer(),De(de.__webglDepthRenderbuffer,Z,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Ce){t.bindTexture(n.TEXTURE_CUBE_MAP,Ae.__webglTexture),Le(n.TEXTURE_CUBE_MAP,V);for(let je=0;je<6;je++)if(V.mipmaps&&V.mipmaps.length>0)for(let tt=0;tt<V.mipmaps.length;tt++)ke(de.__webglFramebuffer[je][tt],Z,V,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+je,tt);else ke(de.__webglFramebuffer[je],Z,V,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+je,0);b(V)&&y(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ut){for(let je=0,tt=Re.length;je<tt;je++){const Ht=Re[je],Ue=i.get(Ht);t.bindTexture(n.TEXTURE_2D,Ue.__webglTexture),Le(n.TEXTURE_2D,Ht),ke(de.__webglFramebuffer,Z,Ht,n.COLOR_ATTACHMENT0+je,n.TEXTURE_2D,0),b(Ht)&&y(n.TEXTURE_2D)}t.unbindTexture()}else{let je=n.TEXTURE_2D;if((Z.isWebGL3DRenderTarget||Z.isWebGLArrayRenderTarget)&&(je=Z.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(je,Ae.__webglTexture),Le(je,V),V.mipmaps&&V.mipmaps.length>0)for(let tt=0;tt<V.mipmaps.length;tt++)ke(de.__webglFramebuffer[tt],Z,V,n.COLOR_ATTACHMENT0,je,tt);else ke(de.__webglFramebuffer,Z,V,n.COLOR_ATTACHMENT0,je,0);b(V)&&y(je),t.unbindTexture()}Z.depthBuffer&&lt(Z)}function Ee(Z){const V=Z.textures;for(let de=0,Ae=V.length;de<Ae;de++){const Re=V[de];if(b(Re)){const Ce=M(Z),ut=i.get(Re).__webglTexture;t.bindTexture(Ce,ut),y(Ce),t.unbindTexture()}}}const Oe=[],Q=[];function Ye(Z){if(Z.samples>0){if(it(Z)===!1){const V=Z.textures,de=Z.width,Ae=Z.height;let Re=n.COLOR_BUFFER_BIT;const Ce=Z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ut=i.get(Z),je=V.length>1;if(je)for(let tt=0;tt<V.length;tt++)t.bindFramebuffer(n.FRAMEBUFFER,ut.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+tt,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,ut.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+tt,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,ut.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ut.__webglFramebuffer);for(let tt=0;tt<V.length;tt++){if(Z.resolveDepthBuffer&&(Z.depthBuffer&&(Re|=n.DEPTH_BUFFER_BIT),Z.stencilBuffer&&Z.resolveStencilBuffer&&(Re|=n.STENCIL_BUFFER_BIT)),je){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ut.__webglColorRenderbuffer[tt]);const Ht=i.get(V[tt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Ht,0)}n.blitFramebuffer(0,0,de,Ae,0,0,de,Ae,Re,n.NEAREST),l===!0&&(Oe.length=0,Q.length=0,Oe.push(n.COLOR_ATTACHMENT0+tt),Z.depthBuffer&&Z.resolveDepthBuffer===!1&&(Oe.push(Ce),Q.push(Ce),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Q)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Oe))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),je)for(let tt=0;tt<V.length;tt++){t.bindFramebuffer(n.FRAMEBUFFER,ut.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+tt,n.RENDERBUFFER,ut.__webglColorRenderbuffer[tt]);const Ht=i.get(V[tt]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,ut.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+tt,n.TEXTURE_2D,Ht,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ut.__webglMultisampledFramebuffer)}else if(Z.depthBuffer&&Z.resolveDepthBuffer===!1&&l){const V=Z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[V])}}}function Be(Z){return Math.min(r.maxSamples,Z.samples)}function it(Z){const V=i.get(Z);return Z.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&V.__useRenderToTexture!==!1}function ze(Z){const V=o.render.frame;u.get(Z)!==V&&(u.set(Z,V),Z.update())}function wt(Z,V){const de=Z.colorSpace,Ae=Z.format,Re=Z.type;return Z.isCompressedTexture===!0||Z.isVideoTexture===!0||de!==sn&&de!==Ms&&(Xt.getTransfer(de)===mi?(Ae!==Ti||Re!==ar)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",de)),V}function et(Z){return typeof HTMLImageElement<"u"&&Z instanceof HTMLImageElement?(c.width=Z.naturalWidth||Z.width,c.height=Z.naturalHeight||Z.height):typeof VideoFrame<"u"&&Z instanceof VideoFrame?(c.width=Z.displayWidth,c.height=Z.displayHeight):(c.width=Z.width,c.height=Z.height),c}this.allocateTextureUnit=A,this.resetTextureUnits=j,this.setTexture2D=k,this.setTexture2DArray=G,this.setTexture3D=ee,this.setTextureCube=J,this.rebindTextures=rt,this.setupRenderTarget=_t,this.updateRenderTargetMipmap=Ee,this.updateMultisampleRenderTarget=Ye,this.setupDepthRenderbuffer=lt,this.setupFrameBufferTexture=ke,this.useMultisampledRTT=it}function wx(n,e){function t(i,r=Ms){let s;const o=Xt.getTransfer(r);if(i===ar)return n.UNSIGNED_BYTE;if(i===Gu)return n.UNSIGNED_SHORT_4_4_4_4;if(i===Vu)return n.UNSIGNED_SHORT_5_5_5_1;if(i===Km)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===qm)return n.BYTE;if(i===Zm)return n.SHORT;if(i===Jo)return n.UNSIGNED_SHORT;if(i===Hu)return n.INT;if(i===As)return n.UNSIGNED_INT;if(i===Ii)return n.FLOAT;if(i===er)return n.HALF_FLOAT;if(i===Qm)return n.ALPHA;if(i===$m)return n.RGB;if(i===Ti)return n.RGBA;if(i===Jm)return n.LUMINANCE;if(i===eg)return n.LUMINANCE_ALPHA;if(i===no)return n.DEPTH_COMPONENT;if(i===ta)return n.DEPTH_STENCIL;if(i===Wu)return n.RED;if(i===Xc)return n.RED_INTEGER;if(i===tg)return n.RG;if(i===Xu)return n.RG_INTEGER;if(i===Yu)return n.RGBA_INTEGER;if(i===Yc||i===jc||i===qc||i===Zc)if(o===mi)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===Yc)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===jc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===qc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Zc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===Yc)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===jc)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===qc)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Zc)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===ju||i===qu||i===Zu||i===Ku)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===ju)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===qu)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Zu)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Ku)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Qu||i===$u||i===Ju)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===Qu||i===$u)return o===mi?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===Ju)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===ef||i===tf||i===nf||i===rf||i===sf||i===of||i===af||i===lf||i===cf||i===hf||i===uf||i===ff||i===df||i===pf)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===ef)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===tf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===nf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===rf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===sf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===of)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===af)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===lf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===cf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===hf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===uf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===ff)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===df)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===pf)return o===mi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Kc||i===mf||i===gf)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===Kc)return o===mi?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===mf)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===gf)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===ig||i===_f||i===vf||i===yf)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===Kc)return s.COMPRESSED_RED_RGTC1_EXT;if(i===_f)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===vf)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===yf)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===ea?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}class Sx extends en{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let ur=class extends Dt{constructor(){super(),this.isGroup=!0,this.type="Group"}};const bL={type:"move"};class Vg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ur,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ur,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ur,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const x of e.hand.values()){const b=t.getJointPose(x,i),y=this._getHandJoint(c,x);b!==null&&(y.matrix.fromArray(b.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=b.radius),y.visible=b!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],p=u.position.distanceTo(d.position),g=.02,_=.005;c.inputState.pinching&&p>g+_?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&p<=g-_&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(bL)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new ur;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const xL=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,wL=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class SL{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const r=new yi,s=e.properties.get(r);s.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new wi({vertexShader:xL,fragmentShader:wL,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new pt(new Er(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class EL extends Jr{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,d=null,p=null,g=null,_=null;const x=new SL,b=t.getContextAttributes();let y=null,M=null;const E=[],w=[],I=new xe;let B=null;const N=new en;N.viewport=new Gt;const L=new en;L.viewport=new Gt;const P=[N,L],R=new Sx;let U=null,j=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(pe){let Te=E[pe];return Te===void 0&&(Te=new Vg,E[pe]=Te),Te.getTargetRaySpace()},this.getControllerGrip=function(pe){let Te=E[pe];return Te===void 0&&(Te=new Vg,E[pe]=Te),Te.getGripSpace()},this.getHand=function(pe){let Te=E[pe];return Te===void 0&&(Te=new Vg,E[pe]=Te),Te.getHandSpace()};function A(pe){const Te=w.indexOf(pe.inputSource);if(Te===-1)return;const ke=E[Te];ke!==void 0&&(ke.update(pe.inputSource,pe.frame,c||o),ke.dispatchEvent({type:pe.type,data:pe.inputSource}))}function D(){r.removeEventListener("select",A),r.removeEventListener("selectstart",A),r.removeEventListener("selectend",A),r.removeEventListener("squeeze",A),r.removeEventListener("squeezestart",A),r.removeEventListener("squeezeend",A),r.removeEventListener("end",D),r.removeEventListener("inputsourceschange",k);for(let pe=0;pe<E.length;pe++){const Te=w[pe];Te!==null&&(w[pe]=null,E[pe].disconnect(Te))}U=null,j=null,x.reset(),e.setRenderTarget(y),g=null,p=null,d=null,r=null,M=null,Ge.stop(),i.isPresenting=!1,e.setPixelRatio(B),e.setSize(I.width,I.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(pe){s=pe,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(pe){a=pe,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(pe){c=pe},this.getBaseLayer=function(){return p!==null?p:g},this.getBinding=function(){return d},this.getFrame=function(){return _},this.getSession=function(){return r},this.setSession=async function(pe){if(r=pe,r!==null){if(y=e.getRenderTarget(),r.addEventListener("select",A),r.addEventListener("selectstart",A),r.addEventListener("selectend",A),r.addEventListener("squeeze",A),r.addEventListener("squeezestart",A),r.addEventListener("squeezeend",A),r.addEventListener("end",D),r.addEventListener("inputsourceschange",k),b.xrCompatible!==!0&&await t.makeXRCompatible(),B=e.getPixelRatio(),e.getSize(I),r.renderState.layers===void 0){const Te={antialias:b.antialias,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:s};g=new XRWebGLLayer(r,t,Te),r.updateRenderState({baseLayer:g}),e.setPixelRatio(1),e.setSize(g.framebufferWidth,g.framebufferHeight,!1),M=new ji(g.framebufferWidth,g.framebufferHeight,{format:Ti,type:ar,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil})}else{let Te=null,ke=null,De=null;b.depth&&(De=b.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Te=b.stencil?ta:no,ke=b.stencil?ea:As);const Je={colorFormat:t.RGBA8,depthFormat:De,scaleFactor:s};d=new XRWebGLBinding(r,t),p=d.createProjectionLayer(Je),r.updateRenderState({layers:[p]}),e.setPixelRatio(1),e.setSize(p.textureWidth,p.textureHeight,!1),M=new ji(p.textureWidth,p.textureHeight,{format:Ti,type:ar,depthTexture:new Yf(p.textureWidth,p.textureHeight,ke,void 0,void 0,void 0,void 0,void 0,void 0,Te),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1})}M.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),Ge.setContext(r),Ge.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return x.getDepthTexture()};function k(pe){for(let Te=0;Te<pe.removed.length;Te++){const ke=pe.removed[Te],De=w.indexOf(ke);De>=0&&(w[De]=null,E[De].disconnect(ke))}for(let Te=0;Te<pe.added.length;Te++){const ke=pe.added[Te];let De=w.indexOf(ke);if(De===-1){for(let lt=0;lt<E.length;lt++)if(lt>=w.length){w.push(ke),De=lt;break}else if(w[lt]===null){w[lt]=ke,De=lt;break}if(De===-1)break}const Je=E[De];Je&&Je.connect(ke)}}const G=new q,ee=new q;function J(pe,Te,ke){G.setFromMatrixPosition(Te.matrixWorld),ee.setFromMatrixPosition(ke.matrixWorld);const De=G.distanceTo(ee),Je=Te.projectionMatrix.elements,lt=ke.projectionMatrix.elements,rt=Je[14]/(Je[10]-1),_t=Je[14]/(Je[10]+1),Ee=(Je[9]+1)/Je[5],Oe=(Je[9]-1)/Je[5],Q=(Je[8]-1)/Je[0],Ye=(lt[8]+1)/lt[0],Be=rt*Q,it=rt*Ye,ze=De/(-Q+Ye),wt=ze*-Q;if(Te.matrixWorld.decompose(pe.position,pe.quaternion,pe.scale),pe.translateX(wt),pe.translateZ(ze),pe.matrixWorld.compose(pe.position,pe.quaternion,pe.scale),pe.matrixWorldInverse.copy(pe.matrixWorld).invert(),Je[10]===-1)pe.projectionMatrix.copy(Te.projectionMatrix),pe.projectionMatrixInverse.copy(Te.projectionMatrixInverse);else{const et=rt+ze,Z=_t+ze,V=Be-wt,de=it+(De-wt),Ae=Ee*_t/Z*et,Re=Oe*_t/Z*et;pe.projectionMatrix.makePerspective(V,de,Ae,Re,et,Z),pe.projectionMatrixInverse.copy(pe.projectionMatrix).invert()}}function re(pe,Te){Te===null?pe.matrixWorld.copy(pe.matrix):pe.matrixWorld.multiplyMatrices(Te.matrixWorld,pe.matrix),pe.matrixWorldInverse.copy(pe.matrixWorld).invert()}this.updateCamera=function(pe){if(r===null)return;let Te=pe.near,ke=pe.far;x.texture!==null&&(x.depthNear>0&&(Te=x.depthNear),x.depthFar>0&&(ke=x.depthFar)),R.near=L.near=N.near=Te,R.far=L.far=N.far=ke,(U!==R.near||j!==R.far)&&(r.updateRenderState({depthNear:R.near,depthFar:R.far}),U=R.near,j=R.far),N.layers.mask=pe.layers.mask|2,L.layers.mask=pe.layers.mask|4,R.layers.mask=N.layers.mask|L.layers.mask;const De=pe.parent,Je=R.cameras;re(R,De);for(let lt=0;lt<Je.length;lt++)re(Je[lt],De);Je.length===2?J(R,N,L):R.projectionMatrix.copy(N.projectionMatrix),oe(pe,R,De)};function oe(pe,Te,ke){ke===null?pe.matrix.copy(Te.matrixWorld):(pe.matrix.copy(ke.matrixWorld),pe.matrix.invert(),pe.matrix.multiply(Te.matrixWorld)),pe.matrix.decompose(pe.position,pe.quaternion,pe.scale),pe.updateMatrixWorld(!0),pe.projectionMatrix.copy(Te.projectionMatrix),pe.projectionMatrixInverse.copy(Te.projectionMatrixInverse),pe.isPerspectiveCamera&&(pe.fov=ul*2*Math.atan(1/pe.projectionMatrix.elements[5]),pe.zoom=1)}this.getCamera=function(){return R},this.getFoveation=function(){if(!(p===null&&g===null))return l},this.setFoveation=function(pe){l=pe,p!==null&&(p.fixedFoveation=pe),g!==null&&g.fixedFoveation!==void 0&&(g.fixedFoveation=pe)},this.hasDepthSensing=function(){return x.texture!==null},this.getDepthSensingMesh=function(){return x.getMesh(R)};let me=null;function Le(pe,Te){if(u=Te.getViewerPose(c||o),_=Te,u!==null){const ke=u.views;g!==null&&(e.setRenderTargetFramebuffer(M,g.framebuffer),e.setRenderTarget(M));let De=!1;ke.length!==R.cameras.length&&(R.cameras.length=0,De=!0);for(let lt=0;lt<ke.length;lt++){const rt=ke[lt];let _t=null;if(g!==null)_t=g.getViewport(rt);else{const Oe=d.getViewSubImage(p,rt);_t=Oe.viewport,lt===0&&(e.setRenderTargetTextures(M,Oe.colorTexture,p.ignoreDepthValues?void 0:Oe.depthStencilTexture),e.setRenderTarget(M))}let Ee=P[lt];Ee===void 0&&(Ee=new en,Ee.layers.enable(lt),Ee.viewport=new Gt,P[lt]=Ee),Ee.matrix.fromArray(rt.transform.matrix),Ee.matrix.decompose(Ee.position,Ee.quaternion,Ee.scale),Ee.projectionMatrix.fromArray(rt.projectionMatrix),Ee.projectionMatrixInverse.copy(Ee.projectionMatrix).invert(),Ee.viewport.set(_t.x,_t.y,_t.width,_t.height),lt===0&&(R.matrix.copy(Ee.matrix),R.matrix.decompose(R.position,R.quaternion,R.scale)),De===!0&&R.cameras.push(Ee)}const Je=r.enabledFeatures;if(Je&&Je.includes("depth-sensing")){const lt=d.getDepthInformation(ke[0]);lt&&lt.isValid&&lt.texture&&x.init(e,lt,r.renderState)}}for(let ke=0;ke<E.length;ke++){const De=w[ke],Je=E[ke];De!==null&&Je!==void 0&&Je.update(De,Te,c||o)}me&&me(pe,Te),Te.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Te}),_=null}const Ge=new qb;Ge.setAnimationLoop(Le),this.setAnimationLoop=function(pe){me=pe},this.dispose=function(){}}}const ga=new Oi,TL=new Mt;function AL(n,e){function t(b,y){b.matrixAutoUpdate===!0&&b.updateMatrix(),y.value.copy(b.matrix)}function i(b,y){y.color.getRGB(b.fogColor.value,Vb(n)),y.isFog?(b.fogNear.value=y.near,b.fogFar.value=y.far):y.isFogExp2&&(b.fogDensity.value=y.density)}function r(b,y,M,E,w){y.isMeshBasicMaterial||y.isMeshLambertMaterial?s(b,y):y.isMeshToonMaterial?(s(b,y),d(b,y)):y.isMeshPhongMaterial?(s(b,y),u(b,y)):y.isMeshStandardMaterial?(s(b,y),p(b,y),y.isMeshPhysicalMaterial&&g(b,y,w)):y.isMeshMatcapMaterial?(s(b,y),_(b,y)):y.isMeshDepthMaterial?s(b,y):y.isMeshDistanceMaterial?(s(b,y),x(b,y)):y.isMeshNormalMaterial?s(b,y):y.isLineBasicMaterial?(o(b,y),y.isLineDashedMaterial&&a(b,y)):y.isPointsMaterial?l(b,y,M,E):y.isSpriteMaterial?c(b,y):y.isShadowMaterial?(b.color.value.copy(y.color),b.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function s(b,y){b.opacity.value=y.opacity,y.color&&b.diffuse.value.copy(y.color),y.emissive&&b.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(b.map.value=y.map,t(y.map,b.mapTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,t(y.alphaMap,b.alphaMapTransform)),y.bumpMap&&(b.bumpMap.value=y.bumpMap,t(y.bumpMap,b.bumpMapTransform),b.bumpScale.value=y.bumpScale,y.side===hn&&(b.bumpScale.value*=-1)),y.normalMap&&(b.normalMap.value=y.normalMap,t(y.normalMap,b.normalMapTransform),b.normalScale.value.copy(y.normalScale),y.side===hn&&b.normalScale.value.negate()),y.displacementMap&&(b.displacementMap.value=y.displacementMap,t(y.displacementMap,b.displacementMapTransform),b.displacementScale.value=y.displacementScale,b.displacementBias.value=y.displacementBias),y.emissiveMap&&(b.emissiveMap.value=y.emissiveMap,t(y.emissiveMap,b.emissiveMapTransform)),y.specularMap&&(b.specularMap.value=y.specularMap,t(y.specularMap,b.specularMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest);const M=e.get(y),E=M.envMap,w=M.envMapRotation;E&&(b.envMap.value=E,ga.copy(w),ga.x*=-1,ga.y*=-1,ga.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(ga.y*=-1,ga.z*=-1),b.envMapRotation.value.setFromMatrix4(TL.makeRotationFromEuler(ga)),b.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,b.reflectivity.value=y.reflectivity,b.ior.value=y.ior,b.refractionRatio.value=y.refractionRatio),y.lightMap&&(b.lightMap.value=y.lightMap,b.lightMapIntensity.value=y.lightMapIntensity,t(y.lightMap,b.lightMapTransform)),y.aoMap&&(b.aoMap.value=y.aoMap,b.aoMapIntensity.value=y.aoMapIntensity,t(y.aoMap,b.aoMapTransform))}function o(b,y){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,y.map&&(b.map.value=y.map,t(y.map,b.mapTransform))}function a(b,y){b.dashSize.value=y.dashSize,b.totalSize.value=y.dashSize+y.gapSize,b.scale.value=y.scale}function l(b,y,M,E){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,b.size.value=y.size*M,b.scale.value=E*.5,y.map&&(b.map.value=y.map,t(y.map,b.uvTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,t(y.alphaMap,b.alphaMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest)}function c(b,y){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,b.rotation.value=y.rotation,y.map&&(b.map.value=y.map,t(y.map,b.mapTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,t(y.alphaMap,b.alphaMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest)}function u(b,y){b.specular.value.copy(y.specular),b.shininess.value=Math.max(y.shininess,1e-4)}function d(b,y){y.gradientMap&&(b.gradientMap.value=y.gradientMap)}function p(b,y){b.metalness.value=y.metalness,y.metalnessMap&&(b.metalnessMap.value=y.metalnessMap,t(y.metalnessMap,b.metalnessMapTransform)),b.roughness.value=y.roughness,y.roughnessMap&&(b.roughnessMap.value=y.roughnessMap,t(y.roughnessMap,b.roughnessMapTransform)),y.envMap&&(b.envMapIntensity.value=y.envMapIntensity)}function g(b,y,M){b.ior.value=y.ior,y.sheen>0&&(b.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),b.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(b.sheenColorMap.value=y.sheenColorMap,t(y.sheenColorMap,b.sheenColorMapTransform)),y.sheenRoughnessMap&&(b.sheenRoughnessMap.value=y.sheenRoughnessMap,t(y.sheenRoughnessMap,b.sheenRoughnessMapTransform))),y.clearcoat>0&&(b.clearcoat.value=y.clearcoat,b.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(b.clearcoatMap.value=y.clearcoatMap,t(y.clearcoatMap,b.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(b.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,t(y.clearcoatRoughnessMap,b.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(b.clearcoatNormalMap.value=y.clearcoatNormalMap,t(y.clearcoatNormalMap,b.clearcoatNormalMapTransform),b.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===hn&&b.clearcoatNormalScale.value.negate())),y.dispersion>0&&(b.dispersion.value=y.dispersion),y.iridescence>0&&(b.iridescence.value=y.iridescence,b.iridescenceIOR.value=y.iridescenceIOR,b.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],b.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(b.iridescenceMap.value=y.iridescenceMap,t(y.iridescenceMap,b.iridescenceMapTransform)),y.iridescenceThicknessMap&&(b.iridescenceThicknessMap.value=y.iridescenceThicknessMap,t(y.iridescenceThicknessMap,b.iridescenceThicknessMapTransform))),y.transmission>0&&(b.transmission.value=y.transmission,b.transmissionSamplerMap.value=M.texture,b.transmissionSamplerSize.value.set(M.width,M.height),y.transmissionMap&&(b.transmissionMap.value=y.transmissionMap,t(y.transmissionMap,b.transmissionMapTransform)),b.thickness.value=y.thickness,y.thicknessMap&&(b.thicknessMap.value=y.thicknessMap,t(y.thicknessMap,b.thicknessMapTransform)),b.attenuationDistance.value=y.attenuationDistance,b.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(b.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(b.anisotropyMap.value=y.anisotropyMap,t(y.anisotropyMap,b.anisotropyMapTransform))),b.specularIntensity.value=y.specularIntensity,b.specularColor.value.copy(y.specularColor),y.specularColorMap&&(b.specularColorMap.value=y.specularColorMap,t(y.specularColorMap,b.specularColorMapTransform)),y.specularIntensityMap&&(b.specularIntensityMap.value=y.specularIntensityMap,t(y.specularIntensityMap,b.specularIntensityMapTransform))}function _(b,y){y.matcap&&(b.matcap.value=y.matcap)}function x(b,y){const M=e.get(y).light;b.referencePosition.value.setFromMatrixPosition(M.matrixWorld),b.nearDistance.value=M.shadow.camera.near,b.farDistance.value=M.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function ML(n,e,t,i){let r={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(M,E){const w=E.program;i.uniformBlockBinding(M,w)}function c(M,E){let w=r[M.id];w===void 0&&(_(M),w=u(M),r[M.id]=w,M.addEventListener("dispose",b));const I=E.program;i.updateUBOMapping(M,I);const B=e.render.frame;s[M.id]!==B&&(p(M),s[M.id]=B)}function u(M){const E=d();M.__bindingPointIndex=E;const w=n.createBuffer(),I=M.__size,B=M.usage;return n.bindBuffer(n.UNIFORM_BUFFER,w),n.bufferData(n.UNIFORM_BUFFER,I,B),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,E,w),w}function d(){for(let M=0;M<a;M++)if(o.indexOf(M)===-1)return o.push(M),M;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function p(M){const E=r[M.id],w=M.uniforms,I=M.__cache;n.bindBuffer(n.UNIFORM_BUFFER,E);for(let B=0,N=w.length;B<N;B++){const L=Array.isArray(w[B])?w[B]:[w[B]];for(let P=0,R=L.length;P<R;P++){const U=L[P];if(g(U,B,P,I)===!0){const j=U.__offset,A=Array.isArray(U.value)?U.value:[U.value];let D=0;for(let k=0;k<A.length;k++){const G=A[k],ee=x(G);typeof G=="number"||typeof G=="boolean"?(U.__data[0]=G,n.bufferSubData(n.UNIFORM_BUFFER,j+D,U.__data)):G.isMatrix3?(U.__data[0]=G.elements[0],U.__data[1]=G.elements[1],U.__data[2]=G.elements[2],U.__data[3]=0,U.__data[4]=G.elements[3],U.__data[5]=G.elements[4],U.__data[6]=G.elements[5],U.__data[7]=0,U.__data[8]=G.elements[6],U.__data[9]=G.elements[7],U.__data[10]=G.elements[8],U.__data[11]=0):(G.toArray(U.__data,D),D+=ee.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,j,U.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function g(M,E,w,I){const B=M.value,N=E+"_"+w;if(I[N]===void 0)return typeof B=="number"||typeof B=="boolean"?I[N]=B:I[N]=B.clone(),!0;{const L=I[N];if(typeof B=="number"||typeof B=="boolean"){if(L!==B)return I[N]=B,!0}else if(L.equals(B)===!1)return L.copy(B),!0}return!1}function _(M){const E=M.uniforms;let w=0;const I=16;for(let N=0,L=E.length;N<L;N++){const P=Array.isArray(E[N])?E[N]:[E[N]];for(let R=0,U=P.length;R<U;R++){const j=P[R],A=Array.isArray(j.value)?j.value:[j.value];for(let D=0,k=A.length;D<k;D++){const G=A[D],ee=x(G),J=w%I,re=J%ee.boundary,oe=J+re;w+=re,oe!==0&&I-oe<ee.storage&&(w+=I-oe),j.__data=new Float32Array(ee.storage/Float32Array.BYTES_PER_ELEMENT),j.__offset=w,w+=ee.storage}}}const B=w%I;return B>0&&(w+=I-B),M.__size=w,M.__cache={},this}function x(M){const E={boundary:0,storage:0};return typeof M=="number"||typeof M=="boolean"?(E.boundary=4,E.storage=4):M.isVector2?(E.boundary=8,E.storage=8):M.isVector3||M.isColor?(E.boundary=16,E.storage=12):M.isVector4?(E.boundary=16,E.storage=16):M.isMatrix3?(E.boundary=48,E.storage=48):M.isMatrix4?(E.boundary=64,E.storage=64):M.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",M),E}function b(M){const E=M.target;E.removeEventListener("dispose",b);const w=o.indexOf(E.__bindingPointIndex);o.splice(w,1),n.deleteBuffer(r[E.id]),delete r[E.id],delete s[E.id]}function y(){for(const M in r)n.deleteBuffer(r[M]);o=[],r={},s={}}return{bind:l,update:c,dispose:y}}class Kf{constructor(e={}){const{canvas:t=xb(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1,reverseDepthBuffer:p=!1}=e;this.isWebGLRenderer=!0;let g;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");g=i.getContextAttributes().alpha}else g=o;const _=new Uint32Array(4),x=new Int32Array(4);let b=null,y=null;const M=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ai,this.toneMapping=xr,this.toneMappingExposure=1;const w=this;let I=!1,B=0,N=0,L=null,P=-1,R=null;const U=new Gt,j=new Gt;let A=null;const D=new ve(0);let k=0,G=t.width,ee=t.height,J=1,re=null,oe=null;const me=new Gt(0,0,G,ee),Le=new Gt(0,0,G,ee);let Ge=!1;const pe=new fa;let Te=!1,ke=!1;const De=new Mt,Je=new Mt,lt=new q,rt=new Gt,_t={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ee=!1;function Oe(){return L===null?J:1}let Q=i;function Ye(Y,le){return t.getContext(Y,le)}try{const Y={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${wn}`),t.addEventListener("webglcontextlost",Ie,!1),t.addEventListener("webglcontextrestored",Ke,!1),t.addEventListener("webglcontextcreationerror",Qe,!1),Q===null){const le="webgl2";if(Q=Ye(le,Y),Q===null)throw Ye(le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Y){throw console.error("THREE.WebGLRenderer: "+Y.message),Y}let Be,it,ze,wt,et,Z,V,de,Ae,Re,Ce,ut,je,tt,Ht,Ue,ot,Et,At,st,Yt,Rt,hi,se;function Ve(){Be=new LR(Q),Be.init(),Rt=new wx(Q,Be),it=new MR(Q,Be,e,Rt),ze=new dL(Q,Be),it.reverseDepthBuffer&&p&&ze.buffers.depth.setReversed(!0),wt=new BR(Q),et=new eL,Z=new yL(Q,Be,ze,et,it,Rt,wt),V=new IR(w),de=new DR(w),Ae=new SI(Q),hi=new TR(Q,Ae),Re=new OR(Q,Ae,wt,hi),Ce=new UR(Q,Re,Ae,wt),At=new FR(Q,it,Z),Ue=new CR(et),ut=new JD(w,V,de,Be,it,hi,Ue),je=new AL(w,et),tt=new iL,Ht=new lL(Be),Et=new ER(w,V,de,ze,Ce,g,l),ot=new uL(w,Ce,it),se=new ML(Q,wt,it,ze),st=new AR(Q,Be,wt),Yt=new NR(Q,Be,wt),wt.programs=ut.programs,w.capabilities=it,w.extensions=Be,w.properties=et,w.renderLists=tt,w.shadowMap=ot,w.state=ze,w.info=wt}Ve();const be=new EL(w,Q);this.xr=be,this.getContext=function(){return Q},this.getContextAttributes=function(){return Q.getContextAttributes()},this.forceContextLoss=function(){const Y=Be.get("WEBGL_lose_context");Y&&Y.loseContext()},this.forceContextRestore=function(){const Y=Be.get("WEBGL_lose_context");Y&&Y.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(Y){Y!==void 0&&(J=Y,this.setSize(G,ee,!1))},this.getSize=function(Y){return Y.set(G,ee)},this.setSize=function(Y,le,ge=!0){if(be.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}G=Y,ee=le,t.width=Math.floor(Y*J),t.height=Math.floor(le*J),ge===!0&&(t.style.width=Y+"px",t.style.height=le+"px"),this.setViewport(0,0,Y,le)},this.getDrawingBufferSize=function(Y){return Y.set(G*J,ee*J).floor()},this.setDrawingBufferSize=function(Y,le,ge){G=Y,ee=le,J=ge,t.width=Math.floor(Y*ge),t.height=Math.floor(le*ge),this.setViewport(0,0,Y,le)},this.getCurrentViewport=function(Y){return Y.copy(U)},this.getViewport=function(Y){return Y.copy(me)},this.setViewport=function(Y,le,ge,_e){Y.isVector4?me.set(Y.x,Y.y,Y.z,Y.w):me.set(Y,le,ge,_e),ze.viewport(U.copy(me).multiplyScalar(J).round())},this.getScissor=function(Y){return Y.copy(Le)},this.setScissor=function(Y,le,ge,_e){Y.isVector4?Le.set(Y.x,Y.y,Y.z,Y.w):Le.set(Y,le,ge,_e),ze.scissor(j.copy(Le).multiplyScalar(J).round())},this.getScissorTest=function(){return Ge},this.setScissorTest=function(Y){ze.setScissorTest(Ge=Y)},this.setOpaqueSort=function(Y){re=Y},this.setTransparentSort=function(Y){oe=Y},this.getClearColor=function(Y){return Y.copy(Et.getClearColor())},this.setClearColor=function(){Et.setClearColor.apply(Et,arguments)},this.getClearAlpha=function(){return Et.getClearAlpha()},this.setClearAlpha=function(){Et.setClearAlpha.apply(Et,arguments)},this.clear=function(Y=!0,le=!0,ge=!0){let _e=0;if(Y){let ce=!1;if(L!==null){const Fe=L.texture.format;ce=Fe===Yu||Fe===Xu||Fe===Xc}if(ce){const Fe=L.texture.type,qe=Fe===ar||Fe===As||Fe===Jo||Fe===ea||Fe===Gu||Fe===Vu,dt=Et.getClearColor(),ct=Et.getClearAlpha(),Ct=dt.r,It=dt.g,ft=dt.b;qe?(_[0]=Ct,_[1]=It,_[2]=ft,_[3]=ct,Q.clearBufferuiv(Q.COLOR,0,_)):(x[0]=Ct,x[1]=It,x[2]=ft,x[3]=ct,Q.clearBufferiv(Q.COLOR,0,x))}else _e|=Q.COLOR_BUFFER_BIT}le&&(_e|=Q.DEPTH_BUFFER_BIT),ge&&(_e|=Q.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Q.clear(_e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ie,!1),t.removeEventListener("webglcontextrestored",Ke,!1),t.removeEventListener("webglcontextcreationerror",Qe,!1),tt.dispose(),Ht.dispose(),et.dispose(),V.dispose(),de.dispose(),Ce.dispose(),hi.dispose(),se.dispose(),ut.dispose(),be.dispose(),be.removeEventListener("sessionstart",Lc),be.removeEventListener("sessionend",Oc),Zr.stop()};function Ie(Y){Y.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function Ke(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1;const Y=wt.autoReset,le=ot.enabled,ge=ot.autoUpdate,_e=ot.needsUpdate,ce=ot.type;Ve(),wt.autoReset=Y,ot.enabled=le,ot.autoUpdate=ge,ot.needsUpdate=_e,ot.type=ce}function Qe(Y){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Y.statusMessage)}function Nt(Y){const le=Y.target;le.removeEventListener("dispose",Nt),Si(le)}function Si(Y){Qi(Y),et.remove(Y)}function Qi(Y){const le=et.get(Y).programs;le!==void 0&&(le.forEach(function(ge){ut.releaseProgram(ge)}),Y.isShaderMaterial&&ut.releaseShaderCache(Y))}this.renderBufferDirect=function(Y,le,ge,_e,ce,Fe){le===null&&(le=_t);const qe=ce.isMesh&&ce.matrixWorld.determinant()<0,dt=Cu(Y,le,ge,_e,ce);ze.setMaterial(_e,qe);let ct=ge.index,Ct=1;if(_e.wireframe===!0){if(ct=Re.getWireframeAttribute(ge),ct===void 0)return;Ct=2}const It=ge.drawRange,ft=ge.attributes.position;let Zt=It.start*Ct,pi=(It.start+It.count)*Ct;Fe!==null&&(Zt=Math.max(Zt,Fe.start*Ct),pi=Math.min(pi,(Fe.start+Fe.count)*Ct)),ct!==null?(Zt=Math.max(Zt,0),pi=Math.min(pi,ct.count)):ft!=null&&(Zt=Math.max(Zt,0),pi=Math.min(pi,ft.count));const ui=pi-Zt;if(ui<0||ui===1/0)return;hi.setup(ce,_e,dt,ge,ct);let oi,ii=st;if(ct!==null&&(oi=Ae.get(ct),ii=Yt,ii.setIndex(oi)),ce.isMesh)_e.wireframe===!0?(ze.setLineWidth(_e.wireframeLinewidth*Oe()),ii.setMode(Q.LINES)):ii.setMode(Q.TRIANGLES);else if(ce.isLine){let z=_e.linewidth;z===void 0&&(z=1),ze.setLineWidth(z*Oe()),ce.isLineSegments?ii.setMode(Q.LINES):ce.isLineLoop?ii.setMode(Q.LINE_LOOP):ii.setMode(Q.LINE_STRIP)}else ce.isPoints?ii.setMode(Q.POINTS):ce.isSprite&&ii.setMode(Q.TRIANGLES);if(ce.isBatchedMesh)if(ce._multiDrawInstances!==null)ii.renderMultiDrawInstances(ce._multiDrawStarts,ce._multiDrawCounts,ce._multiDrawCount,ce._multiDrawInstances);else if(Be.get("WEBGL_multi_draw"))ii.renderMultiDraw(ce._multiDrawStarts,ce._multiDrawCounts,ce._multiDrawCount);else{const z=ce._multiDrawStarts,te=ce._multiDrawCounts,W=ce._multiDrawCount,ne=ct?Ae.get(ct).bytesPerElement:1,ae=et.get(_e).currentProgram.getUniforms();for(let ie=0;ie<W;ie++)ae.setValue(Q,"_gl_DrawID",ie),ii.render(z[ie]/ne,te[ie])}else if(ce.isInstancedMesh)ii.renderInstances(Zt,ui,ce.count);else if(ge.isInstancedBufferGeometry){const z=ge._maxInstanceCount!==void 0?ge._maxInstanceCount:1/0,te=Math.min(ge.instanceCount,z);ii.renderInstances(Zt,ui,te)}else ii.render(Zt,ui)};function ri(Y,le,ge){Y.transparent===!0&&Y.side===Jn&&Y.forceSinglePass===!1?(Y.side=hn,Y.needsUpdate=!0,Ko(Y,le,ge),Y.side=br,Y.needsUpdate=!0,Ko(Y,le,ge),Y.side=Jn):Ko(Y,le,ge)}this.compile=function(Y,le,ge=null){ge===null&&(ge=Y),y=Ht.get(ge),y.init(le),E.push(y),ge.traverseVisible(function(ce){ce.isLight&&ce.layers.test(le.layers)&&(y.pushLight(ce),ce.castShadow&&y.pushShadow(ce))}),Y!==ge&&Y.traverseVisible(function(ce){ce.isLight&&ce.layers.test(le.layers)&&(y.pushLight(ce),ce.castShadow&&y.pushShadow(ce))}),y.setupLights();const _e=new Set;return Y.traverse(function(ce){if(!(ce.isMesh||ce.isPoints||ce.isLine||ce.isSprite))return;const Fe=ce.material;if(Fe)if(Array.isArray(Fe))for(let qe=0;qe<Fe.length;qe++){const dt=Fe[qe];ri(dt,ge,ce),_e.add(dt)}else ri(Fe,ge,ce),_e.add(Fe)}),E.pop(),y=null,_e},this.compileAsync=function(Y,le,ge=null){const _e=this.compile(Y,le,ge);return new Promise(ce=>{function Fe(){if(_e.forEach(function(qe){et.get(qe).currentProgram.isReady()&&_e.delete(qe)}),_e.size===0){ce(Y);return}setTimeout(Fe,10)}Be.get("KHR_parallel_shader_compile")!==null?Fe():setTimeout(Fe,10)})};let $n=null;function vr(Y){$n&&$n(Y)}function Lc(){Zr.stop()}function Oc(){Zr.start()}const Zr=new qb;Zr.setAnimationLoop(vr),typeof self<"u"&&Zr.setContext(self),this.setAnimationLoop=function(Y){$n=Y,be.setAnimationLoop(Y),Y===null?Zr.stop():Zr.start()},be.addEventListener("sessionstart",Lc),be.addEventListener("sessionend",Oc),this.render=function(Y,le){if(le!==void 0&&le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(I===!0)return;if(Y.matrixWorldAutoUpdate===!0&&Y.updateMatrixWorld(),le.parent===null&&le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),be.enabled===!0&&be.isPresenting===!0&&(be.cameraAutoUpdate===!0&&be.updateCamera(le),le=be.getCamera()),Y.isScene===!0&&Y.onBeforeRender(w,Y,le,L),y=Ht.get(Y,E.length),y.init(le),E.push(y),Je.multiplyMatrices(le.projectionMatrix,le.matrixWorldInverse),pe.setFromProjectionMatrix(Je),ke=this.localClippingEnabled,Te=Ue.init(this.clippingPlanes,ke),b=tt.get(Y,M.length),b.init(),M.push(b),be.enabled===!0&&be.isPresenting===!0){const Fe=w.xr.getDepthSensingMesh();Fe!==null&&qo(Fe,le,-1/0,w.sortObjects)}qo(Y,le,0,w.sortObjects),b.finish(),w.sortObjects===!0&&b.sort(re,oe),Ee=be.enabled===!1||be.isPresenting===!1||be.hasDepthSensing()===!1,Ee&&Et.addToRenderList(b,Y),this.info.render.frame++,Te===!0&&Ue.beginShadows();const ge=y.state.shadowsArray;ot.render(ge,Y,le),Te===!0&&Ue.endShadows(),this.info.autoReset===!0&&this.info.reset();const _e=b.opaque,ce=b.transmissive;if(y.setupLights(),le.isArrayCamera){const Fe=le.cameras;if(ce.length>0)for(let qe=0,dt=Fe.length;qe<dt;qe++){const ct=Fe[qe];Bc(_e,ce,Y,ct)}Ee&&Et.render(Y);for(let qe=0,dt=Fe.length;qe<dt;qe++){const ct=Fe[qe];Nc(b,Y,ct,ct.viewport)}}else ce.length>0&&Bc(_e,ce,Y,le),Ee&&Et.render(Y),Nc(b,Y,le);L!==null&&(Z.updateMultisampleRenderTarget(L),Z.updateRenderTargetMipmap(L)),Y.isScene===!0&&Y.onAfterRender(w,Y,le),hi.resetDefaultState(),P=-1,R=null,E.pop(),E.length>0?(y=E[E.length-1],Te===!0&&Ue.setGlobalState(w.clippingPlanes,y.state.camera)):y=null,M.pop(),M.length>0?b=M[M.length-1]:b=null};function qo(Y,le,ge,_e){if(Y.visible===!1)return;if(Y.layers.test(le.layers)){if(Y.isGroup)ge=Y.renderOrder;else if(Y.isLOD)Y.autoUpdate===!0&&Y.update(le);else if(Y.isLight)y.pushLight(Y),Y.castShadow&&y.pushShadow(Y);else if(Y.isSprite){if(!Y.frustumCulled||pe.intersectsSprite(Y)){_e&&rt.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(Je);const qe=Ce.update(Y),dt=Y.material;dt.visible&&b.push(Y,qe,dt,ge,rt.z,null)}}else if((Y.isMesh||Y.isLine||Y.isPoints)&&(!Y.frustumCulled||pe.intersectsObject(Y))){const qe=Ce.update(Y),dt=Y.material;if(_e&&(Y.boundingSphere!==void 0?(Y.boundingSphere===null&&Y.computeBoundingSphere(),rt.copy(Y.boundingSphere.center)):(qe.boundingSphere===null&&qe.computeBoundingSphere(),rt.copy(qe.boundingSphere.center)),rt.applyMatrix4(Y.matrixWorld).applyMatrix4(Je)),Array.isArray(dt)){const ct=qe.groups;for(let Ct=0,It=ct.length;Ct<It;Ct++){const ft=ct[Ct],Zt=dt[ft.materialIndex];Zt&&Zt.visible&&b.push(Y,qe,Zt,ge,rt.z,ft)}}else dt.visible&&b.push(Y,qe,dt,ge,rt.z,null)}}const Fe=Y.children;for(let qe=0,dt=Fe.length;qe<dt;qe++)qo(Fe[qe],le,ge,_e)}function Nc(Y,le,ge,_e){const ce=Y.opaque,Fe=Y.transmissive,qe=Y.transparent;y.setupLightsView(ge),Te===!0&&Ue.setGlobalState(w.clippingPlanes,ge),_e&&ze.viewport(U.copy(_e)),ce.length>0&&Zo(ce,le,ge),Fe.length>0&&Zo(Fe,le,ge),qe.length>0&&Zo(qe,le,ge),ze.buffers.depth.setTest(!0),ze.buffers.depth.setMask(!0),ze.buffers.color.setMask(!0),ze.setPolygonOffset(!1)}function Bc(Y,le,ge,_e){if((ge.isScene===!0?ge.overrideMaterial:null)!==null)return;y.state.transmissionRenderTarget[_e.id]===void 0&&(y.state.transmissionRenderTarget[_e.id]=new ji(1,1,{generateMipmaps:!0,type:Be.has("EXT_color_buffer_half_float")||Be.has("EXT_color_buffer_float")?er:ar,minFilter:wr,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Xt.workingColorSpace}));const Fe=y.state.transmissionRenderTarget[_e.id],qe=_e.viewport||U;Fe.setSize(qe.z,qe.w);const dt=w.getRenderTarget();w.setRenderTarget(Fe),w.getClearColor(D),k=w.getClearAlpha(),k<1&&w.setClearColor(16777215,.5),w.clear(),Ee&&Et.render(ge);const ct=w.toneMapping;w.toneMapping=xr;const Ct=_e.viewport;if(_e.viewport!==void 0&&(_e.viewport=void 0),y.setupLightsView(_e),Te===!0&&Ue.setGlobalState(w.clippingPlanes,_e),Zo(Y,ge,_e),Z.updateMultisampleRenderTarget(Fe),Z.updateRenderTargetMipmap(Fe),Be.has("WEBGL_multisampled_render_to_texture")===!1){let It=!1;for(let ft=0,Zt=le.length;ft<Zt;ft++){const pi=le[ft],ui=pi.object,oi=pi.geometry,ii=pi.material,z=pi.group;if(ii.side===Jn&&ui.layers.test(_e.layers)){const te=ii.side;ii.side=hn,ii.needsUpdate=!0,Fc(ui,ge,_e,oi,ii,z),ii.side=te,ii.needsUpdate=!0,It=!0}}It===!0&&(Z.updateMultisampleRenderTarget(Fe),Z.updateRenderTargetMipmap(Fe))}w.setRenderTarget(dt),w.setClearColor(D,k),Ct!==void 0&&(_e.viewport=Ct),w.toneMapping=ct}function Zo(Y,le,ge){const _e=le.isScene===!0?le.overrideMaterial:null;for(let ce=0,Fe=Y.length;ce<Fe;ce++){const qe=Y[ce],dt=qe.object,ct=qe.geometry,Ct=_e===null?qe.material:_e,It=qe.group;dt.layers.test(ge.layers)&&Fc(dt,le,ge,ct,Ct,It)}}function Fc(Y,le,ge,_e,ce,Fe){Y.onBeforeRender(w,le,ge,_e,ce,Fe),Y.modelViewMatrix.multiplyMatrices(ge.matrixWorldInverse,Y.matrixWorld),Y.normalMatrix.getNormalMatrix(Y.modelViewMatrix),ce.onBeforeRender(w,le,ge,_e,Y,Fe),ce.transparent===!0&&ce.side===Jn&&ce.forceSinglePass===!1?(ce.side=hn,ce.needsUpdate=!0,w.renderBufferDirect(ge,le,_e,ce,Y,Fe),ce.side=br,ce.needsUpdate=!0,w.renderBufferDirect(ge,le,_e,ce,Y,Fe),ce.side=Jn):w.renderBufferDirect(ge,le,_e,ce,Y,Fe),Y.onAfterRender(w,le,ge,_e,ce,Fe)}function Ko(Y,le,ge){le.isScene!==!0&&(le=_t);const _e=et.get(Y),ce=y.state.lights,Fe=y.state.shadowsArray,qe=ce.state.version,dt=ut.getParameters(Y,ce.state,Fe,le,ge),ct=ut.getProgramCacheKey(dt);let Ct=_e.programs;_e.environment=Y.isMeshStandardMaterial?le.environment:null,_e.fog=le.fog,_e.envMap=(Y.isMeshStandardMaterial?de:V).get(Y.envMap||_e.environment),_e.envMapRotation=_e.environment!==null&&Y.envMap===null?le.environmentRotation:Y.envMapRotation,Ct===void 0&&(Y.addEventListener("dispose",Nt),Ct=new Map,_e.programs=Ct);let It=Ct.get(ct);if(It!==void 0){if(_e.currentProgram===It&&_e.lightsStateVersion===qe)return kc(Y,dt),It}else dt.uniforms=ut.getUniforms(Y),Y.onBeforeCompile(dt,w),It=ut.acquireProgram(dt,ct),Ct.set(ct,It),_e.uniforms=dt.uniforms;const ft=_e.uniforms;return(!Y.isShaderMaterial&&!Y.isRawShaderMaterial||Y.clipping===!0)&&(ft.clippingPlanes=Ue.uniform),kc(Y,dt),_e.needsLights=zc(Y),_e.lightsStateVersion=qe,_e.needsLights&&(ft.ambientLightColor.value=ce.state.ambient,ft.lightProbe.value=ce.state.probe,ft.directionalLights.value=ce.state.directional,ft.directionalLightShadows.value=ce.state.directionalShadow,ft.spotLights.value=ce.state.spot,ft.spotLightShadows.value=ce.state.spotShadow,ft.rectAreaLights.value=ce.state.rectArea,ft.ltc_1.value=ce.state.rectAreaLTC1,ft.ltc_2.value=ce.state.rectAreaLTC2,ft.pointLights.value=ce.state.point,ft.pointLightShadows.value=ce.state.pointShadow,ft.hemisphereLights.value=ce.state.hemi,ft.directionalShadowMap.value=ce.state.directionalShadowMap,ft.directionalShadowMatrix.value=ce.state.directionalShadowMatrix,ft.spotShadowMap.value=ce.state.spotShadowMap,ft.spotLightMatrix.value=ce.state.spotLightMatrix,ft.spotLightMap.value=ce.state.spotLightMap,ft.pointShadowMap.value=ce.state.pointShadowMap,ft.pointShadowMatrix.value=ce.state.pointShadowMatrix),_e.currentProgram=It,_e.uniformsList=null,It}function Uc(Y){if(Y.uniformsList===null){const le=Y.currentProgram.getUniforms();Y.uniformsList=qf.seqWithValue(le.seq,Y.uniforms)}return Y.uniformsList}function kc(Y,le){const ge=et.get(Y);ge.outputColorSpace=le.outputColorSpace,ge.batching=le.batching,ge.batchingColor=le.batchingColor,ge.instancing=le.instancing,ge.instancingColor=le.instancingColor,ge.instancingMorph=le.instancingMorph,ge.skinning=le.skinning,ge.morphTargets=le.morphTargets,ge.morphNormals=le.morphNormals,ge.morphColors=le.morphColors,ge.morphTargetsCount=le.morphTargetsCount,ge.numClippingPlanes=le.numClippingPlanes,ge.numIntersection=le.numClipIntersection,ge.vertexAlphas=le.vertexAlphas,ge.vertexTangents=le.vertexTangents,ge.toneMapping=le.toneMapping}function Cu(Y,le,ge,_e,ce){le.isScene!==!0&&(le=_t),Z.resetTextureUnits();const Fe=le.fog,qe=_e.isMeshStandardMaterial?le.environment:null,dt=L===null?w.outputColorSpace:L.isXRRenderTarget===!0?L.texture.colorSpace:sn,ct=(_e.isMeshStandardMaterial?de:V).get(_e.envMap||qe),Ct=_e.vertexColors===!0&&!!ge.attributes.color&&ge.attributes.color.itemSize===4,It=!!ge.attributes.tangent&&(!!_e.normalMap||_e.anisotropy>0),ft=!!ge.morphAttributes.position,Zt=!!ge.morphAttributes.normal,pi=!!ge.morphAttributes.color;let ui=xr;_e.toneMapped&&(L===null||L.isXRRenderTarget===!0)&&(ui=w.toneMapping);const oi=ge.morphAttributes.position||ge.morphAttributes.normal||ge.morphAttributes.color,ii=oi!==void 0?oi.length:0,z=et.get(_e),te=y.state.lights;if(Te===!0&&(ke===!0||Y!==R)){const v=Y===R&&_e.id===P;Ue.setState(_e,Y,v)}let W=!1;_e.version===z.__version?(z.needsLights&&z.lightsStateVersion!==te.state.version||z.outputColorSpace!==dt||ce.isBatchedMesh&&z.batching===!1||!ce.isBatchedMesh&&z.batching===!0||ce.isBatchedMesh&&z.batchingColor===!0&&ce.colorTexture===null||ce.isBatchedMesh&&z.batchingColor===!1&&ce.colorTexture!==null||ce.isInstancedMesh&&z.instancing===!1||!ce.isInstancedMesh&&z.instancing===!0||ce.isSkinnedMesh&&z.skinning===!1||!ce.isSkinnedMesh&&z.skinning===!0||ce.isInstancedMesh&&z.instancingColor===!0&&ce.instanceColor===null||ce.isInstancedMesh&&z.instancingColor===!1&&ce.instanceColor!==null||ce.isInstancedMesh&&z.instancingMorph===!0&&ce.morphTexture===null||ce.isInstancedMesh&&z.instancingMorph===!1&&ce.morphTexture!==null||z.envMap!==ct||_e.fog===!0&&z.fog!==Fe||z.numClippingPlanes!==void 0&&(z.numClippingPlanes!==Ue.numPlanes||z.numIntersection!==Ue.numIntersection)||z.vertexAlphas!==Ct||z.vertexTangents!==It||z.morphTargets!==ft||z.morphNormals!==Zt||z.morphColors!==pi||z.toneMapping!==ui||z.morphTargetsCount!==ii)&&(W=!0):(W=!0,z.__version=_e.version);let ne=z.currentProgram;W===!0&&(ne=Ko(_e,le,ce));let ae=!1,ie=!1,Se=!1;const we=ne.getUniforms(),h=z.uniforms;if(ze.useProgram(ne.program)&&(ae=!0,ie=!0,Se=!0),_e.id!==P&&(P=_e.id,ie=!0),ae||R!==Y){ze.buffers.depth.getReversed()?(De.copy(Y.projectionMatrix),ZC(De),KC(De),we.setValue(Q,"projectionMatrix",De)):we.setValue(Q,"projectionMatrix",Y.projectionMatrix),we.setValue(Q,"viewMatrix",Y.matrixWorldInverse);const S=we.map.cameraPosition;S!==void 0&&S.setValue(Q,lt.setFromMatrixPosition(Y.matrixWorld)),it.logarithmicDepthBuffer&&we.setValue(Q,"logDepthBufFC",2/(Math.log(Y.far+1)/Math.LN2)),(_e.isMeshPhongMaterial||_e.isMeshToonMaterial||_e.isMeshLambertMaterial||_e.isMeshBasicMaterial||_e.isMeshStandardMaterial||_e.isShaderMaterial)&&we.setValue(Q,"isOrthographic",Y.isOrthographicCamera===!0),R!==Y&&(R=Y,ie=!0,Se=!0)}if(ce.isSkinnedMesh){we.setOptional(Q,ce,"bindMatrix"),we.setOptional(Q,ce,"bindMatrixInverse");const v=ce.skeleton;v&&(v.boneTexture===null&&v.computeBoneTexture(),we.setValue(Q,"boneTexture",v.boneTexture,Z))}ce.isBatchedMesh&&(we.setOptional(Q,ce,"batchingTexture"),we.setValue(Q,"batchingTexture",ce._matricesTexture,Z),we.setOptional(Q,ce,"batchingIdTexture"),we.setValue(Q,"batchingIdTexture",ce._indirectTexture,Z),we.setOptional(Q,ce,"batchingColorTexture"),ce._colorsTexture!==null&&we.setValue(Q,"batchingColorTexture",ce._colorsTexture,Z));const m=ge.morphAttributes;if((m.position!==void 0||m.normal!==void 0||m.color!==void 0)&&At.update(ce,ge,ne),(ie||z.receiveShadow!==ce.receiveShadow)&&(z.receiveShadow=ce.receiveShadow,we.setValue(Q,"receiveShadow",ce.receiveShadow)),_e.isMeshGouraudMaterial&&_e.envMap!==null&&(h.envMap.value=ct,h.flipEnvMap.value=ct.isCubeTexture&&ct.isRenderTargetTexture===!1?-1:1),_e.isMeshStandardMaterial&&_e.envMap===null&&le.environment!==null&&(h.envMapIntensity.value=le.environmentIntensity),ie&&(we.setValue(Q,"toneMappingExposure",w.toneMappingExposure),z.needsLights&&$s(h,Se),Fe&&_e.fog===!0&&je.refreshFogUniforms(h,Fe),je.refreshMaterialUniforms(h,_e,J,ee,y.state.transmissionRenderTarget[Y.id]),qf.upload(Q,Uc(z),h,Z)),_e.isShaderMaterial&&_e.uniformsNeedUpdate===!0&&(qf.upload(Q,Uc(z),h,Z),_e.uniformsNeedUpdate=!1),_e.isSpriteMaterial&&we.setValue(Q,"center",ce.center),we.setValue(Q,"modelViewMatrix",ce.modelViewMatrix),we.setValue(Q,"normalMatrix",ce.normalMatrix),we.setValue(Q,"modelMatrix",ce.matrixWorld),_e.isShaderMaterial||_e.isRawShaderMaterial){const v=_e.uniformsGroups;for(let S=0,C=v.length;S<C;S++){const F=v[S];se.update(F,ne),se.bind(F,ne)}}return ne}function $s(Y,le){Y.ambientLightColor.needsUpdate=le,Y.lightProbe.needsUpdate=le,Y.directionalLights.needsUpdate=le,Y.directionalLightShadows.needsUpdate=le,Y.pointLights.needsUpdate=le,Y.pointLightShadows.needsUpdate=le,Y.spotLights.needsUpdate=le,Y.spotLightShadows.needsUpdate=le,Y.rectAreaLights.needsUpdate=le,Y.hemisphereLights.needsUpdate=le}function zc(Y){return Y.isMeshLambertMaterial||Y.isMeshToonMaterial||Y.isMeshPhongMaterial||Y.isMeshStandardMaterial||Y.isShadowMaterial||Y.isShaderMaterial&&Y.lights===!0}this.getActiveCubeFace=function(){return B},this.getActiveMipmapLevel=function(){return N},this.getRenderTarget=function(){return L},this.setRenderTargetTextures=function(Y,le,ge){et.get(Y.texture).__webglTexture=le,et.get(Y.depthTexture).__webglTexture=ge;const _e=et.get(Y);_e.__hasExternalTextures=!0,_e.__autoAllocateDepthBuffer=ge===void 0,_e.__autoAllocateDepthBuffer||Be.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),_e.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Y,le){const ge=et.get(Y);ge.__webglFramebuffer=le,ge.__useDefaultFramebuffer=le===void 0},this.setRenderTarget=function(Y,le=0,ge=0){L=Y,B=le,N=ge;let _e=!0,ce=null,Fe=!1,qe=!1;if(Y){const ct=et.get(Y);if(ct.__useDefaultFramebuffer!==void 0)ze.bindFramebuffer(Q.FRAMEBUFFER,null),_e=!1;else if(ct.__webglFramebuffer===void 0)Z.setupRenderTarget(Y);else if(ct.__hasExternalTextures)Z.rebindTextures(Y,et.get(Y.texture).__webglTexture,et.get(Y.depthTexture).__webglTexture);else if(Y.depthBuffer){const ft=Y.depthTexture;if(ct.__boundDepthTexture!==ft){if(ft!==null&&et.has(ft)&&(Y.width!==ft.image.width||Y.height!==ft.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Z.setupDepthRenderbuffer(Y)}}const Ct=Y.texture;(Ct.isData3DTexture||Ct.isDataArrayTexture||Ct.isCompressedArrayTexture)&&(qe=!0);const It=et.get(Y).__webglFramebuffer;Y.isWebGLCubeRenderTarget?(Array.isArray(It[le])?ce=It[le][ge]:ce=It[le],Fe=!0):Y.samples>0&&Z.useMultisampledRTT(Y)===!1?ce=et.get(Y).__webglMultisampledFramebuffer:Array.isArray(It)?ce=It[ge]:ce=It,U.copy(Y.viewport),j.copy(Y.scissor),A=Y.scissorTest}else U.copy(me).multiplyScalar(J).floor(),j.copy(Le).multiplyScalar(J).floor(),A=Ge;if(ze.bindFramebuffer(Q.FRAMEBUFFER,ce)&&_e&&ze.drawBuffers(Y,ce),ze.viewport(U),ze.scissor(j),ze.setScissorTest(A),Fe){const ct=et.get(Y.texture);Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_CUBE_MAP_POSITIVE_X+le,ct.__webglTexture,ge)}else if(qe){const ct=et.get(Y.texture),Ct=le||0;Q.framebufferTextureLayer(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,ct.__webglTexture,ge||0,Ct)}P=-1},this.readRenderTargetPixels=function(Y,le,ge,_e,ce,Fe,qe){if(!(Y&&Y.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let dt=et.get(Y).__webglFramebuffer;if(Y.isWebGLCubeRenderTarget&&qe!==void 0&&(dt=dt[qe]),dt){ze.bindFramebuffer(Q.FRAMEBUFFER,dt);try{const ct=Y.texture,Ct=ct.format,It=ct.type;if(!it.textureFormatReadable(Ct)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!it.textureTypeReadable(It)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}le>=0&&le<=Y.width-_e&&ge>=0&&ge<=Y.height-ce&&Q.readPixels(le,ge,_e,ce,Rt.convert(Ct),Rt.convert(It),Fe)}finally{const ct=L!==null?et.get(L).__webglFramebuffer:null;ze.bindFramebuffer(Q.FRAMEBUFFER,ct)}}},this.readRenderTargetPixelsAsync=async function(Y,le,ge,_e,ce,Fe,qe){if(!(Y&&Y.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let dt=et.get(Y).__webglFramebuffer;if(Y.isWebGLCubeRenderTarget&&qe!==void 0&&(dt=dt[qe]),dt){const ct=Y.texture,Ct=ct.format,It=ct.type;if(!it.textureFormatReadable(Ct))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!it.textureTypeReadable(It))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(le>=0&&le<=Y.width-_e&&ge>=0&&ge<=Y.height-ce){ze.bindFramebuffer(Q.FRAMEBUFFER,dt);const ft=Q.createBuffer();Q.bindBuffer(Q.PIXEL_PACK_BUFFER,ft),Q.bufferData(Q.PIXEL_PACK_BUFFER,Fe.byteLength,Q.STREAM_READ),Q.readPixels(le,ge,_e,ce,Rt.convert(Ct),Rt.convert(It),0);const Zt=L!==null?et.get(L).__webglFramebuffer:null;ze.bindFramebuffer(Q.FRAMEBUFFER,Zt);const pi=Q.fenceSync(Q.SYNC_GPU_COMMANDS_COMPLETE,0);return Q.flush(),await qC(Q,pi,4),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,ft),Q.getBufferSubData(Q.PIXEL_PACK_BUFFER,0,Fe),Q.deleteBuffer(ft),Q.deleteSync(pi),Fe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Y,le=null,ge=0){Y.isTexture!==!0&&(ih("WebGLRenderer: copyFramebufferToTexture function signature has changed."),le=arguments[0]||null,Y=arguments[1]);const _e=Math.pow(2,-ge),ce=Math.floor(Y.image.width*_e),Fe=Math.floor(Y.image.height*_e),qe=le!==null?le.x:0,dt=le!==null?le.y:0;Z.setTexture2D(Y,0),Q.copyTexSubImage2D(Q.TEXTURE_2D,ge,0,0,qe,dt,ce,Fe),ze.unbindTexture()},this.copyTextureToTexture=function(Y,le,ge=null,_e=null,ce=0){Y.isTexture!==!0&&(ih("WebGLRenderer: copyTextureToTexture function signature has changed."),_e=arguments[0]||null,Y=arguments[1],le=arguments[2],ce=arguments[3]||0,ge=null);let Fe,qe,dt,ct,Ct,It,ft,Zt,pi;const ui=Y.isCompressedTexture?Y.mipmaps[ce]:Y.image;ge!==null?(Fe=ge.max.x-ge.min.x,qe=ge.max.y-ge.min.y,dt=ge.isBox3?ge.max.z-ge.min.z:1,ct=ge.min.x,Ct=ge.min.y,It=ge.isBox3?ge.min.z:0):(Fe=ui.width,qe=ui.height,dt=ui.depth||1,ct=0,Ct=0,It=0),_e!==null?(ft=_e.x,Zt=_e.y,pi=_e.z):(ft=0,Zt=0,pi=0);const oi=Rt.convert(le.format),ii=Rt.convert(le.type);let z;le.isData3DTexture?(Z.setTexture3D(le,0),z=Q.TEXTURE_3D):le.isDataArrayTexture||le.isCompressedArrayTexture?(Z.setTexture2DArray(le,0),z=Q.TEXTURE_2D_ARRAY):(Z.setTexture2D(le,0),z=Q.TEXTURE_2D),Q.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,le.flipY),Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),Q.pixelStorei(Q.UNPACK_ALIGNMENT,le.unpackAlignment);const te=Q.getParameter(Q.UNPACK_ROW_LENGTH),W=Q.getParameter(Q.UNPACK_IMAGE_HEIGHT),ne=Q.getParameter(Q.UNPACK_SKIP_PIXELS),ae=Q.getParameter(Q.UNPACK_SKIP_ROWS),ie=Q.getParameter(Q.UNPACK_SKIP_IMAGES);Q.pixelStorei(Q.UNPACK_ROW_LENGTH,ui.width),Q.pixelStorei(Q.UNPACK_IMAGE_HEIGHT,ui.height),Q.pixelStorei(Q.UNPACK_SKIP_PIXELS,ct),Q.pixelStorei(Q.UNPACK_SKIP_ROWS,Ct),Q.pixelStorei(Q.UNPACK_SKIP_IMAGES,It);const Se=Y.isDataArrayTexture||Y.isData3DTexture,we=le.isDataArrayTexture||le.isData3DTexture;if(Y.isRenderTargetTexture||Y.isDepthTexture){const h=et.get(Y),m=et.get(le),v=et.get(h.__renderTarget),S=et.get(m.__renderTarget);ze.bindFramebuffer(Q.READ_FRAMEBUFFER,v.__webglFramebuffer),ze.bindFramebuffer(Q.DRAW_FRAMEBUFFER,S.__webglFramebuffer);for(let C=0;C<dt;C++)Se&&Q.framebufferTextureLayer(Q.READ_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,et.get(Y).__webglTexture,ce,It+C),Y.isDepthTexture?(we&&Q.framebufferTextureLayer(Q.DRAW_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,et.get(le).__webglTexture,ce,pi+C),Q.blitFramebuffer(ct,Ct,Fe,qe,ft,Zt,Fe,qe,Q.DEPTH_BUFFER_BIT,Q.NEAREST)):we?Q.copyTexSubImage3D(z,ce,ft,Zt,pi+C,ct,Ct,Fe,qe):Q.copyTexSubImage2D(z,ce,ft,Zt,pi+C,ct,Ct,Fe,qe);ze.bindFramebuffer(Q.READ_FRAMEBUFFER,null),ze.bindFramebuffer(Q.DRAW_FRAMEBUFFER,null)}else we?Y.isDataTexture||Y.isData3DTexture?Q.texSubImage3D(z,ce,ft,Zt,pi,Fe,qe,dt,oi,ii,ui.data):le.isCompressedArrayTexture?Q.compressedTexSubImage3D(z,ce,ft,Zt,pi,Fe,qe,dt,oi,ui.data):Q.texSubImage3D(z,ce,ft,Zt,pi,Fe,qe,dt,oi,ii,ui):Y.isDataTexture?Q.texSubImage2D(Q.TEXTURE_2D,ce,ft,Zt,Fe,qe,oi,ii,ui.data):Y.isCompressedTexture?Q.compressedTexSubImage2D(Q.TEXTURE_2D,ce,ft,Zt,ui.width,ui.height,oi,ui.data):Q.texSubImage2D(Q.TEXTURE_2D,ce,ft,Zt,Fe,qe,oi,ii,ui);Q.pixelStorei(Q.UNPACK_ROW_LENGTH,te),Q.pixelStorei(Q.UNPACK_IMAGE_HEIGHT,W),Q.pixelStorei(Q.UNPACK_SKIP_PIXELS,ne),Q.pixelStorei(Q.UNPACK_SKIP_ROWS,ae),Q.pixelStorei(Q.UNPACK_SKIP_IMAGES,ie),ce===0&&le.generateMipmaps&&Q.generateMipmap(z),ze.unbindTexture()},this.copyTextureToTexture3D=function(Y,le,ge=null,_e=null,ce=0){return Y.isTexture!==!0&&(ih("WebGLRenderer: copyTextureToTexture3D function signature has changed."),ge=arguments[0]||null,_e=arguments[1]||null,Y=arguments[2],le=arguments[3],ce=arguments[4]||0),ih('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Y,le,ge,_e,ce)},this.initRenderTarget=function(Y){et.get(Y).__webglFramebuffer===void 0&&Z.setupRenderTarget(Y)},this.initTexture=function(Y){Y.isCubeTexture?Z.setTextureCube(Y,0):Y.isData3DTexture?Z.setTexture3D(Y,0):Y.isDataArrayTexture||Y.isCompressedArrayTexture?Z.setTexture2DArray(Y,0):Z.setTexture2D(Y,0),ze.unbindTexture()},this.resetState=function(){B=0,N=0,L=null,ze.reset(),hi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return $r}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=Xt._getDrawingBufferColorSpace(e),t.unpackColorSpace=Xt._getUnpackColorSpace()}}class Qf{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ve(e),this.density=t}clone(){return new Qf(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class $f{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new ve(e),this.near=t,this.far=i}clone(){return new $f(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class uh extends Dt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Oi,this.environmentIntensity=1,this.environmentRotation=new Oi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Pl{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=un,this.updateRanges=[],this.version=0,this.uuid=lr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=lr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=lr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Hn=new q;class jt{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Hn.fromBufferAttribute(this,t),Hn.applyMatrix4(e),this.setXYZ(t,Hn.x,Hn.y,Hn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Hn.fromBufferAttribute(this,t),Hn.applyNormalMatrix(e),this.setXYZ(t,Hn.x,Hn.y,Hn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Hn.fromBufferAttribute(this,t),Hn.transformDirection(e),this.setXYZ(t,Hn.x,Hn.y,Hn.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=Un(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Ut(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=Ut(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Ut(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Ut(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Ut(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Un(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Un(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Un(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Un(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),r=Ut(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),r=Ut(r,this.array),s=Ut(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Jt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new jt(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class fh extends Ji{static get type(){return"SpriteMaterial"}constructor(e){super(),this.isSpriteMaterial=!0,this.color=new ve(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Rl;const dh=new q,Dl=new q,Ll=new q,Ol=new xe,ph=new xe,Ex=new Mt,Jf=new q,mh=new q,ed=new q,Tx=new xe,Wg=new xe,Ax=new xe;class td extends Dt{constructor(e=new fh){if(super(),this.isSprite=!0,this.type="Sprite",Rl===void 0){Rl=new Tt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Pl(t,5);Rl.setIndex([0,1,2,0,2,3]),Rl.setAttribute("position",new jt(i,3,0,!1)),Rl.setAttribute("uv",new jt(i,2,3,!1))}this.geometry=Rl,this.material=e,this.center=new xe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Dl.setFromMatrixScale(this.matrixWorld),Ex.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ll.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Dl.multiplyScalar(-Ll.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const o=this.center;id(Jf.set(-.5,-.5,0),Ll,o,Dl,r,s),id(mh.set(.5,-.5,0),Ll,o,Dl,r,s),id(ed.set(.5,.5,0),Ll,o,Dl,r,s),Tx.set(0,0),Wg.set(1,0),Ax.set(1,1);let a=e.ray.intersectTriangle(Jf,mh,ed,!1,dh);if(a===null&&(id(mh.set(-.5,.5,0),Ll,o,Dl,r,s),Wg.set(0,1),a=e.ray.intersectTriangle(Jf,ed,mh,!1,dh),a===null))return;const l=e.ray.origin.distanceTo(dh);l<e.near||l>e.far||t.push({distance:l,point:dh.clone(),uv:$i.getInterpolation(dh,Jf,mh,ed,Tx,Wg,Ax,new xe),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function id(n,e,t,i,r,s){Ol.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(ph.x=s*Ol.x-r*Ol.y,ph.y=r*Ol.x+s*Ol.y):ph.copy(Ol),n.copy(e),n.x+=ph.x,n.y+=ph.y,n.applyMatrix4(Ex)}const nd=new q,Mx=new q;class Cx extends Dt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,r=t.length;i<r;i++){const s=t[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const r=t.splice(i,1);return this.remove(r[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r;i++){let s=t[i].distance;if(t[i].object.visible&&(s-=s*t[i].hysteresis),e<s)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){nd.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(nd);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){nd.setFromMatrixPosition(e.matrixWorld),Mx.setFromMatrixPosition(this.matrixWorld);const i=nd.distanceTo(Mx)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),i>=o)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let r=0,s=i.length;r<s;r++){const o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const Ix=new q,Px=new Gt,Rx=new Gt,CL=new q,Dx=new Mt,rd=new q,Xg=new qi,Lx=new Mt,Yg=new ca;class jg extends pt{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=jm,this.bindMatrix=new Mt,this.bindMatrixInverse=new Mt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Vi),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,rd),this.boundingBox.expandByPoint(rd)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new qi),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,rd),this.boundingSphere.expandByPoint(rd)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Xg.copy(this.boundingSphere),Xg.applyMatrix4(r),e.ray.intersectsSphere(Xg)!==!1&&(Lx.copy(r).invert(),Yg.copy(e.ray).applyMatrix4(Lx),!(this.boundingBox!==null&&Yg.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Yg)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Gt,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===jm?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===nb?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;Px.fromBufferAttribute(r.attributes.skinIndex,e),Rx.fromBufferAttribute(r.attributes.skinWeight,e),Ix.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=Rx.getComponent(s);if(o!==0){const a=Px.getComponent(s);Dx.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(CL.copy(Ix).applyMatrix4(Dx),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class sd extends Dt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class An extends yi{constructor(e=null,t=1,i=1,r,s,o,a,l,c=xi,u=xi,d,p){super(null,o,a,l,c,u,r,s,d,p),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ox=new Mt,IL=new Mt;class gh{constructor(e=[],t=[]){this.uuid=lr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Mt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Mt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:IL;Ox.multiplyMatrices(a,t[s]),Ox.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new gh(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new An(t,e,e,Ti,Ii);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new sd),this.bones.push(o),this.boneInverses.push(new Mt().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=i[r];e.boneInverses.push(a.toArray())}return e}}class Gn extends Jt{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Nl=new Mt,Nx=new Mt,od=[],Bx=new Vi,PL=new Mt,_h=new pt,vh=new qi;class Fx extends pt{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Gn(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,PL)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Vi),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Nl),Bx.copy(e.boundingBox).applyMatrix4(Nl),this.boundingBox.union(Bx)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new qi),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Nl),vh.copy(e.boundingSphere).applyMatrix4(Nl),this.boundingSphere.union(vh)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,o=e*s+1;for(let a=0;a<i.length;a++)i[a]=r[o+a]}raycast(e,t){const i=this.matrixWorld,r=this.count;if(_h.geometry=this.geometry,_h.material=this.material,_h.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),vh.copy(this.boundingSphere),vh.applyMatrix4(i),e.ray.intersectsSphere(vh)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Nl),Nx.multiplyMatrices(i,Nl),_h.matrixWorld=Nx,_h.raycast(e,od);for(let o=0,a=od.length;o<a;o++){const l=od[o];l.instanceId=s,l.object=this,t.push(l)}od.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Gn(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new An(new Float32Array(r*this.count),r,this.count,Wu,Ii));const s=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=r*e;s[l]=a,s.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function qg(n,e){return n-e}function RL(n,e){return n.z-e.z}function DL(n,e){return e.z-n.z}class LL{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i,r){const s=this.pool,o=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const a=s[this.index];o.push(a),this.index++,a.start=e,a.count=t,a.z=i,a.index=r}reset(){this.list.length=0,this.index=0}}const ir=new Mt,OL=new ve(1,1,1),Zg=new fa,ad=new Vi,_a=new qi,yh=new q,Ux=new q,NL=new q,Kg=new LL,Mn=new pt,ld=[];function BL(n,e,t=0){const i=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const r=n.count;for(let s=0;s<r;s++)for(let o=0;o<i;o++)e.setComponent(s+t,o,n.getComponent(s,o))}else e.array.set(n.array,t*i);e.needsUpdate=!0}function va(n,e){if(n.constructor!==e.constructor){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++)e[i]=n[i]}else{const t=Math.min(n.length,e.length);e.set(new n.constructor(n.buffer,0,t))}}class kx extends pt{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(e,t,i=t*2,r){super(new Tt,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new An(t,e,e,Ti,Ii);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),i=new An(t,e,e,Xc,As);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),i=new An(t,e,e,Ti,Ii);i.colorSpace=Xt.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const o=e.getAttribute(s),{array:a,itemSize:l,normalized:c}=o,u=new a.constructor(i*l),d=new Jt(u,l,c);t.setAttribute(s,d)}if(e.getIndex()!==null){const s=i>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new Jt(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(!e.hasAttribute(i))throw new Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const r=e.getAttribute(i),s=t.getAttribute(i);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Vi);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let i=0,r=t.length;i<r;i++){if(t[i].active===!1)continue;const s=t[i].geometryIndex;this.getMatrixAt(i,ir),this.getBoundingBoxAt(s,ad).applyMatrix4(ir),e.union(ad)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qi);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let i=0,r=t.length;i<r;i++){if(t[i].active===!1)continue;const s=t[i].geometryIndex;this.getMatrixAt(i,ir),this.getBoundingSphereAt(s,_a).applyMatrix4(ir),e.union(_a)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(qg),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=i):(r=this._instanceInfo.length,this._instanceInfo.push(i));const s=this._matricesTexture;ir.identity().toArray(s.image.data,r*16),s.needsUpdate=!0;const o=this._colorsTexture;return o&&(OL.toArray(o.image.data,r*4),o.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(e,t=-1,i=-1){this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const o=e.getIndex();if(o!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=i===-1?o.count:i),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(qg),l=this._availableGeometryIds.shift(),s[l]=r):(l=this._geometryCount,this._geometryCount++,s.push(r)),this.setGeometryAt(l,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,l}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,r=i.getIndex()!==null,s=i.getIndex(),o=t.getIndex(),a=this._geometryInfo[e];if(r&&o.count>a.reservedIndexCount||t.attributes.position.count>a.reservedVertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.reservedVertexCount;a.vertexCount=t.getAttribute("position").count;for(const u in i.attributes){const d=t.getAttribute(u),p=i.getAttribute(u);BL(d,p,l);const g=d.itemSize;for(let _=d.count,x=c;_<x;_++){const b=l+_;for(let y=0;y<g;y++)p.setComponent(b,y,0)}p.needsUpdate=!0,p.addUpdateRange(l*g,c*g)}if(r){const u=a.indexStart,d=a.reservedIndexCount;a.indexCount=t.getIndex().count;for(let p=0;p<o.count;p++)s.setX(u+p,l+o.getX(p));for(let p=o.count,g=d;p<g;p++)s.setX(u+p,l);s.needsUpdate=!0,s.addUpdateRange(u,a.reservedIndexCount)}return a.start=r?a.indexStart:a.vertexStart,a.count=r?a.indexCount:a.vertexCount,a.boundingBox=null,t.boundingBox!==null&&(a.boundingBox=t.boundingBox.clone()),a.boundingSphere=null,t.boundingSphere!==null&&(a.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const i=this._instanceInfo;for(let r=0,s=i.length;r<s;r++)i[r].geometryIndex===e&&this.deleteInstance(r);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){const t=this._instanceInfo;return e>=t.length||t[e].active===!1?this:(t[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this)}optimize(){let e=0,t=0;const i=this._geometryInfo,r=i.map((o,a)=>a).sort((o,a)=>i[o].vertexStart-i[a].vertexStart),s=this.geometry;for(let o=0,a=i.length;o<a;o++){const l=r[o],c=i[l];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==t){const{indexStart:u,vertexStart:d,reservedIndexCount:p}=c,g=s.index,_=g.array,x=e-d;for(let b=u;b<u+p;b++)_[b]=_[b]+x;g.array.copyWithin(t,u,u+p),g.addUpdateRange(t,p),c.indexStart=t}t+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:u,reservedVertexCount:d}=c,p=s.attributes;for(const g in p){const _=p[g],{array:x,itemSize:b}=_;x.copyWithin(e*b,u*b,(u+d)*b),_.addUpdateRange(e*b,d*b)}c.vertexStart=e}e+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const s=new Vi,o=i.index,a=i.attributes.position;for(let l=r.start,c=r.start+r.count;l<c;l++){let u=l;o&&(u=o.getX(u)),s.expandByPoint(yh.fromBufferAttribute(a,u))}r.boundingBox=s}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const s=new qi;this.getBoundingBoxAt(e,ad),ad.getCenter(s.center);const o=i.index,a=i.attributes.position;let l=0;for(let c=r.start,u=r.start+r.count;c<u;c++){let d=c;o&&(d=o.getX(d)),yh.fromBufferAttribute(a,d),l=Math.max(l,s.center.distanceToSquared(yh))}s.radius=Math.sqrt(l),r.boundingSphere=s}return t.copy(r.boundingSphere),t}setMatrixAt(e,t){const i=this._instanceInfo,r=this._matricesTexture,s=this._matricesTexture.image.data;return e>=i.length||i[e].active===!1?this:(t.toArray(s,e*16),r.needsUpdate=!0,this)}getMatrixAt(e,t){const i=this._instanceInfo,r=this._matricesTexture.image.data;return e>=i.length||i[e].active===!1?null:t.fromArray(r,e*16)}setColorAt(e,t){this._colorsTexture===null&&this._initColorsTexture();const i=this._colorsTexture,r=this._colorsTexture.image.data,s=this._instanceInfo;return e>=s.length||s[e].active===!1?this:(t.toArray(r,e*4),i.needsUpdate=!0,this)}getColorAt(e,t){const i=this._colorsTexture.image.data,r=this._instanceInfo;return e>=r.length||r[e].active===!1?null:t.fromArray(i,e*4)}setVisibleAt(e,t){const i=this._instanceInfo;return e>=i.length||i[e].active===!1||i[e].visible===t?this:(i[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._instanceInfo;return e>=t.length||t[e].active===!1?!1:t[e].visible}setGeometryIdAt(e,t){const i=this._instanceInfo,r=this._geometryInfo;return e>=i.length||i[e].active===!1||t>=r.length||r[t].active===!1?null:(i[e].geometryIndex=t,this)}getGeometryIdAt(e){const t=this._instanceInfo;return e>=t.length||t[e].active===!1?-1:t[e].geometryIndex}getGeometryRangeAt(e,t={}){if(e<0||e>=this._geometryCount)return null;const i=this._geometryInfo[e];return t.vertexStart=i.vertexStart,t.vertexCount=i.vertexCount,t.reservedVertexCount=i.reservedVertexCount,t.indexStart=i.indexStart,t.indexCount=i.indexCount,t.reservedIndexCount=i.reservedIndexCount,t.start=i.start,t.count=i.count,t}setInstanceCount(e){const t=this._availableInstanceIds,i=this._instanceInfo;for(t.sort(qg);t[t.length-1]===i.length;)i.pop(),t.pop();if(e<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const r=new Int32Array(e),s=new Int32Array(e);va(this._multiDrawCounts,r),va(this._multiDrawStarts,s),this._multiDrawCounts=r,this._multiDrawStarts=s,this._maxInstanceCount=e;const o=this._indirectTexture,a=this._matricesTexture,l=this._colorsTexture;o.dispose(),this._initIndirectTexture(),va(o.image.data,this._indirectTexture.image.data),a.dispose(),this._initMatricesTexture(),va(a.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),va(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const i=[...this._geometryInfo].filter(a=>a.active);if(Math.max(...i.map(a=>a.vertexStart+a.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map(l=>l.indexStart+l.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Tt,this._initializeGeometry(s));const o=this.geometry;s.index&&va(s.index.array,o.index.array);for(const a in s.attributes)va(s.attributes[a].array,o.attributes[a].array)}raycast(e,t){const i=this._instanceInfo,r=this._geometryInfo,s=this.matrixWorld,o=this.geometry;Mn.material=this.material,Mn.geometry.index=o.index,Mn.geometry.attributes=o.attributes,Mn.geometry.boundingBox===null&&(Mn.geometry.boundingBox=new Vi),Mn.geometry.boundingSphere===null&&(Mn.geometry.boundingSphere=new qi);for(let a=0,l=i.length;a<l;a++){if(!i[a].visible||!i[a].active)continue;const c=i[a].geometryIndex,u=r[c];Mn.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(a,Mn.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,Mn.geometry.boundingBox),this.getBoundingSphereAt(c,Mn.geometry.boundingSphere),Mn.raycast(e,ld);for(let d=0,p=ld.length;d<p;d++){const g=ld[d];g.object=this,g.batchId=a,t.push(g)}ld.length=0}Mn.material=null,Mn.geometry.index=null,Mn.geometry.attributes={},Mn.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,i,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=r.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,d=this._geometryInfo,p=this.perObjectFrustumCulled,g=this._indirectTexture,_=g.image.data;p&&(ir.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),Zg.setFromProjectionMatrix(ir,e.coordinateSystem));let x=0;if(this.sortObjects){ir.copy(this.matrixWorld).invert(),yh.setFromMatrixPosition(i.matrixWorld).applyMatrix4(ir),Ux.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(ir);for(let M=0,E=l.length;M<E;M++)if(l[M].visible&&l[M].active){const w=l[M].geometryIndex;this.getMatrixAt(M,ir),this.getBoundingSphereAt(w,_a).applyMatrix4(ir);let I=!1;if(p&&(I=!Zg.intersectsSphere(_a)),!I){const B=d[w],N=NL.subVectors(_a.center,yh).dot(Ux);Kg.push(B.start,B.count,N,M)}}const b=Kg.list,y=this.customSort;y===null?b.sort(s.transparent?DL:RL):y.call(this,b,i);for(let M=0,E=b.length;M<E;M++){const w=b[M];c[x]=w.start*a,u[x]=w.count,_[x]=w.index,x++}Kg.reset()}else for(let b=0,y=l.length;b<y;b++)if(l[b].visible&&l[b].active){const M=l[b].geometryIndex;let E=!1;if(p&&(this.getMatrixAt(b,ir),this.getBoundingSphereAt(M,_a).applyMatrix4(ir),E=!Zg.intersectsSphere(_a)),!E){const w=d[M];c[x]=w.start*a,u[x]=w.count,_[x]=b,x++}}g.needsUpdate=!0,this._multiDrawCount=x,this._visibilityChanged=!1}onBeforeShadow(e,t,i,r,s,o){this.onBeforeRender(e,null,r,s,o)}}class rn extends Ji{static get type(){return"LineBasicMaterial"}constructor(e){super(),this.isLineBasicMaterial=!0,this.color=new ve(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const cd=new q,hd=new q,zx=new Mt,bh=new ca,ud=new qi,Qg=new q,Hx=new q;class ts extends Dt{constructor(e=new Tt,t=new rn){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)cd.fromBufferAttribute(t,r-1),hd.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=cd.distanceTo(hd);e.setAttribute("lineDistance",new $e(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),ud.copy(i.boundingSphere),ud.applyMatrix4(r),ud.radius+=s,e.ray.intersectsSphere(ud)===!1)return;zx.copy(r).invert(),bh.copy(e.ray).applyMatrix4(zx);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,u=i.index,p=i.attributes.position;if(u!==null){const g=Math.max(0,o.start),_=Math.min(u.count,o.start+o.count);for(let x=g,b=_-1;x<b;x+=c){const y=u.getX(x),M=u.getX(x+1),E=fd(this,e,bh,l,y,M);E&&t.push(E)}if(this.isLineLoop){const x=u.getX(_-1),b=u.getX(g),y=fd(this,e,bh,l,x,b);y&&t.push(y)}}else{const g=Math.max(0,o.start),_=Math.min(p.count,o.start+o.count);for(let x=g,b=_-1;x<b;x+=c){const y=fd(this,e,bh,l,x,x+1);y&&t.push(y)}if(this.isLineLoop){const x=fd(this,e,bh,l,_-1,g);x&&t.push(x)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function fd(n,e,t,i,r,s){const o=n.geometry.attributes.position;if(cd.fromBufferAttribute(o,r),hd.fromBufferAttribute(o,s),t.distanceSqToSegment(cd,hd,Qg,Hx)>i)return;Qg.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(Qg);if(!(l<e.near||l>e.far))return{distance:l,point:Hx.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:n}}const Gx=new q,Vx=new q;class Cn extends ts{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)Gx.fromBufferAttribute(t,r),Vx.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+Gx.distanceTo(Vx);e.setAttribute("lineDistance",new $e(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $g extends ts{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class dd extends Ji{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new ve(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Wx=new Mt,Jg=new ca,pd=new qi,md=new q;class gd extends Dt{constructor(e=new Tt,t=new dd){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),pd.copy(i.boundingSphere),pd.applyMatrix4(r),pd.radius+=s,e.ray.intersectsSphere(pd)===!1)return;Wx.copy(r).invert(),Jg.copy(e.ray).applyMatrix4(Wx);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(c!==null){const p=Math.max(0,o.start),g=Math.min(c.count,o.start+o.count);for(let _=p,x=g;_<x;_++){const b=c.getX(_);md.fromBufferAttribute(d,b),Xx(md,b,l,r,e,t,this)}}else{const p=Math.max(0,o.start),g=Math.min(d.count,o.start+o.count);for(let _=p,x=g;_<x;_++)md.fromBufferAttribute(d,_),Xx(md,_,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Xx(n,e,t,i,r,s,o){const a=Jg.distanceSqToPoint(n);if(a<t){const l=new q;Jg.closestPointToPoint(n,l),l.applyMatrix4(i);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class FL extends yi{constructor(e,t,i,r,s,o,a,l,c){super(e,t,i,r,s,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Ei,this.magFilter=s!==void 0?s:Ei,this.generateMipmaps=!1;const u=this;function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class e_ extends yi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=xi,this.minFilter=xi,this.generateMipmaps=!1,this.needsUpdate=!0}}class _d extends yi{constructor(e,t,i,r,s,o,a,l,c,u,d,p){super(null,o,a,l,c,u,r,s,d,p),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class UL extends _d{constructor(e,t,i,r,s,o){super(e,t,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=or,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class kL extends _d{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,Ts),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class vd extends yi{constructor(e,t,i,r,s,o,a,l,c){super(e,t,i,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Hr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const s=i.length;let o;t?o=t:o=e*i[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=i[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,i[r]===o)return r/(s-1);const u=i[r],p=i[r+1]-u,g=(o-u)/p;return(r+g)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new xe:new q);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new q,r=[],s=[],o=[],a=new q,l=new Mt;for(let g=0;g<=e;g++){const _=g/e;r[g]=this.getTangentAt(_,new q)}s[0]=new q,o[0]=new q;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),d=Math.abs(r[0].y),p=Math.abs(r[0].z);u<=c&&(c=u,i.set(1,0,0)),d<=c&&(c=d,i.set(0,1,0)),p<=c&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let g=1;g<=e;g++){if(s[g]=s[g-1].clone(),o[g]=o[g-1].clone(),a.crossVectors(r[g-1],r[g]),a.length()>Number.EPSILON){a.normalize();const _=Math.acos(Fi(r[g-1].dot(r[g]),-1,1));s[g].applyMatrix4(l.makeRotationAxis(a,_))}o[g].crossVectors(r[g],s[g])}if(t===!0){let g=Math.acos(Fi(s[0].dot(s[e]),-1,1));g/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(g=-g);for(let _=1;_<=e;_++)s[_].applyMatrix4(l.makeRotationAxis(r[_],g*_)),o[_].crossVectors(r[_],s[_])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class yd extends Hr{constructor(e=0,t=0,i=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new xe){const i=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),p=l-this.aX,g=c-this.aY;l=p*u-g*d+this.aX,c=p*d+g*u+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Yx extends yd{constructor(e,t,i,r,s,o){super(e,t,i,i,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function t_(){let n=0,e=0,t=0,i=0;function r(s,o,a,l){n=s,e=a,t=-3*s+3*o-2*a-l,i=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,u,d){let p=(o-s)/c-(a-s)/(c+u)+(a-o)/u,g=(a-o)/u-(l-o)/(u+d)+(l-a)/d;p*=u,g*=u,r(o,a,p,g)},calc:function(s){const o=s*s,a=o*s;return n+e*s+t*o+i*a}}}const bd=new q,i_=new t_,n_=new t_,r_=new t_;class jx extends Hr{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new q){const i=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,u;this.closed||a>0?c=r[(a-1)%s]:(bd.subVectors(r[0],r[1]).add(r[0]),c=bd);const d=r[a%s],p=r[(a+1)%s];if(this.closed||a+2<s?u=r[(a+2)%s]:(bd.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=bd),this.curveType==="centripetal"||this.curveType==="chordal"){const g=this.curveType==="chordal"?.5:.25;let _=Math.pow(c.distanceToSquared(d),g),x=Math.pow(d.distanceToSquared(p),g),b=Math.pow(p.distanceToSquared(u),g);x<1e-4&&(x=1),_<1e-4&&(_=x),b<1e-4&&(b=x),i_.initNonuniformCatmullRom(c.x,d.x,p.x,u.x,_,x,b),n_.initNonuniformCatmullRom(c.y,d.y,p.y,u.y,_,x,b),r_.initNonuniformCatmullRom(c.z,d.z,p.z,u.z,_,x,b)}else this.curveType==="catmullrom"&&(i_.initCatmullRom(c.x,d.x,p.x,u.x,this.tension),n_.initCatmullRom(c.y,d.y,p.y,u.y,this.tension),r_.initCatmullRom(c.z,d.z,p.z,u.z,this.tension));return i.set(i_.calc(l),n_.calc(l),r_.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new q().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function qx(n,e,t,i,r){const s=(i-e)*.5,o=(r-t)*.5,a=n*n,l=n*a;return(2*t-2*i+s+o)*l+(-3*t+3*i-2*s-o)*a+s*n+t}function zL(n,e){const t=1-n;return t*t*e}function HL(n,e){return 2*(1-n)*n*e}function GL(n,e){return n*n*e}function xh(n,e,t,i){return zL(n,e)+HL(n,t)+GL(n,i)}function VL(n,e){const t=1-n;return t*t*t*e}function WL(n,e){const t=1-n;return 3*t*t*n*e}function XL(n,e){return 3*(1-n)*n*n*e}function YL(n,e){return n*n*n*e}function wh(n,e,t,i,r){return VL(n,e)+WL(n,t)+XL(n,i)+YL(n,r)}class s_ extends Hr{constructor(e=new xe,t=new xe,i=new xe,r=new xe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new xe){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(wh(e,r.x,s.x,o.x,a.x),wh(e,r.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Zx extends Hr{constructor(e=new q,t=new q,i=new q,r=new q){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new q){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(wh(e,r.x,s.x,o.x,a.x),wh(e,r.y,s.y,o.y,a.y),wh(e,r.z,s.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class o_ extends Hr{constructor(e=new xe,t=new xe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new xe){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new xe){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Kx extends Hr{constructor(e=new q,t=new q){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new q){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new q){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class a_ extends Hr{constructor(e=new xe,t=new xe,i=new xe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new xe){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(xh(e,r.x,s.x,o.x),xh(e,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class l_ extends Hr{constructor(e=new q,t=new q,i=new q){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new q){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(xh(e,r.x,s.x,o.x),xh(e,r.y,s.y,o.y),xh(e,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class c_ extends Hr{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new xe){const i=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],d=r[o>r.length-3?r.length-1:o+2];return i.set(qx(a,l.x,c.x,u.x,d.x),qx(a,l.y,c.y,u.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new xe().fromArray(r))}return this}}var xd=Object.freeze({__proto__:null,ArcCurve:Yx,CatmullRomCurve3:jx,CubicBezierCurve:s_,CubicBezierCurve3:Zx,EllipseCurve:yd,LineCurve:o_,LineCurve3:Kx,QuadraticBezierCurve:a_,QuadraticBezierCurve3:l_,SplineCurve:c_});class Qx extends Hr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new xd[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=i){const o=r[s]-i,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const u=l[c];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new xd[r.type]().fromJSON(r))}return this}}class Bl extends Qx{constructor(e){super(),this.type="Path",this.currentPoint=new xe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new o_(this.currentPoint.clone(),new xe(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const s=new a_(this.currentPoint.clone(),new xe(e,t),new xe(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,o){const a=new s_(this.currentPoint.clone(),new xe(e,t),new xe(i,r),new xe(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new c_(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,r,s,o),this}absarc(e,t,i,r,s,o){return this.absellipse(e,t,i,i,r,s,o),this}ellipse(e,t,i,r,s,o,a,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,i,r,s,o,a,l),this}absellipse(e,t,i,r,s,o,a,l){const c=new yd(e,t,i,r,s,o,a,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Sh extends Tt{constructor(e=[new xe(0,-.5),new xe(.5,0),new xe(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Fi(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],c=[],u=1/t,d=new q,p=new xe,g=new q,_=new q,x=new q;let b=0,y=0;for(let M=0;M<=e.length-1;M++)switch(M){case 0:b=e[M+1].x-e[M].x,y=e[M+1].y-e[M].y,g.x=y*1,g.y=-b,g.z=y*0,x.copy(g),g.normalize(),l.push(g.x,g.y,g.z);break;case e.length-1:l.push(x.x,x.y,x.z);break;default:b=e[M+1].x-e[M].x,y=e[M+1].y-e[M].y,g.x=y*1,g.y=-b,g.z=y*0,_.copy(g),g.x+=x.x,g.y+=x.y,g.z+=x.z,g.normalize(),l.push(g.x,g.y,g.z),x.copy(_)}for(let M=0;M<=t;M++){const E=i+M*u*r,w=Math.sin(E),I=Math.cos(E);for(let B=0;B<=e.length-1;B++){d.x=e[B].x*w,d.y=e[B].y,d.z=e[B].x*I,o.push(d.x,d.y,d.z),p.x=M/t,p.y=B/(e.length-1),a.push(p.x,p.y);const N=l[3*B+0]*w,L=l[3*B+1],P=l[3*B+0]*I;c.push(N,L,P)}}for(let M=0;M<t;M++)for(let E=0;E<e.length-1;E++){const w=E+M*e.length,I=w,B=w+e.length,N=w+e.length+1,L=w+1;s.push(I,B,L),s.push(N,L,B)}this.setIndex(s),this.setAttribute("position",new $e(o,3)),this.setAttribute("uv",new $e(a,2)),this.setAttribute("normal",new $e(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sh(e.points,e.segments,e.phiStart,e.phiLength)}}class wd extends Sh{constructor(e=1,t=1,i=4,r=8){const s=new Bl;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:r}}static fromJSON(e){return new wd(e.radius,e.length,e.capSegments,e.radialSegments)}}let $x=class Z1 extends Tt{constructor(e=1,t=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],l=[],c=new q,u=new xe;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let d=0,p=3;d<=t;d++,p+=3){const g=i+d/t*r;c.x=e*Math.cos(g),c.y=e*Math.sin(g),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[p]/e+1)/2,u.y=(o[p+1]/e+1)/2,l.push(u.x,u.y)}for(let d=1;d<=t;d++)s.push(d,d+1,0);this.setIndex(s),this.setAttribute("position",new $e(o,3)),this.setAttribute("normal",new $e(a,3)),this.setAttribute("uv",new $e(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Z1(e.radius,e.segments,e.thetaStart,e.thetaLength)}};class Bs extends Tt{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],d=[],p=[],g=[];let _=0;const x=[],b=i/2;let y=0;M(),o===!1&&(e>0&&E(!0),t>0&&E(!1)),this.setIndex(u),this.setAttribute("position",new $e(d,3)),this.setAttribute("normal",new $e(p,3)),this.setAttribute("uv",new $e(g,2));function M(){const w=new q,I=new q;let B=0;const N=(t-e)/i;for(let L=0;L<=s;L++){const P=[],R=L/s,U=R*(t-e)+e;for(let j=0;j<=r;j++){const A=j/r,D=A*l+a,k=Math.sin(D),G=Math.cos(D);I.x=U*k,I.y=-R*i+b,I.z=U*G,d.push(I.x,I.y,I.z),w.set(k,N,G).normalize(),p.push(w.x,w.y,w.z),g.push(A,1-R),P.push(_++)}x.push(P)}for(let L=0;L<r;L++)for(let P=0;P<s;P++){const R=x[P][L],U=x[P+1][L],j=x[P+1][L+1],A=x[P][L+1];(e>0||P!==0)&&(u.push(R,U,A),B+=3),(t>0||P!==s-1)&&(u.push(U,j,A),B+=3)}c.addGroup(y,B,0),y+=B}function E(w){const I=_,B=new xe,N=new q;let L=0;const P=w===!0?e:t,R=w===!0?1:-1;for(let j=1;j<=r;j++)d.push(0,b*R,0),p.push(0,R,0),g.push(.5,.5),_++;const U=_;for(let j=0;j<=r;j++){const D=j/r*l+a,k=Math.cos(D),G=Math.sin(D);N.x=P*G,N.y=b*R,N.z=P*k,d.push(N.x,N.y,N.z),p.push(0,R,0),B.x=k*.5+.5,B.y=G*.5*R+.5,g.push(B.x,B.y),_++}for(let j=0;j<r;j++){const A=I+j,D=U+j;w===!0?u.push(D,D+1,A):u.push(D+1,D,A),L+=3}c.addGroup(y,L,w===!0?1:2),y+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bs(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Sd extends Bs{constructor(e=1,t=1,i=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,i,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Sd(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ho extends Tt{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};const s=[],o=[];a(r),c(i),u(),this.setAttribute("position",new $e(s,3)),this.setAttribute("normal",new $e(s.slice(),3)),this.setAttribute("uv",new $e(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(M){const E=new q,w=new q,I=new q;for(let B=0;B<t.length;B+=3)g(t[B+0],E),g(t[B+1],w),g(t[B+2],I),l(E,w,I,M)}function l(M,E,w,I){const B=I+1,N=[];for(let L=0;L<=B;L++){N[L]=[];const P=M.clone().lerp(w,L/B),R=E.clone().lerp(w,L/B),U=B-L;for(let j=0;j<=U;j++)j===0&&L===B?N[L][j]=P:N[L][j]=P.clone().lerp(R,j/U)}for(let L=0;L<B;L++)for(let P=0;P<2*(B-L)-1;P++){const R=Math.floor(P/2);P%2===0?(p(N[L][R+1]),p(N[L+1][R]),p(N[L][R])):(p(N[L][R+1]),p(N[L+1][R+1]),p(N[L+1][R]))}}function c(M){const E=new q;for(let w=0;w<s.length;w+=3)E.x=s[w+0],E.y=s[w+1],E.z=s[w+2],E.normalize().multiplyScalar(M),s[w+0]=E.x,s[w+1]=E.y,s[w+2]=E.z}function u(){const M=new q;for(let E=0;E<s.length;E+=3){M.x=s[E+0],M.y=s[E+1],M.z=s[E+2];const w=b(M)/2/Math.PI+.5,I=y(M)/Math.PI+.5;o.push(w,1-I)}_(),d()}function d(){for(let M=0;M<o.length;M+=6){const E=o[M+0],w=o[M+2],I=o[M+4],B=Math.max(E,w,I),N=Math.min(E,w,I);B>.9&&N<.1&&(E<.2&&(o[M+0]+=1),w<.2&&(o[M+2]+=1),I<.2&&(o[M+4]+=1))}}function p(M){s.push(M.x,M.y,M.z)}function g(M,E){const w=M*3;E.x=e[w+0],E.y=e[w+1],E.z=e[w+2]}function _(){const M=new q,E=new q,w=new q,I=new q,B=new xe,N=new xe,L=new xe;for(let P=0,R=0;P<s.length;P+=9,R+=6){M.set(s[P+0],s[P+1],s[P+2]),E.set(s[P+3],s[P+4],s[P+5]),w.set(s[P+6],s[P+7],s[P+8]),B.set(o[R+0],o[R+1]),N.set(o[R+2],o[R+3]),L.set(o[R+4],o[R+5]),I.copy(M).add(E).add(w).divideScalar(3);const U=b(I);x(B,R+0,M,U),x(N,R+2,E,U),x(L,R+4,w,U)}}function x(M,E,w,I){I<0&&M.x===1&&(o[E]=M.x-1),w.x===0&&w.z===0&&(o[E]=I/2/Math.PI+.5)}function b(M){return Math.atan2(M.z,-M.x)}function y(M){return Math.atan2(-M.y,Math.sqrt(M.x*M.x+M.z*M.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ho(e.vertices,e.indices,e.radius,e.details)}}class Ed extends ho{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ed(e.radius,e.detail)}}const Td=new q,Ad=new q,h_=new q,Md=new $i;class u_ extends Tt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(sa*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],d=new Array(3),p={},g=[];for(let _=0;_<l;_+=3){o?(c[0]=o.getX(_),c[1]=o.getX(_+1),c[2]=o.getX(_+2)):(c[0]=_,c[1]=_+1,c[2]=_+2);const{a:x,b,c:y}=Md;if(x.fromBufferAttribute(a,c[0]),b.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),Md.getNormal(h_),d[0]=`${Math.round(x.x*r)},${Math.round(x.y*r)},${Math.round(x.z*r)}`,d[1]=`${Math.round(b.x*r)},${Math.round(b.y*r)},${Math.round(b.z*r)}`,d[2]=`${Math.round(y.x*r)},${Math.round(y.y*r)},${Math.round(y.z*r)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let M=0;M<3;M++){const E=(M+1)%3,w=d[M],I=d[E],B=Md[u[M]],N=Md[u[E]],L=`${w}_${I}`,P=`${I}_${w}`;P in p&&p[P]?(h_.dot(p[P].normal)<=s&&(g.push(B.x,B.y,B.z),g.push(N.x,N.y,N.z)),p[P]=null):L in p||(p[L]={index0:c[M],index1:c[E],normal:h_.clone()})}}for(const _ in p)if(p[_]){const{index0:x,index1:b}=p[_];Td.fromBufferAttribute(a,x),Ad.fromBufferAttribute(a,b),g.push(Td.x,Td.y,Td.z),g.push(Ad.x,Ad.y,Ad.z)}this.setAttribute("position",new $e(g,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let uo=class extends Bl{constructor(e){super(e),this.uuid=lr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new Bl().fromJSON(r))}return this}};const jL={triangulate:function(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let s=Jx(n,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,d,p,g;if(i&&(s=$L(n,e,s,t)),n.length>80*t){a=c=n[0],l=u=n[1];for(let _=t;_<r;_+=t)d=n[_],p=n[_+1],d<a&&(a=d),p<l&&(l=p),d>c&&(c=d),p>u&&(u=p);g=Math.max(c-a,u-l),g=g!==0?32767/g:0}return Eh(s,o,t,a,l,g,0),o}};function Jx(n,e,t,i,r){let s,o;if(r===cO(n,e,t,i)>0)for(s=e;s<t;s+=i)o=iw(s,n[s],n[s+1],o);else for(s=t-i;s>=e;s-=i)o=iw(s,n[s],n[s+1],o);return o&&Cd(o,o.next)&&(Ah(o),o=o.next),o}function ya(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(Cd(t,t.next)||Bi(t.prev,t,t.next)===0)){if(Ah(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Eh(n,e,t,i,r,s,o){if(!n)return;!o&&s&&nO(n,i,r,s);let a=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,s?ZL(n,i,r,s):qL(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(c.i/t|0),Ah(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=KL(ya(n),e,t),Eh(n,e,t,i,r,s,2)):o===2&&QL(n,e,t,i,r,s):Eh(ya(n),e,t,i,r,s,1);break}}}function qL(n){const e=n.prev,t=n,i=n.next;if(Bi(e,t,i)>=0)return!1;const r=e.x,s=t.x,o=i.x,a=e.y,l=t.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,d=a<l?a<c?a:c:l<c?l:c,p=r>s?r>o?r:o:s>o?s:o,g=a>l?a>c?a:c:l>c?l:c;let _=i.next;for(;_!==e;){if(_.x>=u&&_.x<=p&&_.y>=d&&_.y<=g&&Fl(r,a,s,l,o,c,_.x,_.y)&&Bi(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function ZL(n,e,t,i){const r=n.prev,s=n,o=n.next;if(Bi(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,d=s.y,p=o.y,g=a<l?a<c?a:c:l<c?l:c,_=u<d?u<p?u:p:d<p?d:p,x=a>l?a>c?a:c:l>c?l:c,b=u>d?u>p?u:p:d>p?d:p,y=f_(g,_,e,t,i),M=f_(x,b,e,t,i);let E=n.prevZ,w=n.nextZ;for(;E&&E.z>=y&&w&&w.z<=M;){if(E.x>=g&&E.x<=x&&E.y>=_&&E.y<=b&&E!==r&&E!==o&&Fl(a,u,l,d,c,p,E.x,E.y)&&Bi(E.prev,E,E.next)>=0||(E=E.prevZ,w.x>=g&&w.x<=x&&w.y>=_&&w.y<=b&&w!==r&&w!==o&&Fl(a,u,l,d,c,p,w.x,w.y)&&Bi(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;E&&E.z>=y;){if(E.x>=g&&E.x<=x&&E.y>=_&&E.y<=b&&E!==r&&E!==o&&Fl(a,u,l,d,c,p,E.x,E.y)&&Bi(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;w&&w.z<=M;){if(w.x>=g&&w.x<=x&&w.y>=_&&w.y<=b&&w!==r&&w!==o&&Fl(a,u,l,d,c,p,w.x,w.y)&&Bi(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function KL(n,e,t){let i=n;do{const r=i.prev,s=i.next.next;!Cd(r,s)&&ew(r,i,i.next,s)&&Th(r,s)&&Th(s,r)&&(e.push(r.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),Ah(i),Ah(i.next),i=n=s),i=i.next}while(i!==n);return ya(i)}function QL(n,e,t,i,r,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&oO(o,a)){let l=tw(o,a);o=ya(o,o.next),l=ya(l,l.next),Eh(o,e,t,i,r,s,0),Eh(l,e,t,i,r,s,0);return}a=a.next}o=o.next}while(o!==n)}function $L(n,e,t,i){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:n.length,c=Jx(n,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(sO(c));for(r.sort(JL),s=0;s<r.length;s++)t=eO(r[s],t);return t}function JL(n,e){return n.x-e.x}function eO(n,e){const t=tO(n,e);if(!t)return e;const i=tw(t,n);return ya(i,i.next),ya(t,t.next)}function tO(n,e){let t=e,i=-1/0,r;const s=n.x,o=n.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const p=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(p<=s&&p>i&&(i=p,r=t.x<t.next.x?t:t.next,p===s))return r}t=t.next}while(t!==e);if(!r)return null;const a=r,l=r.x,c=r.y;let u=1/0,d;t=r;do s>=t.x&&t.x>=l&&s!==t.x&&Fl(o<c?s:i,o,l,c,o<c?i:s,o,t.x,t.y)&&(d=Math.abs(o-t.y)/(s-t.x),Th(t,n)&&(d<u||d===u&&(t.x>r.x||t.x===r.x&&iO(r,t)))&&(r=t,u=d)),t=t.next;while(t!==a);return r}function iO(n,e){return Bi(n.prev,n,e.prev)<0&&Bi(e.next,n,n.next)<0}function nO(n,e,t,i){let r=n;do r.z===0&&(r.z=f_(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,rO(r)}function rO(n){let e,t,i,r,s,o,a,l,c=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;t=i}s.nextZ=null,c*=2}while(o>1);return n}function f_(n,e,t,i,r){return n=(n-t)*r|0,e=(e-i)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function sO(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Fl(n,e,t,i,r,s,o,a){return(r-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(i-a)}function oO(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!aO(n,e)&&(Th(n,e)&&Th(e,n)&&lO(n,e)&&(Bi(n.prev,n,e.prev)||Bi(n,e.prev,e))||Cd(n,e)&&Bi(n.prev,n,n.next)>0&&Bi(e.prev,e,e.next)>0)}function Bi(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Cd(n,e){return n.x===e.x&&n.y===e.y}function ew(n,e,t,i){const r=Pd(Bi(n,e,t)),s=Pd(Bi(n,e,i)),o=Pd(Bi(t,i,n)),a=Pd(Bi(t,i,e));return!!(r!==s&&o!==a||r===0&&Id(n,t,e)||s===0&&Id(n,i,e)||o===0&&Id(t,n,i)||a===0&&Id(t,e,i))}function Id(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Pd(n){return n>0?1:n<0?-1:0}function aO(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&ew(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Th(n,e){return Bi(n.prev,n,n.next)<0?Bi(n,e,n.next)>=0&&Bi(n,n.prev,e)>=0:Bi(n,e,n.prev)<0||Bi(n,n.next,e)<0}function lO(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function tw(n,e){const t=new d_(n.i,n.x,n.y),i=new d_(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function iw(n,e,t,i){const r=new d_(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ah(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function d_(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function cO(n,e,t,i){let r=0;for(let s=e,o=t-i;s<t;s+=i)r+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return r}class is{static area(e){const t=e.length;let i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return is.area(e)<0}static triangulateShape(e,t){const i=[],r=[],s=[];nw(e),rw(i,e);let o=e.length;t.forEach(nw);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,rw(i,t[l]);const a=jL.triangulate(i,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function nw(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function rw(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}let Rd=class K1 extends Tt{constructor(e=new uo([new xe(.5,.5),new xe(-.5,.5),new xe(-.5,-.5),new xe(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new $e(r,3)),this.setAttribute("uv",new $e(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:1;let p=t.bevelEnabled!==void 0?t.bevelEnabled:!0,g=t.bevelThickness!==void 0?t.bevelThickness:.2,_=t.bevelSize!==void 0?t.bevelSize:g-.1,x=t.bevelOffset!==void 0?t.bevelOffset:0,b=t.bevelSegments!==void 0?t.bevelSegments:3;const y=t.extrudePath,M=t.UVGenerator!==void 0?t.UVGenerator:hO;let E,w=!1,I,B,N,L;y&&(E=y.getSpacedPoints(u),w=!0,p=!1,I=y.computeFrenetFrames(u,!1),B=new q,N=new q,L=new q),p||(b=0,g=0,_=0,x=0);const P=a.extractPoints(c);let R=P.shape;const U=P.holes;if(!is.isClockWise(R)){R=R.reverse();for(let Ee=0,Oe=U.length;Ee<Oe;Ee++){const Q=U[Ee];is.isClockWise(Q)&&(U[Ee]=Q.reverse())}}const A=is.triangulateShape(R,U),D=R;for(let Ee=0,Oe=U.length;Ee<Oe;Ee++){const Q=U[Ee];R=R.concat(Q)}function k(Ee,Oe,Q){return Oe||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ee.clone().addScaledVector(Oe,Q)}const G=R.length,ee=A.length;function J(Ee,Oe,Q){let Ye,Be,it;const ze=Ee.x-Oe.x,wt=Ee.y-Oe.y,et=Q.x-Ee.x,Z=Q.y-Ee.y,V=ze*ze+wt*wt,de=ze*Z-wt*et;if(Math.abs(de)>Number.EPSILON){const Ae=Math.sqrt(V),Re=Math.sqrt(et*et+Z*Z),Ce=Oe.x-wt/Ae,ut=Oe.y+ze/Ae,je=Q.x-Z/Re,tt=Q.y+et/Re,Ht=((je-Ce)*Z-(tt-ut)*et)/(ze*Z-wt*et);Ye=Ce+ze*Ht-Ee.x,Be=ut+wt*Ht-Ee.y;const Ue=Ye*Ye+Be*Be;if(Ue<=2)return new xe(Ye,Be);it=Math.sqrt(Ue/2)}else{let Ae=!1;ze>Number.EPSILON?et>Number.EPSILON&&(Ae=!0):ze<-Number.EPSILON?et<-Number.EPSILON&&(Ae=!0):Math.sign(wt)===Math.sign(Z)&&(Ae=!0),Ae?(Ye=-wt,Be=ze,it=Math.sqrt(V)):(Ye=ze,Be=wt,it=Math.sqrt(V/2))}return new xe(Ye/it,Be/it)}const re=[];for(let Ee=0,Oe=D.length,Q=Oe-1,Ye=Ee+1;Ee<Oe;Ee++,Q++,Ye++)Q===Oe&&(Q=0),Ye===Oe&&(Ye=0),re[Ee]=J(D[Ee],D[Q],D[Ye]);const oe=[];let me,Le=re.concat();for(let Ee=0,Oe=U.length;Ee<Oe;Ee++){const Q=U[Ee];me=[];for(let Ye=0,Be=Q.length,it=Be-1,ze=Ye+1;Ye<Be;Ye++,it++,ze++)it===Be&&(it=0),ze===Be&&(ze=0),me[Ye]=J(Q[Ye],Q[it],Q[ze]);oe.push(me),Le=Le.concat(me)}for(let Ee=0;Ee<b;Ee++){const Oe=Ee/b,Q=g*Math.cos(Oe*Math.PI/2),Ye=_*Math.sin(Oe*Math.PI/2)+x;for(let Be=0,it=D.length;Be<it;Be++){const ze=k(D[Be],re[Be],Ye);De(ze.x,ze.y,-Q)}for(let Be=0,it=U.length;Be<it;Be++){const ze=U[Be];me=oe[Be];for(let wt=0,et=ze.length;wt<et;wt++){const Z=k(ze[wt],me[wt],Ye);De(Z.x,Z.y,-Q)}}}const Ge=_+x;for(let Ee=0;Ee<G;Ee++){const Oe=p?k(R[Ee],Le[Ee],Ge):R[Ee];w?(N.copy(I.normals[0]).multiplyScalar(Oe.x),B.copy(I.binormals[0]).multiplyScalar(Oe.y),L.copy(E[0]).add(N).add(B),De(L.x,L.y,L.z)):De(Oe.x,Oe.y,0)}for(let Ee=1;Ee<=u;Ee++)for(let Oe=0;Oe<G;Oe++){const Q=p?k(R[Oe],Le[Oe],Ge):R[Oe];w?(N.copy(I.normals[Ee]).multiplyScalar(Q.x),B.copy(I.binormals[Ee]).multiplyScalar(Q.y),L.copy(E[Ee]).add(N).add(B),De(L.x,L.y,L.z)):De(Q.x,Q.y,d/u*Ee)}for(let Ee=b-1;Ee>=0;Ee--){const Oe=Ee/b,Q=g*Math.cos(Oe*Math.PI/2),Ye=_*Math.sin(Oe*Math.PI/2)+x;for(let Be=0,it=D.length;Be<it;Be++){const ze=k(D[Be],re[Be],Ye);De(ze.x,ze.y,d+Q)}for(let Be=0,it=U.length;Be<it;Be++){const ze=U[Be];me=oe[Be];for(let wt=0,et=ze.length;wt<et;wt++){const Z=k(ze[wt],me[wt],Ye);w?De(Z.x,Z.y+E[u-1].y,E[u-1].x+Q):De(Z.x,Z.y,d+Q)}}}pe(),Te();function pe(){const Ee=r.length/3;if(p){let Oe=0,Q=G*Oe;for(let Ye=0;Ye<ee;Ye++){const Be=A[Ye];Je(Be[2]+Q,Be[1]+Q,Be[0]+Q)}Oe=u+b*2,Q=G*Oe;for(let Ye=0;Ye<ee;Ye++){const Be=A[Ye];Je(Be[0]+Q,Be[1]+Q,Be[2]+Q)}}else{for(let Oe=0;Oe<ee;Oe++){const Q=A[Oe];Je(Q[2],Q[1],Q[0])}for(let Oe=0;Oe<ee;Oe++){const Q=A[Oe];Je(Q[0]+G*u,Q[1]+G*u,Q[2]+G*u)}}i.addGroup(Ee,r.length/3-Ee,0)}function Te(){const Ee=r.length/3;let Oe=0;ke(D,Oe),Oe+=D.length;for(let Q=0,Ye=U.length;Q<Ye;Q++){const Be=U[Q];ke(Be,Oe),Oe+=Be.length}i.addGroup(Ee,r.length/3-Ee,1)}function ke(Ee,Oe){let Q=Ee.length;for(;--Q>=0;){const Ye=Q;let Be=Q-1;Be<0&&(Be=Ee.length-1);for(let it=0,ze=u+b*2;it<ze;it++){const wt=G*it,et=G*(it+1),Z=Oe+Ye+wt,V=Oe+Be+wt,de=Oe+Be+et,Ae=Oe+Ye+et;lt(Z,V,de,Ae)}}}function De(Ee,Oe,Q){l.push(Ee),l.push(Oe),l.push(Q)}function Je(Ee,Oe,Q){rt(Ee),rt(Oe),rt(Q);const Ye=r.length/3,Be=M.generateTopUV(i,r,Ye-3,Ye-2,Ye-1);_t(Be[0]),_t(Be[1]),_t(Be[2])}function lt(Ee,Oe,Q,Ye){rt(Ee),rt(Oe),rt(Ye),rt(Oe),rt(Q),rt(Ye);const Be=r.length/3,it=M.generateSideWallUV(i,r,Be-6,Be-3,Be-2,Be-1);_t(it[0]),_t(it[1]),_t(it[3]),_t(it[1]),_t(it[2]),_t(it[3])}function rt(Ee){r.push(l[Ee*3+0]),r.push(l[Ee*3+1]),r.push(l[Ee*3+2])}function _t(Ee){s.push(Ee.x),s.push(Ee.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return uO(t,i,e)}static fromJSON(e,t){const i=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];i.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new xd[r.type]().fromJSON(r)),new K1(i,e.options)}};const hO={generateTopUV:function(n,e,t,i,r){const s=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[r*3],u=e[r*3+1];return[new xe(s,o),new xe(a,l),new xe(c,u)]},generateSideWallUV:function(n,e,t,i,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],u=e[i*3+1],d=e[i*3+2],p=e[r*3],g=e[r*3+1],_=e[r*3+2],x=e[s*3],b=e[s*3+1],y=e[s*3+2];return Math.abs(a-u)<Math.abs(o-c)?[new xe(o,1-l),new xe(c,1-d),new xe(p,1-_),new xe(x,1-y)]:[new xe(a,1-l),new xe(u,1-d),new xe(g,1-_),new xe(b,1-y)]}};function uO(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const s=n[i];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Dd extends ho{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Dd(e.radius,e.detail)}}class Mh extends ho{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Mh(e.radius,e.detail)}}class Ld extends Tt{constructor(e=.5,t=1,i=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:s,thetaLength:o},i=Math.max(3,i),r=Math.max(1,r);const a=[],l=[],c=[],u=[];let d=e;const p=(t-e)/r,g=new q,_=new xe;for(let x=0;x<=r;x++){for(let b=0;b<=i;b++){const y=s+b/i*o;g.x=d*Math.cos(y),g.y=d*Math.sin(y),l.push(g.x,g.y,g.z),c.push(0,0,1),_.x=(g.x/t+1)/2,_.y=(g.y/t+1)/2,u.push(_.x,_.y)}d+=p}for(let x=0;x<r;x++){const b=x*(i+1);for(let y=0;y<i;y++){const M=y+b,E=M,w=M+i+1,I=M+i+2,B=M+1;a.push(E,w,B),a.push(w,I,B)}}this.setIndex(a),this.setAttribute("position",new $e(l,3)),this.setAttribute("normal",new $e(c,3)),this.setAttribute("uv",new $e(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ld(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Ch extends Tt{constructor(e=new uo([new xe(0,.5),new xe(-.5,-.5),new xe(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new $e(r,3)),this.setAttribute("normal",new $e(s,3)),this.setAttribute("uv",new $e(o,2));function c(u){const d=r.length/3,p=u.extractPoints(t);let g=p.shape;const _=p.holes;is.isClockWise(g)===!1&&(g=g.reverse());for(let b=0,y=_.length;b<y;b++){const M=_[b];is.isClockWise(M)===!0&&(_[b]=M.reverse())}const x=is.triangulateShape(g,_);for(let b=0,y=_.length;b<y;b++){const M=_[b];g=g.concat(M)}for(let b=0,y=g.length;b<y;b++){const M=g[b];r.push(M.x,M.y,0),s.push(0,0,1),o.push(M.x,M.y)}for(let b=0,y=x.length;b<y;b++){const M=x[b],E=M[0]+d,w=M[1]+d,I=M[2]+d;i.push(E,w,I),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return fO(t,e)}static fromJSON(e,t){const i=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];i.push(o)}return new Ch(i,e.curveSegments)}}function fO(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}let Ul=class Q1 extends Tt{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const u=[],d=new q,p=new q,g=[],_=[],x=[],b=[];for(let y=0;y<=i;y++){const M=[],E=y/i;let w=0;y===0&&o===0?w=.5/t:y===i&&l===Math.PI&&(w=-.5/t);for(let I=0;I<=t;I++){const B=I/t;d.x=-e*Math.cos(r+B*s)*Math.sin(o+E*a),d.y=e*Math.cos(o+E*a),d.z=e*Math.sin(r+B*s)*Math.sin(o+E*a),_.push(d.x,d.y,d.z),p.copy(d).normalize(),x.push(p.x,p.y,p.z),b.push(B+w,1-E),M.push(c++)}u.push(M)}for(let y=0;y<i;y++)for(let M=0;M<t;M++){const E=u[y][M+1],w=u[y][M],I=u[y+1][M],B=u[y+1][M+1];(y!==0||o>0)&&g.push(E,w,B),(y!==i-1||l<Math.PI)&&g.push(w,I,B)}this.setIndex(g),this.setAttribute("position",new $e(_,3)),this.setAttribute("normal",new $e(x,3)),this.setAttribute("uv",new $e(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Q1(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}};class Od extends ho{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Od(e.radius,e.detail)}}class ba extends Tt{constructor(e=1,t=.4,i=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:s},i=Math.floor(i),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new q,d=new q,p=new q;for(let g=0;g<=i;g++)for(let _=0;_<=r;_++){const x=_/r*s,b=g/i*Math.PI*2;d.x=(e+t*Math.cos(b))*Math.cos(x),d.y=(e+t*Math.cos(b))*Math.sin(x),d.z=t*Math.sin(b),a.push(d.x,d.y,d.z),u.x=e*Math.cos(x),u.y=e*Math.sin(x),p.subVectors(d,u).normalize(),l.push(p.x,p.y,p.z),c.push(_/r),c.push(g/i)}for(let g=1;g<=i;g++)for(let _=1;_<=r;_++){const x=(r+1)*g+_-1,b=(r+1)*(g-1)+_-1,y=(r+1)*(g-1)+_,M=(r+1)*g+_;o.push(x,b,M),o.push(b,y,M)}this.setIndex(o),this.setAttribute("position",new $e(a,3)),this.setAttribute("normal",new $e(l,3)),this.setAttribute("uv",new $e(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ba(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Nd extends Tt{constructor(e=1,t=.4,i=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:s,q:o},i=Math.floor(i),r=Math.floor(r);const a=[],l=[],c=[],u=[],d=new q,p=new q,g=new q,_=new q,x=new q,b=new q,y=new q;for(let E=0;E<=i;++E){const w=E/i*s*Math.PI*2;M(w,s,o,e,g),M(w+.01,s,o,e,_),b.subVectors(_,g),y.addVectors(_,g),x.crossVectors(b,y),y.crossVectors(x,b),x.normalize(),y.normalize();for(let I=0;I<=r;++I){const B=I/r*Math.PI*2,N=-t*Math.cos(B),L=t*Math.sin(B);d.x=g.x+(N*y.x+L*x.x),d.y=g.y+(N*y.y+L*x.y),d.z=g.z+(N*y.z+L*x.z),l.push(d.x,d.y,d.z),p.subVectors(d,g).normalize(),c.push(p.x,p.y,p.z),u.push(E/i),u.push(I/r)}}for(let E=1;E<=i;E++)for(let w=1;w<=r;w++){const I=(r+1)*(E-1)+(w-1),B=(r+1)*E+(w-1),N=(r+1)*E+w,L=(r+1)*(E-1)+w;a.push(I,B,L),a.push(B,N,L)}this.setIndex(a),this.setAttribute("position",new $e(l,3)),this.setAttribute("normal",new $e(c,3)),this.setAttribute("uv",new $e(u,2));function M(E,w,I,B,N){const L=Math.cos(E),P=Math.sin(E),R=I/w*E,U=Math.cos(R);N.x=B*(2+U)*.5*L,N.y=B*(2+U)*P*.5,N.z=B*Math.sin(R)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Nd(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Bd extends Tt{constructor(e=new l_(new q(-1,-1,0),new q(-1,1,0),new q(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new q,l=new q,c=new xe;let u=new q;const d=[],p=[],g=[],_=[];x(),this.setIndex(_),this.setAttribute("position",new $e(d,3)),this.setAttribute("normal",new $e(p,3)),this.setAttribute("uv",new $e(g,2));function x(){for(let E=0;E<t;E++)b(E);b(s===!1?t:0),M(),y()}function b(E){u=e.getPointAt(E/t,u);const w=o.normals[E],I=o.binormals[E];for(let B=0;B<=r;B++){const N=B/r*Math.PI*2,L=Math.sin(N),P=-Math.cos(N);l.x=P*w.x+L*I.x,l.y=P*w.y+L*I.y,l.z=P*w.z+L*I.z,l.normalize(),p.push(l.x,l.y,l.z),a.x=u.x+i*l.x,a.y=u.y+i*l.y,a.z=u.z+i*l.z,d.push(a.x,a.y,a.z)}}function y(){for(let E=1;E<=t;E++)for(let w=1;w<=r;w++){const I=(r+1)*(E-1)+(w-1),B=(r+1)*E+(w-1),N=(r+1)*E+w,L=(r+1)*(E-1)+w;_.push(I,B,L),_.push(B,N,L)}}function M(){for(let E=0;E<=t;E++)for(let w=0;w<=r;w++)c.x=E/t,c.y=w/r,g.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Bd(new xd[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class p_ extends Tt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,r=new q,s=new q;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const d=l[c],p=d.start,g=d.count;for(let _=p,x=p+g;_<x;_+=3)for(let b=0;b<3;b++){const y=a.getX(_+b),M=a.getX(_+(b+1)%3);r.fromBufferAttribute(o,y),s.fromBufferAttribute(o,M),sw(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const u=3*a+c,d=3*a+(c+1)%3;r.fromBufferAttribute(o,u),s.fromBufferAttribute(o,d),sw(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new $e(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function sw(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(r)===!0?!1:(t.add(i),t.add(r),!0)}var ow=Object.freeze({__proto__:null,BoxGeometry:zr,CapsuleGeometry:wd,CircleGeometry:$x,ConeGeometry:Sd,CylinderGeometry:Bs,DodecahedronGeometry:Ed,EdgesGeometry:u_,ExtrudeGeometry:Rd,IcosahedronGeometry:Dd,LatheGeometry:Sh,OctahedronGeometry:Mh,PlaneGeometry:Er,PolyhedronGeometry:ho,RingGeometry:Ld,ShapeGeometry:Ch,SphereGeometry:Ul,TetrahedronGeometry:Od,TorusGeometry:ba,TorusKnotGeometry:Nd,TubeGeometry:Bd,WireframeGeometry:p_});class aw extends Ji{static get type(){return"ShadowMaterial"}constructor(e){super(),this.isShadowMaterial=!0,this.color=new ve(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class lw extends wi{static get type(){return"RawShaderMaterial"}constructor(e){super(e),this.isRawShaderMaterial=!0}}class kl extends Ji{static get type(){return"MeshStandardMaterial"}constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new ve(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Oi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class cw extends kl{static get type(){return"MeshPhysicalMaterial"}constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Fi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ve(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ve(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ve(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class hw extends Ji{static get type(){return"MeshPhongMaterial"}constructor(e){super(),this.isMeshPhongMaterial=!0,this.color=new ve(16777215),this.specular=new ve(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Oi,this.combine=rl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uw extends Ji{static get type(){return"MeshToonMaterial"}constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.color=new ve(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Fd extends Ji{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class fw extends Ji{static get type(){return"MeshLambertMaterial"}constructor(e){super(),this.isMeshLambertMaterial=!0,this.color=new ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Oi,this.combine=rl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class dw extends Ji{static get type(){return"MeshMatcapMaterial"}constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.color=new ve(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pw extends rn{static get type(){return"LineDashedMaterial"}constructor(e){super(),this.isLineDashedMaterial=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function xa(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function mw(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function gw(n){function e(r,s){return n[r]-n[s]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i}function m_(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=n[a+l]}return r}function g_(n,e,t,i){let r=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[r++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=n[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++];while(s!==void 0);else do o=s[i],o!==void 0&&(e.push(s.time),t.push(o)),s=n[r++];while(s!==void 0)}function dO(n,e,t,i,r=30){const s=n.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),d=[],p=[];for(let g=0;g<c.times.length;++g){const _=c.times[g]*r;if(!(_<t||_>=i)){d.push(c.times[g]);for(let x=0;x<u;++x)p.push(c.values[g*u+x])}}d.length!==0&&(c.times=xa(d,c.times.constructor),c.values=xa(p,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function pO(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,s=e/i;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find(function(y){return y.name===a.name&&y.ValueTypeName===l});if(c===void 0)continue;let u=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let p=0;const g=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=g/3);const _=a.times.length-1;let x;if(s<=a.times[0]){const y=u,M=d-u;x=a.values.slice(y,M)}else if(s>=a.times[_]){const y=_*d+u,M=y+d-u;x=a.values.slice(y,M)}else{const y=a.createInterpolant(),M=u,E=d-u;y.evaluate(s),x=y.resultBuffer.slice(M,E)}l==="quaternion"&&new Li().fromArray(x).normalize().conjugate().toArray(x);const b=c.times.length;for(let y=0;y<b;++y){const M=y*g+p;if(l==="quaternion")Li.multiplyQuaternionsFlat(c.values,M,x,0,c.values,M);else{const E=g-p*2;for(let w=0;w<E;++w)c.values[M+w]-=x[w]}}}return n.blendMode=ng,n}const mO={convertArray:xa,isTypedArray:mw,getKeyframeOrder:gw,sortedArray:m_,flattenJSON:g_,subclip:dO,makeClipAdditive:pO};class zl{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;i:{n:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break i}if(!(e>=s)){const a=t[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class _w extends zl{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ia,endingEnd:ia}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case na:s=e,a=2*t-i;break;case Qc:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case na:o=e,l=2*i-t;break;case Qc:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const c=(i-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,p=this._weightPrev,g=this._weightNext,_=(i-t)/(r-t),x=_*_,b=x*_,y=-p*b+2*p*x-p*_,M=(1+p)*b+(-1.5-2*p)*x+(-.5+p)*_+1,E=(-1-g)*b+(1.5+g)*x+.5*_,w=g*b-g*x;for(let I=0;I!==a;++I)s[I]=y*o[u+I]+M*o[c+I]+E*o[l+I]+w*o[d+I];return s}}class __ extends zl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-t)/(r-t),d=1-u;for(let p=0;p!==a;++p)s[p]=o[c+p]*d+o[l+p]*u;return s}}class vw extends zl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Gr{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=xa(t,this.TimeBufferType),this.values=xa(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:xa(e.times,Array),values:xa(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new vw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new __(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new _w(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case cl:t=this.InterpolantFactoryMethodDiscrete;break;case hl:t=this.InterpolantFactoryMethodLinear;break;case bf:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return cl;case this.InterpolantFactoryMethodLinear:return hl;case this.InterpolantFactoryMethodSmooth:return bf}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;o!==-1&&i[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=i.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&mw(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===bf,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{const d=a*i,p=d-i,g=d+i;for(let _=0;_!==i;++_){const x=t[d+_];if(x!==t[p+_]||x!==t[g+_]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,p=o*i;for(let g=0;g!==i;++g)t[p+g]=t[d+g]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Gr.prototype.TimeBufferType=Float32Array,Gr.prototype.ValueBufferType=Float32Array,Gr.prototype.DefaultInterpolation=hl;class wa extends Gr{constructor(e,t,i){super(e,t,i)}}wa.prototype.ValueTypeName="bool",wa.prototype.ValueBufferType=Array,wa.prototype.DefaultInterpolation=cl,wa.prototype.InterpolantFactoryMethodLinear=void 0,wa.prototype.InterpolantFactoryMethodSmooth=void 0;class v_ extends Gr{}v_.prototype.ValueTypeName="color";class Sa extends Gr{}Sa.prototype.ValueTypeName="number";class yw extends zl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)Li.slerpFlat(s,0,o,c-a,o,c,l);return s}}class Ea extends Gr{InterpolantFactoryMethodLinear(e){return new yw(this.times,this.values,this.getValueSize(),e)}}Ea.prototype.ValueTypeName="quaternion",Ea.prototype.InterpolantFactoryMethodSmooth=void 0;class Ta extends Gr{constructor(e,t,i){super(e,t,i)}}Ta.prototype.ValueTypeName="string",Ta.prototype.ValueBufferType=Array,Ta.prototype.DefaultInterpolation=cl,Ta.prototype.InterpolantFactoryMethodLinear=void 0,Ta.prototype.InterpolantFactoryMethodSmooth=void 0;class Aa extends Gr{}Aa.prototype.ValueTypeName="vector";class Hl{constructor(e="",t=-1,i=[],r=xf){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=lr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(_O(i[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)t.push(Gr.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=gw(l);l=m_(l,1,u),c=m_(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new Sa(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const d=u[1];let p=r[d];p||(r[d]=p=[]),p.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,p,g,_,x){if(g.length!==0){const b=[],y=[];g_(g,b,y,_),b.length!==0&&x.push(new d(p,b,y))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const p=c[d].keys;if(!(!p||p.length===0))if(p[0].morphTargets){const g={};let _;for(_=0;_<p.length;_++)if(p[_].morphTargets)for(let x=0;x<p[_].morphTargets.length;x++)g[p[_].morphTargets[x]]=-1;for(const x in g){const b=[],y=[];for(let M=0;M!==p[_].morphTargets.length;++M){const E=p[_];b.push(E.time),y.push(E.morphTarget===x?1:0)}r.push(new Sa(".morphTargetInfluence["+x+"]",b,y))}l=g.length*o}else{const g=".bones["+t[d].name+"]";i(Aa,g+".position",p,"pos",r),i(Ea,g+".quaternion",p,"rot",r),i(Aa,g+".scale",p,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function gO(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Sa;case"vector":case"vector2":case"vector3":case"vector4":return Aa;case"color":return v_;case"quaternion":return Ea;case"bool":case"boolean":return wa;case"string":return Ta}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function _O(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=gO(n.type);if(n.times===void 0){const t=[],i=[];g_(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const ns={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class y_{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,p=c.length;d<p;d+=2){const g=c[d],_=c[d+1];if(g.global&&(g.lastIndex=0),g.test(u))return _}return null}}}const bw=new y_;class In{constructor(e){this.manager=e!==void 0?e:bw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}In.DEFAULT_MATERIAL_NAME="__DEFAULT";const Fs={};class vO extends Error{constructor(e,t){super(e),this.response=t}}class fr extends In{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=ns.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Fs[e]!==void 0){Fs[e].push({onLoad:t,onProgress:i,onError:r});return}Fs[e]=[],Fs[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Fs[e],d=c.body.getReader(),p=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),g=p?parseInt(p):0,_=g!==0;let x=0;const b=new ReadableStream({start(y){M();function M(){d.read().then(({done:E,value:w})=>{if(E)y.close();else{x+=w.byteLength;const I=new ProgressEvent("progress",{lengthComputable:_,loaded:x,total:g});for(let B=0,N=u.length;B<N;B++){const L=u[B];L.onProgress&&L.onProgress(I)}y.enqueue(w),M()}},E=>{y.error(E)})}}});return new Response(b)}else throw new vO(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),p=d&&d[1]?d[1].toLowerCase():void 0,g=new TextDecoder(p);return c.arrayBuffer().then(_=>g.decode(_))}}}).then(c=>{ns.add(e,c);const u=Fs[e];delete Fs[e];for(let d=0,p=u.length;d<p;d++){const g=u[d];g.onLoad&&g.onLoad(c)}}).catch(c=>{const u=Fs[e];if(u===void 0)throw this.manager.itemError(e),c;delete Fs[e];for(let d=0,p=u.length;d<p;d++){const g=u[d];g.onError&&g.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class yO extends In{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new fr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const t=[];for(let i=0;i<e.length;i++){const r=Hl.parse(e[i]);t.push(r)}return t}}class bO extends In{constructor(e){super(e)}load(e,t,i,r){const s=this,o=[],a=new _d,l=new fr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(d){l.load(e[d],function(p){const g=s.parse(p,!0);o[d]={width:g.width,height:g.height,format:g.format,mipmaps:g.mipmaps},c+=1,c===6&&(g.mipmapCount===1&&(a.minFilter=Ei),a.image=o,a.format=g.format,a.needsUpdate=!0,t&&t(a))},i,r)}if(Array.isArray(e))for(let d=0,p=e.length;d<p;++d)u(d);else l.load(e,function(d){const p=s.parse(d,!0);if(p.isCubemap){const g=p.mipmaps.length/p.mipmapCount;for(let _=0;_<g;_++){o[_]={mipmaps:[]};for(let x=0;x<p.mipmapCount;x++)o[_].mipmaps.push(p.mipmaps[_*p.mipmapCount+x]),o[_].format=p.format,o[_].width=p.width,o[_].height=p.height}a.image=o}else a.image.width=p.width,a.image.height=p.height,a.mipmaps=p.mipmaps;p.mipmapCount===1&&(a.minFilter=Ei),a.format=p.format,a.needsUpdate=!0,t&&t(a)},i,r);return a}}class Ih extends In{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=ns.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=th("img");function l(){u(),ns.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(d){u(),r&&r(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class xO extends In{constructor(e){super(e)}load(e,t,i,r){const s=new ch;s.colorSpace=Ai;const o=new Ih(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(u){s.images[c]=u,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class xw extends In{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new An,a=new fr(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(r!==void 0)r(u);else{console.error(u);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:or,o.wrapT=c.wrapT!==void 0?c.wrapT:or,o.magFilter=c.magFilter!==void 0?c.magFilter:Ei,o.minFilter=c.minFilter!==void 0?c.minFilter:Ei,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(o.colorSpace=c.colorSpace),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=wr),c.mipmapCount===1&&(o.minFilter=Ei),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},i,r),o}}class Ud extends In{constructor(e){super(e)}load(e,t,i,r){const s=new yi,o=new Ih(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class fo extends Dt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ve(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}let b_=class extends fo{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Dt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ve(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}};const x_=new Mt,ww=new q,Sw=new q;class w_{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new xe(512,512),this.map=null,this.mapPass=null,this.matrix=new Mt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fa,this._frameExtents=new xe(1,1),this._viewportCount=1,this._viewports=[new Gt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;ww.setFromMatrixPosition(e.matrixWorld),t.position.copy(ww),Sw.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Sw),t.updateMatrixWorld(),x_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(x_),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(x_)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class wO extends w_{constructor(){super(new en(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=ul*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class S_ extends fo{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Dt.DEFAULT_UP),this.updateMatrix(),this.target=new Dt,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new wO}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Ew=new Mt,Ph=new q,E_=new q;class SO extends w_{constructor(){super(new en(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new xe(4,2),this._viewportCount=6,this._viewports=[new Gt(2,1,1,1),new Gt(0,1,1,1),new Gt(3,1,1,1),new Gt(1,1,1,1),new Gt(3,0,1,1),new Gt(1,0,1,1)],this._cubeDirections=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],this._cubeUps=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Ph.setFromMatrixPosition(e.matrixWorld),i.position.copy(Ph),E_.copy(i.position),E_.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(E_),i.updateMatrixWorld(),r.makeTranslation(-Ph.x,-Ph.y,-Ph.z),Ew.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ew)}}class T_ extends fo{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new SO}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class EO extends w_{constructor(){super(new Ns(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}let Gl=class extends fo{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Dt.DEFAULT_UP),this.updateMatrix(),this.target=new Dt,this.shadow=new EO}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};class A_ extends fo{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Tw extends fo{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Aw{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new q)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(i*s)),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*i*s),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class Mw extends fo{constructor(e=new Aw,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class kd extends In{constructor(e){super(e),this.textures={}}load(e,t,i,r){const s=this,o=new fr(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const t=this.textures;function i(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const r=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new ve().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(r.dispersion=e.dispersion),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=i(o.value);break;case"c":r.uniforms[s].value=new ve().setHex(o.value);break;case"v2":r.uniforms[s].value=new xe().fromArray(o.value);break;case"v3":r.uniforms[s].value=new q().fromArray(o.value);break;case"v4":r.uniforms[s].value=new Gt().fromArray(o.value);break;case"m3":r.uniforms[s].value=new kt().fromArray(o.value);break;case"m4":r.uniforms[s].value=new Mt().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new xe().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapRotation!==void 0&&r.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new xe().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return kd.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:aw,SpriteMaterial:fh,RawShaderMaterial:lw,ShaderMaterial:wi,PointsMaterial:dd,MeshPhysicalMaterial:cw,MeshStandardMaterial:kl,MeshPhongMaterial:hw,MeshToonMaterial:uw,MeshNormalMaterial:Fd,MeshLambertMaterial:fw,MeshDepthMaterial:zg,MeshDistanceMaterial:Hg,MeshBasicMaterial:Pi,MeshMatcapMaterial:dw,LineDashedMaterial:pw,LineBasicMaterial:rn,Material:Ji};return new t[e]}}class po{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Ma extends Tt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class M_ extends In{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new fr(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e){const t={},i={};function r(g,_){if(t[_]!==void 0)return t[_];const b=g.interleavedBuffers[_],y=s(g,b.buffer),M=fl(b.type,y),E=new Pl(M,b.stride);return E.uuid=b.uuid,t[_]=E,E}function s(g,_){if(i[_]!==void 0)return i[_];const b=g.arrayBuffers[_],y=new Uint32Array(b).buffer;return i[_]=y,y}const o=e.isInstancedBufferGeometry?new Ma:new Tt,a=e.data.index;if(a!==void 0){const g=fl(a.type,a.array);o.setIndex(new Jt(g,1))}const l=e.data.attributes;for(const g in l){const _=l[g];let x;if(_.isInterleavedBufferAttribute){const b=r(e.data,_.data);x=new jt(b,_.itemSize,_.offset,_.normalized)}else{const b=fl(_.type,_.array),y=_.isInstancedBufferAttribute?Gn:Jt;x=new y(b,_.itemSize,_.normalized)}_.name!==void 0&&(x.name=_.name),_.usage!==void 0&&x.setUsage(_.usage),o.setAttribute(g,x)}const c=e.data.morphAttributes;if(c)for(const g in c){const _=c[g],x=[];for(let b=0,y=_.length;b<y;b++){const M=_[b];let E;if(M.isInterleavedBufferAttribute){const w=r(e.data,M.data);E=new jt(w,M.itemSize,M.offset,M.normalized)}else{const w=fl(M.type,M.array);E=new Jt(w,M.itemSize,M.normalized)}M.name!==void 0&&(E.name=M.name),x.push(E)}o.morphAttributes[g]=x}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let g=0,_=d.length;g!==_;++g){const x=d[g];o.addGroup(x.start,x.count,x.materialIndex)}const p=e.data.boundingSphere;if(p!==void 0){const g=new q;p.center!==void 0&&g.fromArray(p.center),o.boundingSphere=new qi(g,p.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class TO extends In{constructor(e){super(e)}load(e,t,i,r){const s=this,o=this.path===""?po.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new fr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(d){r!==void 0&&r(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,t)},i,r)}async loadAsync(e,t){const i=this,r=this.path===""?po.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new fr(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,i),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),t!==void 0){let d=!1;for(const p in o)if(o[p].data instanceof HTMLImageElement){d=!0;break}d===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,r=e.length;i<r;i++){const s=new uo().fromJSON(e[i]);t[s.uuid]=s}return t}parseSkeletons(e,t){const i={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new gh().fromJSON(e[s],r);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const r=new M_;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in ow?a=ow[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},r={};if(e!==void 0){const s=new kd;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=s.parse(l)),r[l.uuid]=i[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const r=e[i],s=Hl.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const i=this,r={};let s;function o(l){return i.manager.itemStart(l),s.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return o(u)}else return l.data?{data:fl(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new y_(t);s=new Ih(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const d=e[c],p=d.url;if(Array.isArray(p)){const g=[];for(let _=0,x=p.length;_<x;_++){const b=p[_],y=a(b);y!==null&&(y instanceof HTMLImageElement?g.push(y):g.push(new An(y.data,y.width,y.height)))}r[d.uuid]=new oa(g)}else{const g=a(d.url);r[d.uuid]=new oa(g)}}}return r}async parseImagesAsync(e){const t=this,i={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:fl(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new Ih(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const u=[];for(let d=0,p=c.length;d<p;d++){const g=c[d],_=await s(g);_!==null&&(_ instanceof HTMLImageElement?u.push(_):u.push(new An(_.data,_.width,_.height)))}i[l.uuid]=new oa(u)}else{const u=await s(l.url);i[l.uuid]=new oa(u)}}}return i}parseTextures(e,t){function i(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let u;Array.isArray(c)?(u=new ch,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new An:u=new yi,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=a.uuid,a.name!==void 0&&(u.name=a.name),a.mapping!==void 0&&(u.mapping=i(a.mapping,AO)),a.channel!==void 0&&(u.channel=a.channel),a.offset!==void 0&&u.offset.fromArray(a.offset),a.repeat!==void 0&&u.repeat.fromArray(a.repeat),a.center!==void 0&&u.center.fromArray(a.center),a.rotation!==void 0&&(u.rotation=a.rotation),a.wrap!==void 0&&(u.wrapS=i(a.wrap[0],Cw),u.wrapT=i(a.wrap[1],Cw)),a.format!==void 0&&(u.format=a.format),a.internalFormat!==void 0&&(u.internalFormat=a.internalFormat),a.type!==void 0&&(u.type=a.type),a.colorSpace!==void 0&&(u.colorSpace=a.colorSpace),a.minFilter!==void 0&&(u.minFilter=i(a.minFilter,Iw)),a.magFilter!==void 0&&(u.magFilter=i(a.magFilter,Iw)),a.anisotropy!==void 0&&(u.anisotropy=a.anisotropy),a.flipY!==void 0&&(u.flipY=a.flipY),a.generateMipmaps!==void 0&&(u.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(u.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(u.compareFunction=a.compareFunction),a.userData!==void 0&&(u.userData=a.userData),r[a.uuid]=u}return r}parseObject(e,t,i,r,s){let o;function a(p){return t[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",p),t[p]}function l(p){if(p!==void 0){if(Array.isArray(p)){const g=[];for(let _=0,x=p.length;_<x;_++){const b=p[_];i[b]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",b),g.push(i[b])}return g}return i[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",p),i[p]}}function c(p){return r[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",p),r[p]}let u,d;switch(e.type){case"Scene":o=new uh,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new ve(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new $f(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new Qf(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(o.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new en(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Ns(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new A_(e.color,e.intensity);break;case"DirectionalLight":o=new Gl(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new T_(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new Tw(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new S_(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new b_(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new Mw().fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),d=l(e.material),o=new jg(u,d),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),d=l(e.material),o=new pt(u,d);break;case"InstancedMesh":u=a(e.geometry),d=l(e.material);const p=e.count,g=e.instanceMatrix,_=e.instanceColor;o=new Fx(u,d,p),o.instanceMatrix=new Gn(new Float32Array(g.array),16),_!==void 0&&(o.instanceColor=new Gn(new Float32Array(_.array),_.itemSize));break;case"BatchedMesh":u=a(e.geometry),d=l(e.material),o=new kx(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,d),o.geometry=u,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(x=>{const b=new Vi;b.min.fromArray(x.boxMin),b.max.fromArray(x.boxMax);const y=new qi;return y.radius=x.sphereRadius,y.center.fromArray(x.sphereCenter),{boxInitialized:x.boxInitialized,box:b,sphereInitialized:x.sphereInitialized,sphere:y}}),o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(o._colorsTexture=c(e.colorsTexture.uuid));break;case"LOD":o=new Cx;break;case"Line":o=new ts(a(e.geometry),l(e.material));break;case"LineLoop":o=new $g(a(e.geometry),l(e.material));break;case"LineSegments":o=new Cn(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new gd(a(e.geometry),l(e.material));break;case"Sprite":o=new td(l(e.material));break;case"Group":o=new ur;break;case"Bone":o=new sd;break;default:o=new Dt}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(o.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const p=e.children;for(let g=0;g<p.length;g++)o.add(this.parseObject(p[g],t,i,r,s))}if(e.animations!==void 0){const p=e.animations;for(let g=0;g<p.length;g++){const _=p[g];o.animations.push(s[_])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const p=e.levels;for(let g=0;g<p.length;g++){const _=p[g],x=o.getObjectByProperty("uuid",_.object);x!==void 0&&o.addLevel(x,_.distance,_.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const r=t[i.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const i=t.target,r=e.getObjectByProperty("uuid",i);r!==void 0?t.target=r:t.target=new Dt}})}}const AO={UVMapping:ku,CubeReflectionMapping:Ts,CubeRefractionMapping:to,EquirectangularReflectionMapping:sl,EquirectangularRefractionMapping:Wc,CubeUVReflectionMapping:ol},Cw={RepeatWrapping:io,ClampToEdgeWrapping:or,MirroredRepeatWrapping:al},Iw={NearestFilter:xi,NearestMipmapNearestFilter:zu,NearestMipmapLinearFilter:$o,LinearFilter:Ei,LinearMipmapNearestFilter:ll,LinearMipmapLinearFilter:wr};class Pw extends In{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=ns.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),s.manager.itemEnd(e)}).catch(c=>{r&&r(c)});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return ns.add(e,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),ns.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});ns.add(e,l),s.manager.itemStart(e)}}let zd;class C_{static getContext(){return zd===void 0&&(zd=new(window.AudioContext||window.webkitAudioContext)),zd}static setContext(e){zd=e}}class MO extends In{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new fr(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);C_.getContext().decodeAudioData(c,function(d){t(d)}).catch(a)}catch(c){a(c)}},i,r);function a(l){r?r(l):console.error(l),s.manager.itemError(e)}}}const Rw=new Mt,Dw=new Mt,Ca=new Mt;class CO{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new en,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new en,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Ca.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(sa*t.fov*.5)/t.zoom;let a,l;Dw.elements[12]=-r,Rw.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,Ca.elements[0]=2*t.near/(l-a),Ca.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Ca),a=-o*t.aspect-s,l=o*t.aspect-s,Ca.elements[0]=2*t.near/(l-a),Ca.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Ca)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Dw),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Rw)}}class Hd{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Lw(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Lw();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Lw(){return performance.now()}const Ia=new q,Ow=new Li,IO=new q,Pa=new q;class PO extends Dt{constructor(){super(),this.type="AudioListener",this.context=C_.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Hd}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ia,Ow,IO),Pa.set(0,0,-1).applyQuaternion(Ow),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Ia.x,r),t.positionY.linearRampToValueAtTime(Ia.y,r),t.positionZ.linearRampToValueAtTime(Ia.z,r),t.forwardX.linearRampToValueAtTime(Pa.x,r),t.forwardY.linearRampToValueAtTime(Pa.y,r),t.forwardZ.linearRampToValueAtTime(Pa.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition(Ia.x,Ia.y,Ia.z),t.setOrientation(Pa.x,Pa.y,Pa.z,i.x,i.y,i.z)}}class Nw extends Dt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Ra=new q,Bw=new Li,RO=new q,Da=new q;class DO extends Nw{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ra,Bw,RO),Da.set(0,0,1).applyQuaternion(Bw);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ra.x,i),t.positionY.linearRampToValueAtTime(Ra.y,i),t.positionZ.linearRampToValueAtTime(Ra.z,i),t.orientationX.linearRampToValueAtTime(Da.x,i),t.orientationY.linearRampToValueAtTime(Da.y,i),t.orientationZ.linearRampToValueAtTime(Da.z,i)}else t.setPosition(Ra.x,Ra.y,Ra.z),t.setOrientation(Da.x,Da.y,Da.z)}}class LO{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class Fw{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)i[s+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(i,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let s=i,o=r;s!==o;++s)t[s]=t[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[i+o]}_slerp(e,t,i,r){Li.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,s){const o=this._workIndex*s;Li.multiplyQuaternionsFlat(e,o,e,t,e,i),Li.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,i,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*r}}_lerpAdditive(e,t,i,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[i+o]*r}}}const I_="\\[\\]\\.:\\/",OO=new RegExp("["+I_+"]","g"),P_="[^"+I_+"]",NO="[^"+I_.replace("\\.","")+"]",BO=/((?:WC+[\/:])*)/.source.replace("WC",P_),FO=/(WCOD+)?/.source.replace("WCOD",NO),UO=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",P_),kO=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",P_),zO=new RegExp("^"+BO+FO+UO+kO+"$"),HO=["material","materials","bones","map"];class GO{constructor(e,t,i){const r=i||ei.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class ei{constructor(e,t,i){this.path=t,this.parsedPath=i||ei.parseTrackName(t),this.node=ei.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new ei.Composite(e,t,i):new ei(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(OO,"")}static parseTrackName(e){const t=zO.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);HO.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=ei.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ei.Composite=GO,ei.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ei.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ei.prototype.GetterByBindingType=[ei.prototype._getValue_direct,ei.prototype._getValue_array,ei.prototype._getValue_arrayElement,ei.prototype._getValue_toArray],ei.prototype.SetterByBindingTypeAndVersioning=[[ei.prototype._setValue_direct,ei.prototype._setValue_direct_setNeedsUpdate,ei.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ei.prototype._setValue_array,ei.prototype._setValue_array_setNeedsUpdate,ei.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ei.prototype._setValue_arrayElement,ei.prototype._setValue_arrayElement_setNeedsUpdate,ei.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ei.prototype._setValue_fromArray,ei.prototype._setValue_fromArray_setNeedsUpdate,ei.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class VO{constructor(){this.isAnimationObjectGroup=!0,this.uuid=lr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,c=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){const p=arguments[u],g=p.uuid;let _=t[g];if(_===void 0){_=l++,t[g]=_,e.push(p);for(let x=0,b=o;x!==b;++x)s[x].push(new ei(p,i[x],r[x]))}else if(_<c){a=e[_];const x=--c,b=e[x];t[b.uuid]=_,e[_]=b,t[g]=x,e[x]=p;for(let y=0,M=o;y!==M;++y){const E=s[y],w=E[x];let I=E[_];E[_]=w,I===void 0&&(I=new ei(p,i[y],r[y])),E[x]=I}}else e[_]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,u=t[c];if(u!==void 0&&u>=s){const d=s++,p=e[d];t[p.uuid]=u,e[u]=p,t[c]=d,e[d]=l;for(let g=0,_=r;g!==_;++g){const x=i[g],b=x[d],y=x[u];x[u]=b,x[d]=y}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],u=c.uuid,d=t[u];if(d!==void 0)if(delete t[u],d<s){const p=--s,g=e[p],_=--o,x=e[_];t[g.uuid]=d,e[d]=g,t[x.uuid]=p,e[p]=x,e.pop();for(let b=0,y=r;b!==y;++b){const M=i[b],E=M[p],w=M[_];M[d]=E,M[p]=w,M.pop()}}else{const p=--o,g=e[p];p>0&&(t[g.uuid]=d),e[d]=g,e.pop();for(let _=0,x=r;_!==x;++_){const b=i[_];b[d]=b[p],b.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,d=new Array(c);r=s.length,i[e]=r,o.push(e),a.push(t),s.push(d);for(let p=u,g=l.length;p!==g;++p){const _=l[p];d[p]=new ei(_,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=i,o[i]=l,o.pop(),s[i]=s[a],s.pop(),r[i]=r[a],r.pop()}}}class Uw{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:ia,endingEnd:ia};for(let c=0;c!==o;++c){const u=s[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=sb,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case ng:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case xf:default:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(o),c[u].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const o=i===ob;if(e===0)return s===-1?r:o&&(s&1)===1?t-r:r;if(i===rb){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=na,r.endingEnd=na):(e?r.endingStart=this.zeroSlopeAtStart?na:ia:r.endingStart=Qc,t?r.endingEnd=this.zeroSlopeAtEnd?na:ia:r.endingEnd=Qc)}_scheduleFading(e,t,i){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=i,this}}const WO=new Float32Array(1);class XO extends Jr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let d=0;d!==s;++d){const p=r[d],g=p.name;let _=u[g];if(_!==void 0)++_.referenceCount,o[d]=_;else{if(_=o[d],_!==void 0){_._cacheIndex===null&&(++_.referenceCount,this._addInactiveBinding(_,l,g));continue}const x=t&&t._propertyBindings[d].binding.parsedPath;_=new Fw(ei.create(i,g,x),p.ValueTypeName,p.getValueSize()),++_.referenceCount,this._addInactiveBinding(_,l,g),o[d]=_}a[d].resultBuffer=_.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const d=a.actionByRoot,p=(e._localRoot||this._root).uuid;delete d[p],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new __(new Float32Array(2),new Float32Array(2),1,WO),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?Hl.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=xf),l!==void 0){const d=l.actionByRoot[s];if(d!==void 0&&d.blendMode===i)return d;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const u=new Uw(this,o,t,i);return this._bindAction(u,c),this._addInactiveAction(u,a,s),u}existingAction(e,t){const i=t||this._root,r=i.uuid,s=typeof e=="string"?Hl.findByName(i,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class R_{constructor(e){this.value=e}clone(){return new R_(this.value.clone===void 0?this.value:this.value.clone())}}let YO=0;class jO extends Jr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:YO++}),this.name="",this.usage=un,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,r=t.length;i<r;i++){const s=Array.isArray(t[i])?t[i]:[t[i]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class Gd extends Pl{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class qO{constructor(e,t,i,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const kw=new Mt;class Us{constructor(e,t,i=0,r=1/0){this.ray=new ca(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Rf,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return kw.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(kw),this}intersectObject(e,t=!0,i=[]){return D_(e,this,i,t),i.sort(zw),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)D_(e[r],this,i,t);return i.sort(zw),i}}function zw(n,e){return n.distance-e.distance}function D_(n,e,t,i){let r=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(r=!1),r===!0&&i===!0){const s=n.children;for(let o=0,a=s.length;o<a;o++)D_(s[o],e,t,!0)}}class ZO{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Fi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class KO{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}class L_{constructor(e,t,i,r){L_.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=i,s[3]=r,this}}const Hw=new xe;class Rh{constructor(e=new xe(1/0,1/0),t=new xe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Hw.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Hw).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Gw=new q,Vd=new q;class ks{constructor(e=new q,t=new q){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Gw.subVectors(e,this.start),Vd.subVectors(this.end,this.start);const i=Vd.dot(Vd);let s=Vd.dot(Gw)/i;return t&&(s=Fi(s,0,1)),s}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Vw=new q;class QO extends Dt{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new Tt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new $e(r,3));const s=new rn({fog:!1,toneMapped:!1});this.cone=new Cn(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Vw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Vw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const mo=new q,Wd=new Mt,O_=new Mt;class $O extends Cn{constructor(e){const t=Ww(e),i=new Tt,r=[],s=[],o=new ve(0,0,1),a=new ve(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}i.setAttribute("position",new $e(r,3)),i.setAttribute("color",new $e(s,3));const l=new rn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");O_.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(Wd.multiplyMatrices(O_,a.matrixWorld),mo.setFromMatrixPosition(Wd),r.setXYZ(o,mo.x,mo.y,mo.z),Wd.multiplyMatrices(O_,a.parent.matrixWorld),mo.setFromMatrixPosition(Wd),r.setXYZ(o+1,mo.x,mo.y,mo.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ww(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,Ww(n.children[t]));return e}class JO extends pt{constructor(e,t,i){const r=new Ul(t,4,2),s=new Pi({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const e2=new q,Xw=new ve,Yw=new ve;class t2 extends Dt{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new Mh(t);r.rotateY(Math.PI*.5),this.material=new Pi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new Jt(o,3)),this.add(new pt(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Xw.copy(this.light.color),Yw.copy(this.light.groundColor);for(let i=0,r=t.count;i<r;i++){const s=i<r/2?Xw:Yw;t.setXYZ(i,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(e2.setFromMatrixPosition(this.light.matrixWorld).negate())}}class i2 extends Cn{constructor(e=10,t=10,i=4473924,r=8947848){i=new ve(i),r=new ve(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let p=0,g=0,_=-a;p<=t;p++,_+=o){l.push(-a,0,_,a,0,_),l.push(_,0,-a,_,0,a);const x=p===s?i:r;x.toArray(c,g),g+=3,x.toArray(c,g),g+=3,x.toArray(c,g),g+=3,x.toArray(c,g),g+=3}const u=new Tt;u.setAttribute("position",new $e(l,3)),u.setAttribute("color",new $e(c,3));const d=new rn({vertexColors:!0,toneMapped:!1});super(u,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class n2 extends Cn{constructor(e=10,t=16,i=8,r=64,s=4473924,o=8947848){s=new ve(s),o=new ve(o);const a=[],l=[];if(t>1)for(let d=0;d<t;d++){const p=d/t*(Math.PI*2),g=Math.sin(p)*e,_=Math.cos(p)*e;a.push(0,0,0),a.push(g,0,_);const x=d&1?s:o;l.push(x.r,x.g,x.b),l.push(x.r,x.g,x.b)}for(let d=0;d<i;d++){const p=d&1?s:o,g=e-e/i*d;for(let _=0;_<r;_++){let x=_/r*(Math.PI*2),b=Math.sin(x)*g,y=Math.cos(x)*g;a.push(b,0,y),l.push(p.r,p.g,p.b),x=(_+1)/r*(Math.PI*2),b=Math.sin(x)*g,y=Math.cos(x)*g,a.push(b,0,y),l.push(p.r,p.g,p.b)}}const c=new Tt;c.setAttribute("position",new $e(a,3)),c.setAttribute("color",new $e(l,3));const u=new rn({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const jw=new q,Xd=new q,qw=new q;class r2 extends Dt{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Tt;r.setAttribute("position",new $e([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new rn({fog:!1,toneMapped:!1});this.lightPlane=new ts(r,s),this.add(this.lightPlane),r=new Tt,r.setAttribute("position",new $e([0,0,0,0,0,1],3)),this.targetLine=new ts(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),jw.setFromMatrixPosition(this.light.matrixWorld),Xd.setFromMatrixPosition(this.light.target.matrixWorld),qw.subVectors(Xd,jw),this.lightPlane.lookAt(Xd),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Xd),this.targetLine.scale.z=qw.length()}}const Yd=new q,Ui=new Gf;class s2 extends Cn{constructor(e){const t=new Tt,i=new rn({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(_,x){l(_),l(x)}function l(_){r.push(0,0,0),s.push(0,0,0),o[_]===void 0&&(o[_]=[]),o[_].push(r.length/3-1)}t.setAttribute("position",new $e(r,3)),t.setAttribute("color",new $e(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new ve(16755200),u=new ve(16711680),d=new ve(43775),p=new ve(16777215),g=new ve(3355443);this.setColors(c,u,d,p,g)}setColors(e,t,i,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,r=1;Ui.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Wi("c",t,e,Ui,0,0,-1),Wi("t",t,e,Ui,0,0,1),Wi("n1",t,e,Ui,-i,-r,-1),Wi("n2",t,e,Ui,i,-r,-1),Wi("n3",t,e,Ui,-i,r,-1),Wi("n4",t,e,Ui,i,r,-1),Wi("f1",t,e,Ui,-i,-r,1),Wi("f2",t,e,Ui,i,-r,1),Wi("f3",t,e,Ui,-i,r,1),Wi("f4",t,e,Ui,i,r,1),Wi("u1",t,e,Ui,i*.7,r*1.1,-1),Wi("u2",t,e,Ui,-i*.7,r*1.1,-1),Wi("u3",t,e,Ui,0,r*2,-1),Wi("cf1",t,e,Ui,-i,0,1),Wi("cf2",t,e,Ui,i,0,1),Wi("cf3",t,e,Ui,0,-r,1),Wi("cf4",t,e,Ui,0,r,1),Wi("cn1",t,e,Ui,-i,0,-1),Wi("cn2",t,e,Ui,i,0,-1),Wi("cn3",t,e,Ui,0,-r,-1),Wi("cn4",t,e,Ui,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Wi(n,e,t,i,r,s,o){Yd.set(r,s,o).unproject(i);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],Yd.x,Yd.y,Yd.z)}}const jd=new Vi;class o2 extends Cn{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new Tt;s.setIndex(new Jt(i,1)),s.setAttribute("position",new Jt(r,3)),super(s,new rn({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&jd.setFromObject(this.object),jd.isEmpty())return;const t=jd.min,i=jd.max,r=this.geometry.attributes.position,s=r.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=t.x,s[4]=i.y,s[5]=i.z,s[6]=t.x,s[7]=t.y,s[8]=i.z,s[9]=i.x,s[10]=t.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=t.z,s[15]=t.x,s[16]=i.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=i.x,s[22]=t.y,s[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Zw extends Cn{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Tt;s.setIndex(new Jt(i,1)),s.setAttribute("position",new $e(r,3)),super(s,new rn({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Kw extends ts{constructor(e,t=1,i=16776960){const r=i,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Tt;o.setAttribute("position",new $e(s,3)),o.computeBoundingSphere(),super(o,new rn({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Tt;l.setAttribute("position",new $e(a,3)),l.computeBoundingSphere(),this.add(new pt(l,new Pi({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Qw=new q;let qd,N_;class a2 extends Dt{constructor(e=new q(0,0,1),t=new q(0,0,0),i=1,r=16776960,s=i*.2,o=s*.2){super(),this.type="ArrowHelper",qd===void 0&&(qd=new Tt,qd.setAttribute("position",new $e([0,0,0,0,1,0],3)),N_=new Bs(0,.5,1,5,1),N_.translate(0,-.5,0)),this.position.copy(t),this.line=new ts(qd,new rn({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new pt(N_,new Pi({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Qw.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Qw,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class $w extends Cn{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Tt;r.setAttribute("position",new $e(t,3)),r.setAttribute("color",new $e(i,3));const s=new rn({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,i){const r=new ve,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class l2{constructor(){this.type="ShapePath",this.color=new ve,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Bl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,o){return this.currentPath.bezierCurveTo(e,t,i,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(y){const M=[];for(let E=0,w=y.length;E<w;E++){const I=y[E],B=new uo;B.curves=I.curves,M.push(B)}return M}function i(y,M){const E=M.length;let w=!1;for(let I=E-1,B=0;B<E;I=B++){let N=M[I],L=M[B],P=L.x-N.x,R=L.y-N.y;if(Math.abs(R)>Number.EPSILON){if(R<0&&(N=M[B],P=-P,L=M[I],R=-R),y.y<N.y||y.y>L.y)continue;if(y.y===N.y){if(y.x===N.x)return!0}else{const U=R*(y.x-N.x)-P*(y.y-N.y);if(U===0)return!0;if(U<0)continue;w=!w}}else{if(y.y!==N.y)continue;if(L.x<=y.x&&y.x<=N.x||N.x<=y.x&&y.x<=L.x)return!0}}return w}const r=is.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const c=[];if(s.length===1)return a=s[0],l=new uo,l.curves=a.curves,c.push(l),c;let u=!r(s[0].getPoints());u=e?!u:u;const d=[],p=[];let g=[],_=0,x;p[_]=void 0,g[_]=[];for(let y=0,M=s.length;y<M;y++)a=s[y],x=a.getPoints(),o=r(x),o=e?!o:o,o?(!u&&p[_]&&_++,p[_]={s:new uo,p:x},p[_].s.curves=a.curves,u&&_++,g[_]=[]):g[_].push({h:a,p:x[0]});if(!p[0])return t(s);if(p.length>1){let y=!1,M=0;for(let E=0,w=p.length;E<w;E++)d[E]=[];for(let E=0,w=p.length;E<w;E++){const I=g[E];for(let B=0;B<I.length;B++){const N=I[B];let L=!0;for(let P=0;P<p.length;P++)i(N.p,p[P].p)&&(E!==P&&M++,L?(L=!1,d[P].push(N)):y=!0);L&&d[E].push(N)}}M>0&&y===!1&&(g=d)}let b;for(let y=0,M=p.length;y<M;y++){l=p[y].s,c.push(l),b=g[y];for(let E=0,w=b.length;E<w;E++)l.holes.push(b[E].h)}return c}}class c2 extends Jr{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}class Jw extends ji{constructor(e=1,t=1,i=1,r={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...r,count:i}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:wn}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=wn);const h2=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Vc,AddEquation:Js,AddOperation:ib,AdditiveAnimationBlendMode:ng,AdditiveBlending:km,AgXToneMapping:Xm,AlphaFormat:Qm,AlwaysCompare:_b,AlwaysDepth:Du,AlwaysStencilFunc:sg,AmbientLight:A_,AnimationAction:Uw,AnimationClip:Hl,AnimationLoader:yO,AnimationMixer:XO,AnimationObjectGroup:VO,AnimationUtils:mO,ArcCurve:Yx,ArrayCamera:Sx,ArrowHelper:a2,AttachedBindMode:jm,Audio:Nw,AudioAnalyser:LO,AudioContext:C_,AudioListener:PO,AudioLoader:MO,AxesHelper:$w,BackSide:hn,BasicDepthPacking:lb,BasicShadowMap:tC,BatchedMesh:kx,Bone:sd,BooleanKeyframeTrack:wa,Box2:Rh,Box3:Vi,Box3Helper:Zw,BoxGeometry:zr,BoxHelper:o2,BufferAttribute:Jt,BufferGeometry:Tt,BufferGeometryLoader:M_,ByteType:qm,Cache:ns,Camera:Gf,CameraHelper:s2,CanvasTexture:vd,CapsuleGeometry:wd,CatmullRomCurve3:jx,CineonToneMapping:Vm,CircleGeometry:$x,ClampToEdgeWrapping:or,Clock:Hd,Color:ve,ColorKeyframeTrack:v_,ColorManagement:Xt,CompressedArrayTexture:UL,CompressedCubeTexture:kL,CompressedTexture:_d,CompressedTextureLoader:bO,ConeGeometry:Sd,ConstantAlphaFactor:Jy,ConstantColorFactor:Qy,Controls:c2,CubeCamera:Yb,CubeReflectionMapping:Ts,CubeRefractionMapping:to,CubeTexture:ch,CubeTextureLoader:xO,CubeUVReflectionMapping:ol,CubicBezierCurve:s_,CubicBezierCurve3:Zx,CubicInterpolant:_w,CullFaceBack:Fm,CullFaceFront:Ny,CullFaceFrontBack:eC,CullFaceNone:Oy,Curve:Hr,CurvePath:Qx,CustomBlending:Fy,CustomToneMapping:Wm,CylinderGeometry:Bs,Cylindrical:KO,Data3DTexture:hg,DataArrayTexture:Ef,DataTexture:An,DataTextureLoader:xw,DataUtils:ah,DecrementStencilOp:fC,DecrementWrapStencilOp:pC,DefaultLoadingManager:bw,DepthFormat:no,DepthStencilFormat:ta,DepthTexture:Yf,DetachedBindMode:nb,DirectionalLight:Gl,DirectionalLightHelper:r2,DiscreteInterpolant:vw,DodecahedronGeometry:Ed,DoubleSide:Jn,DstAlphaFactor:Yy,DstColorFactor:qy,DynamicCopyUsage:CC,DynamicDrawUsage:SC,DynamicReadUsage:TC,EdgesGeometry:u_,EllipseCurve:yd,EqualCompare:db,EqualDepth:Ou,EqualStencilFunc:vC,EquirectangularReflectionMapping:sl,EquirectangularRefractionMapping:Wc,Euler:Oi,EventDispatcher:Jr,ExtrudeGeometry:Rd,FileLoader:fr,Float16BufferAttribute:mI,Float32BufferAttribute:$e,FloatType:Ii,Fog:$f,FogExp2:Qf,FramebufferTexture:e_,FrontSide:br,Frustum:fa,GLBufferAttribute:qO,GLSL1:PC,GLSL3:Sf,GreaterCompare:pb,GreaterDepth:Bu,GreaterEqualCompare:gb,GreaterEqualDepth:Nu,GreaterEqualStencilFunc:wC,GreaterStencilFunc:bC,GridHelper:i2,Group:ur,HalfFloatType:er,HemisphereLight:b_,HemisphereLightHelper:t2,IcosahedronGeometry:Dd,ImageBitmapLoader:Pw,ImageLoader:Ih,ImageUtils:Cb,IncrementStencilOp:uC,IncrementWrapStencilOp:dC,InstancedBufferAttribute:Gn,InstancedBufferGeometry:Ma,InstancedInterleavedBuffer:Gd,InstancedMesh:Fx,Int16BufferAttribute:dI,Int32BufferAttribute:pI,Int8BufferAttribute:hI,IntType:Hu,InterleavedBuffer:Pl,InterleavedBufferAttribute:jt,Interpolant:zl,InterpolateDiscrete:cl,InterpolateLinear:hl,InterpolateSmooth:bf,InvertStencilOp:mC,KeepStencilOp:ra,KeyframeTrack:Gr,LOD:Cx,LatheGeometry:Sh,Layers:Rf,LessCompare:fb,LessDepth:Lu,LessEqualCompare:og,LessEqualDepth:eo,LessEqualStencilFunc:yC,LessStencilFunc:_C,Light:fo,LightProbe:Mw,Line:ts,Line3:ks,LineBasicMaterial:rn,LineCurve:o_,LineCurve3:Kx,LineDashedMaterial:pw,LineLoop:$g,LineSegments:Cn,LinearFilter:Ei,LinearInterpolant:__,LinearMipMapLinearFilter:sC,LinearMipMapNearestFilter:rC,LinearMipmapLinearFilter:wr,LinearMipmapNearestFilter:ll,LinearSRGBColorSpace:sn,LinearToneMapping:Uu,LinearTransfer:$c,Loader:In,LoaderUtils:po,LoadingManager:y_,LoopOnce:rb,LoopPingPong:ob,LoopRepeat:sb,LuminanceAlphaFormat:eg,LuminanceFormat:Jm,MOUSE:Qo,Material:Ji,MaterialLoader:kd,MathUtils:kn,Matrix2:L_,Matrix3:kt,Matrix4:Mt,MaxEquation:Hy,Mesh:pt,MeshBasicMaterial:Pi,MeshDepthMaterial:zg,MeshDistanceMaterial:Hg,MeshLambertMaterial:fw,MeshMatcapMaterial:dw,MeshNormalMaterial:Fd,MeshPhongMaterial:hw,MeshPhysicalMaterial:cw,MeshStandardMaterial:kl,MeshToonMaterial:uw,MinEquation:zy,MirroredRepeatWrapping:al,MixOperation:tb,MultiplyBlending:Hm,MultiplyOperation:rl,NearestFilter:xi,NearestMipMapLinearFilter:nC,NearestMipMapNearestFilter:iC,NearestMipmapLinearFilter:$o,NearestMipmapNearestFilter:zu,NeutralToneMapping:Ym,NeverCompare:ub,NeverDepth:Ru,NeverStencilFunc:gC,NoBlending:Qr,NoColorSpace:Ms,NoToneMapping:xr,NormalAnimationBlendMode:xf,NormalBlending:Es,NotEqualCompare:mb,NotEqualDepth:Fu,NotEqualStencilFunc:xC,NumberKeyframeTrack:Sa,Object3D:Dt,ObjectLoader:TO,ObjectSpaceNormalMap:hb,OctahedronGeometry:Mh,OneFactor:Vy,OneMinusConstantAlphaFactor:eb,OneMinusConstantColorFactor:$y,OneMinusDstAlphaFactor:jy,OneMinusDstColorFactor:Zy,OneMinusSrcAlphaFactor:Pu,OneMinusSrcColorFactor:Xy,OrthographicCamera:Ns,PCFShadowMap:Um,PCFSoftShadowMap:By,PMREMGenerator:Bg,Path:Bl,PerspectiveCamera:en,Plane:es,PlaneGeometry:Er,PlaneHelper:Kw,PointLight:T_,PointLightHelper:JO,Points:gd,PointsMaterial:dd,PolarGridHelper:n2,PolyhedronGeometry:ho,PositionalAudio:DO,PropertyBinding:ei,PropertyMixer:Fw,QuadraticBezierCurve:a_,QuadraticBezierCurve3:l_,Quaternion:Li,QuaternionKeyframeTrack:Ea,QuaternionLinearInterpolant:yw,RED_GREEN_RGTC2_Format:vf,RED_RGTC1_Format:ig,REVISION:wn,RGBADepthPacking:cb,RGBAFormat:Ti,RGBAIntegerFormat:Yu,RGBA_ASTC_10x10_Format:ff,RGBA_ASTC_10x5_Format:cf,RGBA_ASTC_10x6_Format:hf,RGBA_ASTC_10x8_Format:uf,RGBA_ASTC_12x10_Format:df,RGBA_ASTC_12x12_Format:pf,RGBA_ASTC_4x4_Format:ef,RGBA_ASTC_5x4_Format:tf,RGBA_ASTC_5x5_Format:nf,RGBA_ASTC_6x5_Format:rf,RGBA_ASTC_6x6_Format:sf,RGBA_ASTC_8x5_Format:of,RGBA_ASTC_8x6_Format:af,RGBA_ASTC_8x8_Format:lf,RGBA_BPTC_Format:Kc,RGBA_ETC2_EAC_Format:Ju,RGBA_PVRTC_2BPPV1_Format:Ku,RGBA_PVRTC_4BPPV1_Format:Zu,RGBA_S3TC_DXT1_Format:jc,RGBA_S3TC_DXT3_Format:qc,RGBA_S3TC_DXT5_Format:Zc,RGBDepthPacking:aC,RGBFormat:$m,RGBIntegerFormat:oC,RGB_BPTC_SIGNED_Format:mf,RGB_BPTC_UNSIGNED_Format:gf,RGB_ETC1_Format:Qu,RGB_ETC2_Format:$u,RGB_PVRTC_2BPPV1_Format:qu,RGB_PVRTC_4BPPV1_Format:ju,RGB_S3TC_DXT1_Format:Yc,RGDepthPacking:lC,RGFormat:tg,RGIntegerFormat:Xu,RawShaderMaterial:lw,Ray:ca,Raycaster:Us,RectAreaLight:Tw,RedFormat:Wu,RedIntegerFormat:Xc,ReinhardToneMapping:Gm,RenderTarget:Ib,RepeatWrapping:io,ReplaceStencilOp:hC,ReverseSubtractEquation:ky,RingGeometry:Ld,SIGNED_RED_GREEN_RGTC2_Format:yf,SIGNED_RED_RGTC1_Format:_f,SRGBColorSpace:Ai,SRGBTransfer:mi,Scene:uh,ShaderChunk:Ft,ShaderLib:Ni,ShaderMaterial:wi,ShadowMaterial:aw,Shape:uo,ShapeGeometry:Ch,ShapePath:l2,ShapeUtils:is,ShortType:Zm,Skeleton:gh,SkeletonHelper:$O,SkinnedMesh:jg,Source:oa,Sphere:qi,SphereGeometry:Ul,Spherical:ZO,SphericalHarmonics3:Aw,SplineCurve:c_,SpotLight:S_,SpotLightHelper:QO,Sprite:td,SpriteMaterial:fh,SrcAlphaFactor:Iu,SrcAlphaSaturateFactor:Ky,SrcColorFactor:Wy,StaticCopyUsage:MC,StaticDrawUsage:un,StaticReadUsage:EC,StereoCamera:CO,StreamCopyUsage:IC,StreamDrawUsage:vb,StreamReadUsage:AC,StringKeyframeTrack:Ta,SubtractEquation:Uy,SubtractiveBlending:zm,TOUCH:J1,TangentSpaceNormalMap:Br,TetrahedronGeometry:Od,Texture:yi,TextureLoader:Ud,TextureUtils:vL,TorusGeometry:ba,TorusKnotGeometry:Nd,Triangle:$i,TriangleFanDrawMode:wf,TriangleStripDrawMode:rg,TrianglesDrawMode:ab,TubeGeometry:Bd,UVMapping:ku,Uint16BufferAttribute:Ag,Uint32BufferAttribute:Mg,Uint8BufferAttribute:uI,Uint8ClampedBufferAttribute:fI,Uniform:R_,UniformsGroup:jO,UniformsLib:He,UniformsUtils:Tn,UnsignedByteType:ar,UnsignedInt248Type:ea,UnsignedInt5999Type:Km,UnsignedIntType:As,UnsignedShort4444Type:Gu,UnsignedShort5551Type:Vu,UnsignedShortType:Jo,VSMShadowMap:Kr,Vector2:xe,Vector3:q,Vector4:Gt,VectorKeyframeTrack:Aa,VideoTexture:FL,WebGL3DRenderTarget:eI,WebGLArrayRenderTarget:JC,WebGLCoordinateSystem:$r,WebGLCubeRenderTarget:jb,WebGLMultipleRenderTargets:Jw,WebGLRenderTarget:ji,WebGLRenderer:Kf,WebGLUtils:wx,WebGPUCoordinateSystem:Jc,WireframeGeometry:p_,WrapAroundEnding:Qc,ZeroCurvatureEnding:ia,ZeroFactor:Gy,ZeroSlopeEnding:na,ZeroStencilOp:cC,createCanvasElement:xb},Symbol.toStringTag,{value:"Module"}));let u2=new xe;new xe;class zs extends Rh{constructor(t=new xe(1/0,1/0),i=new xe(-1/0,-1/0)){super(t,i);f(this,"_size",new xe)}get size(){return this.getSize(this._size)}setSize(t){let i=this.getCenter(u2);this.setFromCenterAndSize(i,t)}static fromBoundingBox3D(t,i=new zs){const{min:r,max:s}=t;return i.min.set(r.x,r.y),i.max.set(s.x,s.y),i}static fromArray(t,i=new zs){return i.min.set(t[0],t[1]),i.max.set(t[2],t[3]),i}computeScreenSpacePosition(t,i=[]){}}function O(n){return n!=null}class Ze extends Error{constructor(t){super();f(this,"name","DeveloperError");f(this,"message");f(this,"stack");this.message=t;let i;try{throw new Error(t)}catch(r){i=r.stack}this.stack=i}toString(){let t=`${this.name}: ${this.message}`;return O(this.stack)&&(t+=`
${this.stack.toString()}`),t}static throwInstantiationError(){throw new Ze("This function defines an interface and should not be called directly.")}}function ye(n,e){return n??e}ye.EMPTY_OBJECT=Object.freeze({});class f2{constructor(e=new Date().getTime()){f(this,"N",624);f(this,"M",397);f(this,"MATRIX_A",2567483615);f(this,"UPPER_MASK",2147483648);f(this,"LOWER_MASK",2147483647);f(this,"mt",new Array(this.N));f(this,"mti",this.N+1);e instanceof Array?this.init_by_array(e,e.length):this.init_seed(e)}init_seed(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){const t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((t&4294901760)>>>16)*1812433253<<16)+(t&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}}init_by_array(e,t){let i,r,s;for(this.init_seed(19650218),i=1,r=0,s=this.N>t?this.N:t;s;s--){const o=this.mt[i-1]^this.mt[i-1]>>>30;this.mt[i]=(this.mt[i]^(((o&4294901760)>>>16)*1664525<<16)+(o&65535)*1664525)+e[r]+r,this.mt[i]>>>=0,i++,r++,i>=this.N&&(this.mt[0]=this.mt[this.N-1],i=1),r>=t&&(r=0)}for(s=this.N-1;s;s--){const o=this.mt[i-1]^this.mt[i-1]>>>30;this.mt[i]=(this.mt[i]^(((o&4294901760)>>>16)*1566083941<<16)+(o&65535)*1566083941)-i,this.mt[i]>>>=0,i++,i>=this.N&&(this.mt[0]=this.mt[this.N-1],i=1)}this.mt[0]=2147483648}random_int(){let e;const t=[0,this.MATRIX_A];if(this.mti>=this.N){let i;for(this.mti==this.N+1&&this.init_seed(5489),i=0;i<this.N-this.M;i++)e=this.mt[i]&this.UPPER_MASK|this.mt[i+1]&this.LOWER_MASK,this.mt[i]=this.mt[i+this.M]^e>>>1^t[e&1];for(;i<this.N-1;i++)e=this.mt[i]&this.UPPER_MASK|this.mt[i+1]&this.LOWER_MASK,this.mt[i]=this.mt[i+(this.M-this.N)]^e>>>1^t[e&1];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>>18,e>>>0}random_int31(){return this.random_int()>>>1}random_incl(){return this.random_int()*(1/4294967295)}random(){return this.random_int()*(1/4294967296)}random_excl(){return(this.random_int()+.5)*(1/4294967296)}random_long(){const e=this.random_int()>>>5,t=this.random_int()>>>6;return(e*67108864+t)*(1/9007199254740992)}}const d2=new f2,Ne={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,SIXTY_FOUR_KILOBYTES:64*1024,PI_OVER_TWO:Math.PI/2,TWO_PI:2*Math.PI,RADIANS_PER_DEGREE:Math.PI/180,PI_OVER_FOUR:Math.PI/4,LEFT_SHIFT16:65536,LEFT_SHIFT8:256,equalsEpsilon:(n,e,t=0,i=t)=>{const r=Math.abs(n-e);return r<=i||r<=t*Math.max(Math.abs(n),Math.abs(e))},incrementWrap:(n,e,t)=>{if(t=ye(t,0),e<=t)throw new Ze("maximumValue must be greater than minimumValue.");return++n,n>e&&(n=t),n},negativePiToPi(n){return n>=-Math.PI&&n<=Math.PI?n:Ne.zeroToTwoPi(n+Math.PI)-Math.PI},zeroToTwoPi(n){if(n>=0&&n<=Ne.TWO_PI)return n;const e=Ne.mod(n,Ne.TWO_PI);return Math.abs(e)<Ne.EPSILON14&&Math.abs(n)>Ne.EPSILON14?Ne.TWO_PI:e},mod(n,e){return Ne.sign(n)===Ne.sign(e)&&Math.abs(n)<Math.abs(e)?n:(n%e+e)%e},sign:ye(Math.sign,function(e){return e=+e,e===0||e!==e?e:e>0?1:-1}),normalize(n,e,t){return t=Math.max(t-e,0),t===0?0:kn.clamp((n-e)/t,0,1)},fog(n,e){var t=n*e;return 1-Math.exp(-(t*t))},toRadians(n){return n*Ne.RADIANS_PER_DEGREE},acosClamped(n){return Math.acos(kn.clamp(n,-1,1))},lerp(n,e,t){return(1-t)*n+t*e},clamp(n,e,t){if(!O(n))throw new Ze("value is required");if(!O(e))throw new Ze("min is required.");if(!O(t))throw new Ze("max is required.");return n<e?e:n>t?t:n},asinClamped(n){return Math.asin(Ne.clamp(n,-1,1))},nextRandomNumber(){return d2.random()},randomBetween(n,e){return Ne.nextRandomNumber()*(e-n)+n}},$t=class $t extends q{constructor(e=0,t=0,i=0){super(e,t,i)}static clone(e,t=new $t){if(O(e))return t.x=e.x,t.y=e.y,t.z=e.z,t}static equals(e,t){return e===t||O(e)&&O(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z}static subtract(e,t,i){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i}static multiplyByScalar(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i}static magnitudeSquared(e){return e.x*e.x+e.y*e.y+e.z*e.z}static magnitude(e){return Math.sqrt($t.magnitudeSquared(e))}static equalsEpsilon(e,t,i=0,r=i){return e===t||O(e)&&O(t)&&Ne.equalsEpsilon(e.x,t.x,i,r)&&Ne.equalsEpsilon(e.y,t.y,i,r)&&Ne.equalsEpsilon(e.z,t.z,i,r)}static maximumComponent(e){return Math.max(e.x,e.y,e.z)}static minimumComponent(e){return Math.min(e.x,e.y,e.z)}static fromElements(e,t,i,r=new $t){return r.x=e,r.y=t,r.z=i,r}static normalize(e,t){var i=$t.magnitude(e);if(t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,isNaN(t.x)||isNaN(t.y)||isNaN(t.z))throw new Ze("normalized result is not a number");return t}static add(e,t,i){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i}static cross(e,t,i){var r=e.x,s=e.y,o=e.z,a=t.x,l=t.y,c=t.z,u=s*c-o*l,d=o*a-r*c,p=r*l-s*a;return i.x=u,i.y=d,i.z=p,i}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static divideByScalar(e,t,i){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i}static multiplyComponents(e,t,i){return i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z,i}static negate(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}static angleBetween(e,t){$t.normalize(e,Zd),$t.normalize(t,B_);var i=$t.dot(Zd,B_),r=$t.magnitude($t.cross(Zd,B_,Zd));return Math.atan2(r,i)}static distance(e,t){return $t.subtract(e,t,eS),$t.magnitude(eS)}static abs(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t}static mostOrthogonalAxis(e,t){var i=$t.normalize(e,p2);return $t.abs(i,i),i.x<=i.y?i.x<=i.z?t=$t.clone($t.UNIT_X,t):t=$t.clone($t.UNIT_Z,t):i.y<=i.z?t=$t.clone($t.UNIT_Y,t):t=$t.clone($t.UNIT_Z,t),t}static pack(e,t,i=0){return t[i++]=e.x,t[i++]=e.y,t[i]=e.z,t}static unpack(e,t=0,i=new $t){return i.x=e[t++],i.y=e[t++],i.z=e[t],i}};f($t,"packedLength",3),f($t,"ZERO",Object.freeze(new $t(0,0,0))),f($t,"UNIT_X",Object.freeze(new $t(1,0,0))),f($t,"UNIT_Y",Object.freeze(new $t(0,1,0))),f($t,"UNIT_Z",Object.freeze(new $t(0,0,1))),f($t,"fromVector4",$t.clone);let T=$t,Zd=new T,B_=new T,eS=new T,p2=new T;new T,new T,new T(6378137*6378137,6378137*6378137,6356752314245179e-9*6356752314245179e-9);class fi extends es{constructor(e=new T,t){super(T.clone(e),t)}get distance(){return this.constant}set distance(e){this.constant=e}static fromPointNormal(e,t,i){if(!Ne.equalsEpsilon(T.magnitude(t),1,Ne.EPSILON6))throw new Ze("normal must be normalized.");var r=-T.dot(t,e);return O(i)?(T.clone(t,i.normal),i.distance=r,i):new fi(t,r)}}const m2={POSITIVE_X:(n,e=new fi)=>e.setFromNormalAndCoplanarPoint(T.UNIT_X,n.max),NEGATIVE_X:(n,e=new fi)=>{},POSITIVE_Y:(n,e=new fi)=>{},NEGATIVE_Y:(n,e=new fi)=>{},POSITIVE_Z:(n,e=new fi)=>{},NEGATIVE_Z:(n,e=new fi)=>{}};class Lt extends Vi{constructor(t=new T(1/0,1/0,1/0),i=new T(-1/0,-1/0,-1/0)){super(t,i);f(this,"_size",new T);f(this,"_center",new T)}get size(){return this.getSize(this._size)}get center(){return this.getCenter(this._center)}get minimum(){return this.min}get maximum(){return this.max}static getAxisAlignedPlane(t,i,r=new fi){return m2[i](t,r)}static getPoints(t,i=[]){const r=t.min,s=t.max;return i.push(new T(r.x,r.y,r.z)),i.push(new T(s.x,r.y,r.z)),i.push(new T(s.x,s.y,r.z)),i.push(new T(r.x,s.y,r.z)),i.push(new T(s.x,r.y,s.z)),i.push(new T(r.x,r.y,s.z)),i.push(new T(r.x,s.y,s.z)),i.push(new T(s.x,s.y,s.z)),i}static equals(t,i){return t===i||O(t)&&O(i)&&T.equals(t.center,i.center)&&T.equals(t.minimum,i.minimum)&&T.equals(t.maximum,i.maximum)}static clone(t,i=new Lt){return i.copy(t)}static toArray(t){const{min:i,max:r}=t;return[...i.toArray(),...r.toArray()]}}function g2(n){for(var e=0,t=0;t<9;++t){var i=n.elements[t];e+=i*i}return Math.sqrt(e)}var F_=[1,0,0],U_=[2,2,1];function _2(n){for(var e=0,t=0;t<3;++t){var i=n.elements[at.getElementIndex(U_[t],F_[t])];e+=2*i*i}return Math.sqrt(e)}function v2(n,e){for(var t=Ne.EPSILON15,i=0,r=1,s=0;s<3;++s){var o=Math.abs(n.elements[at.getElementIndex(U_[s],F_[s])]);o>i&&(r=s,i=o)}var a=1,l=0,c=F_[r],u=U_[r];if(Math.abs(n.elements[at.getElementIndex(u,c)])>t){var d=n.elements[at.getElementIndex(u,u)],p=n.elements[at.getElementIndex(c,c)],g=n.elements[at.getElementIndex(u,c)],_=(d-p)/2/g,x;_<0?x=-1/(-_+Math.sqrt(1+_*_)):x=1/(_+Math.sqrt(1+_*_)),a=1/Math.sqrt(1+x*x),l=x*a}return e=at.clone(at.IDENTITY,e),e.elements[at.getElementIndex(c,c)]=e.elements[at.getElementIndex(u,u)]=a,e.elements[at.getElementIndex(u,c)]=l,e.elements[at.getElementIndex(c,u)]=-l,e}const ci=class ci extends kt{constructor(){super()}static fromArray(e,t=0,i=new ci){return i.elements[0]=e[t],i.elements[1]=e[t+1],i.elements[2]=e[t+2],i.elements[3]=e[t+3],i.elements[4]=e[t+4],i.elements[5]=e[t+5],i.elements[6]=e[t+6],i.elements[7]=e[t+7],i.elements[8]=e[t+8],i}static multiply(e,t,i){return i.multiplyMatrices(e,t)}static clone(e,t=new ci){return t.copy(e)}static getColumn(e,t,i){let r=t*3;const s=e.elements;let o=s[r],a=s[r+1],l=s[r+2];return i.x=o,i.y=a,i.z=l,i}static setColumn(e,t,i,r){r=ci.clone(e,r);let s=t*3;return r.elements[s]=i.x,r.elements[s+1]=i.y,r.elements[s+2]=i.z,r}static fromRotationX(e,t){var i=Math.cos(e),r=Math.sin(e);return O(t)?(t.elements[0]=1,t.elements[1]=0,t.elements[2]=0,t.elements[3]=0,t.elements[4]=i,t.elements[5]=r,t.elements[6]=0,t.elements[7]=-r,t.elements[8]=i,t):new ci().set(1,0,0,0,i,-r,0,r,i)}static multiplyByVector(e,t,i){var r=t.x,s=t.y,o=t.z;let{elements:a}=e;var l=a[0]*r+a[3]*s+a[6]*o,c=a[1]*r+a[4]*s+a[7]*o,u=a[2]*r+a[5]*s+a[8]*o;return i.x=l,i.y=c,i.z=u,i}static fromQuaternion(e,t=new ci){var i=e.x*e.x,r=e.x*e.y,s=e.x*e.z,o=e.x*e.w,a=e.y*e.y,l=e.y*e.z,c=e.y*e.w,u=e.z*e.z,d=e.z*e.w,p=e.w*e.w,g=i-a-u+p,_=2*(r-d),x=2*(s+c),b=2*(r+d),y=-i+a-u+p,M=2*(l-o),E=2*(s-c),w=2*(l+o),I=-i-a+u+p;return t.elements[0]=g,t.elements[1]=b,t.elements[2]=E,t.elements[3]=_,t.elements[4]=y,t.elements[5]=w,t.elements[6]=x,t.elements[7]=M,t.elements[8]=I,t}static transpose(e,t){var i=e.elements[0],r=e.elements[3],s=e.elements[6],o=e.elements[1],a=e.elements[4],l=e.elements[7],c=e.elements[2],u=e.elements[5],d=e.elements[8];return t.elements[0]=i,t.elements[1]=r,t.elements[2]=s,t.elements[3]=o,t.elements[4]=a,t.elements[5]=l,t.elements[6]=c,t.elements[7]=u,t.elements[8]=d,t}static multiplyByScale(e,t,i){return i.elements[0]=e.elements[0]*t.x,i.elements[1]=e.elements[1]*t.x,i.elements[2]=e.elements[2]*t.x,i.elements[3]=e.elements[3]*t.y,i.elements[4]=e.elements[4]*t.y,i.elements[5]=e.elements[5]*t.y,i.elements[6]=e.elements[6]*t.z,i.elements[7]=e.elements[7]*t.z,i.elements[8]=e.elements[8]*t.z,i}static fromScale(e,t){return O(t)?(t.elements[0]=e.x,t.elements[1]=0,t.elements[2]=0,t.elements[3]=0,t.elements[4]=e.y,t.elements[5]=0,t.elements[6]=0,t.elements[7]=0,t.elements[8]=e.z,t):new ci().set(e.x,0,0,0,e.y,0,0,0,e.z)}static getElementIndex(e,t){return e*3+t}static multiplyByUniformScale(e,t,i){return i.elements[0]=e.elements[0]*t,i.elements[1]=e.elements[1]*t,i.elements[2]=e.elements[2]*t,i.elements[3]=e.elements[3]*t,i.elements[4]=e.elements[4]*t,i.elements[5]=e.elements[5]*t,i.elements[6]=e.elements[6]*t,i.elements[7]=e.elements[7]*t,i.elements[8]=e.elements[8]*t,i}static multiplyByScalar(e,t,i){return ci.multiplyByUniformScale(e,t,i)}};f(ci,"packedLength",9),f(ci,"ZERO",Object.freeze(new ci().set(0,0,0,0,0,0,0,0,0))),f(ci,"IDENTITY",Object.freeze(new ci().identity())),f(ci,"COLUMN0ROW0",0),f(ci,"COLUMN0ROW1",1),f(ci,"COLUMN0ROW2",2),f(ci,"COLUMN1ROW0",3),f(ci,"COLUMN1ROW1",4),f(ci,"COLUMN1ROW2",5),f(ci,"COLUMN2ROW0",6),f(ci,"COLUMN2ROW1",7),f(ci,"COLUMN2ROW2",8),f(ci,"computeEigenDecomposition",function(e,t={}){for(var i=Ne.EPSILON20,r=10,s=0,o=0,a=t.unitary=ci.clone(ci.IDENTITY,t.unitary),l=t.diagonal=ci.clone(e,t.diagonal),c=i*g2(l);o<r&&_2(l)>c;)v2(l,Kd),ci.transpose(Kd,tS),ci.multiply(l,Kd,l),ci.multiply(tS,l,l),ci.multiply(a,Kd,a),++s>2&&(++o,s=0);return t});let at=ci;const Kd=new at,tS=new at,k_=new T;let y2=new T,b2=new T,x2=new T;const w2=new T;var S2=new T;class Mi extends qi{constructor(e,t){super(e,t)}static fromPoints(e,t=new Mi){return t.setFromPoints(e)}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;k_.subVectors(e,this.center);const t=k_.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(k_,r/i),this.radius+=r}return this}distanceSquaredTo(e){return Mi.distanceSquaredTo(this,e)}static fromOrientedBoundingBox(e,t=new Mi){let i=e.halfAxes,r=at.getColumn(i,0,y2),s=at.getColumn(i,1,b2),o=at.getColumn(i,2,x2);return T.add(r,s,r),T.add(r,o,r),t.center=T.clone(e.center,t.center),t.radius=T.magnitude(r),t}static distanceSquaredTo(e,t){var i=T.subtract(e.center,t,w2),r=T.magnitude(i)-e.radius;return r<=0?0:r*r}static expand(e,t,i=new Mi){i=Mi.clone(e,i);var r=T.magnitude(T.subtract(t,i.center,S2));return r>i.radius&&(i.radius=r),i}static clone(e,t=new Mi){return t.center=T.clone(e.center,t.center),t.radius=e.radius,t}}const z_=new Float32Array(1),Pn=new Uint8Array(z_.buffer),E2=new Uint32Array([287454020]),iS=new Uint8Array(E2.buffer)[0]===68,Yo=class Yo extends Gt{constructor(e=0,t=0,i=0,r=0){super(e,t,i,r)}static unpack(e,t=0,i=new Yo){return i.x=e[t++],i.y=e[t++],i.z=e[t++],i.w=e[t],i}static pack(e,t,i=0){return t[i++]=e.x,t[i++]=e.y,t[i++]=e.z,t[i]=e.w,t}static clone(e,t=new Yo){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}static fromElements(e,t,i,r,s=new Yo){return s.x=e,s.y=t,s.z=i,s.w=r,s}static unpackFloat(e){return iS?(Pn[0]=e.x,Pn[1]=e.y,Pn[2]=e.z,Pn[3]=e.w):(Pn[0]=e.w,Pn[1]=e.z,Pn[2]=e.y,Pn[3]=e.x),z_[0]}static equals(e,t){return e.equals(t)}static packFloat(e,t=new Yo){return z_[0]=e,iS?(t.x=Pn[0],t.y=Pn[1],t.z=Pn[2],t.w=Pn[3]):(t.x=Pn[3],t.y=Pn[2],t.z=Pn[1],t.w=Pn[0]),t}static multiplyByScalar(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i.w=e.w*t,i}static divideByScalar(e,t,i){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i.w=e.w/t,i}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}};f(Yo,"UNIT_W",Object.freeze(new Yo(0,0,0,1)));let nt=Yo;const T2=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,A2=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,M2=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,C2=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;let nS=new ArrayBuffer(4),rS=new Uint32Array(nS),go=new Uint8Array(nS);function H_(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t*6<1?n+(e-n)*6*t:t*2<1?e:t*3<2?n+(e-n)*(2/3-t)*6:n}const X=class X extends nt{constructor(e=1,t=1,i=1,r=1){super(e,t,i,r)}get red(){return this.x}set red(e){this.x=e}get green(){return this.y}set green(e){this.y=e}get blue(){return this.z}set blue(e){this.z=e}get alpha(){return this.w}set alpha(e){this.w=e}static byteToFloat(e){return e/255}static floatToByte(e){return e===1?255:e*256|0}static clone(e,t=new X){return t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t}static fromCssColorString(e,t=new X){e=e.replace(/\s/g,"");const i=X[e.toUpperCase()];if(O(i))return X.clone(i,t),t;let r=T2.exec(e);return r!==null?(t.red=parseInt(r[1],16)/15,t.green=parseInt(r[2],16)/15,t.blue=parseInt(r[3],16)/15,t.alpha=parseInt(ye(r[4],"f"),16)/15,t):(r=A2.exec(e),r!==null?(t.red=parseInt(r[1],16)/255,t.green=parseInt(r[2],16)/255,t.blue=parseInt(r[3],16)/255,t.alpha=parseInt(ye(r[4],"ff"),16)/255,t):(r=M2.exec(e),r!==null?(t.red=parseFloat(r[1])/(r[1].substr(-1)==="%"?100:255),t.green=parseFloat(r[2])/(r[2].substr(-1)==="%"?100:255),t.blue=parseFloat(r[3])/(r[3].substr(-1)==="%"?100:255),t.alpha=parseFloat(ye(r[4],"1.0")),t):(r=C2.exec(e),r!==null?X.fromHsl(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,parseFloat(ye(r[4],"1.0")),t):(t=void 0,t))))}static fromAlpha(e,t,i=new X(e.red,e.green,e.blue,t)){return i.red=e.red,i.green=e.green,i.blue=e.blue,i.alpha=t,i}toCssColorString(){const e=X.floatToByte(this.red),t=X.floatToByte(this.green),i=X.floatToByte(this.blue);return this.alpha===1?`rgb(${e},${t},${i})`:`rgba(${e},${t},${i},${this.alpha})`}static fromBytes(e=255,t=255,i=255,r=255,s=new X){return e=X.byteToFloat(e),t=X.byteToFloat(t),i=X.byteToFloat(i),r=X.byteToFloat(r),s.red=e,s.green=t,s.blue=i,s.alpha=r,s}static fromHsl(e=0,t=0,i=0,r=1,s=new X){e=ye(e,0)%1,t=ye(t,0),i=ye(i,0),r=ye(r,1);let o=i,a=i,l=i;if(t!==0){let c;i<.5?c=i*(1+t):c=i+t-i*t;const u=2*i-c;o=H_(u,c,e+1/3),a=H_(u,c,e),l=H_(u,c,e-1/3)}return O(s)?(s.red=o,s.green=a,s.blue=l,s.alpha=r,s):new X(o,a,l,r)}static fromRgba(e,t=new X){return rS[0]=e,X.fromBytes(go[0],go[1],go[2],go[3],t)}fromRgbaArray(e){this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3]}toRgba(){return go[0]=X.floatToByte(this.red),go[1]=X.floatToByte(this.green),go[2]=X.floatToByte(this.blue),go[3]=X.floatToByte(this.alpha),rS[0]}toBytes(e=[]){const t=X.floatToByte(this.red),i=X.floatToByte(this.green),r=X.floatToByte(this.blue),s=X.floatToByte(this.alpha);return e?(e[0]=t,e[1]=i,e[2]=r,e[3]=s,e):[t,i,r,s]}static fromRandom(e={},t=new X){let i=e.red;if(!O(i)){const a=ye(e.minimumRed,0),l=ye(e.maximumRed,1);i=a+Ne.nextRandomNumber()*(l-a)}let r=e.green;if(!O(r)){const a=ye(e.minimumGreen,0),l=ye(e.maximumGreen,1);r=a+Ne.nextRandomNumber()*(l-a)}let s=e.blue;if(!O(s)){const a=ye(e.minimumBlue,0),l=ye(e.maximumBlue,1);s=a+Ne.nextRandomNumber()*(l-a)}let o=e.alpha;if(!O(o)){const a=ye(e.minimumAlpha,0),l=ye(e.maximumAlpha,1);o=a+Ne.nextRandomNumber()*(l-a)}return t.red=i,t.green=r,t.blue=s,t.alpha=o,t}brighten(e,t){return e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t}darken(e,t){return e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t}withAlpha(e,t){return X.fromAlpha(this,e,t)}toCssHexString(){var e=X.floatToByte(this.red).toString(16);e.length<2&&(e="0"+e);var t=X.floatToByte(this.green).toString(16);t.length<2&&(t="0"+t);var i=X.floatToByte(this.blue).toString(16);if(i.length<2&&(i="0"+i),this.alpha<1){var r=X.floatToByte(this.alpha).toString(16);return r.length<2&&(r="0"+r),"#"+e+t+i+r}return"#"+e+t+i}};f(X,"packedLength",4),f(X,"RED",Object.freeze(X.fromCssColorString("#FF0000"))),f(X,"WHITE",Object.freeze(X.fromCssColorString("#FFFFFF"))),f(X,"YELLOW",Object.freeze(X.fromCssColorString("#FFFF00"))),f(X,"BLACK",Object.freeze(X.fromCssColorString("#000000"))),f(X,"TRANSPARENT",Object.freeze(new X(0,0,0,0))),f(X,"ALICEBLUE",Object.freeze(X.fromCssColorString("#F0F8FF"))),f(X,"ANTIQUEWHITE",Object.freeze(X.fromCssColorString("#FAEBD7"))),f(X,"AQUA",Object.freeze(X.fromCssColorString("#00FFFF"))),f(X,"AQUAMARINE",Object.freeze(X.fromCssColorString("#7FFFD4"))),f(X,"AZURE",Object.freeze(X.fromCssColorString("#F0FFFF"))),f(X,"BEIGE",Object.freeze(X.fromCssColorString("#F5F5DC"))),f(X,"BISQUE",Object.freeze(X.fromCssColorString("#FFE4C4"))),f(X,"BLANCHEDALMOND",Object.freeze(X.fromCssColorString("#FFEBCD"))),f(X,"BLUE",Object.freeze(X.fromCssColorString("#0000FF"))),f(X,"BLUEVIOLET",Object.freeze(X.fromCssColorString("#8A2BE2"))),f(X,"BROWN",Object.freeze(X.fromCssColorString("#A52A2A"))),f(X,"BURLYWOOD",Object.freeze(X.fromCssColorString("#DEB887"))),f(X,"CADETBLUE",Object.freeze(X.fromCssColorString("#5F9EA0"))),f(X,"CHARTREUSE",Object.freeze(X.fromCssColorString("#7FFF00"))),f(X,"CHOCOLATE",Object.freeze(X.fromCssColorString("#D2691E"))),f(X,"CORAL",Object.freeze(X.fromCssColorString("#FF7F50"))),f(X,"CORNFLOWERBLUE",Object.freeze(X.fromCssColorString("#6495ED"))),f(X,"CORNSILK",Object.freeze(X.fromCssColorString("#FFF8DC"))),f(X,"CRIMSON",Object.freeze(X.fromCssColorString("#DC143C"))),f(X,"CYAN",Object.freeze(X.fromCssColorString("#00FFFF"))),f(X,"DARKBLUE",Object.freeze(X.fromCssColorString("#00008B"))),f(X,"DARKCYAN",Object.freeze(X.fromCssColorString("#008B8B"))),f(X,"DARKGOLDENROD",Object.freeze(X.fromCssColorString("#B8860B"))),f(X,"DARKGRAY",Object.freeze(X.fromCssColorString("#A9A9A9"))),f(X,"DARKGREEN",Object.freeze(X.fromCssColorString("#006400"))),f(X,"DARKGREY",X.DARKGRAY),f(X,"DARKKHAKI",Object.freeze(X.fromCssColorString("#BDB76B"))),f(X,"DARKMAGENTA",Object.freeze(X.fromCssColorString("#8B008B"))),f(X,"DARKOLIVEGREEN",Object.freeze(X.fromCssColorString("#556B2F"))),f(X,"DARKORANGE",Object.freeze(X.fromCssColorString("#FF8C00"))),f(X,"DARKORCHID",Object.freeze(X.fromCssColorString("#9932CC"))),f(X,"DARKRED",Object.freeze(X.fromCssColorString("#8B0000"))),f(X,"DARKSALMON",Object.freeze(X.fromCssColorString("#E9967A"))),f(X,"DARKSEAGREEN",Object.freeze(X.fromCssColorString("#8FBC8F"))),f(X,"DARKSLATEBLUE",Object.freeze(X.fromCssColorString("#483D8B"))),f(X,"DARKSLATEGRAY",Object.freeze(X.fromCssColorString("#2F4F4F"))),f(X,"DARKSLATEGREY",X.DARKSLATEGRAY),f(X,"DARKTURQUOISE",Object.freeze(X.fromCssColorString("#00CED1"))),f(X,"DARKVIOLET",Object.freeze(X.fromCssColorString("#9400D3"))),f(X,"DEEPPINK",Object.freeze(X.fromCssColorString("#FF1493"))),f(X,"DEEPSKYBLUE",Object.freeze(X.fromCssColorString("#00BFFF"))),f(X,"DIMGRAY",Object.freeze(X.fromCssColorString("#696969"))),f(X,"DIMGREY",X.DIMGRAY),f(X,"DODGERBLUE",Object.freeze(X.fromCssColorString("#1E90FF"))),f(X,"FIREBRICK",Object.freeze(X.fromCssColorString("#B22222"))),f(X,"FLORALWHITE",Object.freeze(X.fromCssColorString("#FFFAF0"))),f(X,"FORESTGREEN",Object.freeze(X.fromCssColorString("#228B22"))),f(X,"FUCHSIA",Object.freeze(X.fromCssColorString("#FF00FF"))),f(X,"GAINSBORO",Object.freeze(X.fromCssColorString("#DCDCDC"))),f(X,"GHOSTWHITE",Object.freeze(X.fromCssColorString("#F8F8FF"))),f(X,"GOLD",Object.freeze(X.fromCssColorString("#FFD700"))),f(X,"GOLDENROD",Object.freeze(X.fromCssColorString("#DAA520"))),f(X,"GRAY",Object.freeze(X.fromCssColorString("#808080"))),f(X,"GREEN",Object.freeze(X.fromCssColorString("#008000"))),f(X,"GREENYELLOW",Object.freeze(X.fromCssColorString("#ADFF2F"))),f(X,"GREY",X.GRAY),f(X,"HONEYDEW",Object.freeze(X.fromCssColorString("#F0FFF0"))),f(X,"HOTPINK",Object.freeze(X.fromCssColorString("#FF69B4"))),f(X,"INDIANRED",Object.freeze(X.fromCssColorString("#CD5C5C"))),f(X,"INDIGO",Object.freeze(X.fromCssColorString("#4B0082"))),f(X,"IVORY",Object.freeze(X.fromCssColorString("#FFFFF0"))),f(X,"KHAKI",Object.freeze(X.fromCssColorString("#F0E68C"))),f(X,"LAVENDER",Object.freeze(X.fromCssColorString("#E6E6FA"))),f(X,"LAVENDAR_BLUSH",Object.freeze(X.fromCssColorString("#FFF0F5"))),f(X,"LAWNGREEN",Object.freeze(X.fromCssColorString("#7CFC00"))),f(X,"LEMONCHIFFON",Object.freeze(X.fromCssColorString("#FFFACD"))),f(X,"LIGHTBLUE",Object.freeze(X.fromCssColorString("#ADD8E6"))),f(X,"LIGHTCORAL",Object.freeze(X.fromCssColorString("#F08080"))),f(X,"LIGHTCYAN",Object.freeze(X.fromCssColorString("#E0FFFF"))),f(X,"LIGHTGOLDENRODYELLOW",Object.freeze(X.fromCssColorString("#FAFAD2"))),f(X,"LIGHTGRAY",Object.freeze(X.fromCssColorString("#D3D3D3"))),f(X,"LIGHTGREEN",Object.freeze(X.fromCssColorString("#90EE90"))),f(X,"LIGHTGREY",X.LIGHTGRAY),f(X,"LIGHTPINK",Object.freeze(X.fromCssColorString("#FFB6C1"))),f(X,"LIGHTSEAGREEN",Object.freeze(X.fromCssColorString("#20B2AA"))),f(X,"LIGHTSKYBLUE",Object.freeze(X.fromCssColorString("#87CEFA"))),f(X,"LIGHTSLATEGRAY",Object.freeze(X.fromCssColorString("#778899"))),f(X,"LIGHTSLATEGREY",X.LIGHTSLATEGRAY),f(X,"LIGHTSTEELBLUE",Object.freeze(X.fromCssColorString("#B0C4DE"))),f(X,"LIGHTYELLOW",Object.freeze(X.fromCssColorString("#FFFFE0"))),f(X,"LIME",Object.freeze(X.fromCssColorString("#00FF00"))),f(X,"LIMEGREEN",Object.freeze(X.fromCssColorString("#32CD32"))),f(X,"LINEN",Object.freeze(X.fromCssColorString("#FAF0E6"))),f(X,"MAGENTA",Object.freeze(X.fromCssColorString("#FF00FF"))),f(X,"MAROON",Object.freeze(X.fromCssColorString("#800000"))),f(X,"MEDIUMAQUAMARINE",Object.freeze(X.fromCssColorString("#66CDAA"))),f(X,"MEDIUMBLUE",Object.freeze(X.fromCssColorString("#0000CD"))),f(X,"MEDIUMORCHID",Object.freeze(X.fromCssColorString("#BA55D3"))),f(X,"MEDIUMPURPLE",Object.freeze(X.fromCssColorString("#9370DB"))),f(X,"MEDIUMSEAGREEN",Object.freeze(X.fromCssColorString("#3CB371"))),f(X,"MEDIUMSLATEBLUE",Object.freeze(X.fromCssColorString("#7B68EE"))),f(X,"MEDIUMSPRINGGREEN",Object.freeze(X.fromCssColorString("#00FA9A"))),f(X,"MEDIUMTURQUOISE",Object.freeze(X.fromCssColorString("#48D1CC"))),f(X,"MEDIUMVIOLETRED",Object.freeze(X.fromCssColorString("#C71585"))),f(X,"MIDNIGHTBLUE",Object.freeze(X.fromCssColorString("#191970"))),f(X,"MINTCREAM",Object.freeze(X.fromCssColorString("#F5FFFA"))),f(X,"MISTYROSE",Object.freeze(X.fromCssColorString("#FFE4E1"))),f(X,"MOCCASIN",Object.freeze(X.fromCssColorString("#FFE4B5"))),f(X,"NAVAJOWHITE",Object.freeze(X.fromCssColorString("#FFDEAD"))),f(X,"NAVY",Object.freeze(X.fromCssColorString("#000080"))),f(X,"OLDLACE",Object.freeze(X.fromCssColorString("#FDF5E6"))),f(X,"OLIVE",Object.freeze(X.fromCssColorString("#808000"))),f(X,"OLIVEDRAB",Object.freeze(X.fromCssColorString("#6B8E23"))),f(X,"ORANGE",Object.freeze(X.fromCssColorString("#FFA500"))),f(X,"ORANGERED",Object.freeze(X.fromCssColorString("#FF4500"))),f(X,"ORCHID",Object.freeze(X.fromCssColorString("#DA70D6"))),f(X,"PALEGOLDENROD",Object.freeze(X.fromCssColorString("#EEE8AA"))),f(X,"PALEGREEN",Object.freeze(X.fromCssColorString("#98FB98"))),f(X,"PALETURQUOISE",Object.freeze(X.fromCssColorString("#AFEEEE"))),f(X,"PALEVIOLETRED",Object.freeze(X.fromCssColorString("#DB7093"))),f(X,"PAPAYAWHIP",Object.freeze(X.fromCssColorString("#FFEFD5"))),f(X,"PEACHPUFF",Object.freeze(X.fromCssColorString("#FFDAB9"))),f(X,"PERU",Object.freeze(X.fromCssColorString("#CD853F"))),f(X,"PINK",Object.freeze(X.fromCssColorString("#FFC0CB"))),f(X,"PLUM",Object.freeze(X.fromCssColorString("#DDA0DD"))),f(X,"POWDERBLUE",Object.freeze(X.fromCssColorString("#B0E0E6"))),f(X,"PURPLE",Object.freeze(X.fromCssColorString("#800080"))),f(X,"ROSYBROWN",Object.freeze(X.fromCssColorString("#BC8F8F"))),f(X,"ROYALBLUE",Object.freeze(X.fromCssColorString("#4169E1"))),f(X,"SADDLEBROWN",Object.freeze(X.fromCssColorString("#8B4513"))),f(X,"SALMON",Object.freeze(X.fromCssColorString("#FA8072"))),f(X,"SANDYBROWN",Object.freeze(X.fromCssColorString("#F4A460"))),f(X,"SEAGREEN",Object.freeze(X.fromCssColorString("#2E8B57"))),f(X,"SEASHELL",Object.freeze(X.fromCssColorString("#FFF5EE"))),f(X,"SIENNA",Object.freeze(X.fromCssColorString("#A0522D"))),f(X,"SILVER",Object.freeze(X.fromCssColorString("#C0C0C0"))),f(X,"SKYBLUE",Object.freeze(X.fromCssColorString("#87CEEB"))),f(X,"SLATEBLUE",Object.freeze(X.fromCssColorString("#6A5ACD"))),f(X,"SLATEGRAY",Object.freeze(X.fromCssColorString("#708090"))),f(X,"SLATEGREY",X.SLATEGRAY),f(X,"SNOW",Object.freeze(X.fromCssColorString("#FFFAFA"))),f(X,"SPRINGGREEN",Object.freeze(X.fromCssColorString("#00FF7F"))),f(X,"STEELBLUE",Object.freeze(X.fromCssColorString("#4682B4"))),f(X,"TAN",Object.freeze(X.fromCssColorString("#D2B48C"))),f(X,"TEAL",Object.freeze(X.fromCssColorString("#008080"))),f(X,"THISTLE",Object.freeze(X.fromCssColorString("#D8BFD8"))),f(X,"TOMATO",Object.freeze(X.fromCssColorString("#FF6347"))),f(X,"TURQUOISE",Object.freeze(X.fromCssColorString("#40E0D0"))),f(X,"VIOLET",Object.freeze(X.fromCssColorString("#EE82EE"))),f(X,"WHEAT",Object.freeze(X.fromCssColorString("#F5DEB3"))),f(X,"WHITESMOKE",Object.freeze(X.fromCssColorString("#F5F5F5"))),f(X,"YELLOWGREEN",Object.freeze(X.fromCssColorString("#9ACD32")));let We=X;var qt=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-qt.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?qt.Bounce.In(n*2)*.5:qt.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Dh=function(){return performance.now()},I2=function(){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var r=0,s=t;r<s.length;r++){var o=s[r];(e=o._group)===null||e===void 0||e.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},n.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0,r=e;i<r.length;i++){var s=r[i];s._group=void 0,delete this._tweens[s.getId()],delete this._tweensAddedDuringUpdate[s.getId()]}},n.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},n.prototype.update=function(e,t){e===void 0&&(e=Dh()),t===void 0&&(t=!0);var i=Object.keys(this._tweens);if(i.length!==0)for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var s=this._tweens[i[r]],o=!t;s&&s.update(e,o)===!1&&!t&&this.remove(s)}i=Object.keys(this._tweensAddedDuringUpdate)}},n}(),Vl={Linear:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=Vl.Utils.Linear;return e<0?s(n[0],n[1],i):e>1?s(n[t],n[t-1],t-i):s(n[r],n[r+1>t?t:r+1],i-r)},Bezier:function(n,e){for(var t=0,i=n.length-1,r=Math.pow,s=Vl.Utils.Bernstein,o=0;o<=i;o++)t+=r(1-e,i-o)*r(e,o)*n[o]*s(i,o);return t},CatmullRom:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=Vl.Utils.CatmullRom;return n[0]===n[t]?(e<0&&(r=Math.floor(i=t*(1+e))),s(n[(r-1+t)%t],n[r],n[(r+1)%t],n[(r+2)%t],i-r)):e<0?n[0]-(s(n[0],n[0],n[1],n[1],-i)-n[0]):e>1?n[t]-(s(n[t],n[t],n[t-1],n[t-1],i-t)-n[t]):s(n[r?r-1:0],n[r],n[t<r+1?t:r+1],n[t<r+2?t:r+2],i-r)},Utils:{Linear:function(n,e,t){return(e-n)*t+n},Bernstein:function(n,e){var t=Vl.Utils.Factorial;return t(n)/t(e)/t(n-e)},Factorial:function(){var n=[1];return function(e){var t=1;if(n[e])return n[e];for(var i=e;i>1;i--)t*=i;return n[e]=t,t}}(),CatmullRom:function(n,e,t,i,r){var s=(t-n)*.5,o=(i-e)*.5,a=r*r,l=r*a;return(2*e-2*t+s+o)*l+(-3*e+3*t-2*s-o)*a+s*r+e}}},P2=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),G_=new I2,R2=function(){function n(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=qt.Linear.None,this._interpolationFunction=Vl.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=P2.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=G_,G_.add(this))}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=Dh()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,i,r,s){for(var o in i){var a=e[o],l=Array.isArray(a),c=l?"array":typeof a,u=!l&&Array.isArray(i[o]);if(!(c==="undefined"||c==="function")){if(u){var d=i[o];if(d.length===0)continue;for(var p=[a],g=0,_=d.length;g<_;g+=1){var x=this._handleRelativeValue(a,d[g]);if(isNaN(x)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}p.push(x)}u&&(i[o]=p)}if((c==="object"||l)&&a&&!u){t[o]=l?[]:{};var b=a;for(var y in b)t[o][y]=b[y];r[o]=l?[]:{};var d=i[o];if(!this._isDynamic){var M={};for(var y in d)M[y]=d[y];i[o]=d=M}this._setupProperties(b,t[o],d,r[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=a),l||(t[o]*=1),u?r[o]=i[o].slice().reverse():r[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},n.prototype.pause=function(e){return e===void 0&&(e=Dh()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},n.prototype.resume=function(e){return e===void 0&&(e=Dh()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},n.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=qt.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=Vl.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var i=this,r;if(e===void 0&&(e=Dh()),t===void 0&&(t=n.autoStartOnUpdate),this._isPaused)return!0;var s;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,a=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),l=this._duration+this._repeat*a,c=function(){if(i._duration===0||o>l)return 1;var x=Math.trunc(o/a),b=o-x*a,y=Math.min(b/i._duration,1);return y===0&&o===i._duration?1:y},u=c(),d=this._easingFunction(u);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,d),this._onUpdateCallback&&this._onUpdateCallback(this._object,u),this._duration===0||o>=this._duration)if(this._repeat>0){var p=Math.min(Math.trunc((o-this._duration)/a)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=p);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*p,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var g=0,_=this._chainedTweens.length;g<_;g++)this._chainedTweens[g].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,i,r){for(var s in i)if(t[s]!==void 0){var o=t[s]||0,a=i[s],l=Array.isArray(e[s]),c=Array.isArray(a),u=!l&&c;u?e[s]=this._interpolationFunction(a,r):typeof a=="object"&&a?this._updateProperties(e[s],o,a,r):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*r))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n.autoStartOnUpdate=!1,n}(),rs=G_;rs.getAll.bind(rs),rs.removeAll.bind(rs),rs.add.bind(rs),rs.remove.bind(rs),rs.update.bind(rs);const Qd={LINEAR_NONE:qt.Linear.None,QUADRATIC_IN:qt.Quadratic.In,QUADRATIC_OUT:qt.Quadratic.Out,QUADRATIC_IN_OUT:qt.Quadratic.InOut,CUBIC_IN:qt.Cubic.In,CUBIC_OUT:qt.Cubic.Out,CUBIC_IN_OUT:qt.Cubic.InOut,QUARTIC_IN:qt.Quartic.In,QUARTIC_OUT:qt.Quartic.Out,QUARTIC_IN_OUT:qt.Quartic.InOut,QUINTIC_IN:qt.Quintic.In,QUINTIC_OUT:qt.Quintic.Out,QUINTIC_IN_OUT:qt.Quintic.InOut,SINUSOIDAL_IN:qt.Sinusoidal.In,SINUSOIDAL_OUT:qt.Sinusoidal.Out,SINUSOIDAL_IN_OUT:qt.Sinusoidal.InOut,EXPONENTIAL_IN:qt.Exponential.In,EXPONENTIAL_OUT:qt.Exponential.Out,EXPONENTIAL_IN_OUT:qt.Exponential.InOut,CIRCULAR_IN:qt.Circular.In,CIRCULAR_OUT:qt.Circular.Out,CIRCULAR_IN_OUT:qt.Circular.InOut,ELASTIC_IN:qt.Elastic.In,ELASTIC_OUT:qt.Elastic.Out,ELASTIC_IN_OUT:qt.Elastic.InOut,BACK_IN:qt.Back.In,BACK_OUT:qt.Back.Out,BACK_IN_OUT:qt.Back.InOut,BOUNCE_IN:qt.Bounce.In,BOUNCE_OUT:qt.Bounce.Out,BOUNCE_IN_OUT:qt.Bounce.InOut};let Hs={high:0,low:0};const jo=class jo{constructor(){f(this,"high",T.clone(T.ZERO));f(this,"low",T.clone(T.ZERO))}static encode(e,t){O(t)||(t={high:0,low:0});var i;return e>=0?(i=Math.floor(e/65536)*65536,t.high=i,t.low=e-i):(i=Math.floor(-e/65536)*65536,t.high=-i,t.low=e+i),t}static writeElements(e,t,i){jo.fromCartesian(e,V_);var r=V_.high,s=V_.low;t[i]=r.x,t[i+1]=r.y,t[i+2]=r.z,t[i+3]=s.x,t[i+4]=s.y,t[i+5]=s.z}};f(jo,"fromCartesian",function(e,t=new jo){var i=t.high,r=t.low;return jo.encode(e.x,Hs),i.x=Hs.high,r.x=Hs.low,jo.encode(e.y,Hs),i.y=Hs.high,r.y=Hs.low,jo.encode(e.z,Hs),i.z=Hs.high,r.z=Hs.low,t});let $d=jo;var V_=new $d;let Wl;typeof navigator<"u"?Wl=navigator:Wl={};function D2(n){const e=n.split(".");for(let t=0,i=e.length;t<i;++t)e[t]=parseInt(e[t],10);return e}let Rn=function(){if(!Rn.initialized)throw new Ze("You must call FeatureDetection.supportsWebP.initialize and wait for the promise to resolve before calling FeatureDetection.supportsWebP");return Rn._result};Rn._promise=void 0,Rn._result=void 0,Rn.initialize=function(){return O(Rn._promise)||(Rn._promise=new Promise(n=>{const e=new Image;e.onload=function(){Rn._result=e.width>0&&e.height>0,n(Rn._result)},e.onerror=function(){Rn._result=!1,n(Rn._result)},e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"})),Rn._promise},Object.defineProperties(Rn,{initialized:{get:function(){return O(Rn._result)}}});const Xl=[];typeof ArrayBuffer<"u"&&(Xl.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),typeof Uint8ClampedArray<"u"&&Xl.push(Uint8ClampedArray),typeof Uint8ClampedArray<"u"&&Xl.push(Uint8ClampedArray),typeof BigInt64Array<"u"&&Xl.push(BigInt64Array),typeof BigUint64Array<"u"&&Xl.push(BigUint64Array));let L2=()=>typeof ArrayBuffer<"u",O2=function(){return typeof BigInt64Array<"u"},N2=function(){return typeof BigUint64Array<"u"},B2=function(){return typeof BigInt<"u"},F2=()=>typeof Worker<"u",U2=function(){return typeof WebAssembly<"u"};const k2=(()=>Object.freeze(O(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1))(),W_=function(){try{const e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch{return!1}}();let Jd;function z2(){if(!O(Jd)){Jd=!1;const n=/Firefox\/([\.0-9]+)/.exec(Wl.userAgent);n!==null&&(Jd=!0,D2(n[1]))}return Jd}let X_;function H2(){return O(X_)||(X_=!z2()&&typeof PointerEvent<"u"&&(!O(Wl.pointerEnabled)||Wl.pointerEnabled)),X_}const Ot={hardwareConcurrency:ye(Wl.hardwareConcurrency,3),supportsWebP:Rn,typedArrayTypes:Xl,supportsTypedArrays:L2,supportsBigInt64Array:O2,supportsWebWorkers:F2,supportsWebAssembly:U2,supportsBigInt:B2,supportsBigUint64Array:N2,isMobile:k2,devicePixelRatio:1,supportWebgl2:W_,useWebGL2:W_&&!0,useMRT:W_&&!1,supportsPointerEvents:H2};try{Ot.devicePixelRatio=Object.freeze(window.devicePixelRatio)}catch{Ot.devicePixelRatio=1}const Y_=new T,Yl=new T,j_=new T,G2=new T,cn=class cn extends Mt{constructor(){super()}static clone(e,t=new cn){return t.copy(e)}static unpack(e,t=0,i=new cn){return i.elements[0]=e[t++],i.elements[1]=e[t++],i.elements[2]=e[t++],i.elements[3]=e[t++],i.elements[4]=e[t++],i.elements[5]=e[t++],i.elements[6]=e[t++],i.elements[7]=e[t++],i.elements[8]=e[t++],i.elements[9]=e[t++],i.elements[10]=e[t++],i.elements[11]=e[t++],i.elements[12]=e[t++],i.elements[13]=e[t++],i.elements[14]=e[t++],i.elements[15]=e[t],i}static multiply(e,t,i=new cn){var r=e.elements[0],s=e.elements[1],o=e.elements[2],a=e.elements[3],l=e.elements[4],c=e.elements[5],u=e.elements[6],d=e.elements[7],p=e.elements[8],g=e.elements[9],_=e.elements[10],x=e.elements[11],b=e.elements[12],y=e.elements[13],M=e.elements[14],E=e.elements[15],w=t.elements[0],I=t.elements[1],B=t.elements[2],N=t.elements[3],L=t.elements[4],P=t.elements[5],R=t.elements[6],U=t.elements[7],j=t.elements[8],A=t.elements[9],D=t.elements[10],k=t.elements[11],G=t.elements[12],ee=t.elements[13],J=t.elements[14],re=t.elements[15],oe=r*w+l*I+p*B+b*N,me=s*w+c*I+g*B+y*N,Le=o*w+u*I+_*B+M*N,Ge=a*w+d*I+x*B+E*N,pe=r*L+l*P+p*R+b*U,Te=s*L+c*P+g*R+y*U,ke=o*L+u*P+_*R+M*U,De=a*L+d*P+x*R+E*U,Je=r*j+l*A+p*D+b*k,lt=s*j+c*A+g*D+y*k,rt=o*j+u*A+_*D+M*k,_t=a*j+d*A+x*D+E*k,Ee=r*G+l*ee+p*J+b*re,Oe=s*G+c*ee+g*J+y*re,Q=o*G+u*ee+_*J+M*re,Ye=a*G+d*ee+x*J+E*re;return i.elements[0]=oe,i.elements[1]=me,i.elements[2]=Le,i.elements[3]=Ge,i.elements[4]=pe,i.elements[5]=Te,i.elements[6]=ke,i.elements[7]=De,i.elements[8]=Je,i.elements[9]=lt,i.elements[10]=rt,i.elements[11]=_t,i.elements[12]=Ee,i.elements[13]=Oe,i.elements[14]=Q,i.elements[15]=Ye,i}static getMatrix3(e,t){return t.elements[0]=e.elements[0],t.elements[1]=e.elements[1],t.elements[2]=e.elements[2],t.elements[3]=e.elements[4],t.elements[4]=e.elements[5],t.elements[5]=e.elements[6],t.elements[6]=e.elements[8],t.elements[7]=e.elements[9],t.elements[8]=e.elements[10],t}static getScale(e,t){let{elements:i}=e;return t.x=T.magnitude(T.fromElements(i[0],i[1],i[2],Y_)),t.y=T.magnitude(T.fromElements(i[4],i[5],i[6],Y_)),t.z=T.magnitude(T.fromElements(i[8],i[9],i[10],Y_)),t}static equals(e,t){return e===t||O(e)&&O(t)&&e.equals(t)}static multiplyByVector(e,t,i){var r=t.x,s=t.y,o=t.z,a=t.w;let{elements:l}=e;var c=l[0]*r+l[4]*s+l[8]*o+l[12]*a,u=l[1]*r+l[5]*s+l[9]*o+l[13]*a,d=l[2]*r+l[6]*s+l[10]*o+l[14]*a,p=l[3]*r+l[7]*s+l[11]*o+l[15]*a;return i.x=c,i.y=u,i.z=d,i.w=p,i}static computeViewportTransformation(e={x:0,y:0,width:0,height:0},t=0,i=1,r=new cn){var s=ye(e.x,0),o=ye(e.y,0),a=ye(e.width,0),l=ye(e.height,0);t=ye(t,0),i=ye(i,1);var c=a*.5,u=l*.5,d=(i-t)*.5,p=c,g=u,_=d,x=s+c,b=o+u,y=t+d,M=1;let{elements:E}=r;return E[0]=p,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=g,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=_,E[11]=0,E[12]=x,E[13]=b,E[14]=y,E[15]=M,r}static fromRotationTranslation(e,t=T.ZERO,i=new cn){return i.elements[0]=e.elements[0],i.elements[1]=e.elements[1],i.elements[2]=e.elements[2],i.elements[3]=0,i.elements[4]=e.elements[3],i.elements[5]=e.elements[4],i.elements[6]=e.elements[5],i.elements[7]=0,i.elements[8]=e.elements[6],i.elements[9]=e.elements[7],i.elements[10]=e.elements[8],i.elements[11]=0,i.elements[12]=t.x,i.elements[13]=t.y,i.elements[14]=t.z,i.elements[15]=1,i}static multiplyByPointAsVector(e,t,i){var r=t.x,s=t.y,o=t.z;let{elements:a}=e;var l=a[0]*r+a[4]*s+a[8]*o,c=a[1]*r+a[5]*s+a[9]*o,u=a[2]*r+a[6]*s+a[10]*o;return i.x=l,i.y=c,i.z=u,i}static inverseTransformation(e,t){var i=e.elements[0],r=e.elements[1],s=e.elements[2],o=e.elements[4],a=e.elements[5],l=e.elements[6],c=e.elements[8],u=e.elements[9],d=e.elements[10],p=e.elements[12],g=e.elements[13],_=e.elements[14],x=-i*p-r*g-s*_,b=-o*p-a*g-l*_,y=-c*p-u*g-d*_;return t.elements[0]=i,t.elements[1]=o,t.elements[2]=c,t.elements[3]=0,t.elements[4]=r,t.elements[5]=a,t.elements[6]=u,t.elements[7]=0,t.elements[8]=s,t.elements[9]=l,t.elements[10]=d,t.elements[11]=0,t.elements[12]=x,t.elements[13]=b,t.elements[14]=y,t.elements[15]=1,t}static inverse(e,t){return t.copy(e),t.invert()}static computeView(e,t,i,r,s=new cn){return s.elements[0]=r.x,s.elements[1]=i.x,s.elements[2]=-t.x,s.elements[3]=0,s.elements[4]=r.y,s.elements[5]=i.y,s.elements[6]=-t.y,s.elements[7]=0,s.elements[8]=r.z,s.elements[9]=i.z,s.elements[10]=-t.z,s.elements[11]=0,s.elements[12]=-T.dot(r,e),s.elements[13]=-T.dot(i,e),s.elements[14]=T.dot(t,e),s.elements[15]=1,s}static lookAtMatrix(e,t,i,r=new cn){T.subtract(e,t,Yl),T.normalize(Yl,Yl),T.cross(i,Yl,j_);let s=T.cross(j_,Yl,new T);return cn.computeView(e,Yl,s,j_,r)}static transformToThreeMatrix4(e,t){if(O(e))return cn.toArray(e,t.elements),t}static toArray(e,t){return O(t)?(t[0]=e.elements[0],t[1]=e.elements[1],t[2]=e.elements[2],t[3]=e.elements[3],t[4]=e.elements[4],t[5]=e.elements[5],t[6]=e.elements[6],t[7]=e.elements[7],t[8]=e.elements[8],t[9]=e.elements[9],t[10]=e.elements[10],t[11]=e.elements[11],t[12]=e.elements[12],t[13]=e.elements[13],t[14]=e.elements[14],t[15]=e.elements[15],t):[e.elements[0],e.elements[1],e.elements[2],e.elements[3],e.elements[4],e.elements[5],e.elements[6],e.elements[7],e.elements[8],e.elements[9],e.elements[10],e.elements[11],e.elements[12],e.elements[13],e.elements[14],e.elements[15]]}static computePerspectiveOffCenter(e,t,i,r,s,o,a){var l=2*s/(t-e),c=2*s/(r-i),u=(t+e)/(t-e),d=(r+i)/(r-i),p=-(o+s)/(o-s),g=-1,_=-2*o*s/(o-s);return a.elements[0]=l,a.elements[1]=0,a.elements[2]=0,a.elements[3]=0,a.elements[4]=0,a.elements[5]=c,a.elements[6]=0,a.elements[7]=0,a.elements[8]=u,a.elements[9]=d,a.elements[10]=p,a.elements[11]=g,a.elements[12]=0,a.elements[13]=0,a.elements[14]=_,a.elements[15]=0,a}static computeInfinitePerspectiveOffCenter(e,t,i,r,s,o){var a=2*s/(t-e),l=2*s/(r-i),c=(t+e)/(t-e),u=(r+i)/(r-i),d=-1,p=-1,g=-2*s;return o.elements[0]=a,o.elements[1]=0,o.elements[2]=0,o.elements[3]=0,o.elements[4]=0,o.elements[5]=l,o.elements[6]=0,o.elements[7]=0,o.elements[8]=c,o.elements[9]=u,o.elements[10]=d,o.elements[11]=p,o.elements[12]=0,o.elements[13]=0,o.elements[14]=g,o.elements[15]=0,o}static getColumn(e,t,i){var r=t*4,s=e.elements[r],o=e.elements[r+1],a=e.elements[r+2],l=e.elements[r+3];return i.x=s,i.y=o,i.z=a,i.w=l,i}static multiplyByMatrix3(e,t,i){let{elements:r}=e;var s=r[0],o=r[1],a=r[2],l=r[4],c=r[5],u=r[6],d=r[8],p=r[9],g=r[10];let{elements:_}=t;var x=_[0],b=_[1],y=_[2],M=_[3],E=_[4],w=_[5],I=_[6],B=_[7],N=_[8],L=s*x+l*b+d*y,P=o*x+c*b+p*y,R=a*x+u*b+g*y,U=s*M+l*E+d*w,j=o*M+c*E+p*w,A=a*M+u*E+g*w,D=s*I+l*B+d*N,k=o*I+c*B+p*N,G=a*I+u*B+g*N;return i.elements[0]=L,i.elements[1]=P,i.elements[2]=R,i.elements[3]=0,i.elements[4]=U,i.elements[5]=j,i.elements[6]=A,i.elements[7]=0,i.elements[8]=D,i.elements[9]=k,i.elements[10]=G,i.elements[11]=0,i.elements[12]=e.elements[12],i.elements[13]=e.elements[13],i.elements[14]=e.elements[14],i.elements[15]=e.elements[15],i}static setTranslation(e,t,i){return i.elements[0]=e.elements[0],i.elements[1]=e.elements[1],i.elements[2]=e.elements[2],i.elements[3]=e.elements[3],i.elements[4]=e.elements[4],i.elements[5]=e.elements[5],i.elements[6]=e.elements[6],i.elements[7]=e.elements[7],i.elements[8]=e.elements[8],i.elements[9]=e.elements[9],i.elements[10]=e.elements[10],i.elements[11]=e.elements[11],i.elements[12]=t.x,i.elements[13]=t.y,i.elements[14]=t.z,i.elements[15]=e.elements[15],i}static getTranslation(e,t){return t.x=e.elements[12],t.y=e.elements[13],t.z=e.elements[14],t}static equalsEpsilon(e,t,i=0){return i=ye(i,0),e===t||O(e)&&O(t)&&Math.abs(e.elements[0]-t.elements[0])<=i&&Math.abs(e.elements[1]-t.elements[1])<=i&&Math.abs(e.elements[2]-t.elements[2])<=i&&Math.abs(e.elements[3]-t.elements[3])<=i&&Math.abs(e.elements[4]-t.elements[4])<=i&&Math.abs(e.elements[5]-t.elements[5])<=i&&Math.abs(e.elements[6]-t.elements[6])<=i&&Math.abs(e.elements[7]-t.elements[7])<=i&&Math.abs(e.elements[8]-t.elements[8])<=i&&Math.abs(e.elements[9]-t.elements[9])<=i&&Math.abs(e.elements[10]-t.elements[10])<=i&&Math.abs(e.elements[11]-t.elements[11])<=i&&Math.abs(e.elements[12]-t.elements[12])<=i&&Math.abs(e.elements[13]-t.elements[13])<=i&&Math.abs(e.elements[14]-t.elements[14])<=i&&Math.abs(e.elements[15]-t.elements[15])<=i}static fromTranslation(e,t){return cn.fromRotationTranslation(at.IDENTITY,e,t)}static multiplyByTranslation(e,t,i){var r=t.x,s=t.y,o=t.z,a=r*e.elements[0]+s*e.elements[4]+o*e.elements[8]+e.elements[12],l=r*e.elements[1]+s*e.elements[5]+o*e.elements[9]+e.elements[13],c=r*e.elements[2]+s*e.elements[6]+o*e.elements[10]+e.elements[14];return i.elements[0]=e.elements[0],i.elements[1]=e.elements[1],i.elements[2]=e.elements[2],i.elements[3]=e.elements[3],i.elements[4]=e.elements[4],i.elements[5]=e.elements[5],i.elements[6]=e.elements[6],i.elements[7]=e.elements[7],i.elements[8]=e.elements[8],i.elements[9]=e.elements[9],i.elements[10]=e.elements[10],i.elements[11]=e.elements[11],i.elements[12]=a,i.elements[13]=l,i.elements[14]=c,i.elements[15]=e.elements[15],i}static multiplyByScale(e,t,i){const r=t.x,s=t.y,o=t.z;return r===1&&s===1&&o===1?cn.clone(e,i):(i.elements[0]=r*e.elements[0],i.elements[1]=r*e.elements[1],i.elements[2]=r*e.elements[2],i.elements[3]=e.elements[3],i.elements[4]=s*e.elements[4],i.elements[5]=s*e.elements[5],i.elements[6]=s*e.elements[6],i.elements[7]=e.elements[7],i.elements[8]=o*e.elements[8],i.elements[9]=o*e.elements[9],i.elements[10]=o*e.elements[10],i.elements[11]=e.elements[11],i.elements[12]=e.elements[12],i.elements[13]=e.elements[13],i.elements[14]=e.elements[14],i.elements[15]=e.elements[15],i)}static setScale(e,t,i){const r=cn.getScale(e,G2),s=t.x/r.x,o=t.y/r.y,a=t.z/r.z;return i.elements[0]=e.elements[0]*s,i.elements[1]=e.elements[1]*s,i.elements[2]=e.elements[2]*s,i.elements[3]=e.elements[3],i.elements[4]=e.elements[4]*o,i.elements[5]=e.elements[5]*o,i.elements[6]=e.elements[6]*o,i.elements[7]=e.elements[7],i.elements[8]=e.elements[8]*a,i.elements[9]=e.elements[9]*a,i.elements[10]=e.elements[10]*a,i.elements[11]=e.elements[11],i.elements[12]=e.elements[12],i.elements[13]=e.elements[13],i.elements[14]=e.elements[14],i.elements[15]=e.elements[15],i}};f(cn,"packedLength",16),f(cn,"IDENTITY",Object.freeze(new cn().identity())),f(cn,"multiplyByPoint",function(e,t,i){var r=t.x,s=t.y,o=t.z;let a=e.elements;var l=a[0]*r+a[4]*s+a[8]*o+a[12],c=a[1]*r+a[5]*s+a[9]*o+a[13],u=a[2]*r+a[6]*s+a[10]*o+a[14];return i.x=l,i.y=c,i.z=u,i});let fe=cn;const yn=class yn extends xe{constructor(e=0,t=0){super(e,t)}static clone(e,t=new yn){return t.x=e.x,t.y=e.y,t}static equals(e,t){return e.equals(t)}distanceToSq(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}project(e){const t=e.lengthSq(),i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}toString(){return"("+this.x+", "+this.y+")"}static equalsEpsilon(e,t,i=0,r=i){return e===t||O(e)&&O(t)&&Ne.equalsEpsilon(e.x,t.x,i,r)&&Ne.equalsEpsilon(e.y,t.y,i,r)}static multiplyByScalar(e,t,i){return i.x=e.x*t,i.y=e.y*t,i}static add(e,t,i){return i.x=e.x+t.x,i.y=e.y+t.y,i}static lerp(e,t,i,r){return yn.multiplyByScalar(t,i,sS),r=yn.multiplyByScalar(e,1-i,r),yn.add(sS,r,r)}static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){return Math.sqrt(yn.magnitudeSquared(e))}static normalize(e,t){var i=yn.magnitude(e);if(t.x=e.x/i,t.y=e.y/i,isNaN(t.x)||isNaN(t.y))throw new Ze("normalized result is not a number");return t}static subtract(e,t,i){return i.x=e.x-t.x,i.y=e.y-t.y,i}static distance(e,t){return yn.subtract(e,t,oS),yn.magnitude(oS)}static unpack(e,t=0,i=new yn){return i.x=e[t++],i.y=e[t],i}};f(yn,"fromVector4",yn.clone),f(yn,"ZERO",Object.freeze(new yn(0,0))),f(yn,"fromCartesian3",yn.clone);let he=yn;const sS=new he,oS=new he;function V2(n,e){return e-n}class Vn{constructor(){f(this,"_listeners",[]);f(this,"_scopes",[]);f(this,"_toRemove",[]);f(this,"_insideRaiseEvent",!1)}get numberOfListeners(){return this._listeners.length-this._toRemove.length}addEventListener(e,t){this._listeners.push(e),this._scopes.push(t);let i=this;return function(){i.removeEventListener(e,t)}}removeEventListener(e,t){let i=this._listeners,r=this._scopes,s=-1;for(let o=0;o<i.length;o++)if(i[o]===e&&r[o]===t){s=o;break}return s!==-1?(this._insideRaiseEvent?(this._toRemove.push(s),i[s]=void 0,r[s]=void 0):(i.splice(s,1),r.splice(s,1)),!0):!1}raiseEvent(...e){this._insideRaiseEvent=!0;let t,i=this._listeners,r=this._scopes,s=i.length;for(t=0;t<s;t++){let a=i[t];O(a)&&i[t].apply(r[t],arguments)}let o=this._toRemove;if(s=o.length,s>0){for(o.sort(V2),t=0;t<s;t++){let a=o[t];i.splice(a,1),r.splice(a,1)}o.length=0}this._insideRaiseEvent=!1}}class jl{constructor(e=0,t=0,i=0){this.heading=e,this.pitch=t,this.range=i}static clone(e,t=new jl){if(O(e))return t.heading=e.heading,t.pitch=e.pitch,t.range=e.range,t}}let Lh=new T;class bi extends Li{constructor(e=0,t=0,i=0,r=0){super(e,t,i,r),this.x=e,this.y=t,this.z=i,this.w=r}static fromAxisAngle(e,t,i){const r=t/2,s=Math.sin(r);Lh=T.normalize(e,Lh);const o=Lh.x*s,a=Lh.y*s,l=Lh.z*s,c=Math.cos(r);return O(i)?(i.x=o,i.y=a,i.z=l,i.w=c,i):new bi(o,a,l,c)}static multiply(e,t,i){const r=e.x,s=e.y,o=e.z,a=e.w,l=t.x,c=t.y,u=t.z,d=t.w,p=a*l+r*d+s*u-o*c,g=a*c-r*u+s*d+o*l,_=a*u+r*c-s*l+o*d,x=a*d-r*l-s*c-o*u;return i.x=p,i.y=g,i.z=_,i.w=x,i}static fromHeadingPitchRoll(e,t){return cS=bi.fromAxisAngle(T.UNIT_X,e.roll,aS),q_=bi.fromAxisAngle(T.UNIT_Y,-e.pitch,t),t=bi.multiply(q_,cS,q_),lS=bi.fromAxisAngle(T.UNIT_Z,-e.heading,aS),bi.multiply(lS,t,t)}}const aS=new bi;let lS=new bi,q_=new bi,cS=new bi;class Tr extends ca{constructor(e=new T(0,0,0),t=new T(0,0,0)){super(e,t),T.equals(t,T.ZERO)||T.normalize(t,t),this.direction=t}static clone(e,t=new Tr){return t.origin=T.clone(e.origin),t.direction=T.clone(e.direction),t}static getPoint(e,t,i=new T){return O(i)||(i=new T),i=T.multiplyByScalar(e.direction,t,i),T.add(e.origin,i,i)}}class Z_{constructor(e=0,t=0,i=0){this.heading=e,this.pitch=t,this.roll=i}static fromQuaternion(e,t=new Z_){var i=2*(e.w*e.y-e.z*e.x),r=1-2*(e.x*e.x+e.y*e.y),s=2*(e.w*e.x+e.y*e.z),o=1-2*(e.y*e.y+e.z*e.z),a=2*(e.w*e.z+e.x*e.y);return t.heading=-Math.atan2(a,o),t.roll=Math.atan2(s,r),t.pitch=-Ne.asinClamped(i),t}}let K_;typeof performance<"u"&&typeof performance.now=="function"&&isFinite(performance.now())?K_=()=>performance.now():K_=()=>Date.now();const _o=K_;var Pt=(n=>(n[n.SCENE2D=0]="SCENE2D",n[n.SCENE3D=1]="SCENE3D",n[n.COLUMBUS_VIEW=2]="COLUMBUS_VIEW",n[n.MORPHING=3]="MORPHING",n))(Pt||{});const hS=new T,uS=new T;new T,new T;function Q_(n,e){return Ne.equalsEpsilon(n,Ne.TWO_PI,Ne.EPSILON11)&&(n=0),e>n+Math.PI?n+=Ne.TWO_PI:e<n-Math.PI&&(n-=Ne.TWO_PI),n}function fS(n,e){return{startObject:{},stopObject:{},duration:0,complete:n,cancel:e}}function W2(n,e,t,i,r){return s=>Ne.lerp(t,i,s)}function X2(n,e,t,i){if(O(i)&&t(.5)>i){var r=t(0),s=t(1),o=t(.5),a=o-r,l=o-s;return function(c){var u=t(c);if(c<=.5){var d=(u-r)/a;return Ne.lerp(n,-Ne.PI_OVER_TWO,d)}var p=(u-s)/l;return Ne.lerp(-Ne.PI_OVER_TWO,e,1-p)}}return function(c){return Ne.lerp(n,e,c)}}function Y2(n,e,t,i,r,s,o){const a=n.camera,l=hS.copy(a.position);Q_(a.rotation.y,i);function c(u){const d=u.time/e;uS.lerpVectors(l,t,d),a.setView({destination:uS,orientation:{heading:0}})}return c}function j2(n,e,t,i,r,s,o,a){var l=n.camera,c=T.clone(l.position,hS),u=l.pitch,d=Q_(l.heading,i),p=Q_(l.roll,s),g=W2(l,t,c.z,t.z),_=X2(u,r,g,a);function x(b){var y=b.time/e;l.setView({orientation:{heading:Ne.lerp(d,i,y),pitch:_(y),roll:Ne.lerp(p,s,y)}}),he.lerp(c,t,y,l.frustum.position),l.position.z=g(y)}return x}function dS(n,e){function t(){n.enableInputs=!0,typeof e=="function"&&e()}return t}const q2={createTween:(n,e)=>{e=ye(e,ye.EMPTY_OBJECT);let t=e.destination;const i=n.mode,r=e.maximumHeight,s=e.flyOverLongitude,o=e.flyOverLongitudeWeight,a=e.pitchAdjustHeight;let l=e.easingFunction;const c=n.camera;e.endTransform;let u=e.duration;O(u)||(u=Math.ceil(c.position.distanceTo(t)/1e6)+2,u=Math.min(u,3));const d=ye(e.heading,0),p=ye(e.pitch,-Ne.PI_OVER_TWO),g=ye(e.roll,0),_=n.screenSpaceCameraController;_.enableInputs=!1;const x=dS(_,e.complete),b=dS(_,e.cancel),y=c.frustum;let M=n.mode===Pt.SCENE2D;if(M=M&&he.equalsEpsilon(c.position,t,Ne.EPSILON6),M=M&&Ne.equalsEpsilon(Math.max(y.right-y.left,y.top-y.bottom),t.z,Ne.EPSILON6),M=M||n.mode!==Pt.SCENE2D&&T.equalsEpsilon(t,c.position,Ne.EPSILON10),M=M&&Ne.equalsEpsilon(Ne.negativePiToPi(d),Ne.negativePiToPi(c.heading),Ne.EPSILON10)&&Ne.equalsEpsilon(Ne.negativePiToPi(p),Ne.negativePiToPi(c.pitch),Ne.EPSILON10)&&Ne.equalsEpsilon(Ne.negativePiToPi(g),Ne.negativePiToPi(c.roll),Ne.EPSILON10),M)return fS(x,b);const E=new Array(4);if(E[Pt.SCENE2D]=Y2,E[Pt.SCENE3D]=j2,u<=0)return fS(function(){E[i](n,1,t,d,p,g,r,s,o,a)({time:1}),typeof x=="function"&&x()},b);const w=E[i](n,u,t,d,p,g,r,s,o,a);if(!O(l)){const I=c.position.z,B=t.z;I>B&&I>11500?l=Qd.CUBIC_OUT:l=Qd.QUINTIC_IN_OUT}return{duration:u,easingFunction:l,startObject:{time:0},stopObject:{time:u},update:w,complete:x,cancel:b}}};new q,new q,new q;class Gs extends Ns{constructor(t={}){let i=t.width,r=t.aspectRatio,s=ye(t.near,.1),o=ye(t.far,5e8);super(1,1,1,1,s,o);f(this,"frustumType",vo.ORTHOGRAPHIC);f(this,"_camera");f(this,"width");f(this,"_width");f(this,"aspectRatio");f(this,"_aspectRatio");f(this,"_near");f(this,"_far");f(this,"cullVolume",new Lt);this.width=i,this.aspectRatio=r}get heading(){return this.rotation.y}get pitch(){return this.rotation.x}get roll(){return this.rotation.z}setCamera(t,i){const{left:r,right:s,top:o,bottom:a,near:l,far:c}=t,{clientWidth:u,clientHeight:d}=i;return r&&s&&o&&a&&(this.zoom=Math.min(u/(s-r),d/(o-a))),this.near=l??1,this.far=c??1e3,this.updateProjectionMatrix(),this}getThresholdBySize(t,i,r,s,o){return r*(this.right-this.left)/this.zoom/s}resize(t,i){this.aspectRatio=t/i,this.width=Nh(this._camera),console.log(this.width),this.update()}computeView(){const{left:t,right:i,top:r,bottom:s,zoom:o,position:a}=this,{x:l,y:c}=a;return[t/o+l,s/o+c,i/o+l,r/o+c]}computeViewRectangle(){let t=this.computeView();this.cullVolume.min.set(t[0],t[1],0),this.cullVolume.max.set(t[2],t[3],0)}update(){if(this.width!==this._width||this.aspectRatio!==this._aspectRatio||this.near!==this._near||this.far!==this._far){this._aspectRatio=this.aspectRatio,this._width=this.width,this._near=this.near,this._far=this.far;const t=1/this.aspectRatio;this.right=this.width*.5,this.left=-this.right,this.top=t*this.right,this.bottom=-this.top,this.near=this._near,this.far=this._far,this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}this.computeViewRectangle()}}class ep{constructor(){f(this,"planes",[])}}f(ep,"MASK_OUTSIDE",4294967295),f(ep,"MASK_INSIDE",0),f(ep,"MASK_INDETERMINATE",2147483647);const Z2=new T,K2=new T,Q2=new T,$2=new T;class ql{constructor(e={}){f(this,"left");f(this,"_left");f(this,"right");f(this,"_right");f(this,"top");f(this,"_top");f(this,"bottom");f(this,"_bottom");f(this,"near");f(this,"_near");f(this,"far");f(this,"_far");f(this,"_cullingVolume");f(this,"_perspectiveMatrix");f(this,"_infinitePerspective");this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=ye(e.near,1),this._near=this.near,this.far=ye(e.far,5e8),this._far=this.far,this._cullingVolume=new ep,this._perspectiveMatrix=new fe,this._infinitePerspective=new fe}get projectionMatrix(){return $_(this),this._perspectiveMatrix}get infiniteProjectionMatrix(){return $_(this),this._infinitePerspective}computeCullingVolume(e,t,i){if(!O(e))throw new Ze("position is required.");if(!O(t))throw new Ze("direction is required.");if(!O(i))throw new Ze("up is required.");const r=this._cullingVolume.planes,s=this.top,o=this.bottom,a=this.right,l=this.left,c=this.near,u=this.far,d=T.cross(t,i,Z2),p=K2;T.multiplyByScalar(t,c,p),T.add(e,p,p);const g=Q2;T.multiplyByScalar(t,u,g),T.add(e,g,g);const _=$2;T.multiplyByScalar(d,l,_),T.add(p,_,_),T.subtract(_,e,_),T.normalize(_,_),T.cross(_,i,_),T.normalize(_,_);let x=r[0];return O(x)||(x=r[0]=new nt),x.x=_.x,x.y=_.y,x.z=_.z,x.w=-T.dot(_,e),T.multiplyByScalar(d,a,_),T.add(p,_,_),T.subtract(_,e,_),T.cross(i,_,_),T.normalize(_,_),x=r[1],O(x)||(x=r[1]=new nt),x.x=_.x,x.y=_.y,x.z=_.z,x.w=-T.dot(_,e),T.multiplyByScalar(i,o,_),T.add(p,_,_),T.subtract(_,e,_),T.cross(d,_,_),T.normalize(_,_),x=r[2],O(x)||(x=r[2]=new nt),x.x=_.x,x.y=_.y,x.z=_.z,x.w=-T.dot(_,e),T.multiplyByScalar(i,s,_),T.add(p,_,_),T.subtract(_,e,_),T.cross(_,d,_),T.normalize(_,_),x=r[3],O(x)||(x=r[3]=new nt),x.x=_.x,x.y=_.y,x.z=_.z,x.w=-T.dot(_,e),x=r[4],O(x)||(x=r[4]=new nt),x.x=t.x,x.y=t.y,x.z=t.z,x.w=-T.dot(t,p),T.negate(t,_),x=r[5],O(x)||(x=r[5]=new nt),x.x=_.x,x.y=_.y,x.z=_.z,x.w=-T.dot(_,g),this._cullingVolume}getPixelDimensions(e,t,i,r,s){if($_(this),!O(e)||!O(t))throw new Ze("Both drawingBufferWidth and drawingBufferHeight are required.");if(e<=0)throw new Ze("drawingBufferWidth must be greater than zero.");if(t<=0)throw new Ze("drawingBufferHeight must be greater than zero.");if(!O(i))throw new Ze("distance is required.");if(!O(r))throw new Ze("pixelRatio is required");if(r<=0)throw new Ze("pixelRatio must be greater than zero.");if(!O(s))throw new Ze("A result object is required.");const o=1/this.near;let a=this.top*o;const l=2*r*i*a/t;a=this.right*o;const c=2*r*i*a/e;return s.x=c,s.y=l,s}clone(e=new ql){return O(e)||(e=new ql),e.right=this.right,e.left=this.left,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e}equals(e){return O(e)&&e instanceof ql&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}equalsEpsilon(e,t,i){return e===this||O(e)&&e instanceof ql&&Ne.equalsEpsilon(this.right,e.right,t,i)&&Ne.equalsEpsilon(this.left,e.left,t,i)&&Ne.equalsEpsilon(this.top,e.top,t,i)&&Ne.equalsEpsilon(this.bottom,e.bottom,t,i)&&Ne.equalsEpsilon(this.near,e.near,t,i)&&Ne.equalsEpsilon(this.far,e.far,t,i)}}function $_(n){if(!O(n.right)||!O(n.left)||!O(n.top)||!O(n.bottom)||!O(n.near)||!O(n.far))throw new Ze("right, left, top, bottom, near, or far parameters are not set.");const e=n.top,t=n.bottom,i=n.right,r=n.left,s=n.near,o=n.far;if(e!==n._top||t!==n._bottom||r!==n._left||i!==n._right||s!==n._near||o!==n._far){if(n.near<=0||n.near>n.far)throw new Ze("near must be greater than zero and less than far.");n._left=r,n._right=i,n._top=e,n._bottom=t,n._near=s,n._far=o,n._perspectiveMatrix=fe.computePerspectiveOffCenter(r,i,t,e,s,o,n._perspectiveMatrix),n._infinitePerspective=fe.computeInfinitePerspectiveOffCenter(r,i,t,e,s,n._infinitePerspective)}}const Oh=new bi;class J_ extends en{constructor(t=45,i,r=3,s=1e10){super(t,i,r,s);f(this,"frustumType",vo.PERSPECTIVE);f(this,"_camera");f(this,"cullVolume",new fa);f(this,"_projScreenMatrix",new fe);f(this,"_offCenterFrustum",new ql);f(this,"_aspectRatio");f(this,"_fov");f(this,"_aspect");f(this,"_near");f(this,"_far");f(this,"_fovy");f(this,"_sseDenominator",0);f(this,"xOffset",0);f(this,"_xOffset",this.xOffset);f(this,"yOffset",0);f(this,"_yOffset",0);this._fov=this.fov,this._aspect=this.aspect,this._near=this.near,this._far=this.far}get fovy(){return J2(this),this._fovy}get heading(){return this.rotation.z}get pitch(){return this.rotation.y}get roll(){return this.rotation.x}get aspectRatio(){return this.aspect}set aspectRatio(t){this.aspect=t}get fovRadius(){return kn.degToRad(this.fov)}get sseDenominator(){return this._sseDenominator}setCamera(t,i){const{fov:r,aspect:s,near:o,far:a}=t;return this.fov=r??this.fov,this.aspect=s??i.clientWidth/i.clientHeight,this.near=o??this.near,this.far=a??this.far,this._camera.updateProjectionMatrix(),this}getThresholdBySize(t,i,r,s,o){const a=new q().fromArray(t),l=new q().fromArray(i),c=a.distanceTo(l)*Math.tan(this.fov/2*Math.PI/180);return 2*r*c/o}applyCesiumQuaternion(t){Oh.x=t.x,Oh.y=t.y,Oh.z=t.z,Oh.w=t.w,this.applyQuaternion(Oh)}resize(t,i){this.aspect=t/i,this.updateProjectionMatrix()}updateProjectionMatrixToOrthographic(){const t=this.position.length(),i=Math.tan(this.fov/180*Math.PI/2)*t,r=i*this.aspectRatio;this.projectionMatrix.makeOrthographic(-r,r,i,-i,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}update(){this._projScreenMatrix.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse),this.cullVolume.setFromProjectionMatrix(this._projScreenMatrix)}}function J2(n){const e=n._offCenterFrustum;(n.fov!==n._fov||n.aspectRatio!==n._aspectRatio||n.near!==n._near||n.far!==n._far)&&(n._aspectRatio=n.aspectRatio,n._fov=n.fov,n._fovy=kn.degToRad(n.fov),n.aspectRatio=n.aspect,n._near=n.near,n._far=n.far,n._sseDenominator=2*Math.tan(.5*n.fovRadius),n._xOffset=n.xOffset,n._yOffset=n.yOffset,e.top=n.near*Math.tan(.5*n._fovy),e.bottom=-e.top,e.right=n.aspectRatio*e.top,e.left=-e.right,e.near=n.near,e.far=n.far,e.right+=n.xOffset,e.left+=n.xOffset,e.top+=n.yOffset,e.bottom+=n.yOffset)}var vo=(n=>(n.PERSPECTIVE="perspective",n.ORTHOGRAPHIC="orthographic",n))(vo||{});const eN=new T(0,0,-1),e0=new zs;let tN=new fe,pS=new T;const iN=new bi,nN=new at,rN=new bi,sN=new at,oN=new T,aN=new T,lN=new T;let cN=new T,hN=new T,uN=new T,fN=new nt,dN=new bi,pN=new at;new fe;const tp=new T;function mS(n,e){let t;return Ne.equalsEpsilon(Math.abs(n.z),1,Ne.EPSILON3)?t=Math.atan2(e.y,e.x)-Ne.PI_OVER_TWO:t=Math.atan2(n.y,n.x)-Ne.PI_OVER_TWO,Ne.TWO_PI-Ne.zeroToTwoPi(t)}function gS(n){return Ne.PI_OVER_TWO-Ne.acosClamped(n.z)}function _S(n,e,t){let i=0;return Ne.equalsEpsilon(Math.abs(n.z),1,Ne.EPSILON3)||(i=Math.atan2(-t.z,e.z),i=Ne.zeroToTwoPi(i+Ne.TWO_PI)),i}const nl=class nl{constructor(e){f(this,"frustum");f(this,"_perspectiveFrustum");f(this,"_orthoFrustum");f(this,"scene");f(this,"_cameraView",{position:[0,0,0],target:[0,0,0],up:[0,0,0]});f(this,"_mode",Pt.SCENE3D);f(this,"_modeChanged",!0);f(this,"_currentFlight");f(this,"_rightDir",new T(1,0,0));f(this,"_position",new T);f(this,"_positionWC",new T);f(this,"direction",new T);f(this,"_direction",new T);f(this,"_directionWC",new T);f(this,"up",new T);f(this,"_up",new T);f(this,"_upWC",new T);f(this,"right",new T);f(this,"_right",new T);f(this,"_rightWC",new T);f(this,"_changedPosition");f(this,"_changedDirection");f(this,"percentageChanged",.001);f(this,"scratchHpr",new Z_);f(this,"scratchBoxSize",new he);f(this,"scratchBox2D",new zs);f(this,"scratchSetViewVector3",new T);f(this,"scratchSetViewCartesian",new T);f(this,"scratchFlyToDestination",new T);f(this,"scratchScreenPosition",new he);f(this,"scratchWorldPosition",new T);f(this,"scratchSetViewOptions",{destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0});f(this,"newOptions",{destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,maximumHeight:void 0,easingFunction:void 0});f(this,"_viewSyncMatrix");f(this,"_scratchBox",new Lt);f(this,"_oldPositionWC");f(this,"positionWCDeltaMagnitude",0);f(this,"positionWCDeltaMagnitudeLastFrame",0);f(this,"timeSinceMoved",0);f(this,"_lastMovedTimestamp",0);f(this,"_transform",fe.clone(fe.IDENTITY));f(this,"_invTransform",fe.clone(fe.IDENTITY));f(this,"_actualTransform",fe.clone(fe.IDENTITY));f(this,"_actualInvTransform",fe.clone(fe.IDENTITY));f(this,"_transformChanged",!1);f(this,"_viewMatrix",new fe);f(this,"_invViewMatrix",new fe);f(this,"defaultMoveAmount",1);f(this,"defaultLookAmount",Math.PI/60);f(this,"defaultRotateAmount",Math.PI/3600);f(this,"defaultZoomAmount",1e5);f(this,"constrainedAxis");f(this,"change",new Vn);f(this,"moveStart",new Vn);f(this,"moveEnd",new Vn);this.scene=e;const{width:t,height:i}=e.drawingBufferSize;this._perspectiveFrustum=new J_(50,t/i),this._perspectiveFrustum._camera=this,this._orthoFrustum=new Gs,this._orthoFrustum.up.set(0,0,1),this._orthoFrustum._camera=this,this.frustum=this._perspectiveFrustum,this._viewMatrix=new fe,this._invViewMatrix=new fe,fe.computeView(this._position,this._direction,this._up,this._right,this._viewMatrix),fe.multiply(this._viewMatrix,this._actualInvTransform,this._viewMatrix),fe.inverseTransformation(this._viewMatrix,this._invViewMatrix),PN(this,nl.DEFAULT_VIEW_DESTINATION,this.position,!0),this.frustum instanceof J_&&(this.frustum.up.set(0,0,1),this.frustum.near=1),ss(this)}get container(){return this.scene.container}get cameraType(){return this.frustum.frustumType}get type(){return this.frustum.frustumType}get aspect(){return this._perspectiveFrustum.aspect}set aspect(e){this._perspectiveFrustum.aspect=e}get far(){return this.frustum.far}set far(e){this.frustum.far=e}get near(){return this.frustum.near}set near(e){this.frustum.near=e}get left(){return this._orthoFrustum.left}set left(e){this._orthoFrustum.left=e}get top(){return this._orthoFrustum.top}set top(e){this._orthoFrustum.top=e}get bottom(){return this._orthoFrustum.bottom}set bottom(e){this._orthoFrustum.bottom=e}get directionWC(){return this._mode===Pt.SCENE2D?eN:(ss(this),this._directionWC)}get box(){return this._orthoFrustum.computeViewRectangle()}get zoom(){return console.warn(".zoom"),this.frustum.zoom}set zoom(e){console.warn(".zoom"),this.frustum.zoom=e}get rotation(){return this.frustum.rotation}set rotation(e){this.frustum.rotation.copy(e)}get matrix(){return this.frustum.matrix}get view(){return this.getView()}get heading(){return mS(this.direction,this.up)}get pitch(){return gS(this.direction)}get roll(){let e=fe.clone(this._transform,tN),t=_S(this.direction,this.up,this.right);return this._setTransform(e),t}get cullVolume(){return this.frustum.cullVolume}get position(){return this.frustum.position}get positionWC(){return ss(this),this.position}get transform(){return this._transform}get upWC(){return ss(this),this._upWC}get rightWC(){return ss(this),this._rightWC}get viewMatrix(){return ss(this),this._viewMatrix}get inverseViewMatrix(){return ss(this),this._invViewMatrix}updateProjectionMatrix(){return this.frustum.updateProjectionMatrix()}lerpProjectionMatrix(e=0){}switchCamera(e){let t=e.type,i=this.container,{width:r,height:s}=this.scene.drawingBufferSize;if(t==="perspective")this.frustum=this._perspectiveFrustum.setCamera(e,i);else{this._orthoFrustum.position.copy(this._perspectiveFrustum.position),this.frustum=this._orthoFrustum,e.near&&(this.frustum.near=e.near),e.far&&(this.frustum.far=e.far);const o=Nh(this);this.frustum.aspectRatio=r/s,this.frustum.width=o,this.frustum.updateProjectionMatrix()}}switchToOrthographicFrustum(){if(!(this.frustum instanceof Gs)){var e=Nh(this),t=this.scene;this.frustum=new Gs,this.frustum.applyMatrix4(this._perspectiveFrustum.matrixWorld),this.frustum._camera=this,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=e}}getMagnitude(){return T.magnitude(this.position)}rotate(e,t){if(!O(e))throw new Ze("axis is required.");const i=ye(t,this.defaultRotateAmount),r=bi.fromAxisAngle(e,-i,iN),s=at.fromQuaternion(r,nN);at.multiplyByVector(s,this.position,this.position),at.multiplyByVector(s,this.direction,this.direction),at.multiplyByVector(s,this.up,this.up),T.cross(this.direction,this.up,this.right),T.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)}rotateUp(e=this.defaultRotateAmount){yS(this,-e)}rotateDown(e=this.defaultRotateAmount){yS(this,e)}rotateRight(e=this.defaultRotateAmount){vS(this,e)}rotateLeft(e=this.defaultRotateAmount){vS(this,-e)}setOrthoCameraView(e,t,i,r){const s=this._orthoFrustum,{left:o,right:a,top:l,bottom:c}=s;s.zoom=Math.min((a-o)/(t-e),(l-c)/(i-r)),s.updateProjectionMatrix()}getOrthoCameraView(){const{left:e,right:t,top:i,bottom:r,zoom:s,position:o}=this._orthoFrustum,{x:a,y:l}=o;return[e/s+a,t/s+a,i/s+l,r/s+l]}setViewOffset(e,t,i,r,s,o){this.frustum.setViewOffset(e,t,i,r,s,o)}clearViewOffset(){this.frustum.clearViewOffset()}getThresholdBySize(e,t,i,r){const{clientWidth:s,clientHeight:o}=r;return this.frustum.getThresholdBySize(e,t,i,s,o)}getView(){let e=this._orthoFrustum.computeView();return this._mode===Pt.SCENE2D?T.fromElements(this.position.x,this.position.y,0,tp):this._mode===Pt.SCENE3D&&(tp.copy(this.position),tp.add(this.direction)),{position:this.position.toArray(),target:tp.toArray(),up:this.up.toArray(),viewRect:[[e[0],e[1]],[e[2],e[3]]]}}resize(e,t){this.frustum.resize(e,t)}cancelFlight(){O(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)}completeFlight(){if(!O(this._currentFlight))return;this._currentFlight.cancelTween();const e={destination:void 0,orientation:{heading:void 0,pitch:void 0,roll:void 0}};e.destination=this.newOptions.destination,e.orientation.heading=this.newOptions.heading,e.orientation.pitch=this.newOptions.pitch,e.orientation.roll=this.newOptions.roll,this.setView(e),O(this._currentFlight.complete)&&this._currentFlight.complete(),this._currentFlight=void 0}update(e){e!==this._mode&&(this._mode=e,this._mode,Pt.SCENE3D)}_updateCameraChanged(){xN(this);let e=this.percentageChanged;if(!O(this._changedDirection)){this._changedPosition=T.clone(this.positionWC,this._changedPosition),this._changedDirection=T.clone(this.directionWC,this._changedDirection);return}var t=Ne.acosClamped(T.dot(this.directionWC,this._changedDirection)),i;O(this.frustum.fovy)?i=t/(this.frustum.fovy*.5):i=t;var r=T.distance(this.positionWC,this._changedPosition),s=r/this.position.z;(i>e||s>e)&&(this.change.raiseEvent(Math.max(i,s)),this._changedPosition=T.clone(this.positionWC,this._changedPosition),this._changedDirection=T.clone(this.directionWC,this._changedDirection)),this.frustum.update()}setView(e){const t=this.scene.mode,{scratchHpr:i}=this;let r=ye(e.orientation,ye.EMPTY_OBJECT),s=ye(e.destination,this.scratchSetViewVector3.copy(this.position));if((s instanceof Rh||s instanceof Vi)&&this.scene.mode===Pt.SCENE2D){if(s.getSize(this.scratchBoxSize),this.scratchBoxSize.x===0&&this.scratchBoxSize.y===0)throw new Ze("");s=this.getRectangleCameraCoordinates(s,this.scratchFlyToDestination)}t===Pt.SCENE2D?(i.heading=ye(r.heading,i.heading),i.pitch=ye(r.pitch,i.pitch),i.roll=ye(r.roll,i.roll),mN(this,s,this.scratchHpr)):t===Pt.SCENE3D&&(O(r.direction)&&(r=i0(r,i)),i.heading=ye(r.heading,this.heading),i.pitch=ye(r.pitch,this.pitch),i.roll=ye(r.roll,this.roll),yN(this,s,i,!1)),this.change.raiseEvent()}setViewSyncMatrix(e){this._viewSyncMatrix||(this._viewSyncMatrix=new fe),this._viewSyncMatrix.fromArray(e)}_updateDestination(e){if(e instanceof Vi||e instanceof T)e.applyMatrix4(this._viewSyncMatrix);else if(e instanceof Rh){const{x:t,y:i}=e.min,{x:r,y:s}=e.max,o=new T(t,i,0),a=new T(r,s,0);o.applyMatrix4(this._viewSyncMatrix),a.applyMatrix4(this._viewSyncMatrix),e.min.x=o.x,e.min.y=o.y,e.max.x=a.x,e.max.y=a.y}}setViewSync(e){this._viewSyncMatrix&&this._updateDestination(e.destination),this.setView(e)}getViewSync(){return{destination:this.position.clone(),orientation:{direction:this.directionWC.clone(),up:this.upWC.clone()}}}look(e,t){if(!O(e))throw new Ze("axis is required.");const i=ye(t,this.defaultLookAmount),r=bi.fromAxisAngle(e,-i,rN),s=at.fromQuaternion(r,sN),o=this.direction,a=this.up,l=this.right;at.multiplyByVector(s,o,o),at.multiplyByVector(s,a,a),at.multiplyByVector(s,l,l)}lookAt(e,t){}lookAtTransform(e,t){this._setTransform(e),O(t)&&(O(t.heading)&&xS(t.heading,t.pitch,t.range),T.negate(this.position,this.direction),T.normalize(this.direction,this.direction),T.cross(this.direction,T.UNIT_Z,this.right),T.magnitudeSquared(this.right)<Ne.EPSILON10&&T.clone(T.UNIT_X,this.right),T.normalize(this.right,this.right),T.cross(this.right,this.direction,this.up),T.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0))}lookLeft(e=this.defaultLookAmount){this._mode!==Pt.SCENE2D&&this.look(this.up,-e)}lookRight(e=this.defaultLookAmount){this._mode!==Pt.SCENE2D&&this.look(this.up,e)}lookUp(e=this.defaultLookAmount){this._mode!==Pt.SCENE2D&&this.look(this.right,-e)}lookDown(e=this.defaultLookAmount){this._mode!==Pt.SCENE2D&&this.look(this.right,e)}_setTransform(e){const t=T.clone(this.positionWC,oN),i=T.clone(this.upWC,aN),r=T.clone(this.directionWC,lN);fe.clone(e,this._transform),this._transformChanged=!0,ss(this);const s=this._actualInvTransform;fe.multiplyByPoint(s,t,this.position),fe.multiplyByPointAsVector(s,r,this.direction),fe.multiplyByPointAsVector(s,i,this.up),T.cross(this.direction,this.up,this.right),ss(this)}getRectangleCameraCoordinates(e,t=new T){if(this.scene.mode===Pt.SCENE2D)return bN(this,e,t)}flyTo(e){let t=e.destination;this.cancelFlight(),t instanceof Rh&&(t=this.getRectangleCameraCoordinates(t,this.scratchFlyToDestination)),t=ye(e.destination,this.position);let r=ye(e.orientation,{heading:this.heading,pitch:this.pitch,roll:this.roll});if(O(r.direction)&&(r=i0(r,this.scratchSetViewOptions.orientation)),O(e.duration)&&e.duration<=0){const c=this.scratchSetViewOptions;c.destination=e.destination,c.orientation.heading=r.heading,c.orientation.pitch=r.pitch,c.orientation.roll=r.roll,c.convert=!1,c.endTransform=e.endTransform,this.setView(c),typeof e.complete=="function"&&e.complete();return}const s=this;let o;this.newOptions.destination=t,this.newOptions.heading=r.heading,this.newOptions.pitch=r.pitch,this.newOptions.roll=r.roll,this.newOptions.duration=e.duration,this.newOptions.complete=()=>{o===s._currentFlight&&(s._currentFlight=void 0),O(e.complete)&&e.complete()},this.newOptions.cancel=e.cancel,this.newOptions.endTransform=e.endTransform,this.newOptions.convert=e.convert,this.newOptions.maximumHeight=e.maximumHeight,this.newOptions.easingFunction=e.easingFunction;const a=this.scene,l=q2.createTween(a,this.newOptions);if(l.duration===0){typeof l.complete=="function"&&l.complete();return}o=a.tweens.add(l),this._currentFlight=o}flyToBoundingBox(e){if(this.scene.mode===Pt.SCENE2D){e0.min.set(e.min.x,e.min.y),e0.max.set(e.max.x,e.max.y),this.flyTo({destination:e0});return}e instanceof zs}flyToBoundingSphere(e,t){t=ye(t,ye.EMPTY_OBJECT);let i=this._mode===Pt.SCENE2D;this._setTransform(fe.IDENTITY);let r=bS(this,e,t.offset),s=xS(r.heading,r.pitch,r.range);const o=new fe().makeTranslation(e.center);fe.multiplyByPoint(o,s,s);let a,l;if(!i){if(a=T.subtract(e.center,s,cN),T.normalize(a,a),l=fe.multiplyByPointAsVector(o,T.UNIT_Z,hN),1-Math.abs(T.dot(a,l))<Ne.EPSILON6){let u=bi.fromAxisAngle(a,r.heading,dN),d=at.fromQuaternion(u,pN);T.fromVector4(fe.getColumn(o,1,fN),l),at.multiplyByVector(d,l,l)}let c=T.cross(a,l,uN);T.cross(c,a,l),T.normalize(l,l)}this.flyTo({destination:s,orientation:{direction:a,up:l},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction})}viewBoundingSphere(e,t){t=bS(this,e,t),this.lookAt(e.center,t)}move(e,t){let i=this.position;T.multiplyByScalar(e,t,pS),T.add(i,pS,i),this._mode,Pt.SCENE2D,this._adjustOrthographicFrustum(!0)}moveForward(e=this.defaultMoveAmount){this._mode===Pt.SCENE3D&&this.move(this.direction,e)}moveBackward(e=this.defaultMoveAmount){this._mode===Pt.SCENE3D&&this.move(this.direction,-e)}twistLeft(e=this.defaultLookAmount){this.look(this.direction,e)}twistRight(e=this.defaultLookAmount){this.look(this.direction,-e)}moveUp(e=this.defaultMoveAmount){this.move(this.up,e)}moveDown(e=this.defaultMoveAmount){this.move(this.up,-e)}moveLeft(e=this.defaultMoveAmount){this.move(this.right,-e)}moveRight(e=this.defaultMoveAmount){this.move(this.right,e)}zoomIn(e=this.defaultZoomAmount){e=ye(e,this.defaultZoomAmount),this._mode===Pt.SCENE2D||RN(this,e)}getPickRay(e=new he,t=new Tr){return this.frustum instanceof J_?AN(this,e,t):MN(this,e,t)}_adjustOrthographicFrustum(e){this.frustum instanceof Gs&&(this.frustum.width=Nh(this))}computeViewRectangle(){if(this.frustum instanceof Gs)return this.frustum.computeViewRectangle()}worldToCameraCoordinates(e,t=new nt){return ss(this),fe.multiplyByVector(this._actualInvTransform,e,t)}getScaleFactor(e){let{frustum:t}=this;return t instanceof Gs?(t.top-t.bottom)/t.zoom:e.distanceTo(this.position)*Math.min(1.9*Math.tan(Math.PI*t.fov/360)/t.zoom,7)}static clone(e,t){return O(t)||(t=new nl(e.scene)),e.type==="perspective"?t.frustum=t._perspectiveFrustum:t.frustum=t._orthoFrustum,t._perspectiveFrustum.copy(e._perspectiveFrustum),t._orthoFrustum.copy(e._orthoFrustum),t._cameraView.target=[...e._cameraView.target],T.clone(e.position,t.position),T.clone(e.direction,t.direction),T.clone(e.up,t.up),T.clone(e.right,t.right),fe.clone(e._transform,t.transform),t._transformChanged=!0,t.frustum=e.frustum.clone(),t}};f(nl,"DEFAULT_VIEW_DESTINATION",new T(0,-100,100)),f(nl,"DEFAULT_VIEW_FACTOR",.5),f(nl,"DEFAULT_OFFSET",new jl(5*Ne.PI_OVER_FOUR,-Ne.PI_OVER_FOUR,0));let yo=nl;function mN(n,e,t){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))throw new Ze("");n.position.copy(e),n.frustum.updateMatrix(),n.frustum.updateMatrixWorld();const i=Nh(n);let{width:r,height:s}=n.scene.drawingBufferSize;n.frustum.aspectRatio=r/s,n.frustum.width=i,n.frustum.near=e.z*.9,n.frustum.far=e.z*1.1,n.frustum.setRotationFromEuler(new Oi(t.heading,t.pitch,t.roll)),n.frustum.update()}let gN=new fe,_N=new bi,vN=new at;function yN(n,e,t,i=!1){let r=fe.clone(n.transform,gN);n._setTransform(fe.IDENTITY),T.equals(e,n.positionWC)||T.clone(e,n.position),t.heading=t.heading-Ne.PI_OVER_TWO;let s=bi.fromHeadingPitchRoll(t,_N),o=at.fromQuaternion(s,vN);at.getColumn(o,0,n.direction),at.getColumn(o,2,n.up),T.cross(n.direction,n.up,n.right),n._setTransform(r),n._adjustOrthographicFrustum(!0)}new he,new T;function Nh(n){return n._mode===Pt.SCENE2D?n.position.z:T.magnitude(n.position)}function bN(n,e,t=new T){let{min:i,max:r}=e;const s=Math.abs(r.x-i.x)*.5;let o=Math.abs(r.y-i.y)*.5,a,l;const c=n.frustum.right/n.frustum.top,u=o*c;return s>u?(a=s,l=a/c):(l=o,a=u),e.getCenter(t),t.z=Math.max(2*a,2*l),t}function xN(n){if(!O(n._oldPositionWC))n._oldPositionWC=T.clone(n.positionWC,n._oldPositionWC);else{n.positionWCDeltaMagnitudeLastFrame=n.positionWCDeltaMagnitude;let e=T.subtract(n.positionWC,n._oldPositionWC,n._oldPositionWC);n.positionWCDeltaMagnitude=T.magnitude(e),n._oldPositionWC=T.clone(n.positionWC,n._oldPositionWC),n.positionWCDeltaMagnitude>0?(n.timeSinceMoved=0,n._lastMovedTimestamp=_o()):n.timeSinceMoved=Math.max(_o()-n._lastMovedTimestamp,0)/1e3}}let wN=new T,SN=new T,EN=new T;const TN=new Us;function AN(n,e,t){let i=n.scene.canvas,r=i.clientWidth,s=i.clientHeight,o=Math.tan(n.frustum.fovy*.5),a=n.frustum.aspectRatio*o,l=n.frustum.near,c=2/r*e.x-1,u=2/s*(s-e.y)-1,d=n.positionWC;T.clone(d,t.origin);let p=T.multiplyByScalar(n.directionWC,l,wN);T.add(d,p,p);let g=T.multiplyByScalar(n.rightWC,c*l*a,SN),_=T.multiplyByScalar(n.upWC,u*l*o,EN),x=T.add(p,g,t.direction);return T.add(x,_,x),T.subtract(x,d,x),T.normalize(x,x),TN.setFromCamera(e,n.frustum),t}var ip=new T;function MN(n,e,t){var i=n.scene.canvas,r=i.clientWidth,s=i.clientHeight,o=n.frustum,a=2/r*e.x-1;a*=(o.right-o.left)*.5;var l=2/s*(s-e.y)-1;l*=(o.top-o.bottom)*.5;var c=t.origin;return T.clone(n.position,c),T.multiplyByScalar(n.right,a,ip),T.add(ip,c,c),T.multiplyByScalar(n.up,l,ip),T.add(ip,c,c),T.clone(n.directionWC,t.direction),T.fromElements(t.origin.z,t.origin.x,t.origin.y,t.origin),t}const t0=new T;function ss(n){const e=n._mode,t=!1,i=0;let r=n._position;const s=!T.equals(r,n.position)||t;s&&(r=T.clone(n.position,n._position));let o=n._up;const a=!T.equals(o,n.up);a&&(T.normalize(n.up,n.up),o=T.clone(n.up,n._up));let l=n._direction;const c=!T.equals(l,n.direction);c&&(T.normalize(n.direction,n.direction),l=T.clone(n.direction,n._direction));let u=n._right;const d=!T.equals(u,n.right);d&&(T.normalize(n.right,n.right),u=T.clone(n.right,n._right));const p=n._transformChanged||n._modeChanged;n._transformChanged=!1,p&&(fe.inverseTransformation(n._transform,n._invTransform),n._mode===Pt.COLUMBUS_VIEW||n._mode===Pt.SCENE2D||fe.clone(n._transform,n._actualTransform),fe.inverseTransformation(n._actualTransform,n._actualInvTransform),n._modeChanged=!1);const g=n._actualTransform;if((s||p)&&(n._positionWC=fe.multiplyByPoint(g,r,n._positionWC),!(e===Pt.SCENE3D||e===Pt.MORPHING))){const _=t0;_.x=n._positionWC.y,_.y=n._positionWC.z,_.z=n._positionWC.x,e===Pt.SCENE2D&&(_.z=i)}if(c||a||d){const _=T.dot(l,T.cross(o,u,t0));if(Math.abs(1-_)>Ne.EPSILON2){const x=1/T.magnitudeSquared(o),b=T.dot(o,l)*x,y=T.multiplyByScalar(l,b,t0);o=T.normalize(T.subtract(o,y,n._up),n._up),T.clone(o,n.up),u=T.cross(l,o,n._right),T.clone(u,n.right)}}(c||p)&&(n._directionWC=fe.multiplyByPointAsVector(g,l,n._directionWC),T.normalize(n._directionWC,n._directionWC)),(a||p)&&(n._upWC=fe.multiplyByPointAsVector(g,o,n._upWC),T.normalize(n._upWC,n._upWC)),(d||p)&&(n._rightWC=fe.multiplyByPointAsVector(g,u,n._rightWC),T.normalize(n._rightWC,n._rightWC)),(s||c||a||d||p)&&CN(n)}function CN(n){fe.computeView(n._position,n._direction,n._up,n._right,n._viewMatrix),fe.multiply(n._viewMatrix,n._actualInvTransform,n._viewMatrix),fe.inverseTransformation(n._viewMatrix,n._invViewMatrix),fe.clone(n._invViewMatrix,n.frustum.matrixWorld),n.frustum.matrixWorld.decompose(n.frustum.position,n.frustum.quaternion,n.frustum.scale)}const IN={direction:new T,right:new T,up:new T};function PN(n,e,t,i){const r=i?n:IN,s=new T().copy(e).negate();s.normalize(),r.direction.copy(s);const o=T.cross(s,T.UNIT_Z,r.right);return T.normalize(o,o),T.cross(o,s,r.up),T.clone(e,t)}function RN(n,e){n.move(n.direction,e)}function vS(n,e){O(n.constrainedAxis)?n.rotate(n.constrainedAxis,e):n.rotate(n.up,e)}new T,new T,new T,new T;function yS(n,e){n.position,n.rotate(n.right,e)}function DN(n,e){let t=n.frustum,i=Math.tan(t.fovy*.5),r=t.aspectRatio*i;return Math.max(e/r,e/i)}function LN(n,e){let t=n.frustum,i,r,s=t.right/t.top,o=e*s;return e>o?(i=e,r=i/s):(r=e,i=o),Math.max(i,r)*1.5}let ON=100;function bS(n,e,t){t=jl.clone(O(t)?t:yo.DEFAULT_OFFSET);let i=n.scene.screenSpaceCameraController.minDistance,r=n.scene.screenSpaceCameraController.maxDistance,s=t.range;if(!O(s)||s===0){let o=e.radius;o===0?t.range=ON:n.frustum instanceof Gs||n._mode===Pt.SCENE2D?t.range=LN(n,o):t.range=DN(n,o),t.range=Ne.clamp(t.range,i,r)}return t}let NN=new T,BN=new bi,FN=new bi,UN=new at;function xS(n,e,t){e=Ne.clamp(e,-Ne.PI_OVER_TWO,Ne.PI_OVER_TWO),n=Ne.zeroToTwoPi(n)-Ne.PI_OVER_TWO;let i=bi.fromAxisAngle(T.UNIT_Y,-e,BN),r=bi.fromAxisAngle(T.UNIT_Z,-n,FN),s=bi.multiply(r,i,r),o=at.fromQuaternion(s,UN),a=T.clone(T.UNIT_X,NN);return at.multiplyByVector(o,a,a),T.negate(a,a),T.multiplyByScalar(a,t,a),a}const kN=new T,zN=new T,HN=new T;function i0(n,e){const t=T.clone(n.direction,kN),i=T.clone(n.up,zN),r=T.cross(t,i,HN);return e.heading=mS(t,i),e.pitch=gS(t),e.roll=_S(t,i,r),e}function GN(){return!0}function ht(n,e="This object was destroyed, i.e., destroy() was called."){function t(){throw new Ze(e)}for(const i in n)typeof n[i]=="function"&&(n[i]=t);n.isDestroyed=GN}class np{constructor(e,t){f(this,"enabled",!0);f(this,"domElement");f(this,"position",new T);f(this,"offset",new he);f(this,"center",!1);f(this,"_canvasCoordinates",new he);f(this,"_renderToScreen",!1);let{position:i=new T,offset:r=new he,center:s=!1}=t;this.center=s,this.domElement=e,this.position.copy(i),this.offset.copy(r)}show(e=!0){this.domElement.style.display=e?"block":"none",this.enabled=e}update(e){if(!this.enabled)return;let{scene:t}=e,i=t.positionToCanvasCoordinates(this.position,this._canvasCoordinates);if(i.x+=this.offset.x,i.y+=this.offset.y,this.center){let{clientWidth:r,clientHeight:s}=this.domElement;i.x-=r/2,i.y-=s/2}O(i)&&(this.domElement.style.top=`${i.y}px`,this.domElement.style.left=`${i.x}px`),this._renderToScreen=!0}isDestroyed(){return!1}destroy(){var e;return(e=this.domElement.parentElement)==null||e.removeChild(this.domElement),ht(this)}}function Zl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function rp(n,e){return n.overlays.indexOf(e)}class wS{constructor(){f(this,"overlays");f(this,"_guid",Zl());f(this,"destroyObjects",!0);f(this,"visible",!0);this.overlays=[]}get length(){return this.overlays.length}add(e,t){const i=O(t),r=e._external=e._external||{},s=r._composites=r._composites||{};return s[this._guid]={collection:this},i?this.overlays.splice(t,0,e):this.overlays.push(e),e}remove(e){if(this.contains(e)){const t=this.overlays.indexOf(e);if(t!==-1)return this.overlays.splice(t,1),delete e._external._composites[this._guid],this.destroyObjects&&e.destroy(),!0}return!1}removeAll(){const e=this.overlays,t=e.length;for(let i=0;i<t;++i)delete e[i]._external._composites[this._guid],this.destroyObjects&&e[i].destroy();this.overlays=[]}contains(e){return!!(O(e)&&e._external&&e._external._composites&&e._external._composites[this._guid])}raise(e){if(O(e)){const t=rp(this,e),i=this.overlays;if(t!==i.length-1){const r=i[t];i[t]=i[t+1],i[t+1]=r}}}raiseToTop(e){if(O(e)){const t=rp(this,e),i=this.overlays;t!==i.length-1&&(i.splice(t,1),i.push(e))}}lower(e){if(O(e)){const t=rp(this,e),i=this.overlays;if(t!==0){const r=i[t];i[t]=i[t-1],i[t-1]=r}}}lowerToBottom(e){if(O(e)){const t=rp(this,e),i=this.overlays;t!==0&&(i.splice(t,1),i.unshift(e))}}update(e){if(!this.visible)return;const t=this.overlays;for(let i=0;i<t.length;++i)t[i].update(e)}}var os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function n0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function sp(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var SS={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(n,e){(function(t){n.exports=t()})(function(){return function t(i,r,s){function o(c,u){if(!r[c]){if(!i[c]){var d=typeof sp=="function"&&sp;if(!u&&d)return d(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var g=r[c]={exports:{}};i[c][0].call(g.exports,function(_){var x=i[c][1][_];return o(x||_)},g,g.exports,t,i,r,s)}return r[c].exports}for(var a=typeof sp=="function"&&sp,l=0;l<s.length;l++)o(s[l]);return o}({1:[function(t,i,r){(function(s){var o=s.MutationObserver||s.WebKitMutationObserver,a;if(o){var l=0,c=new o(_),u=s.document.createTextNode("");c.observe(u,{characterData:!0}),a=function(){u.data=l=++l%2}}else if(!s.setImmediate&&typeof s.MessageChannel<"u"){var d=new s.MessageChannel;d.port1.onmessage=_,a=function(){d.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?a=function(){var b=s.document.createElement("script");b.onreadystatechange=function(){_(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},s.document.documentElement.appendChild(b)}:a=function(){setTimeout(_,0)};var p,g=[];function _(){p=!0;for(var b,y,M=g.length;M;){for(y=g,g=[],b=-1;++b<M;)y[b]();M=g.length}p=!1}i.exports=x;function x(b){g.push(b)===1&&!p&&a()}}).call(this,typeof os<"u"?os:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(t,i,r){var s=t(1);function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];i.exports=d;function d(I){if(typeof I!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,I!==o&&x(this,I)}d.prototype.catch=function(I){return this.then(null,I)},d.prototype.then=function(I,B){if(typeof I!="function"&&this.state===c||typeof B!="function"&&this.state===l)return this;var N=new this.constructor(o);if(this.state!==u){var L=this.state===c?I:B;g(N,L,this.outcome)}else this.queue.push(new p(N,I,B));return N};function p(I,B,N){this.promise=I,typeof B=="function"&&(this.onFulfilled=B,this.callFulfilled=this.otherCallFulfilled),typeof N=="function"&&(this.onRejected=N,this.callRejected=this.otherCallRejected)}p.prototype.callFulfilled=function(I){a.resolve(this.promise,I)},p.prototype.otherCallFulfilled=function(I){g(this.promise,this.onFulfilled,I)},p.prototype.callRejected=function(I){a.reject(this.promise,I)},p.prototype.otherCallRejected=function(I){g(this.promise,this.onRejected,I)};function g(I,B,N){s(function(){var L;try{L=B(N)}catch(P){return a.reject(I,P)}L===I?a.reject(I,new TypeError("Cannot resolve promise with itself")):a.resolve(I,L)})}a.resolve=function(I,B){var N=b(_,B);if(N.status==="error")return a.reject(I,N.value);var L=N.value;if(L)x(I,L);else{I.state=c,I.outcome=B;for(var P=-1,R=I.queue.length;++P<R;)I.queue[P].callFulfilled(B)}return I},a.reject=function(I,B){I.state=l,I.outcome=B;for(var N=-1,L=I.queue.length;++N<L;)I.queue[N].callRejected(B);return I};function _(I){var B=I&&I.then;if(I&&(typeof I=="object"||typeof I=="function")&&typeof B=="function")return function(){B.apply(I,arguments)}}function x(I,B){var N=!1;function L(j){N||(N=!0,a.reject(I,j))}function P(j){N||(N=!0,a.resolve(I,j))}function R(){B(P,L)}var U=b(R);U.status==="error"&&L(U.value)}function b(I,B){var N={};try{N.value=I(B),N.status="success"}catch(L){N.status="error",N.value=L}return N}d.resolve=y;function y(I){return I instanceof this?I:a.resolve(new this(o),I)}d.reject=M;function M(I){var B=new this(o);return a.reject(B,I)}d.all=E;function E(I){var B=this;if(Object.prototype.toString.call(I)!=="[object Array]")return this.reject(new TypeError("must be an array"));var N=I.length,L=!1;if(!N)return this.resolve([]);for(var P=new Array(N),R=0,U=-1,j=new this(o);++U<N;)A(I[U],U);return j;function A(D,k){B.resolve(D).then(G,function(ee){L||(L=!0,a.reject(j,ee))});function G(ee){P[k]=ee,++R===N&&!L&&(L=!0,a.resolve(j,P))}}}d.race=w;function w(I){var B=this;if(Object.prototype.toString.call(I)!=="[object Array]")return this.reject(new TypeError("must be an array"));var N=I.length,L=!1;if(!N)return this.resolve([]);for(var P=-1,R=new this(o);++P<N;)U(I[P]);return R;function U(j){B.resolve(j).then(function(A){L||(L=!0,a.resolve(R,A))},function(A){L||(L=!0,a.reject(R,A))})}}},{1:1}],3:[function(t,i,r){(function(s){typeof s.Promise!="function"&&(s.Promise=t(2))}).call(this,typeof os<"u"?os:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(t,i,r){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z};function o(z,te){if(!(z instanceof te))throw new TypeError("Cannot call a class as a function")}function a(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var l=a();function c(){try{if(!l||!l.open)return!1;var z=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),te=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!z||te)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function u(z,te){z=z||[],te=te||{};try{return new Blob(z,te)}catch(ie){if(ie.name!=="TypeError")throw ie;for(var W=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,ne=new W,ae=0;ae<z.length;ae+=1)ne.append(z[ae]);return ne.getBlob(te.type)}}typeof Promise>"u"&&t(3);var d=Promise;function p(z,te){te&&z.then(function(W){te(null,W)},function(W){te(W)})}function g(z,te,W){typeof te=="function"&&z.then(te),typeof W=="function"&&z.catch(W)}function _(z){return typeof z!="string"&&(console.warn(z+" used as a key, but it is not a string."),z=String(z)),z}function x(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var b="local-forage-detect-blob-support",y=void 0,M={},E=Object.prototype.toString,w="readonly",I="readwrite";function B(z){for(var te=z.length,W=new ArrayBuffer(te),ne=new Uint8Array(W),ae=0;ae<te;ae++)ne[ae]=z.charCodeAt(ae);return W}function N(z){return new d(function(te){var W=z.transaction(b,I),ne=u([""]);W.objectStore(b).put(ne,"key"),W.onabort=function(ae){ae.preventDefault(),ae.stopPropagation(),te(!1)},W.oncomplete=function(){var ae=navigator.userAgent.match(/Chrome\/(\d+)/),ie=navigator.userAgent.match(/Edge\//);te(ie||!ae||parseInt(ae[1],10)>=43)}}).catch(function(){return!1})}function L(z){return typeof y=="boolean"?d.resolve(y):N(z).then(function(te){return y=te,y})}function P(z){var te=M[z.name],W={};W.promise=new d(function(ne,ae){W.resolve=ne,W.reject=ae}),te.deferredOperations.push(W),te.dbReady?te.dbReady=te.dbReady.then(function(){return W.promise}):te.dbReady=W.promise}function R(z){var te=M[z.name],W=te.deferredOperations.pop();if(W)return W.resolve(),W.promise}function U(z,te){var W=M[z.name],ne=W.deferredOperations.pop();if(ne)return ne.reject(te),ne.promise}function j(z,te){return new d(function(W,ne){if(M[z.name]=M[z.name]||Le(),z.db)if(te)P(z),z.db.close();else return W(z.db);var ae=[z.name];te&&ae.push(z.version);var ie=l.open.apply(l,ae);te&&(ie.onupgradeneeded=function(Se){var we=ie.result;try{we.createObjectStore(z.storeName),Se.oldVersion<=1&&we.createObjectStore(b)}catch(h){if(h.name==="ConstraintError")console.warn('The database "'+z.name+'" has been upgraded from version '+Se.oldVersion+" to version "+Se.newVersion+', but the storage "'+z.storeName+'" already exists.');else throw h}}),ie.onerror=function(Se){Se.preventDefault(),ne(ie.error)},ie.onsuccess=function(){var Se=ie.result;Se.onversionchange=function(we){we.target.close()},W(Se),R(z)}})}function A(z){return j(z,!1)}function D(z){return j(z,!0)}function k(z,te){if(!z.db)return!0;var W=!z.db.objectStoreNames.contains(z.storeName),ne=z.version<z.db.version,ae=z.version>z.db.version;if(ne&&(z.version!==te&&console.warn('The database "'+z.name+`" can't be downgraded from version `+z.db.version+" to version "+z.version+"."),z.version=z.db.version),ae||W){if(W){var ie=z.db.version+1;ie>z.version&&(z.version=ie)}return!0}return!1}function G(z){return new d(function(te,W){var ne=new FileReader;ne.onerror=W,ne.onloadend=function(ae){var ie=btoa(ae.target.result||"");te({__local_forage_encoded_blob:!0,data:ie,type:z.type})},ne.readAsBinaryString(z)})}function ee(z){var te=B(atob(z.data));return u([te],{type:z.type})}function J(z){return z&&z.__local_forage_encoded_blob}function re(z){var te=this,W=te._initReady().then(function(){var ne=M[te._dbInfo.name];if(ne&&ne.dbReady)return ne.dbReady});return g(W,z,z),W}function oe(z){P(z);for(var te=M[z.name],W=te.forages,ne=0;ne<W.length;ne++){var ae=W[ne];ae._dbInfo.db&&(ae._dbInfo.db.close(),ae._dbInfo.db=null)}return z.db=null,A(z).then(function(ie){return z.db=ie,k(z)?D(z):ie}).then(function(ie){z.db=te.db=ie;for(var Se=0;Se<W.length;Se++)W[Se]._dbInfo.db=ie}).catch(function(ie){throw U(z,ie),ie})}function me(z,te,W,ne){ne===void 0&&(ne=1);try{var ae=z.db.transaction(z.storeName,te);W(null,ae)}catch(ie){if(ne>0&&(!z.db||ie.name==="InvalidStateError"||ie.name==="NotFoundError"))return d.resolve().then(function(){if(!z.db||ie.name==="NotFoundError"&&!z.db.objectStoreNames.contains(z.storeName)&&z.version<=z.db.version)return z.db&&(z.version=z.db.version+1),D(z)}).then(function(){return oe(z).then(function(){me(z,te,W,ne-1)})}).catch(W);W(ie)}}function Le(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Ge(z){var te=this,W={db:null};if(z)for(var ne in z)W[ne]=z[ne];var ae=M[W.name];ae||(ae=Le(),M[W.name]=ae),ae.forages.push(te),te._initReady||(te._initReady=te.ready,te.ready=re);var ie=[];function Se(){return d.resolve()}for(var we=0;we<ae.forages.length;we++){var h=ae.forages[we];h!==te&&ie.push(h._initReady().catch(Se))}var m=ae.forages.slice(0);return d.all(ie).then(function(){return W.db=ae.db,A(W)}).then(function(v){return W.db=v,k(W,te._defaultConfig.version)?D(W):v}).then(function(v){W.db=ae.db=v,te._dbInfo=W;for(var S=0;S<m.length;S++){var C=m[S];C!==te&&(C._dbInfo.db=W.db,C._dbInfo.version=W.version)}})}function pe(z,te){var W=this;z=_(z);var ne=new d(function(ae,ie){W.ready().then(function(){me(W._dbInfo,w,function(Se,we){if(Se)return ie(Se);try{var h=we.objectStore(W._dbInfo.storeName),m=h.get(z);m.onsuccess=function(){var v=m.result;v===void 0&&(v=null),J(v)&&(v=ee(v)),ae(v)},m.onerror=function(){ie(m.error)}}catch(v){ie(v)}})}).catch(ie)});return p(ne,te),ne}function Te(z,te){var W=this,ne=new d(function(ae,ie){W.ready().then(function(){me(W._dbInfo,w,function(Se,we){if(Se)return ie(Se);try{var h=we.objectStore(W._dbInfo.storeName),m=h.openCursor(),v=1;m.onsuccess=function(){var S=m.result;if(S){var C=S.value;J(C)&&(C=ee(C));var F=z(C,S.key,v++);F!==void 0?ae(F):S.continue()}else ae()},m.onerror=function(){ie(m.error)}}catch(S){ie(S)}})}).catch(ie)});return p(ne,te),ne}function ke(z,te,W){var ne=this;z=_(z);var ae=new d(function(ie,Se){var we;ne.ready().then(function(){return we=ne._dbInfo,E.call(te)==="[object Blob]"?L(we.db).then(function(h){return h?te:G(te)}):te}).then(function(h){me(ne._dbInfo,I,function(m,v){if(m)return Se(m);try{var S=v.objectStore(ne._dbInfo.storeName);h===null&&(h=void 0);var C=S.put(h,z);v.oncomplete=function(){h===void 0&&(h=null),ie(h)},v.onabort=v.onerror=function(){var F=C.error?C.error:C.transaction.error;Se(F)}}catch(F){Se(F)}})}).catch(Se)});return p(ae,W),ae}function De(z,te){var W=this;z=_(z);var ne=new d(function(ae,ie){W.ready().then(function(){me(W._dbInfo,I,function(Se,we){if(Se)return ie(Se);try{var h=we.objectStore(W._dbInfo.storeName),m=h.delete(z);we.oncomplete=function(){ae()},we.onerror=function(){ie(m.error)},we.onabort=function(){var v=m.error?m.error:m.transaction.error;ie(v)}}catch(v){ie(v)}})}).catch(ie)});return p(ne,te),ne}function Je(z){var te=this,W=new d(function(ne,ae){te.ready().then(function(){me(te._dbInfo,I,function(ie,Se){if(ie)return ae(ie);try{var we=Se.objectStore(te._dbInfo.storeName),h=we.clear();Se.oncomplete=function(){ne()},Se.onabort=Se.onerror=function(){var m=h.error?h.error:h.transaction.error;ae(m)}}catch(m){ae(m)}})}).catch(ae)});return p(W,z),W}function lt(z){var te=this,W=new d(function(ne,ae){te.ready().then(function(){me(te._dbInfo,w,function(ie,Se){if(ie)return ae(ie);try{var we=Se.objectStore(te._dbInfo.storeName),h=we.count();h.onsuccess=function(){ne(h.result)},h.onerror=function(){ae(h.error)}}catch(m){ae(m)}})}).catch(ae)});return p(W,z),W}function rt(z,te){var W=this,ne=new d(function(ae,ie){if(z<0){ae(null);return}W.ready().then(function(){me(W._dbInfo,w,function(Se,we){if(Se)return ie(Se);try{var h=we.objectStore(W._dbInfo.storeName),m=!1,v=h.openKeyCursor();v.onsuccess=function(){var S=v.result;if(!S){ae(null);return}z===0||m?ae(S.key):(m=!0,S.advance(z))},v.onerror=function(){ie(v.error)}}catch(S){ie(S)}})}).catch(ie)});return p(ne,te),ne}function _t(z){var te=this,W=new d(function(ne,ae){te.ready().then(function(){me(te._dbInfo,w,function(ie,Se){if(ie)return ae(ie);try{var we=Se.objectStore(te._dbInfo.storeName),h=we.openKeyCursor(),m=[];h.onsuccess=function(){var v=h.result;if(!v){ne(m);return}m.push(v.key),v.continue()},h.onerror=function(){ae(h.error)}}catch(v){ae(v)}})}).catch(ae)});return p(W,z),W}function Ee(z,te){te=x.apply(this,arguments);var W=this.config();z=typeof z!="function"&&z||{},z.name||(z.name=z.name||W.name,z.storeName=z.storeName||W.storeName);var ne=this,ae;if(!z.name)ae=d.reject("Invalid arguments");else{var ie=z.name===W.name&&ne._dbInfo.db,Se=ie?d.resolve(ne._dbInfo.db):A(z).then(function(we){var h=M[z.name],m=h.forages;h.db=we;for(var v=0;v<m.length;v++)m[v]._dbInfo.db=we;return we});z.storeName?ae=Se.then(function(we){if(we.objectStoreNames.contains(z.storeName)){var h=we.version+1;P(z);var m=M[z.name],v=m.forages;we.close();for(var S=0;S<v.length;S++){var C=v[S];C._dbInfo.db=null,C._dbInfo.version=h}var F=new d(function(H,K){var $=l.open(z.name,h);$.onerror=function(ue){var Pe=$.result;Pe.close(),K(ue)},$.onupgradeneeded=function(){var ue=$.result;ue.deleteObjectStore(z.storeName)},$.onsuccess=function(){var ue=$.result;ue.close(),H(ue)}});return F.then(function(H){m.db=H;for(var K=0;K<v.length;K++){var $=v[K];$._dbInfo.db=H,R($._dbInfo)}}).catch(function(H){throw(U(z,H)||d.resolve()).catch(function(){}),H})}}):ae=Se.then(function(we){P(z);var h=M[z.name],m=h.forages;we.close();for(var v=0;v<m.length;v++){var S=m[v];S._dbInfo.db=null}var C=new d(function(F,H){var K=l.deleteDatabase(z.name);K.onerror=function(){var $=K.result;$&&$.close(),H(K.error)},K.onblocked=function(){console.warn('dropInstance blocked for database "'+z.name+'" until all open connections are closed')},K.onsuccess=function(){var $=K.result;$&&$.close(),F($)}});return C.then(function(F){h.db=F;for(var H=0;H<m.length;H++){var K=m[H];R(K._dbInfo)}}).catch(function(F){throw(U(z,F)||d.resolve()).catch(function(){}),F})})}return p(ae,te),ae}var Oe={_driver:"asyncStorage",_initStorage:Ge,_support:c(),iterate:Te,getItem:pe,setItem:ke,removeItem:De,clear:Je,length:lt,key:rt,keys:_t,dropInstance:Ee};function Q(){return typeof openDatabase=="function"}var Ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Be="~~local_forage_type~",it=/^~~local_forage_type~([^~]+)~/,ze="__lfsc__:",wt=ze.length,et="arbf",Z="blob",V="si08",de="ui08",Ae="uic8",Re="si16",Ce="si32",ut="ur16",je="ui32",tt="fl32",Ht="fl64",Ue=wt+et.length,ot=Object.prototype.toString;function Et(z){var te=z.length*.75,W=z.length,ne,ae=0,ie,Se,we,h;z[z.length-1]==="="&&(te--,z[z.length-2]==="="&&te--);var m=new ArrayBuffer(te),v=new Uint8Array(m);for(ne=0;ne<W;ne+=4)ie=Ye.indexOf(z[ne]),Se=Ye.indexOf(z[ne+1]),we=Ye.indexOf(z[ne+2]),h=Ye.indexOf(z[ne+3]),v[ae++]=ie<<2|Se>>4,v[ae++]=(Se&15)<<4|we>>2,v[ae++]=(we&3)<<6|h&63;return m}function At(z){var te=new Uint8Array(z),W="",ne;for(ne=0;ne<te.length;ne+=3)W+=Ye[te[ne]>>2],W+=Ye[(te[ne]&3)<<4|te[ne+1]>>4],W+=Ye[(te[ne+1]&15)<<2|te[ne+2]>>6],W+=Ye[te[ne+2]&63];return te.length%3===2?W=W.substring(0,W.length-1)+"=":te.length%3===1&&(W=W.substring(0,W.length-2)+"=="),W}function st(z,te){var W="";if(z&&(W=ot.call(z)),z&&(W==="[object ArrayBuffer]"||z.buffer&&ot.call(z.buffer)==="[object ArrayBuffer]")){var ne,ae=ze;z instanceof ArrayBuffer?(ne=z,ae+=et):(ne=z.buffer,W==="[object Int8Array]"?ae+=V:W==="[object Uint8Array]"?ae+=de:W==="[object Uint8ClampedArray]"?ae+=Ae:W==="[object Int16Array]"?ae+=Re:W==="[object Uint16Array]"?ae+=ut:W==="[object Int32Array]"?ae+=Ce:W==="[object Uint32Array]"?ae+=je:W==="[object Float32Array]"?ae+=tt:W==="[object Float64Array]"?ae+=Ht:te(new Error("Failed to get type for BinaryArray"))),te(ae+At(ne))}else if(W==="[object Blob]"){var ie=new FileReader;ie.onload=function(){var Se=Be+z.type+"~"+At(this.result);te(ze+Z+Se)},ie.readAsArrayBuffer(z)}else try{te(JSON.stringify(z))}catch(Se){console.error("Couldn't convert value into a JSON string: ",z),te(null,Se)}}function Yt(z){if(z.substring(0,wt)!==ze)return JSON.parse(z);var te=z.substring(Ue),W=z.substring(wt,Ue),ne;if(W===Z&&it.test(te)){var ae=te.match(it);ne=ae[1],te=te.substring(ae[0].length)}var ie=Et(te);switch(W){case et:return ie;case Z:return u([ie],{type:ne});case V:return new Int8Array(ie);case de:return new Uint8Array(ie);case Ae:return new Uint8ClampedArray(ie);case Re:return new Int16Array(ie);case ut:return new Uint16Array(ie);case Ce:return new Int32Array(ie);case je:return new Uint32Array(ie);case tt:return new Float32Array(ie);case Ht:return new Float64Array(ie);default:throw new Error("Unkown type: "+W)}}var Rt={serialize:st,deserialize:Yt,stringToBuffer:Et,bufferToString:At};function hi(z,te,W,ne){z.executeSql("CREATE TABLE IF NOT EXISTS "+te.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],W,ne)}function se(z){var te=this,W={db:null};if(z)for(var ne in z)W[ne]=typeof z[ne]!="string"?z[ne].toString():z[ne];var ae=new d(function(ie,Se){try{W.db=openDatabase(W.name,String(W.version),W.description,W.size)}catch(we){return Se(we)}W.db.transaction(function(we){hi(we,W,function(){te._dbInfo=W,ie()},function(h,m){Se(m)})},Se)});return W.serializer=Rt,ae}function Ve(z,te,W,ne,ae,ie){z.executeSql(W,ne,ae,function(Se,we){we.code===we.SYNTAX_ERR?Se.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[te.storeName],function(h,m){m.rows.length?ie(h,we):hi(h,te,function(){h.executeSql(W,ne,ae,ie)},ie)},ie):ie(Se,we)},ie)}function be(z,te){var W=this;z=_(z);var ne=new d(function(ae,ie){W.ready().then(function(){var Se=W._dbInfo;Se.db.transaction(function(we){Ve(we,Se,"SELECT * FROM "+Se.storeName+" WHERE key = ? LIMIT 1",[z],function(h,m){var v=m.rows.length?m.rows.item(0).value:null;v&&(v=Se.serializer.deserialize(v)),ae(v)},function(h,m){ie(m)})})}).catch(ie)});return p(ne,te),ne}function Ie(z,te){var W=this,ne=new d(function(ae,ie){W.ready().then(function(){var Se=W._dbInfo;Se.db.transaction(function(we){Ve(we,Se,"SELECT * FROM "+Se.storeName,[],function(h,m){for(var v=m.rows,S=v.length,C=0;C<S;C++){var F=v.item(C),H=F.value;if(H&&(H=Se.serializer.deserialize(H)),H=z(H,F.key,C+1),H!==void 0){ae(H);return}}ae()},function(h,m){ie(m)})})}).catch(ie)});return p(ne,te),ne}function Ke(z,te,W,ne){var ae=this;z=_(z);var ie=new d(function(Se,we){ae.ready().then(function(){te===void 0&&(te=null);var h=te,m=ae._dbInfo;m.serializer.serialize(te,function(v,S){S?we(S):m.db.transaction(function(C){Ve(C,m,"INSERT OR REPLACE INTO "+m.storeName+" (key, value) VALUES (?, ?)",[z,v],function(){Se(h)},function(F,H){we(H)})},function(C){if(C.code===C.QUOTA_ERR){if(ne>0){Se(Ke.apply(ae,[z,h,W,ne-1]));return}we(C)}})})}).catch(we)});return p(ie,W),ie}function Qe(z,te,W){return Ke.apply(this,[z,te,W,1])}function Nt(z,te){var W=this;z=_(z);var ne=new d(function(ae,ie){W.ready().then(function(){var Se=W._dbInfo;Se.db.transaction(function(we){Ve(we,Se,"DELETE FROM "+Se.storeName+" WHERE key = ?",[z],function(){ae()},function(h,m){ie(m)})})}).catch(ie)});return p(ne,te),ne}function Si(z){var te=this,W=new d(function(ne,ae){te.ready().then(function(){var ie=te._dbInfo;ie.db.transaction(function(Se){Ve(Se,ie,"DELETE FROM "+ie.storeName,[],function(){ne()},function(we,h){ae(h)})})}).catch(ae)});return p(W,z),W}function Qi(z){var te=this,W=new d(function(ne,ae){te.ready().then(function(){var ie=te._dbInfo;ie.db.transaction(function(Se){Ve(Se,ie,"SELECT COUNT(key) as c FROM "+ie.storeName,[],function(we,h){var m=h.rows.item(0).c;ne(m)},function(we,h){ae(h)})})}).catch(ae)});return p(W,z),W}function ri(z,te){var W=this,ne=new d(function(ae,ie){W.ready().then(function(){var Se=W._dbInfo;Se.db.transaction(function(we){Ve(we,Se,"SELECT key FROM "+Se.storeName+" WHERE id = ? LIMIT 1",[z+1],function(h,m){var v=m.rows.length?m.rows.item(0).key:null;ae(v)},function(h,m){ie(m)})})}).catch(ie)});return p(ne,te),ne}function $n(z){var te=this,W=new d(function(ne,ae){te.ready().then(function(){var ie=te._dbInfo;ie.db.transaction(function(Se){Ve(Se,ie,"SELECT key FROM "+ie.storeName,[],function(we,h){for(var m=[],v=0;v<h.rows.length;v++)m.push(h.rows.item(v).key);ne(m)},function(we,h){ae(h)})})}).catch(ae)});return p(W,z),W}function vr(z){return new d(function(te,W){z.transaction(function(ne){ne.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(ae,ie){for(var Se=[],we=0;we<ie.rows.length;we++)Se.push(ie.rows.item(we).name);te({db:z,storeNames:Se})},function(ae,ie){W(ie)})},function(ne){W(ne)})})}function Lc(z,te){te=x.apply(this,arguments);var W=this.config();z=typeof z!="function"&&z||{},z.name||(z.name=z.name||W.name,z.storeName=z.storeName||W.storeName);var ne=this,ae;return z.name?ae=new d(function(ie){var Se;z.name===W.name?Se=ne._dbInfo.db:Se=openDatabase(z.name,"","",0),z.storeName?ie({db:Se,storeNames:[z.storeName]}):ie(vr(Se))}).then(function(ie){return new d(function(Se,we){ie.db.transaction(function(h){function m(F){return new d(function(H,K){h.executeSql("DROP TABLE IF EXISTS "+F,[],function(){H()},function($,ue){K(ue)})})}for(var v=[],S=0,C=ie.storeNames.length;S<C;S++)v.push(m(ie.storeNames[S]));d.all(v).then(function(){Se()}).catch(function(F){we(F)})},function(h){we(h)})})}):ae=d.reject("Invalid arguments"),p(ae,te),ae}var Oc={_driver:"webSQLStorage",_initStorage:se,_support:Q(),iterate:Ie,getItem:be,setItem:Qe,removeItem:Nt,clear:Si,length:Qi,key:ri,keys:$n,dropInstance:Lc};function Zr(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function qo(z,te){var W=z.name+"/";return z.storeName!==te.storeName&&(W+=z.storeName+"/"),W}function Nc(){var z="_localforage_support_test";try{return localStorage.setItem(z,!0),localStorage.removeItem(z),!1}catch{return!0}}function Bc(){return!Nc()||localStorage.length>0}function Zo(z){var te=this,W={};if(z)for(var ne in z)W[ne]=z[ne];return W.keyPrefix=qo(z,te._defaultConfig),Bc()?(te._dbInfo=W,W.serializer=Rt,d.resolve()):d.reject()}function Fc(z){var te=this,W=te.ready().then(function(){for(var ne=te._dbInfo.keyPrefix,ae=localStorage.length-1;ae>=0;ae--){var ie=localStorage.key(ae);ie.indexOf(ne)===0&&localStorage.removeItem(ie)}});return p(W,z),W}function Ko(z,te){var W=this;z=_(z);var ne=W.ready().then(function(){var ae=W._dbInfo,ie=localStorage.getItem(ae.keyPrefix+z);return ie&&(ie=ae.serializer.deserialize(ie)),ie});return p(ne,te),ne}function Uc(z,te){var W=this,ne=W.ready().then(function(){for(var ae=W._dbInfo,ie=ae.keyPrefix,Se=ie.length,we=localStorage.length,h=1,m=0;m<we;m++){var v=localStorage.key(m);if(v.indexOf(ie)===0){var S=localStorage.getItem(v);if(S&&(S=ae.serializer.deserialize(S)),S=z(S,v.substring(Se),h++),S!==void 0)return S}}});return p(ne,te),ne}function kc(z,te){var W=this,ne=W.ready().then(function(){var ae=W._dbInfo,ie;try{ie=localStorage.key(z)}catch{ie=null}return ie&&(ie=ie.substring(ae.keyPrefix.length)),ie});return p(ne,te),ne}function Cu(z){var te=this,W=te.ready().then(function(){for(var ne=te._dbInfo,ae=localStorage.length,ie=[],Se=0;Se<ae;Se++){var we=localStorage.key(Se);we.indexOf(ne.keyPrefix)===0&&ie.push(we.substring(ne.keyPrefix.length))}return ie});return p(W,z),W}function $s(z){var te=this,W=te.keys().then(function(ne){return ne.length});return p(W,z),W}function zc(z,te){var W=this;z=_(z);var ne=W.ready().then(function(){var ae=W._dbInfo;localStorage.removeItem(ae.keyPrefix+z)});return p(ne,te),ne}function Y(z,te,W){var ne=this;z=_(z);var ae=ne.ready().then(function(){te===void 0&&(te=null);var ie=te;return new d(function(Se,we){var h=ne._dbInfo;h.serializer.serialize(te,function(m,v){if(v)we(v);else try{localStorage.setItem(h.keyPrefix+z,m),Se(ie)}catch(S){(S.name==="QuotaExceededError"||S.name==="NS_ERROR_DOM_QUOTA_REACHED")&&we(S),we(S)}})})});return p(ae,W),ae}function le(z,te){if(te=x.apply(this,arguments),z=typeof z!="function"&&z||{},!z.name){var W=this.config();z.name=z.name||W.name,z.storeName=z.storeName||W.storeName}var ne=this,ae;return z.name?ae=new d(function(ie){z.storeName?ie(qo(z,ne._defaultConfig)):ie(z.name+"/")}).then(function(ie){for(var Se=localStorage.length-1;Se>=0;Se--){var we=localStorage.key(Se);we.indexOf(ie)===0&&localStorage.removeItem(we)}}):ae=d.reject("Invalid arguments"),p(ae,te),ae}var ge={_driver:"localStorageWrapper",_initStorage:Zo,_support:Zr(),iterate:Uc,getItem:Ko,setItem:Y,removeItem:zc,clear:Fc,length:$s,key:kc,keys:Cu,dropInstance:le},_e=function(te,W){return te===W||typeof te=="number"&&typeof W=="number"&&isNaN(te)&&isNaN(W)},ce=function(te,W){for(var ne=te.length,ae=0;ae<ne;){if(_e(te[ae],W))return!0;ae++}return!1},Fe=Array.isArray||function(z){return Object.prototype.toString.call(z)==="[object Array]"},qe={},dt={},ct={INDEXEDDB:Oe,WEBSQL:Oc,LOCALSTORAGE:ge},Ct=[ct.INDEXEDDB._driver,ct.WEBSQL._driver,ct.LOCALSTORAGE._driver],It=["dropInstance"],ft=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(It),Zt={description:"",driver:Ct.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function pi(z,te){z[te]=function(){var W=arguments;return z.ready().then(function(){return z[te].apply(z,W)})}}function ui(){for(var z=1;z<arguments.length;z++){var te=arguments[z];if(te)for(var W in te)te.hasOwnProperty(W)&&(Fe(te[W])?arguments[0][W]=te[W].slice():arguments[0][W]=te[W])}return arguments[0]}var oi=function(){function z(te){o(this,z);for(var W in ct)if(ct.hasOwnProperty(W)){var ne=ct[W],ae=ne._driver;this[W]=ae,qe[ae]||this.defineDriver(ne)}this._defaultConfig=ui({},Zt),this._config=ui({},this._defaultConfig,te),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return z.prototype.config=function(W){if((typeof W>"u"?"undefined":s(W))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var ne in W){if(ne==="storeName"&&(W[ne]=W[ne].replace(/\W/g,"_")),ne==="version"&&typeof W[ne]!="number")return new Error("Database version must be a number.");this._config[ne]=W[ne]}return"driver"in W&&W.driver?this.setDriver(this._config.driver):!0}else return typeof W=="string"?this._config[W]:this._config},z.prototype.defineDriver=function(W,ne,ae){var ie=new d(function(Se,we){try{var h=W._driver,m=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!W._driver){we(m);return}for(var v=ft.concat("_initStorage"),S=0,C=v.length;S<C;S++){var F=v[S],H=!ce(It,F);if((H||W[F])&&typeof W[F]!="function"){we(m);return}}var K=function(){for(var Pe=function(Wt){return function(){var vi=new Error("Method "+Wt+" is not implemented by the current driver"),xn=d.reject(vi);return p(xn,arguments[arguments.length-1]),xn}},Me=0,Xe=It.length;Me<Xe;Me++){var St=It[Me];W[St]||(W[St]=Pe(St))}};K();var $=function(Pe){qe[h]&&console.info("Redefining LocalForage driver: "+h),qe[h]=W,dt[h]=Pe,Se()};"_support"in W?W._support&&typeof W._support=="function"?W._support().then($,we):$(!!W._support):$(!0)}catch(ue){we(ue)}});return g(ie,ne,ae),ie},z.prototype.driver=function(){return this._driver||null},z.prototype.getDriver=function(W,ne,ae){var ie=qe[W]?d.resolve(qe[W]):d.reject(new Error("Driver not found."));return g(ie,ne,ae),ie},z.prototype.getSerializer=function(W){var ne=d.resolve(Rt);return g(ne,W),ne},z.prototype.ready=function(W){var ne=this,ae=ne._driverSet.then(function(){return ne._ready===null&&(ne._ready=ne._initDriver()),ne._ready});return g(ae,W,W),ae},z.prototype.setDriver=function(W,ne,ae){var ie=this;Fe(W)||(W=[W]);var Se=this._getSupportedDrivers(W);function we(){ie._config.driver=ie.driver()}function h(S){return ie._extend(S),we(),ie._ready=ie._initStorage(ie._config),ie._ready}function m(S){return function(){var C=0;function F(){for(;C<S.length;){var H=S[C];return C++,ie._dbInfo=null,ie._ready=null,ie.getDriver(H).then(h).catch(F)}we();var K=new Error("No available storage method found.");return ie._driverSet=d.reject(K),ie._driverSet}return F()}}var v=this._driverSet!==null?this._driverSet.catch(function(){return d.resolve()}):d.resolve();return this._driverSet=v.then(function(){var S=Se[0];return ie._dbInfo=null,ie._ready=null,ie.getDriver(S).then(function(C){ie._driver=C._driver,we(),ie._wrapLibraryMethodsWithReady(),ie._initDriver=m(Se)})}).catch(function(){we();var S=new Error("No available storage method found.");return ie._driverSet=d.reject(S),ie._driverSet}),g(this._driverSet,ne,ae),this._driverSet},z.prototype.supports=function(W){return!!dt[W]},z.prototype._extend=function(W){ui(this,W)},z.prototype._getSupportedDrivers=function(W){for(var ne=[],ae=0,ie=W.length;ae<ie;ae++){var Se=W[ae];this.supports(Se)&&ne.push(Se)}return ne},z.prototype._wrapLibraryMethodsWithReady=function(){for(var W=0,ne=ft.length;W<ne;W++)pi(this,ft[W])},z.prototype.createInstance=function(W){return new z(W)},z}(),ii=new oi;i.exports=ii},{3:3}]},{},[4])(4)})})(SS);var VN=SS.exports;const r0=n0(VN);/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const WN=4,ES=0,TS=1,XN=2;function Kl(n){let e=n.length;for(;--e>=0;)n[e]=0}const YN=0,AS=1,jN=2,qN=3,ZN=258,s0=29,Bh=256,Fh=Bh+1+s0,Ql=30,o0=19,MS=2*Fh+1,La=15,a0=16,KN=7,l0=256,CS=16,IS=17,PS=18,c0=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),op=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),QN=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),RS=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$N=512,Vs=new Array((Fh+2)*2);Kl(Vs);const Uh=new Array(Ql*2);Kl(Uh);const kh=new Array($N);Kl(kh);const zh=new Array(ZN-qN+1);Kl(zh);const h0=new Array(s0);Kl(h0);const ap=new Array(Ql);Kl(ap);function u0(n,e,t,i,r){this.static_tree=n,this.extra_bits=e,this.extra_base=t,this.elems=i,this.max_length=r,this.has_stree=n&&n.length}let DS,LS,OS;function f0(n,e){this.dyn_tree=n,this.max_code=0,this.stat_desc=e}const NS=n=>n<256?kh[n]:kh[256+(n>>>7)],Hh=(n,e)=>{n.pending_buf[n.pending++]=e&255,n.pending_buf[n.pending++]=e>>>8&255},nr=(n,e,t)=>{n.bi_valid>a0-t?(n.bi_buf|=e<<n.bi_valid&65535,Hh(n,n.bi_buf),n.bi_buf=e>>a0-n.bi_valid,n.bi_valid+=t-a0):(n.bi_buf|=e<<n.bi_valid&65535,n.bi_valid+=t)},as=(n,e,t)=>{nr(n,t[e*2],t[e*2+1])},BS=(n,e)=>{let t=0;do t|=n&1,n>>>=1,t<<=1;while(--e>0);return t>>>1},JN=n=>{n.bi_valid===16?(Hh(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=n.bi_buf&255,n.bi_buf>>=8,n.bi_valid-=8)},e3=(n,e)=>{const t=e.dyn_tree,i=e.max_code,r=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,u,d,p,g,_,x=0;for(p=0;p<=La;p++)n.bl_count[p]=0;for(t[n.heap[n.heap_max]*2+1]=0,c=n.heap_max+1;c<MS;c++)u=n.heap[c],p=t[t[u*2+1]*2+1]+1,p>l&&(p=l,x++),t[u*2+1]=p,!(u>i)&&(n.bl_count[p]++,g=0,u>=a&&(g=o[u-a]),_=t[u*2],n.opt_len+=_*(p+g),s&&(n.static_len+=_*(r[u*2+1]+g)));if(x!==0){do{for(p=l-1;n.bl_count[p]===0;)p--;n.bl_count[p]--,n.bl_count[p+1]+=2,n.bl_count[l]--,x-=2}while(x>0);for(p=l;p!==0;p--)for(u=n.bl_count[p];u!==0;)d=n.heap[--c],!(d>i)&&(t[d*2+1]!==p&&(n.opt_len+=(p-t[d*2+1])*t[d*2],t[d*2+1]=p),u--)}},FS=(n,e,t)=>{const i=new Array(La+1);let r=0,s,o;for(s=1;s<=La;s++)r=r+t[s-1]<<1,i[s]=r;for(o=0;o<=e;o++){let a=n[o*2+1];a!==0&&(n[o*2]=BS(i[a]++,a))}},t3=()=>{let n,e,t,i,r;const s=new Array(La+1);for(t=0,i=0;i<s0-1;i++)for(h0[i]=t,n=0;n<1<<c0[i];n++)zh[t++]=i;for(zh[t-1]=i,r=0,i=0;i<16;i++)for(ap[i]=r,n=0;n<1<<op[i];n++)kh[r++]=i;for(r>>=7;i<Ql;i++)for(ap[i]=r<<7,n=0;n<1<<op[i]-7;n++)kh[256+r++]=i;for(e=0;e<=La;e++)s[e]=0;for(n=0;n<=143;)Vs[n*2+1]=8,n++,s[8]++;for(;n<=255;)Vs[n*2+1]=9,n++,s[9]++;for(;n<=279;)Vs[n*2+1]=7,n++,s[7]++;for(;n<=287;)Vs[n*2+1]=8,n++,s[8]++;for(FS(Vs,Fh+1,s),n=0;n<Ql;n++)Uh[n*2+1]=5,Uh[n*2]=BS(n,5);DS=new u0(Vs,c0,Bh+1,Fh,La),LS=new u0(Uh,op,0,Ql,La),OS=new u0(new Array(0),QN,0,o0,KN)},US=n=>{let e;for(e=0;e<Fh;e++)n.dyn_ltree[e*2]=0;for(e=0;e<Ql;e++)n.dyn_dtree[e*2]=0;for(e=0;e<o0;e++)n.bl_tree[e*2]=0;n.dyn_ltree[l0*2]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},kS=n=>{n.bi_valid>8?Hh(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},zS=(n,e,t,i)=>{const r=e*2,s=t*2;return n[r]<n[s]||n[r]===n[s]&&i[e]<=i[t]},d0=(n,e,t)=>{const i=n.heap[t];let r=t<<1;for(;r<=n.heap_len&&(r<n.heap_len&&zS(e,n.heap[r+1],n.heap[r],n.depth)&&r++,!zS(e,i,n.heap[r],n.depth));)n.heap[t]=n.heap[r],t=r,r<<=1;n.heap[t]=i},HS=(n,e,t)=>{let i,r,s=0,o,a;if(n.sym_next!==0)do i=n.pending_buf[n.sym_buf+s++]&255,i+=(n.pending_buf[n.sym_buf+s++]&255)<<8,r=n.pending_buf[n.sym_buf+s++],i===0?as(n,r,e):(o=zh[r],as(n,o+Bh+1,e),a=c0[o],a!==0&&(r-=h0[o],nr(n,r,a)),i--,o=NS(i),as(n,o,t),a=op[o],a!==0&&(i-=ap[o],nr(n,i,a)));while(s<n.sym_next);as(n,l0,e)},p0=(n,e)=>{const t=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,l=-1,c;for(n.heap_len=0,n.heap_max=MS,o=0;o<s;o++)t[o*2]!==0?(n.heap[++n.heap_len]=l=o,n.depth[o]=0):t[o*2+1]=0;for(;n.heap_len<2;)c=n.heap[++n.heap_len]=l<2?++l:0,t[c*2]=1,n.depth[c]=0,n.opt_len--,r&&(n.static_len-=i[c*2+1]);for(e.max_code=l,o=n.heap_len>>1;o>=1;o--)d0(n,t,o);c=s;do o=n.heap[1],n.heap[1]=n.heap[n.heap_len--],d0(n,t,1),a=n.heap[1],n.heap[--n.heap_max]=o,n.heap[--n.heap_max]=a,t[c*2]=t[o*2]+t[a*2],n.depth[c]=(n.depth[o]>=n.depth[a]?n.depth[o]:n.depth[a])+1,t[o*2+1]=t[a*2+1]=c,n.heap[1]=c++,d0(n,t,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],e3(n,e),FS(t,l,n.bl_count)},GS=(n,e,t)=>{let i,r=-1,s,o=e[0*2+1],a=0,l=7,c=4;for(o===0&&(l=138,c=3),e[(t+1)*2+1]=65535,i=0;i<=t;i++)s=o,o=e[(i+1)*2+1],!(++a<l&&s===o)&&(a<c?n.bl_tree[s*2]+=a:s!==0?(s!==r&&n.bl_tree[s*2]++,n.bl_tree[CS*2]++):a<=10?n.bl_tree[IS*2]++:n.bl_tree[PS*2]++,a=0,r=s,o===0?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4))},VS=(n,e,t)=>{let i,r=-1,s,o=e[0*2+1],a=0,l=7,c=4;for(o===0&&(l=138,c=3),i=0;i<=t;i++)if(s=o,o=e[(i+1)*2+1],!(++a<l&&s===o)){if(a<c)do as(n,s,n.bl_tree);while(--a!==0);else s!==0?(s!==r&&(as(n,s,n.bl_tree),a--),as(n,CS,n.bl_tree),nr(n,a-3,2)):a<=10?(as(n,IS,n.bl_tree),nr(n,a-3,3)):(as(n,PS,n.bl_tree),nr(n,a-11,7));a=0,r=s,o===0?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4)}},i3=n=>{let e;for(GS(n,n.dyn_ltree,n.l_desc.max_code),GS(n,n.dyn_dtree,n.d_desc.max_code),p0(n,n.bl_desc),e=o0-1;e>=3&&n.bl_tree[RS[e]*2+1]===0;e--);return n.opt_len+=3*(e+1)+5+5+4,e},n3=(n,e,t,i)=>{let r;for(nr(n,e-257,5),nr(n,t-1,5),nr(n,i-4,4),r=0;r<i;r++)nr(n,n.bl_tree[RS[r]*2+1],3);VS(n,n.dyn_ltree,e-1),VS(n,n.dyn_dtree,t-1)},r3=n=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&n.dyn_ltree[t*2]!==0)return ES;if(n.dyn_ltree[9*2]!==0||n.dyn_ltree[10*2]!==0||n.dyn_ltree[13*2]!==0)return TS;for(t=32;t<Bh;t++)if(n.dyn_ltree[t*2]!==0)return TS;return ES};let WS=!1;const s3=n=>{WS||(t3(),WS=!0),n.l_desc=new f0(n.dyn_ltree,DS),n.d_desc=new f0(n.dyn_dtree,LS),n.bl_desc=new f0(n.bl_tree,OS),n.bi_buf=0,n.bi_valid=0,US(n)},XS=(n,e,t,i)=>{nr(n,(YN<<1)+(i?1:0),3),kS(n),Hh(n,t),Hh(n,~t),t&&n.pending_buf.set(n.window.subarray(e,e+t),n.pending),n.pending+=t},o3=n=>{nr(n,AS<<1,3),as(n,l0,Vs),JN(n)},a3=(n,e,t,i)=>{let r,s,o=0;n.level>0?(n.strm.data_type===XN&&(n.strm.data_type=r3(n)),p0(n,n.l_desc),p0(n,n.d_desc),o=i3(n),r=n.opt_len+3+7>>>3,s=n.static_len+3+7>>>3,s<=r&&(r=s)):r=s=t+5,t+4<=r&&e!==-1?XS(n,e,t,i):n.strategy===WN||s===r?(nr(n,(AS<<1)+(i?1:0),3),HS(n,Vs,Uh)):(nr(n,(jN<<1)+(i?1:0),3),n3(n,n.l_desc.max_code+1,n.d_desc.max_code+1,o+1),HS(n,n.dyn_ltree,n.dyn_dtree)),US(n),i&&kS(n)},l3=(n,e,t)=>(n.pending_buf[n.sym_buf+n.sym_next++]=e,n.pending_buf[n.sym_buf+n.sym_next++]=e>>8,n.pending_buf[n.sym_buf+n.sym_next++]=t,e===0?n.dyn_ltree[t*2]++:(n.matches++,e--,n.dyn_ltree[(zh[t]+Bh+1)*2]++,n.dyn_dtree[NS(e)*2]++),n.sym_next===n.sym_end);var c3=s3,h3=XS,u3=a3,f3=l3,d3=o3,p3={_tr_init:c3,_tr_stored_block:h3,_tr_flush_block:u3,_tr_tally:f3,_tr_align:d3},Gh=(n,e,t,i)=>{let r=n&65535|0,s=n>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do r=r+e[i++]|0,s=s+r|0;while(--o);r%=65521,s%=65521}return r|s<<16|0};const m3=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},g3=new Uint32Array(m3());var an=(n,e,t,i)=>{const r=g3,s=i+t;n^=-1;for(let o=i;o<s;o++)n=n>>>8^r[(n^e[o])&255];return n^-1},Oa={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Na={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:_3,_tr_stored_block:m0,_tr_flush_block:v3,_tr_tally:bo,_tr_align:y3}=p3,{Z_NO_FLUSH:xo,Z_PARTIAL_FLUSH:b3,Z_FULL_FLUSH:x3,Z_FINISH:Ar,Z_BLOCK:YS,Z_OK:fn,Z_STREAM_END:jS,Z_STREAM_ERROR:ls,Z_DATA_ERROR:w3,Z_BUF_ERROR:g0,Z_DEFAULT_COMPRESSION:S3,Z_FILTERED:E3,Z_HUFFMAN_ONLY:lp,Z_RLE:T3,Z_FIXED:A3,Z_DEFAULT_STRATEGY:M3,Z_UNKNOWN:C3,Z_DEFLATED:cp}=Na,I3=9,P3=15,R3=8,D3=29,_0=256+1+D3,L3=30,O3=19,N3=2*_0+1,B3=15,Kt=3,wo=258,cs=wo+Kt+1,F3=32,$l=42,v0=57,y0=69,b0=73,x0=91,w0=103,Ba=113,Vh=666,Wn=1,Jl=2,Fa=3,ec=4,U3=3,Ua=(n,e)=>(n.msg=Oa[e],e),qS=n=>n*2-(n>4?9:0),So=n=>{let e=n.length;for(;--e>=0;)n[e]=0},k3=n=>{let e,t,i,r=n.w_size;e=n.hash_size,i=e;do t=n.head[--i],n.head[i]=t>=r?t-r:0;while(--e);e=r,i=e;do t=n.prev[--i],n.prev[i]=t>=r?t-r:0;while(--e)};let Eo=(n,e,t)=>(e<<n.hash_shift^t)&n.hash_mask;const dr=n=>{const e=n.state;let t=e.pending;t>n.avail_out&&(t=n.avail_out),t!==0&&(n.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),n.next_out),n.next_out+=t,e.pending_out+=t,n.total_out+=t,n.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},pr=(n,e)=>{v3(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,e),n.block_start=n.strstart,dr(n.strm)},ai=(n,e)=>{n.pending_buf[n.pending++]=e},Wh=(n,e)=>{n.pending_buf[n.pending++]=e>>>8&255,n.pending_buf[n.pending++]=e&255},S0=(n,e,t,i)=>{let r=n.avail_in;return r>i&&(r=i),r===0?0:(n.avail_in-=r,e.set(n.input.subarray(n.next_in,n.next_in+r),t),n.state.wrap===1?n.adler=Gh(n.adler,e,r,t):n.state.wrap===2&&(n.adler=an(n.adler,e,r,t)),n.next_in+=r,n.total_in+=r,r)},ZS=(n,e)=>{let t=n.max_chain_length,i=n.strstart,r,s,o=n.prev_length,a=n.nice_match;const l=n.strstart>n.w_size-cs?n.strstart-(n.w_size-cs):0,c=n.window,u=n.w_mask,d=n.prev,p=n.strstart+wo;let g=c[i+o-1],_=c[i+o];n.prev_length>=n.good_match&&(t>>=2),a>n.lookahead&&(a=n.lookahead);do if(r=e,!(c[r+o]!==_||c[r+o-1]!==g||c[r]!==c[i]||c[++r]!==c[i+1])){i+=2,r++;do;while(c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&i<p);if(s=wo-(p-i),i=p-wo,s>o){if(n.match_start=e,o=s,s>=a)break;g=c[i+o-1],_=c[i+o]}}while((e=d[e&u])>l&&--t!==0);return o<=n.lookahead?o:n.lookahead},tc=n=>{const e=n.w_size;let t,i,r;do{if(i=n.window_size-n.lookahead-n.strstart,n.strstart>=e+(e-cs)&&(n.window.set(n.window.subarray(e,e+e-i),0),n.match_start-=e,n.strstart-=e,n.block_start-=e,n.insert>n.strstart&&(n.insert=n.strstart),k3(n),i+=e),n.strm.avail_in===0)break;if(t=S0(n.strm,n.window,n.strstart+n.lookahead,i),n.lookahead+=t,n.lookahead+n.insert>=Kt)for(r=n.strstart-n.insert,n.ins_h=n.window[r],n.ins_h=Eo(n,n.ins_h,n.window[r+1]);n.insert&&(n.ins_h=Eo(n,n.ins_h,n.window[r+Kt-1]),n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++,n.insert--,!(n.lookahead+n.insert<Kt)););}while(n.lookahead<cs&&n.strm.avail_in!==0)},KS=(n,e)=>{let t=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,i,r,s,o=0,a=n.strm.avail_in;do{if(i=65535,s=n.bi_valid+42>>3,n.strm.avail_out<s||(s=n.strm.avail_out-s,r=n.strstart-n.block_start,i>r+n.strm.avail_in&&(i=r+n.strm.avail_in),i>s&&(i=s),i<t&&(i===0&&e!==Ar||e===xo||i!==r+n.strm.avail_in)))break;o=e===Ar&&i===r+n.strm.avail_in?1:0,m0(n,0,0,o),n.pending_buf[n.pending-4]=i,n.pending_buf[n.pending-3]=i>>8,n.pending_buf[n.pending-2]=~i,n.pending_buf[n.pending-1]=~i>>8,dr(n.strm),r&&(r>i&&(r=i),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+r),n.strm.next_out),n.strm.next_out+=r,n.strm.avail_out-=r,n.strm.total_out+=r,n.block_start+=r,i-=r),i&&(S0(n.strm,n.strm.output,n.strm.next_out,i),n.strm.next_out+=i,n.strm.avail_out-=i,n.strm.total_out+=i)}while(o===0);return a-=n.strm.avail_in,a&&(a>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=a&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-a,n.strm.next_in),n.strstart),n.strstart+=a,n.insert+=a>n.w_size-n.insert?n.w_size-n.insert:a),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),o?ec:e!==xo&&e!==Ar&&n.strm.avail_in===0&&n.strstart===n.block_start?Jl:(s=n.window_size-n.strstart,n.strm.avail_in>s&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,s+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),s>n.strm.avail_in&&(s=n.strm.avail_in),s&&(S0(n.strm,n.window,n.strstart,s),n.strstart+=s,n.insert+=s>n.w_size-n.insert?n.w_size-n.insert:s),n.high_water<n.strstart&&(n.high_water=n.strstart),s=n.bi_valid+42>>3,s=n.pending_buf_size-s>65535?65535:n.pending_buf_size-s,t=s>n.w_size?n.w_size:s,r=n.strstart-n.block_start,(r>=t||(r||e===Ar)&&e!==xo&&n.strm.avail_in===0&&r<=s)&&(i=r>s?s:r,o=e===Ar&&n.strm.avail_in===0&&i===r?1:0,m0(n,n.block_start,i,o),n.block_start+=i,dr(n.strm)),o?Fa:Wn)},E0=(n,e)=>{let t,i;for(;;){if(n.lookahead<cs){if(tc(n),n.lookahead<cs&&e===xo)return Wn;if(n.lookahead===0)break}if(t=0,n.lookahead>=Kt&&(n.ins_h=Eo(n,n.ins_h,n.window[n.strstart+Kt-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),t!==0&&n.strstart-t<=n.w_size-cs&&(n.match_length=ZS(n,t)),n.match_length>=Kt)if(i=bo(n,n.strstart-n.match_start,n.match_length-Kt),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=Kt){n.match_length--;do n.strstart++,n.ins_h=Eo(n,n.ins_h,n.window[n.strstart+Kt-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!==0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=Eo(n,n.ins_h,n.window[n.strstart+1]);else i=bo(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(i&&(pr(n,!1),n.strm.avail_out===0))return Wn}return n.insert=n.strstart<Kt-1?n.strstart:Kt-1,e===Ar?(pr(n,!0),n.strm.avail_out===0?Fa:ec):n.sym_next&&(pr(n,!1),n.strm.avail_out===0)?Wn:Jl},ic=(n,e)=>{let t,i,r;for(;;){if(n.lookahead<cs){if(tc(n),n.lookahead<cs&&e===xo)return Wn;if(n.lookahead===0)break}if(t=0,n.lookahead>=Kt&&(n.ins_h=Eo(n,n.ins_h,n.window[n.strstart+Kt-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=Kt-1,t!==0&&n.prev_length<n.max_lazy_match&&n.strstart-t<=n.w_size-cs&&(n.match_length=ZS(n,t),n.match_length<=5&&(n.strategy===E3||n.match_length===Kt&&n.strstart-n.match_start>4096)&&(n.match_length=Kt-1)),n.prev_length>=Kt&&n.match_length<=n.prev_length){r=n.strstart+n.lookahead-Kt,i=bo(n,n.strstart-1-n.prev_match,n.prev_length-Kt),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=r&&(n.ins_h=Eo(n,n.ins_h,n.window[n.strstart+Kt-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!==0);if(n.match_available=0,n.match_length=Kt-1,n.strstart++,i&&(pr(n,!1),n.strm.avail_out===0))return Wn}else if(n.match_available){if(i=bo(n,0,n.window[n.strstart-1]),i&&pr(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return Wn}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(i=bo(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<Kt-1?n.strstart:Kt-1,e===Ar?(pr(n,!0),n.strm.avail_out===0?Fa:ec):n.sym_next&&(pr(n,!1),n.strm.avail_out===0)?Wn:Jl},z3=(n,e)=>{let t,i,r,s;const o=n.window;for(;;){if(n.lookahead<=wo){if(tc(n),n.lookahead<=wo&&e===xo)return Wn;if(n.lookahead===0)break}if(n.match_length=0,n.lookahead>=Kt&&n.strstart>0&&(r=n.strstart-1,i=o[r],i===o[++r]&&i===o[++r]&&i===o[++r])){s=n.strstart+wo;do;while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<s);n.match_length=wo-(s-r),n.match_length>n.lookahead&&(n.match_length=n.lookahead)}if(n.match_length>=Kt?(t=bo(n,1,n.match_length-Kt),n.lookahead-=n.match_length,n.strstart+=n.match_length,n.match_length=0):(t=bo(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++),t&&(pr(n,!1),n.strm.avail_out===0))return Wn}return n.insert=0,e===Ar?(pr(n,!0),n.strm.avail_out===0?Fa:ec):n.sym_next&&(pr(n,!1),n.strm.avail_out===0)?Wn:Jl},H3=(n,e)=>{let t;for(;;){if(n.lookahead===0&&(tc(n),n.lookahead===0)){if(e===xo)return Wn;break}if(n.match_length=0,t=bo(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++,t&&(pr(n,!1),n.strm.avail_out===0))return Wn}return n.insert=0,e===Ar?(pr(n,!0),n.strm.avail_out===0?Fa:ec):n.sym_next&&(pr(n,!1),n.strm.avail_out===0)?Wn:Jl};function hs(n,e,t,i,r){this.good_length=n,this.max_lazy=e,this.nice_length=t,this.max_chain=i,this.func=r}const Xh=[new hs(0,0,0,0,KS),new hs(4,4,8,4,E0),new hs(4,5,16,8,E0),new hs(4,6,32,32,E0),new hs(4,4,16,16,ic),new hs(8,16,32,32,ic),new hs(8,16,128,128,ic),new hs(8,32,128,256,ic),new hs(32,128,258,1024,ic),new hs(32,258,258,4096,ic)],G3=n=>{n.window_size=2*n.w_size,So(n.head),n.max_lazy_match=Xh[n.level].max_lazy,n.good_match=Xh[n.level].good_length,n.nice_match=Xh[n.level].nice_length,n.max_chain_length=Xh[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=Kt-1,n.match_available=0,n.ins_h=0};function V3(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=cp,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(N3*2),this.dyn_dtree=new Uint16Array((2*L3+1)*2),this.bl_tree=new Uint16Array((2*O3+1)*2),So(this.dyn_ltree),So(this.dyn_dtree),So(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(B3+1),this.heap=new Uint16Array(2*_0+1),So(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*_0+1),So(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Yh=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.status!==$l&&e.status!==v0&&e.status!==y0&&e.status!==b0&&e.status!==x0&&e.status!==w0&&e.status!==Ba&&e.status!==Vh?1:0},QS=n=>{if(Yh(n))return Ua(n,ls);n.total_in=n.total_out=0,n.data_type=C3;const e=n.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?v0:e.wrap?$l:Ba,n.adler=e.wrap===2?0:1,e.last_flush=-2,_3(e),fn},$S=n=>{const e=QS(n);return e===fn&&G3(n.state),e},W3=(n,e)=>Yh(n)||n.state.wrap!==2?ls:(n.state.gzhead=e,fn),JS=(n,e,t,i,r,s)=>{if(!n)return ls;let o=1;if(e===S3&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>I3||t!==cp||i<8||i>15||e<0||e>9||s<0||s>A3||i===8&&o!==1)return Ua(n,ls);i===8&&(i=9);const a=new V3;return n.state=a,a.strm=n,a.status=$l,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Kt-1)/Kt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=t,$S(n)},X3=(n,e)=>JS(n,e,cp,P3,R3,M3),Y3=(n,e)=>{if(Yh(n)||e>YS||e<0)return n?Ua(n,ls):ls;const t=n.state;if(!n.output||n.avail_in!==0&&!n.input||t.status===Vh&&e!==Ar)return Ua(n,n.avail_out===0?g0:ls);const i=t.last_flush;if(t.last_flush=e,t.pending!==0){if(dr(n),n.avail_out===0)return t.last_flush=-1,fn}else if(n.avail_in===0&&qS(e)<=qS(i)&&e!==Ar)return Ua(n,g0);if(t.status===Vh&&n.avail_in!==0)return Ua(n,g0);if(t.status===$l&&t.wrap===0&&(t.status=Ba),t.status===$l){let r=cp+(t.w_bits-8<<4)<<8,s=-1;if(t.strategy>=lp||t.level<2?s=0:t.level<6?s=1:t.level===6?s=2:s=3,r|=s<<6,t.strstart!==0&&(r|=F3),r+=31-r%31,Wh(t,r),t.strstart!==0&&(Wh(t,n.adler>>>16),Wh(t,n.adler&65535)),n.adler=1,t.status=Ba,dr(n),t.pending!==0)return t.last_flush=-1,fn}if(t.status===v0){if(n.adler=0,ai(t,31),ai(t,139),ai(t,8),t.gzhead)ai(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),ai(t,t.gzhead.time&255),ai(t,t.gzhead.time>>8&255),ai(t,t.gzhead.time>>16&255),ai(t,t.gzhead.time>>24&255),ai(t,t.level===9?2:t.strategy>=lp||t.level<2?4:0),ai(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(ai(t,t.gzhead.extra.length&255),ai(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(n.adler=an(n.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=y0;else if(ai(t,0),ai(t,0),ai(t,0),ai(t,0),ai(t,0),ai(t,t.level===9?2:t.strategy>=lp||t.level<2?4:0),ai(t,U3),t.status=Ba,dr(n),t.pending!==0)return t.last_flush=-1,fn}if(t.status===y0){if(t.gzhead.extra){let r=t.pending,s=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+s>t.pending_buf_size;){let a=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>r&&(n.adler=an(n.adler,t.pending_buf,t.pending-r,r)),t.gzindex+=a,dr(n),t.pending!==0)return t.last_flush=-1,fn;r=0,s-=a}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending+=s,t.gzhead.hcrc&&t.pending>r&&(n.adler=an(n.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=b0}if(t.status===b0){if(t.gzhead.name){let r=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(n.adler=an(n.adler,t.pending_buf,t.pending-r,r)),dr(n),t.pending!==0)return t.last_flush=-1,fn;r=0}t.gzindex<t.gzhead.name.length?s=t.gzhead.name.charCodeAt(t.gzindex++)&255:s=0,ai(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>r&&(n.adler=an(n.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=x0}if(t.status===x0){if(t.gzhead.comment){let r=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(n.adler=an(n.adler,t.pending_buf,t.pending-r,r)),dr(n),t.pending!==0)return t.last_flush=-1,fn;r=0}t.gzindex<t.gzhead.comment.length?s=t.gzhead.comment.charCodeAt(t.gzindex++)&255:s=0,ai(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>r&&(n.adler=an(n.adler,t.pending_buf,t.pending-r,r))}t.status=w0}if(t.status===w0){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(dr(n),t.pending!==0))return t.last_flush=-1,fn;ai(t,n.adler&255),ai(t,n.adler>>8&255),n.adler=0}if(t.status=Ba,dr(n),t.pending!==0)return t.last_flush=-1,fn}if(n.avail_in!==0||t.lookahead!==0||e!==xo&&t.status!==Vh){let r=t.level===0?KS(t,e):t.strategy===lp?H3(t,e):t.strategy===T3?z3(t,e):Xh[t.level].func(t,e);if((r===Fa||r===ec)&&(t.status=Vh),r===Wn||r===Fa)return n.avail_out===0&&(t.last_flush=-1),fn;if(r===Jl&&(e===b3?y3(t):e!==YS&&(m0(t,0,0,!1),e===x3&&(So(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),dr(n),n.avail_out===0))return t.last_flush=-1,fn}return e!==Ar?fn:t.wrap<=0?jS:(t.wrap===2?(ai(t,n.adler&255),ai(t,n.adler>>8&255),ai(t,n.adler>>16&255),ai(t,n.adler>>24&255),ai(t,n.total_in&255),ai(t,n.total_in>>8&255),ai(t,n.total_in>>16&255),ai(t,n.total_in>>24&255)):(Wh(t,n.adler>>>16),Wh(t,n.adler&65535)),dr(n),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?fn:jS)},j3=n=>{if(Yh(n))return ls;const e=n.state.status;return n.state=null,e===Ba?Ua(n,w3):fn},q3=(n,e)=>{let t=e.length;if(Yh(n))return ls;const i=n.state,r=i.wrap;if(r===2||r===1&&i.status!==$l||i.lookahead)return ls;if(r===1&&(n.adler=Gh(n.adler,e,t,0)),i.wrap=0,t>=i.w_size){r===0&&(So(i.head),i.strstart=0,i.block_start=0,i.insert=0);let l=new Uint8Array(i.w_size);l.set(e.subarray(t-i.w_size,t),0),e=l,t=i.w_size}const s=n.avail_in,o=n.next_in,a=n.input;for(n.avail_in=t,n.next_in=0,n.input=e,tc(i);i.lookahead>=Kt;){let l=i.strstart,c=i.lookahead-(Kt-1);do i.ins_h=Eo(i,i.ins_h,i.window[l+Kt-1]),i.prev[l&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=l,l++;while(--c);i.strstart=l,i.lookahead=Kt-1,tc(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=Kt-1,i.match_available=0,n.next_in=o,n.input=a,n.avail_in=s,i.wrap=r,fn};var Z3=X3,K3=JS,Q3=$S,$3=QS,J3=W3,eB=Y3,tB=j3,iB=q3,nB="pako deflate (from Nodeca project)",jh={deflateInit:Z3,deflateInit2:K3,deflateReset:Q3,deflateResetKeep:$3,deflateSetHeader:J3,deflate:eB,deflateEnd:tB,deflateSetDictionary:iB,deflateInfo:nB};const rB=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var sB=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)rB(t,i)&&(n[i]=t[i])}}return n},oB=n=>{let e=0;for(let i=0,r=n.length;i<r;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,r=0,s=n.length;i<s;i++){let o=n[i];t.set(o,r),r+=o.length}return t},hp={assign:sB,flattenChunks:oB};let eE=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{eE=!1}const qh=new Uint8Array(256);for(let n=0;n<256;n++)qh[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;qh[254]=qh[254]=1;var aB=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,r,s,o=n.length,a=0;for(r=0;r<o;r++)t=n.charCodeAt(r),(t&64512)===55296&&r+1<o&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,r=0;s<a;r++)t=n.charCodeAt(r),(t&64512)===55296&&r+1<o&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e};const lB=(n,e)=>{if(e<65534&&n.subarray&&eE)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(n[i]);return t};var cB=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,r;const s=new Array(t*2);for(r=0,i=0;i<t;){let o=n[i++];if(o<128){s[r++]=o;continue}let a=qh[o];if(a>4){s[r++]=65533,i+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&i<t;)o=o<<6|n[i++]&63,a--;if(a>1){s[r++]=65533;continue}o<65536?s[r++]=o:(o-=65536,s[r++]=55296|o>>10&1023,s[r++]=56320|o&1023)}return lB(s,r)},hB=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+qh[n[t]]>e?t:e},Zh={string2buf:aB,buf2string:cB,utf8border:hB};function uB(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var tE=uB;const iE=Object.prototype.toString,{Z_NO_FLUSH:fB,Z_SYNC_FLUSH:dB,Z_FULL_FLUSH:pB,Z_FINISH:mB,Z_OK:up,Z_STREAM_END:gB,Z_DEFAULT_COMPRESSION:_B,Z_DEFAULT_STRATEGY:vB,Z_DEFLATED:yB}=Na;function Kh(n){this.options=hp.assign({level:_B,method:yB,chunkSize:16384,windowBits:15,memLevel:8,strategy:vB},n||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tE,this.strm.avail_out=0;let t=jh.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==up)throw new Error(Oa[t]);if(e.header&&jh.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(typeof e.dictionary=="string"?i=Zh.string2buf(e.dictionary):iE.call(e.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(e.dictionary):i=e.dictionary,t=jh.deflateSetDictionary(this.strm,i),t!==up)throw new Error(Oa[t]);this._dict_set=!0}}Kh.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?mB:fB,typeof n=="string"?t.input=Zh.string2buf(n):iE.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(s===dB||s===pB)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(r=jh.deflate(t,s),r===gB)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),r=jh.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===up;if(t.avail_out===0){this.onData(t.output);continue}if(s>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0},Kh.prototype.onData=function(n){this.chunks.push(n)},Kh.prototype.onEnd=function(n){n===up&&(this.result=hp.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function T0(n,e){const t=new Kh(e);if(t.push(n,!0),t.err)throw t.msg||Oa[t.err];return t.result}function bB(n,e){return e=e||{},e.raw=!0,T0(n,e)}function xB(n,e){return e=e||{},e.gzip=!0,T0(n,e)}var wB=Kh,SB=T0,EB=bB,TB=xB,AB=Na,MB={Deflate:wB,deflate:SB,deflateRaw:EB,gzip:TB,constants:AB};const fp=16209,CB=16191;var IB=function(e,t){let i,r,s,o,a,l,c,u,d,p,g,_,x,b,y,M,E,w,I,B,N,L,P,R;const U=e.state;i=e.next_in,P=e.input,r=i+(e.avail_in-5),s=e.next_out,R=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),l=U.dmax,c=U.wsize,u=U.whave,d=U.wnext,p=U.window,g=U.hold,_=U.bits,x=U.lencode,b=U.distcode,y=(1<<U.lenbits)-1,M=(1<<U.distbits)-1;e:do{_<15&&(g+=P[i++]<<_,_+=8,g+=P[i++]<<_,_+=8),E=x[g&y];t:for(;;){if(w=E>>>24,g>>>=w,_-=w,w=E>>>16&255,w===0)R[s++]=E&65535;else if(w&16){I=E&65535,w&=15,w&&(_<w&&(g+=P[i++]<<_,_+=8),I+=g&(1<<w)-1,g>>>=w,_-=w),_<15&&(g+=P[i++]<<_,_+=8,g+=P[i++]<<_,_+=8),E=b[g&M];i:for(;;){if(w=E>>>24,g>>>=w,_-=w,w=E>>>16&255,w&16){if(B=E&65535,w&=15,_<w&&(g+=P[i++]<<_,_+=8,_<w&&(g+=P[i++]<<_,_+=8)),B+=g&(1<<w)-1,B>l){e.msg="invalid distance too far back",U.mode=fp;break e}if(g>>>=w,_-=w,w=s-o,B>w){if(w=B-w,w>u&&U.sane){e.msg="invalid distance too far back",U.mode=fp;break e}if(N=0,L=p,d===0){if(N+=c-w,w<I){I-=w;do R[s++]=p[N++];while(--w);N=s-B,L=R}}else if(d<w){if(N+=c+d-w,w-=d,w<I){I-=w;do R[s++]=p[N++];while(--w);if(N=0,d<I){w=d,I-=w;do R[s++]=p[N++];while(--w);N=s-B,L=R}}}else if(N+=d-w,w<I){I-=w;do R[s++]=p[N++];while(--w);N=s-B,L=R}for(;I>2;)R[s++]=L[N++],R[s++]=L[N++],R[s++]=L[N++],I-=3;I&&(R[s++]=L[N++],I>1&&(R[s++]=L[N++]))}else{N=s-B;do R[s++]=R[N++],R[s++]=R[N++],R[s++]=R[N++],I-=3;while(I>2);I&&(R[s++]=R[N++],I>1&&(R[s++]=R[N++]))}}else if(w&64){e.msg="invalid distance code",U.mode=fp;break e}else{E=b[(E&65535)+(g&(1<<w)-1)];continue i}break}}else if(w&64)if(w&32){U.mode=CB;break e}else{e.msg="invalid literal/length code",U.mode=fp;break e}else{E=x[(E&65535)+(g&(1<<w)-1)];continue t}break}}while(i<r&&s<a);I=_>>3,i-=I,_-=I<<3,g&=(1<<_)-1,e.next_in=i,e.next_out=s,e.avail_in=i<r?5+(r-i):5-(i-r),e.avail_out=s<a?257+(a-s):257-(s-a),U.hold=g,U.bits=_};const nc=15,nE=852,rE=592,sE=0,A0=1,oE=2,PB=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),RB=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),DB=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),LB=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Qh=(n,e,t,i,r,s,o,a)=>{const l=a.bits;let c=0,u=0,d=0,p=0,g=0,_=0,x=0,b=0,y=0,M=0,E,w,I,B,N,L=null,P;const R=new Uint16Array(nc+1),U=new Uint16Array(nc+1);let j=null,A,D,k;for(c=0;c<=nc;c++)R[c]=0;for(u=0;u<i;u++)R[e[t+u]]++;for(g=l,p=nc;p>=1&&R[p]===0;p--);if(g>p&&(g=p),p===0)return r[s++]=1<<24|64<<16|0,r[s++]=1<<24|64<<16|0,a.bits=1,0;for(d=1;d<p&&R[d]===0;d++);for(g<d&&(g=d),b=1,c=1;c<=nc;c++)if(b<<=1,b-=R[c],b<0)return-1;if(b>0&&(n===sE||p!==1))return-1;for(U[1]=0,c=1;c<nc;c++)U[c+1]=U[c]+R[c];for(u=0;u<i;u++)e[t+u]!==0&&(o[U[e[t+u]]++]=u);if(n===sE?(L=j=o,P=20):n===A0?(L=PB,j=RB,P=257):(L=DB,j=LB,P=0),M=0,u=0,c=d,N=s,_=g,x=0,I=-1,y=1<<g,B=y-1,n===A0&&y>nE||n===oE&&y>rE)return 1;for(;;){A=c-x,o[u]+1<P?(D=0,k=o[u]):o[u]>=P?(D=j[o[u]-P],k=L[o[u]-P]):(D=32+64,k=0),E=1<<c-x,w=1<<_,d=w;do w-=E,r[N+(M>>x)+w]=A<<24|D<<16|k|0;while(w!==0);for(E=1<<c-1;M&E;)E>>=1;if(E!==0?(M&=E-1,M+=E):M=0,u++,--R[c]===0){if(c===p)break;c=e[t+o[u]]}if(c>g&&(M&B)!==I){for(x===0&&(x=g),N+=d,_=c-x,b=1<<_;_+x<p&&(b-=R[_+x],!(b<=0));)_++,b<<=1;if(y+=1<<_,n===A0&&y>nE||n===oE&&y>rE)return 1;I=M&B,r[I]=g<<24|_<<16|N-s|0}}return M!==0&&(r[N+M]=c-x<<24|64<<16|0),a.bits=g,0};const OB=0,aE=1,lE=2,{Z_FINISH:cE,Z_BLOCK:NB,Z_TREES:dp,Z_OK:ka,Z_STREAM_END:BB,Z_NEED_DICT:FB,Z_STREAM_ERROR:Mr,Z_DATA_ERROR:hE,Z_MEM_ERROR:uE,Z_BUF_ERROR:UB,Z_DEFLATED:fE}=Na,pp=16180,dE=16181,pE=16182,mE=16183,gE=16184,_E=16185,vE=16186,yE=16187,bE=16188,xE=16189,mp=16190,Ws=16191,M0=16192,wE=16193,C0=16194,SE=16195,EE=16196,TE=16197,AE=16198,gp=16199,_p=16200,ME=16201,CE=16202,IE=16203,PE=16204,RE=16205,I0=16206,DE=16207,LE=16208,Ri=16209,OE=16210,NE=16211,kB=852,zB=592,HB=15,BE=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function GB(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const za=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<pp||e.mode>NE?1:0},FE=n=>{if(za(n))return Mr;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=pp,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(kB),e.distcode=e.distdyn=new Int32Array(zB),e.sane=1,e.back=-1,ka},UE=n=>{if(za(n))return Mr;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,FE(n)},kE=(n,e)=>{let t;if(za(n))return Mr;const i=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Mr:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,UE(n))},zE=(n,e)=>{if(!n)return Mr;const t=new GB;n.state=t,t.strm=n,t.window=null,t.mode=pp;const i=kE(n,e);return i!==ka&&(n.state=null),i},VB=n=>zE(n,HB);let HE=!0,P0,R0;const WB=n=>{if(HE){P0=new Int32Array(512),R0=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(Qh(aE,n.lens,0,288,P0,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;Qh(lE,n.lens,0,32,R0,0,n.work,{bits:5}),HE=!1}n.lencode=P0,n.lenbits=9,n.distcode=R0,n.distbits=5},GE=(n,e,t,i)=>{let r;const s=n.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(e.subarray(t-i,t-i+r),s.wnext),i-=r,i?(s.window.set(e.subarray(t-i,t),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0},XB=(n,e)=>{let t,i,r,s,o,a,l,c,u,d,p,g,_,x,b=0,y,M,E,w,I,B,N,L;const P=new Uint8Array(4);let R,U;const j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(za(n)||!n.output||!n.input&&n.avail_in!==0)return Mr;t=n.state,t.mode===Ws&&(t.mode=M0),o=n.next_out,r=n.output,l=n.avail_out,s=n.next_in,i=n.input,a=n.avail_in,c=t.hold,u=t.bits,d=a,p=l,L=ka;e:for(;;)switch(t.mode){case pp:if(t.wrap===0){t.mode=M0;break}for(;u<16;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(t.wrap&2&&c===35615){t.wbits===0&&(t.wbits=15),t.check=0,P[0]=c&255,P[1]=c>>>8&255,t.check=an(t.check,P,2,0),c=0,u=0,t.mode=dE;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((c&255)<<8)+(c>>8))%31){n.msg="incorrect header check",t.mode=Ri;break}if((c&15)!==fE){n.msg="unknown compression method",t.mode=Ri;break}if(c>>>=4,u-=4,N=(c&15)+8,t.wbits===0&&(t.wbits=N),N>15||N>t.wbits){n.msg="invalid window size",t.mode=Ri;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=c&512?xE:Ws,c=0,u=0;break;case dE:for(;u<16;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(t.flags=c,(t.flags&255)!==fE){n.msg="unknown compression method",t.mode=Ri;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=Ri;break}t.head&&(t.head.text=c>>8&1),t.flags&512&&t.wrap&4&&(P[0]=c&255,P[1]=c>>>8&255,t.check=an(t.check,P,2,0)),c=0,u=0,t.mode=pE;case pE:for(;u<32;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}t.head&&(t.head.time=c),t.flags&512&&t.wrap&4&&(P[0]=c&255,P[1]=c>>>8&255,P[2]=c>>>16&255,P[3]=c>>>24&255,t.check=an(t.check,P,4,0)),c=0,u=0,t.mode=mE;case mE:for(;u<16;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}t.head&&(t.head.xflags=c&255,t.head.os=c>>8),t.flags&512&&t.wrap&4&&(P[0]=c&255,P[1]=c>>>8&255,t.check=an(t.check,P,2,0)),c=0,u=0,t.mode=gE;case gE:if(t.flags&1024){for(;u<16;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}t.length=c,t.head&&(t.head.extra_len=c),t.flags&512&&t.wrap&4&&(P[0]=c&255,P[1]=c>>>8&255,t.check=an(t.check,P,2,0)),c=0,u=0}else t.head&&(t.head.extra=null);t.mode=_E;case _E:if(t.flags&1024&&(g=t.length,g>a&&(g=a),g&&(t.head&&(N=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(s,s+g),N)),t.flags&512&&t.wrap&4&&(t.check=an(t.check,i,g,s)),a-=g,s+=g,t.length-=g),t.length))break e;t.length=0,t.mode=vE;case vE:if(t.flags&2048){if(a===0)break e;g=0;do N=i[s+g++],t.head&&N&&t.length<65536&&(t.head.name+=String.fromCharCode(N));while(N&&g<a);if(t.flags&512&&t.wrap&4&&(t.check=an(t.check,i,g,s)),a-=g,s+=g,N)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=yE;case yE:if(t.flags&4096){if(a===0)break e;g=0;do N=i[s+g++],t.head&&N&&t.length<65536&&(t.head.comment+=String.fromCharCode(N));while(N&&g<a);if(t.flags&512&&t.wrap&4&&(t.check=an(t.check,i,g,s)),a-=g,s+=g,N)break e}else t.head&&(t.head.comment=null);t.mode=bE;case bE:if(t.flags&512){for(;u<16;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(t.wrap&4&&c!==(t.check&65535)){n.msg="header crc mismatch",t.mode=Ri;break}c=0,u=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=Ws;break;case xE:for(;u<32;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}n.adler=t.check=BE(c),c=0,u=0,t.mode=mp;case mp:if(t.havedict===0)return n.next_out=o,n.avail_out=l,n.next_in=s,n.avail_in=a,t.hold=c,t.bits=u,FB;n.adler=t.check=1,t.mode=Ws;case Ws:if(e===NB||e===dp)break e;case M0:if(t.last){c>>>=u&7,u-=u&7,t.mode=I0;break}for(;u<3;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}switch(t.last=c&1,c>>>=1,u-=1,c&3){case 0:t.mode=wE;break;case 1:if(WB(t),t.mode=gp,e===dp){c>>>=2,u-=2;break e}break;case 2:t.mode=EE;break;case 3:n.msg="invalid block type",t.mode=Ri}c>>>=2,u-=2;break;case wE:for(c>>>=u&7,u-=u&7;u<32;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if((c&65535)!==(c>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Ri;break}if(t.length=c&65535,c=0,u=0,t.mode=C0,e===dp)break e;case C0:t.mode=SE;case SE:if(g=t.length,g){if(g>a&&(g=a),g>l&&(g=l),g===0)break e;r.set(i.subarray(s,s+g),o),a-=g,s+=g,l-=g,o+=g,t.length-=g;break}t.mode=Ws;break;case EE:for(;u<14;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(t.nlen=(c&31)+257,c>>>=5,u-=5,t.ndist=(c&31)+1,c>>>=5,u-=5,t.ncode=(c&15)+4,c>>>=4,u-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Ri;break}t.have=0,t.mode=TE;case TE:for(;t.have<t.ncode;){for(;u<3;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}t.lens[j[t.have++]]=c&7,c>>>=3,u-=3}for(;t.have<19;)t.lens[j[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,R={bits:t.lenbits},L=Qh(OB,t.lens,0,19,t.lencode,0,t.work,R),t.lenbits=R.bits,L){n.msg="invalid code lengths set",t.mode=Ri;break}t.have=0,t.mode=AE;case AE:for(;t.have<t.nlen+t.ndist;){for(;b=t.lencode[c&(1<<t.lenbits)-1],y=b>>>24,M=b>>>16&255,E=b&65535,!(y<=u);){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(E<16)c>>>=y,u-=y,t.lens[t.have++]=E;else{if(E===16){for(U=y+2;u<U;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(c>>>=y,u-=y,t.have===0){n.msg="invalid bit length repeat",t.mode=Ri;break}N=t.lens[t.have-1],g=3+(c&3),c>>>=2,u-=2}else if(E===17){for(U=y+3;u<U;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}c>>>=y,u-=y,N=0,g=3+(c&7),c>>>=3,u-=3}else{for(U=y+7;u<U;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}c>>>=y,u-=y,N=0,g=11+(c&127),c>>>=7,u-=7}if(t.have+g>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Ri;break}for(;g--;)t.lens[t.have++]=N}}if(t.mode===Ri)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Ri;break}if(t.lenbits=9,R={bits:t.lenbits},L=Qh(aE,t.lens,0,t.nlen,t.lencode,0,t.work,R),t.lenbits=R.bits,L){n.msg="invalid literal/lengths set",t.mode=Ri;break}if(t.distbits=6,t.distcode=t.distdyn,R={bits:t.distbits},L=Qh(lE,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,R),t.distbits=R.bits,L){n.msg="invalid distances set",t.mode=Ri;break}if(t.mode=gp,e===dp)break e;case gp:t.mode=_p;case _p:if(a>=6&&l>=258){n.next_out=o,n.avail_out=l,n.next_in=s,n.avail_in=a,t.hold=c,t.bits=u,IB(n,p),o=n.next_out,r=n.output,l=n.avail_out,s=n.next_in,i=n.input,a=n.avail_in,c=t.hold,u=t.bits,t.mode===Ws&&(t.back=-1);break}for(t.back=0;b=t.lencode[c&(1<<t.lenbits)-1],y=b>>>24,M=b>>>16&255,E=b&65535,!(y<=u);){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(M&&!(M&240)){for(w=y,I=M,B=E;b=t.lencode[B+((c&(1<<w+I)-1)>>w)],y=b>>>24,M=b>>>16&255,E=b&65535,!(w+y<=u);){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}c>>>=w,u-=w,t.back+=w}if(c>>>=y,u-=y,t.back+=y,t.length=E,M===0){t.mode=RE;break}if(M&32){t.back=-1,t.mode=Ws;break}if(M&64){n.msg="invalid literal/length code",t.mode=Ri;break}t.extra=M&15,t.mode=ME;case ME:if(t.extra){for(U=t.extra;u<U;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,u-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=CE;case CE:for(;b=t.distcode[c&(1<<t.distbits)-1],y=b>>>24,M=b>>>16&255,E=b&65535,!(y<=u);){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(!(M&240)){for(w=y,I=M,B=E;b=t.distcode[B+((c&(1<<w+I)-1)>>w)],y=b>>>24,M=b>>>16&255,E=b&65535,!(w+y<=u);){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}c>>>=w,u-=w,t.back+=w}if(c>>>=y,u-=y,t.back+=y,M&64){n.msg="invalid distance code",t.mode=Ri;break}t.offset=E,t.extra=M&15,t.mode=IE;case IE:if(t.extra){for(U=t.extra;u<U;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,u-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Ri;break}t.mode=PE;case PE:if(l===0)break e;if(g=p-l,t.offset>g){if(g=t.offset-g,g>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Ri;break}g>t.wnext?(g-=t.wnext,_=t.wsize-g):_=t.wnext-g,g>t.length&&(g=t.length),x=t.window}else x=r,_=o-t.offset,g=t.length;g>l&&(g=l),l-=g,t.length-=g;do r[o++]=x[_++];while(--g);t.length===0&&(t.mode=_p);break;case RE:if(l===0)break e;r[o++]=t.length,l--,t.mode=_p;break;case I0:if(t.wrap){for(;u<32;){if(a===0)break e;a--,c|=i[s++]<<u,u+=8}if(p-=l,n.total_out+=p,t.total+=p,t.wrap&4&&p&&(n.adler=t.check=t.flags?an(t.check,r,p,o-p):Gh(t.check,r,p,o-p)),p=l,t.wrap&4&&(t.flags?c:BE(c))!==t.check){n.msg="incorrect data check",t.mode=Ri;break}c=0,u=0}t.mode=DE;case DE:if(t.wrap&&t.flags){for(;u<32;){if(a===0)break e;a--,c+=i[s++]<<u,u+=8}if(t.wrap&4&&c!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=Ri;break}c=0,u=0}t.mode=LE;case LE:L=BB;break e;case Ri:L=hE;break e;case OE:return uE;case NE:default:return Mr}return n.next_out=o,n.avail_out=l,n.next_in=s,n.avail_in=a,t.hold=c,t.bits=u,(t.wsize||p!==n.avail_out&&t.mode<Ri&&(t.mode<I0||e!==cE))&&GE(n,n.output,n.next_out,p-n.avail_out),d-=n.avail_in,p-=n.avail_out,n.total_in+=d,n.total_out+=p,t.total+=p,t.wrap&4&&p&&(n.adler=t.check=t.flags?an(t.check,r,p,n.next_out-p):Gh(t.check,r,p,n.next_out-p)),n.data_type=t.bits+(t.last?64:0)+(t.mode===Ws?128:0)+(t.mode===gp||t.mode===C0?256:0),(d===0&&p===0||e===cE)&&L===ka&&(L=UB),L},YB=n=>{if(za(n))return Mr;let e=n.state;return e.window&&(e.window=null),n.state=null,ka},jB=(n,e)=>{if(za(n))return Mr;const t=n.state;return t.wrap&2?(t.head=e,e.done=!1,ka):Mr},qB=(n,e)=>{const t=e.length;let i,r,s;return za(n)||(i=n.state,i.wrap!==0&&i.mode!==mp)?Mr:i.mode===mp&&(r=1,r=Gh(r,e,t,0),r!==i.check)?hE:(s=GE(n,e,t,t),s?(i.mode=OE,uE):(i.havedict=1,ka))};var ZB=UE,KB=kE,QB=FE,$B=VB,JB=zE,eF=XB,tF=YB,iF=jB,nF=qB,rF="pako inflate (from Nodeca project)",Xs={inflateReset:ZB,inflateReset2:KB,inflateResetKeep:QB,inflateInit:$B,inflateInit2:JB,inflate:eF,inflateEnd:tF,inflateGetHeader:iF,inflateSetDictionary:nF,inflateInfo:rF};function sF(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var oF=sF;const VE=Object.prototype.toString,{Z_NO_FLUSH:aF,Z_FINISH:lF,Z_OK:$h,Z_STREAM_END:D0,Z_NEED_DICT:L0,Z_STREAM_ERROR:cF,Z_DATA_ERROR:WE,Z_MEM_ERROR:hF}=Na;function Jh(n){this.options=hp.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tE,this.strm.avail_out=0;let t=Xs.inflateInit2(this.strm,e.windowBits);if(t!==$h)throw new Error(Oa[t]);if(this.header=new oF,Xs.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Zh.string2buf(e.dictionary):VE.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Xs.inflateSetDictionary(this.strm,e.dictionary),t!==$h)))throw new Error(Oa[t])}Jh.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?lF:aF,VE.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),s=Xs.inflate(t,o),s===L0&&r&&(s=Xs.inflateSetDictionary(t,r),s===$h?s=Xs.inflate(t,o):s===WE&&(s=L0));t.avail_in>0&&s===D0&&t.state.wrap>0&&n[t.next_in]!==0;)Xs.inflateReset(t),s=Xs.inflate(t,o);switch(s){case cF:case WE:case L0:case hF:return this.onEnd(s),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||s===D0))if(this.options.to==="string"){let l=Zh.utf8border(t.output,t.next_out),c=t.next_out-l,u=Zh.buf2string(t.output,l);t.next_out=c,t.avail_out=i-c,c&&t.output.set(t.output.subarray(l,l+c),0),this.onData(u)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===$h&&a===0)){if(s===D0)return s=Xs.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},Jh.prototype.onData=function(n){this.chunks.push(n)},Jh.prototype.onEnd=function(n){n===$h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=hp.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function O0(n,e){const t=new Jh(e);if(t.push(n),t.err)throw t.msg||Oa[t.err];return t.result}function uF(n,e){return e=e||{},e.raw=!0,O0(n,e)}var fF=Jh,dF=O0,pF=uF,mF=O0,gF=Na,_F={Inflate:fF,inflate:dF,inflateRaw:pF,ungzip:mF,constants:gF};const{Deflate:vF,deflate:yF,deflateRaw:bF,gzip:xF}=MB,{Inflate:wF,inflate:SF,inflateRaw:EF,ungzip:TF}=_F;var AF=vF,MF=yF,CF=bF,IF=xF,PF=wF,RF=SF,DF=EF,LF=TF,OF=Na,NF={Deflate:AF,deflate:MF,deflateRaw:CF,gzip:IF,Inflate:PF,inflate:RF,inflateRaw:DF,ungzip:LF,constants:OF};const BF={name:"v-engine-ts",version:"2.9.1",description:"",directories:{example:"examples"},scripts:{dev:"vite serve",build:"vite build","docs:dev":"vitepress dev docs","docs:build":"vitepress build docs","docs:preview":"vitepress preview docs","build:dts":"tsc && dts-bundle --name VEngine --main dist/index.d.ts --outFile dist/bundle.d.ts"},repository:{type:"git",url:"http://git.vanke.com/positive-design-platform/vk3d-web3d.git"},keywords:[],author:"",license:"ISC",type:"module",devDependencies:{"@tweakpane/core":"^2.0.0","@types/node":"^20.2.5","@types/three":"^0.170.0","dts-bundle":"^0.7.3",three:"^0.170.0",typescript:"^5.0.4",vconsole:"^3.15.1",vite:"^4.3.9","vite-plugin-css-injected-by-js":"^3.1.1",vitepress:"^1.0.0-rc.24"},dependencies:{"@doodle3d/clipper-js":"^1.0.11","@tweenjs/tween.js":"^25.0.0","@types/pako":"^2.0.0","@types/urijs":"^1.19.19","cordova-plugin-file":"^8.0.0","cordova-plugin-zip":"^3.1.0",hammerjs:"^2.0.8",knockout:"^3.5.1",localforage:"^1.10.0","mersenne-twister":"^1.1.0","monotone-convex-hull-2d":"^1.0.1",pako:"^2.1.0","polygon-clipping":"^0.15.7","rollup-plugin-copy":"^3.5.0",rxjs:"^7.8.1",tinykeys:"^2.1.0",tweakpane:"^4.0.1",tweenjs:"^1.0.2",urijs:"^1.19.11"}},Or=class Or{constructor(e={}){f(this,"position",!1);f(this,"normal",!1);f(this,"uv",!1);f(this,"bitangent",!1);f(this,"tangent",!1);f(this,"color",!1);const{position:t=!1,normal:i=!1,uv:r=!1,bitangent:s=!1,tangent:o=!1,color:a=!1}=e;this.position=t,this.normal=i,this.uv=r,this.bitangent=s,this.tangent=o,this.color=a}get st(){return this.uv}set st(e){this.st=e}static pack(e,t,i=0){return t[i++]=e.position?1:0,t[i++]=e.normal?1:0,t[i++]=e.st?1:0,t[i++]=e.tangent?1:0,t[i++]=e.bitangent?1:0,t[i]=e.color?1:0,t}static unpack(e,t=0,i=new Or){return i.position=e[t++]===1,i.normal=e[t++]===1,i.st=e[t++]===1,i.tangent=e[t++]===1,i.bitangent=e[t++]===1,i.color=e[t]===1,i}};f(Or,"POSITION_ONLY",Object.freeze(new Or({position:!0}))),f(Or,"POSITION_AND_NORMAL",Object.freeze(new Or({position:!0,normal:!0}))),f(Or,"packedLength",6),f(Or,"POSITION_NORMAL_AND_ST",Object.freeze(new Or({position:!0,normal:!0,uv:!0}))),f(Or,"DEFAULT",Or.POSITION_NORMAL_AND_ST);let eu=Or;class FF{constructor({width:e=1,height:t=1,depth:i=1,widthSegments:r=1,heightSegments:s=1,depthSegments:o=1}){f(this,"_instance");f(this,"_vertexFormat",eu.DEFAULT);f(this,"width");f(this,"height");f(this,"depth");f(this,"widthSegments");f(this,"heightSegments");f(this,"depthSegments");this.width=e,this.height=t,this.depth=i,this.widthSegments=r,this.heightSegments=s,this.depthSegments=o}static pack(e,t,i=0){const{width:r,height:s,depth:o,widthSegments:a,heightSegments:l,depthSegments:c}=e;return T.pack(new T(r,s,o),t,i),T.pack(new T(a,l,c),t,i+T.packedLength),eu.pack(e._vertexFormat,t,i+2*T.packedLength),t[i+2*T.packedLength+eu.packedLength]=-1,t}getObject(){return this._instance}createGeometry(){const{width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o}=this;return this._instance=new zr(e,t,i,r,s,o),this._instance}update(e){}isDestroyed(){return!1}destroy(){var e;return(e=this._instance)==null||e.dispose(),ht(this)}}var rc=(n=>(n.BOX="box",n.AXIS_X="axisX",n.AXIS_Y="axisY",n.AXIS_Z="axisZ",n))(rc||{});class Xn extends ve{constructor(e=0,t,i){super(e,t,i)}static fromArray(e){return new Xn(e[0],e[1],e[2])}static toArray(e,t=0,i=[]){return i[t]=e.r,i[t+1]=e.g,i[t+2]=e.b,i}static clone(e,t=new Xn){return t.r=e.r,t.g=e.g,t.b=e.b,t}static floatToByte(e){return e===1?255:e*256|0}}const bt={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047},xt={BYTE:bt.BYTE,UNSIGNED_BYTE:bt.UNSIGNED_BYTE,SHORT:bt.SHORT,UNSIGNED_SHORT:bt.UNSIGNED_SHORT,INT:bt.INT,UNSIGNED_INT:bt.UNSIGNED_INT,FLOAT:bt.FLOAT,DOUBLE:bt.DOUBLE,getSizeInBytes(n){switch(n){case xt.BYTE:return Int8Array.BYTES_PER_ELEMENT;case xt.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case xt.SHORT:return Int16Array.BYTES_PER_ELEMENT;case xt.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case xt.INT:return Int32Array.BYTES_PER_ELEMENT;case xt.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case xt.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case xt.DOUBLE:return Float64Array.BYTES_PER_ELEMENT;default:throw new Ze("componentDatatype is not a valid value.")}},createArrayBufferView(n,e,t,i){switch(t=ye(t,0),i=ye(i,(e.byteLength-t)/xt.getSizeInBytes(n)),n){case xt.BYTE:return new Int8Array(e,t,i);case xt.UNSIGNED_BYTE:return new Uint8Array(e,t,i);case xt.SHORT:return new Int16Array(e,t,i);case xt.UNSIGNED_SHORT:return new Uint16Array(e,t,i);case xt.INT:return new Int32Array(e,t,i);case xt.UNSIGNED_INT:return new Uint32Array(e,t,i);case xt.FLOAT:return new Float32Array(e,t,i);case xt.DOUBLE:return new Float64Array(e,t,i);default:throw new Ze("componentDatatype is not a valid value.")}},createTypedArray(n,e){switch(n){case xt.BYTE:return new Int8Array(e);case xt.UNSIGNED_BYTE:return new Uint8Array(e);case xt.SHORT:return new Int16Array(e);case xt.UNSIGNED_SHORT:return new Uint16Array(e);case xt.INT:return new Int32Array(e);case xt.UNSIGNED_INT:return new Uint32Array(e);case xt.FLOAT:return new Float32Array(e);case xt.DOUBLE:return new Float64Array(e);default:throw new Ze("componentDatatype is not a valid value.")}}};class sc{constructor(e=1,t=1,i=1,r=1){f(this,"value");f(this,"componentDatatype",xt.UNSIGNED_BYTE);f(this,"componentsPerAttribute",4);f(this,"normalize",!0);this.red=e,this.green=t,this.blue=i,this.alpha=r,this.value=new Uint8Array([Xn.floatToByte(e),Xn.floatToByte(t),Xn.floatToByte(i),Xn.floatToByte(r)])}static toValue(e,t){return O(t)?e.toBytes(t):new Uint8Array(e.toBytes())}static fromColor(e){return new sc(e.red,e.green,e.blue,e.alpha)}}class XE{constructor(e,t={}){f(this,"_instance");f(this,"depth",3);f(this,"_rayCasterGeometry");this.shape=e,this.depth=t.depth??this.depth}createGeometry(){return this._instance=new Rd(this.shape,{bevelEnabled:!1,depth:this.depth}),this.shape=null,this._instance}isDestroyed(){return!1}destroy(){throw new Error("Method not implemented.")}}let To;var ki={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0};const Cr={get element(){if(Cr.supportsFullscreen())return document[ki.fullscreenElement]},get changeEventName(){if(Cr.supportsFullscreen())return ki.fullscreenchange},get errorEventName(){if(Cr.supportsFullscreen())return ki.fullscreenerror},get enabled(){if(Cr.supportsFullscreen())return document[ki.fullscreenEnabled]},get fullscreen(){if(Cr.supportsFullscreen())return Cr.element!==null},supportsFullscreen:function(){if(O(To))return To;To=!1;var n=document.body;if(typeof n.requestFullscreen=="function")return ki.requestFullscreen="requestFullscreen",ki.exitFullscreen="exitFullscreen",ki.fullscreenEnabled="fullscreenEnabled",ki.fullscreenElement="fullscreenElement",ki.fullscreenchange="fullscreenchange",ki.fullscreenerror="fullscreenerror",To=!0,To;for(var e=["webkit","moz","o","ms","khtml"],t,i=0,r=e.length;i<r;++i){var s=e[i];t=s+"RequestFullscreen",typeof n[t]=="function"?(ki.requestFullscreen=t,To=!0):(t=s+"RequestFullScreen",typeof n[t]=="function"&&(ki.requestFullscreen=t,To=!0)),t=s+"ExitFullscreen",typeof document[t]=="function"?ki.exitFullscreen=t:(t=s+"CancelFullScreen",typeof document[t]=="function"&&(ki.exitFullscreen=t)),t=s+"FullscreenEnabled",document[t]!==void 0?ki.fullscreenEnabled=t:(t=s+"FullScreenEnabled",document[t]!==void 0&&(ki.fullscreenEnabled=t)),t=s+"FullscreenElement",document[t]!==void 0?ki.fullscreenElement=t:(t=s+"FullScreenElement",document[t]!==void 0&&(ki.fullscreenElement=t)),t=s+"fullscreenchange",document["on"+t]!==void 0&&(s==="ms"&&(t="MSFullscreenChange"),ki.fullscreenchange=t),t=s+"fullscreenerror",document["on"+t]!==void 0&&(s==="ms"&&(t="MSFullscreenError"),ki.fullscreenerror=t)}return To},requestFullscreen(n,e){Cr.supportsFullscreen()&&n[ki.requestFullscreen]({vrDisplay:e})},exitFullscreen(){Cr.supportsFullscreen()&&document[ki.exitFullscreen]()}};class N0{constructor(e){f(this,"geometry");f(this,"modelMatrix");f(this,"id");f(this,"attributes");f(this,"pickPrimitive");const{geometry:t,modelMatrix:i,id:r,attributes:s,pickPrimitive:o}=e;this.modelMatrix=fe.clone(i??new fe().identity()),this.geometry=t,this.id=r,!O(s)||Object.keys(s).length===0?this.attributes={color:new sc(1,1,1,1)}:this.attributes=s,this.pickPrimitive=o}}class YE{constructor(e,t,i,r,s,o,a,l){f(this,"year");f(this,"month");f(this,"day");f(this,"hour");f(this,"minute");f(this,"second");f(this,"millisecond");f(this,"isLeapSecond");this.year=e,this.month=t,this.day=i,this.hour=r,this.minute=s,this.second=o,this.millisecond=a,this.isLeapSecond=l}}class gi{constructor(e,t){f(this,"julianDate");f(this,"offset");this.julianDate=e,this.offset=t}}const Dn={SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:24000005e-1};var Qt=(n=>(n[n.UTC=0]="UTC",n[n.TAI=1]="TAI",n))(Qt||{});function jE(n,e,t){for(var i=0,r=n.length-1,s,o;i<=r;){if(s=~~((i+r)/2),o=t(n[s],e),o<0){i=s+1;continue}if(o>0){r=s-1;continue}return s}return~(r+1)}function qE(n){return n%4===0&&n%100!==0||n%400===0}let ZE=new YE;const vp=[31,28,31,30,31,30,31,31,30,31,30,31],yp=29;let UF=/^(\d{4})$/,kF=/^(\d{4})-(\d{2})$/,zF=/^(\d{4})-?(\d{3})$/,HF=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,GF=/^(\d{4})-?(\d{2})-?(\d{2})$/,B0=/([Z+\-])?(\d{2})?:?(\d{2})?$/,VF=/^(\d{2})(\.\d+)?/.source+B0.source,WF=/^(\d{2}):?(\d{2})(\.\d+)?/.source+B0.source,XF=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+B0.source,us="Invalid ISO 8601 date.";function KE(n,e,t,i,r,s,o){var a=(e-14)/12|0,l=n+4800+a,c=(1461*l/4|0)+(367*(e-2-12*a)/12|0)-(3*((l+100)/100|0)/4|0)+t-32075;i=i-12,i<0&&(i+=24);var u=s+(i*Dn.SECONDS_PER_HOUR+r*Dn.SECONDS_PER_MINUTE+o*Dn.SECONDS_PER_MILLISECOND);return u>=43200&&(c-=1),[c,u]}var bp=new gi;function F0(n){bp.julianDate=n;var e=ni.leapSeconds,t=jE(e,bp,QE);t<0&&(t=~t),t>=e.length&&(t=e.length-1);var i=e[t].offset;if(t>0){var r=ni.secondsDifference(e[t].julianDate,n);r>i&&(t--,i=e[t].offset)}ni.addSeconds(n,i,n)}function QE(n,e){return ni.compare(n.julianDate,e.julianDate)}function xp(n,e,t){var i=e/Dn.SECONDS_PER_DAY|0;return n+=i,e-=Dn.SECONDS_PER_DAY*i,e<0&&(n--,e+=Dn.SECONDS_PER_DAY),t.dayNumber=n,t.secondsOfDay=e,t}function $E(n,e){bp.julianDate=n;var t=ni.leapSeconds,i=jE(t,bp,QE);if(i<0&&(i=~i),i===0)return ni.addSeconds(n,-t[0].offset,e);if(i>=t.length)return ni.addSeconds(n,-t[i-1].offset,e);var r=ni.secondsDifference(t[i].julianDate,n);if(r===0)return ni.addSeconds(n,-t[i].offset,e);if(!(r<=1))return ni.addSeconds(n,-t[--i].offset,e)}const Bt=class Bt{constructor(e=0,t=0,i=Qt.UTC){f(this,"dayNumber");f(this,"secondsOfDay");var r=e|0;t=t+(e-r)*Dn.SECONDS_PER_DAY,xp(r,t,this),i===Qt.UTC&&F0(this)}static compare(e,t){var i=e.dayNumber-t.dayNumber;return i!==0?i:e.secondsOfDay-t.secondsOfDay}static addSeconds(e,t,i){return xp(e.dayNumber,e.secondsOfDay+t,i)}clone(e){return Bt.clone(this,e)}static fromDate(e,t){var i=KE(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return O(t)?(xp(i[0],i[1],t),F0(t),t):new Bt(i[0],i[1],Qt.UTC)}static now(e){return Bt.fromDate(new Date,e)}static toDate(e){var t=Bt.toGregorianDate(e,ZE),i=t.second;return t.isLeapSecond&&(i-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,i,t.millisecond))}static toGregorianDate(e,t){var i=!1,r=$E(e,wp);O(r)||(Bt.addSeconds(e,-1,wp),r=$E(wp,wp),i=!0);var s=r.dayNumber,o=r.secondsOfDay;o>=43200&&(s+=1);var a=s+68569|0,l=4*a/146097|0;a=a-((146097*l+3)/4|0)|0;var c=4e3*(a+1)/1461001|0;a=a-(1461*c/4|0)+31|0;var u=80*a/2447|0,d=a-(2447*u/80|0)|0;a=u/11|0;var p=u+2-12*a|0,g=100*(l-49)+c+a|0,_=o/Dn.SECONDS_PER_HOUR|0,x=o-_*Dn.SECONDS_PER_HOUR,b=x/Dn.SECONDS_PER_MINUTE|0;x=x-b*Dn.SECONDS_PER_MINUTE;var y=x|0,M=(x-y)/Dn.SECONDS_PER_MILLISECOND;return _+=12,_>23&&(_-=24),i&&(y+=1),O(t)?(t.year=g,t.month=p,t.day=d,t.hour=_,t.minute=b,t.second=y,t.millisecond=M,t.isLeapSecond=i,t):new YE(g,p,d,_,b,y,M,i)}static lessThan(e,t){return Bt.compare(e,t)<0}static toIso8601(e,t){var i=Bt.toGregorianDate(e,ZE),r=i.year,s=i.month,o=i.day,a=i.hour,l=i.minute,c=i.second,u=i.millisecond;r===1e4&&s===1&&o===1&&a===0&&l===0&&c===0&&u===0&&(r=9999,s=12,o=31,a=24);var d;return!O(t)&&u!==0?(d=(u*.01).toString().replace(".",""),r.toString().padStart(4,"0")+"-"+s.toString().padStart(2,"0")+"-"+o.toString().padStart(2,"0")+"T"+a.toString().padStart(2,"0")+":"+l.toString().padStart(2,"0")+":"+c.toString().padStart(2,"0")+"."+d+"Z"):!O(t)||t===0?r.toString().padStart(4,"0")+"-"+s.toString().padStart(2,"0")+"-"+o.toString().padStart(2,"0")+"T"+a.toString().padStart(2,"0")+":"+l.toString().padStart(2,"0")+":"+c.toString().padStart(2,"0")+"Z":(d=(u*.01).toFixed(t).replace(".","").slice(0,t),r.toString().padStart(4,"0")+"-"+s.toString().padStart(2,"0")+"-"+o.toString().padStart(2,"0")+"T"+a.toString().padStart(2,"0")+":"+l.toString().padStart(2,"0")+":"+c.toString().padStart(2,"0")+"."+d+"Z")}static fromIso8601(e,t=new Bt){e=e.replace(",",".");var i=e.split("T"),r,s=1,o=1,a=0,l=0,c=0,u=0,d=i[0],p=i[1],g,_;if(!O(d))throw new Ze(us);var x;if(i=d.match(GF),i!==null){if(x=d.split("-").length-1,x>0&&x!==2)throw new Ze(us);r=+i[1],s=+i[2],o=+i[3]}else if(i=d.match(kF),i!==null)r=+i[1],s=+i[2];else if(i=d.match(UF),i!==null)r=+i[1];else{var b;if(i=d.match(zF),i!==null){if(r=+i[1],b=+i[2],_=qE(r),b<1||_&&b>366||!_&&b>365)throw new Ze(us)}else if(i=d.match(HF),i!==null){r=+i[1];var y=+i[2],M=+i[3]||0;if(x=d.split("-").length-1,x>0&&(!O(i[3])&&x!==1||O(i[3])&&x!==2))throw new Ze(us);var E=new Date(Date.UTC(r,0,4));b=y*7+M-E.getUTCDay()-3}else throw new Ze(us);g=new Date(Date.UTC(r,0,1)),g.setUTCDate(b),s=g.getUTCMonth()+1,o=g.getUTCDate()}if(_=qE(r),s<1||s>12||o<1||(s!==2||!_)&&o>vp[s-1]||_&&s===2&&o>yp)throw new Ze(us);var w;if(O(p)){if(i=p.match(XF),i!==null){if(x=p.split(":").length-1,x>0&&x!==2&&x!==3)throw new Ze(us);a=+i[1],l=+i[2],c=+i[3],u=+(i[4]||0)*1e3,w=5}else if(i=p.match(WF),i!==null){if(x=p.split(":").length-1,x>2)throw new Ze(us);a=+i[1],l=+i[2],c=+(i[3]||0)*60,w=4}else if(i=p.match(VF),i!==null)a=+i[1],l=+(i[2]||0)*60,w=3;else throw new Ze(us);if(l>=60||c>=61||a>24||a===24&&(l>0||c>0||u>0))throw new Ze(us);var I=i[w],B=+i[w+1],N=+(i[w+2]||0);switch(I){case"+":a=a-B,l=l-N;break;case"-":a=a+B,l=l+N;break;case"Z":break;default:l=l+new Date(Date.UTC(r,s-1,o,a,l)).getTimezoneOffset();break}}var L=c===60;for(L&&c--;l>=60;)l-=60,a++;for(;a>=24;)a-=24,o++;for(g=_&&s===2?yp:vp[s-1];o>g;)o-=g,s++,s>12&&(s-=12,r++),g=_&&s===2?yp:vp[s-1];for(;l<0;)l+=60,a--;for(;a<0;)a+=24,o--;for(;o<1;)s--,s<1&&(s+=12,r--),g=_&&s===2?yp:vp[s-1],o+=g;var P=KE(r,s,o,a,l,c,u);return O(t)?(xp(P[0],P[1],t),F0(t)):t=new Bt(P[0],P[1],Qt.UTC),L&&Bt.addSeconds(t,1,t),t}};f(Bt,"leapSeconds",[new gi(new Bt(2441317,43210,Qt.TAI),10),new gi(new Bt(2441499,43211,Qt.TAI),11),new gi(new Bt(2441683,43212,Qt.TAI),12),new gi(new Bt(2442048,43213,Qt.TAI),13),new gi(new Bt(2442413,43214,Qt.TAI),14),new gi(new Bt(2442778,43215,Qt.TAI),15),new gi(new Bt(2443144,43216,Qt.TAI),16),new gi(new Bt(2443509,43217,Qt.TAI),17),new gi(new Bt(2443874,43218,Qt.TAI),18),new gi(new Bt(2444239,43219,Qt.TAI),19),new gi(new Bt(2444786,43220,Qt.TAI),20),new gi(new Bt(2445151,43221,Qt.TAI),21),new gi(new Bt(2445516,43222,Qt.TAI),22),new gi(new Bt(2446247,43223,Qt.TAI),23),new gi(new Bt(2447161,43224,Qt.TAI),24),new gi(new Bt(2447892,43225,Qt.TAI),25),new gi(new Bt(2448257,43226,Qt.TAI),26),new gi(new Bt(2448804,43227,Qt.TAI),27),new gi(new Bt(2449169,43228,Qt.TAI),28),new gi(new Bt(2449534,43229,Qt.TAI),29),new gi(new Bt(2450083,43230,Qt.TAI),30),new gi(new Bt(2450630,43231,Qt.TAI),31),new gi(new Bt(2451179,43232,Qt.TAI),32),new gi(new Bt(2453736,43233,Qt.TAI),33),new gi(new Bt(2454832,43234,Qt.TAI),34),new gi(new Bt(2456109,43235,Qt.TAI),35),new gi(new Bt(2457204,43236,Qt.TAI),36),new gi(new Bt(2457754,43237,Qt.TAI),37)]),f(Bt,"secondsDifference",function(e,t){var i=(e.dayNumber-t.dayNumber)*Dn.SECONDS_PER_DAY;return i+(e.secondsOfDay-t.secondsOfDay)}),f(Bt,"clone",function(e,t=new Bt(e.dayNumber,e.secondsOfDay,Qt.TAI)){return t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t});let ni=Bt,wp=new ni(0,0,Qt.TAI);class zi extends Dt{constructor(t={}){super();f(this,"destroyChildren",!0);this.visible=ye(t.visible,!0),this.destroyChildren=ye(t.destroyChildren,!0)}preUpdate(t){}update(t){}prePassesUpdate(t){}updateForPass(t,i){}postPassesUpdate(t){}}var JE={exports:{}},tu={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */tu.exports;var eT;function YF(){return eT||(eT=1,function(n,e){(function(t){var i=e&&!e.nodeType&&e,r=n&&!n.nodeType&&n,s=typeof os=="object"&&os;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,l=36,c=1,u=26,d=38,p=700,g=72,_=128,x="-",b=/^xn--/,y=/[^\x20-\x7E]/,M=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=l-c,I=Math.floor,B=String.fromCharCode,N;function L(oe){throw new RangeError(E[oe])}function P(oe,me){for(var Le=oe.length,Ge=[];Le--;)Ge[Le]=me(oe[Le]);return Ge}function R(oe,me){var Le=oe.split("@"),Ge="";Le.length>1&&(Ge=Le[0]+"@",oe=Le[1]),oe=oe.replace(M,".");var pe=oe.split("."),Te=P(pe,me).join(".");return Ge+Te}function U(oe){for(var me=[],Le=0,Ge=oe.length,pe,Te;Le<Ge;)pe=oe.charCodeAt(Le++),pe>=55296&&pe<=56319&&Le<Ge?(Te=oe.charCodeAt(Le++),(Te&64512)==56320?me.push(((pe&1023)<<10)+(Te&1023)+65536):(me.push(pe),Le--)):me.push(pe);return me}function j(oe){return P(oe,function(me){var Le="";return me>65535&&(me-=65536,Le+=B(me>>>10&1023|55296),me=56320|me&1023),Le+=B(me),Le}).join("")}function A(oe){return oe-48<10?oe-22:oe-65<26?oe-65:oe-97<26?oe-97:l}function D(oe,me){return oe+22+75*(oe<26)-((me!=0)<<5)}function k(oe,me,Le){var Ge=0;for(oe=Le?I(oe/p):oe>>1,oe+=I(oe/me);oe>w*u>>1;Ge+=l)oe=I(oe/w);return I(Ge+(w+1)*oe/(oe+d))}function G(oe){var me=[],Le=oe.length,Ge,pe=0,Te=_,ke=g,De,Je,lt,rt,_t,Ee,Oe,Q,Ye;for(De=oe.lastIndexOf(x),De<0&&(De=0),Je=0;Je<De;++Je)oe.charCodeAt(Je)>=128&&L("not-basic"),me.push(oe.charCodeAt(Je));for(lt=De>0?De+1:0;lt<Le;){for(rt=pe,_t=1,Ee=l;lt>=Le&&L("invalid-input"),Oe=A(oe.charCodeAt(lt++)),(Oe>=l||Oe>I((a-pe)/_t))&&L("overflow"),pe+=Oe*_t,Q=Ee<=ke?c:Ee>=ke+u?u:Ee-ke,!(Oe<Q);Ee+=l)Ye=l-Q,_t>I(a/Ye)&&L("overflow"),_t*=Ye;Ge=me.length+1,ke=k(pe-rt,Ge,rt==0),I(pe/Ge)>a-Te&&L("overflow"),Te+=I(pe/Ge),pe%=Ge,me.splice(pe++,0,Te)}return j(me)}function ee(oe){var me,Le,Ge,pe,Te,ke,De,Je,lt,rt,_t,Ee=[],Oe,Q,Ye,Be;for(oe=U(oe),Oe=oe.length,me=_,Le=0,Te=g,ke=0;ke<Oe;++ke)_t=oe[ke],_t<128&&Ee.push(B(_t));for(Ge=pe=Ee.length,pe&&Ee.push(x);Ge<Oe;){for(De=a,ke=0;ke<Oe;++ke)_t=oe[ke],_t>=me&&_t<De&&(De=_t);for(Q=Ge+1,De-me>I((a-Le)/Q)&&L("overflow"),Le+=(De-me)*Q,me=De,ke=0;ke<Oe;++ke)if(_t=oe[ke],_t<me&&++Le>a&&L("overflow"),_t==me){for(Je=Le,lt=l;rt=lt<=Te?c:lt>=Te+u?u:lt-Te,!(Je<rt);lt+=l)Be=Je-rt,Ye=l-rt,Ee.push(B(D(rt+Be%Ye,0))),Je=I(Be/Ye);Ee.push(B(D(Je,0))),Te=k(Le,Q,Ge==pe),Le=0,++Ge}++Le,++me}return Ee.join("")}function J(oe){return R(oe,function(me){return b.test(me)?G(me.slice(4).toLowerCase()):me})}function re(oe){return R(oe,function(me){return y.test(me)?"xn--"+ee(me):me})}if(o={version:"1.3.2",ucs2:{decode:U,encode:j},decode:G,encode:ee,toASCII:re,toUnicode:J},i&&r)if(n.exports==i)r.exports=o;else for(N in o)o.hasOwnProperty(N)&&(i[N]=o[N]);else t.punycode=o})(os)}(tu,tu.exports)),tu.exports}var U0={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var tT;function jF(){return tT||(tT=1,function(n){(function(e,t){n.exports?n.exports=t():e.IPv6=t(e)})(os,function(e){var t=e&&e.IPv6;function i(s){var o=s.toLowerCase(),a=o.split(":"),l=a.length,c=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(c=7);var u;for(u=0;u<l&&a[u]!=="";u++);if(u<c)for(a.splice(u,1,"0000");a.length<c;)a.splice(u,0,"0000");for(var d,p=0;p<c;p++){d=a[p].split("");for(var g=0;g<3&&(d[0]==="0"&&d.length>1);g++)d.splice(0,1);a[p]=d.join("")}var _=-1,x=0,b=0,y=-1,M=!1;for(p=0;p<c;p++)M?a[p]==="0"?b+=1:(M=!1,b>x&&(_=y,x=b)):a[p]==="0"&&(M=!0,y=p,b=1);b>x&&(_=y,x=b),x>1&&a.splice(_,x,""),l=a.length;var E="";for(a[0]===""&&(E=":"),p=0;p<l&&(E+=a[p],p!==l-1);p++)E+=":";return a[l-1]===""&&(E+=":"),E}function r(){return e.IPv6===this&&(e.IPv6=t),this}return{best:i,noConflict:r}})}(U0)),U0.exports}var k0={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var iT;function qF(){return iT||(iT=1,function(n){(function(e,t){n.exports?n.exports=t():e.SecondLevelDomains=t(e)})(os,function(e){var t=e&&e.SecondLevelDomains,i={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(r){var s=r.lastIndexOf(".");if(s<=0||s>=r.length-1)return!1;var o=r.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=i.list[r.slice(s+1)];return a?a.indexOf(" "+r.slice(o+1,s)+" ")>=0:!1},is:function(r){var s=r.lastIndexOf(".");if(s<=0||s>=r.length-1)return!1;var o=r.lastIndexOf(".",s-1);if(o>=0)return!1;var a=i.list[r.slice(s+1)];return a?a.indexOf(" "+r.slice(0,s)+" ")>=0:!1},get:function(r){var s=r.lastIndexOf(".");if(s<=0||s>=r.length-1)return null;var o=r.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=i.list[r.slice(s+1)];return!a||a.indexOf(" "+r.slice(o+1,s)+" ")<0?null:r.slice(o+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return i})}(k0)),k0.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(n){(function(e,t){n.exports?n.exports=t(YF(),jF(),qF()):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(os,function(e,t,i,r){var s=r&&r.URI;function o(A,D){var k=arguments.length>=1,G=arguments.length>=2;if(!(this instanceof o))return k?G?new o(A,D):new o(A):new o;if(A===void 0){if(k)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?A=location.href+"":A=""}if(A===null&&k)throw new TypeError("null is not a valid argument for URI");return this.href(A),D!==void 0?this.absoluteTo(D):this}function a(A){return/^[0-9]+$/.test(A)}o.version="1.19.11";var l=o.prototype,c=Object.prototype.hasOwnProperty;function u(A){return A.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function d(A){return A===void 0?"Undefined":String(Object.prototype.toString.call(A)).slice(8,-1)}function p(A){return d(A)==="Array"}function g(A,D){var k={},G,ee;if(d(D)==="RegExp")k=null;else if(p(D))for(G=0,ee=D.length;G<ee;G++)k[D[G]]=!0;else k[D]=!0;for(G=0,ee=A.length;G<ee;G++){var J=k&&k[A[G]]!==void 0||!k&&D.test(A[G]);J&&(A.splice(G,1),ee--,G--)}return A}function _(A,D){var k,G;if(p(D)){for(k=0,G=D.length;k<G;k++)if(!_(A,D[k]))return!1;return!0}var ee=d(D);for(k=0,G=A.length;k<G;k++)if(ee==="RegExp"){if(typeof A[k]=="string"&&A[k].match(D))return!0}else if(A[k]===D)return!0;return!1}function x(A,D){if(!p(A)||!p(D)||A.length!==D.length)return!1;A.sort(),D.sort();for(var k=0,G=A.length;k<G;k++)if(A[k]!==D[k])return!1;return!0}function b(A){var D=/^\/+|\/+$/g;return A.replace(D,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(A){if(!(!A||!A.nodeName)){var D=A.nodeName.toLowerCase();if(!(D==="input"&&A.type!=="image"))return o.domAttributes[D]}};function y(A){return escape(A)}function M(A){return encodeURIComponent(A).replace(/[!'()*]/g,y).replace(/\*/g,"%2A")}o.encode=M,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=M,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(A,D){var k=o.encode(A+"");return D===void 0&&(D=o.escapeQuerySpace),D?k.replace(/%20/g,"+"):k},o.decodeQuery=function(A,D){A+="",D===void 0&&(D=o.escapeQuerySpace);try{return o.decode(D?A.replace(/\+/g,"%20"):A)}catch{return A}};var E={encode:"encode",decode:"decode"},w,I=function(A,D){return function(k){try{return o[D](k+"").replace(o.characters[A][D].expression,function(G){return o.characters[A][D].map[G]})}catch{return k}}};for(w in E)o[w+"PathSegment"]=I("pathname",E[w]),o[w+"UrnPathSegment"]=I("urnpath",E[w]);var B=function(A,D,k){return function(G){var ee;k?ee=function(me){return o[D](o[k](me))}:ee=o[D];for(var J=(G+"").split(A),re=0,oe=J.length;re<oe;re++)J[re]=ee(J[re]);return J.join(A)}};o.decodePath=B("/","decodePathSegment"),o.decodeUrnPath=B(":","decodeUrnPathSegment"),o.recodePath=B("/","encodePathSegment","decode"),o.recodeUrnPath=B(":","encodeUrnPathSegment","decode"),o.encodeReserved=I("reserved","encode"),o.parse=function(A,D){var k;return D||(D={preventInvalidHostname:o.preventInvalidHostname}),A=A.replace(o.leading_whitespace_expression,""),A=A.replace(o.ascii_tab_whitespace,""),k=A.indexOf("#"),k>-1&&(D.fragment=A.substring(k+1)||null,A=A.substring(0,k)),k=A.indexOf("?"),k>-1&&(D.query=A.substring(k+1)||null,A=A.substring(0,k)),A=A.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),A=A.replace(/^[/\\]{2,}/i,"//"),A.substring(0,2)==="//"?(D.protocol=null,A=A.substring(2),A=o.parseAuthority(A,D)):(k=A.indexOf(":"),k>-1&&(D.protocol=A.substring(0,k)||null,D.protocol&&!D.protocol.match(o.protocol_expression)?D.protocol=void 0:A.substring(k+1,k+3).replace(/\\/g,"/")==="//"?(A=A.substring(k+3),A=o.parseAuthority(A,D)):(A=A.substring(k+1),D.urn=!0))),D.path=A,D},o.parseHost=function(A,D){A||(A=""),A=A.replace(/\\/g,"/");var k=A.indexOf("/"),G,ee;if(k===-1&&(k=A.length),A.charAt(0)==="[")G=A.indexOf("]"),D.hostname=A.substring(1,G)||null,D.port=A.substring(G+2,k)||null,D.port==="/"&&(D.port=null);else{var J=A.indexOf(":"),re=A.indexOf("/"),oe=A.indexOf(":",J+1);oe!==-1&&(re===-1||oe<re)?(D.hostname=A.substring(0,k)||null,D.port=null):(ee=A.substring(0,k).split(":"),D.hostname=ee[0]||null,D.port=ee[1]||null)}return D.hostname&&A.substring(k).charAt(0)!=="/"&&(k++,A="/"+A),D.preventInvalidHostname&&o.ensureValidHostname(D.hostname,D.protocol),D.port&&o.ensureValidPort(D.port),A.substring(k)||"/"},o.parseAuthority=function(A,D){return A=o.parseUserinfo(A,D),o.parseHost(A,D)},o.parseUserinfo=function(A,D){var k=A,G=A.indexOf("\\");G!==-1&&(A=A.replace(/\\/g,"/"));var ee=A.indexOf("/"),J=A.lastIndexOf("@",ee>-1?ee:A.length-1),re;return J>-1&&(ee===-1||J<ee)?(re=A.substring(0,J).split(":"),D.username=re[0]?o.decode(re[0]):null,re.shift(),D.password=re[0]?o.decode(re.join(":")):null,A=k.substring(J+1)):(D.username=null,D.password=null),A},o.parseQuery=function(A,D){if(!A)return{};if(A=A.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!A)return{};for(var k={},G=A.split("&"),ee=G.length,J,re,oe,me=0;me<ee;me++)J=G[me].split("="),re=o.decodeQuery(J.shift(),D),oe=J.length?o.decodeQuery(J.join("="),D):null,re!=="__proto__"&&(c.call(k,re)?((typeof k[re]=="string"||k[re]===null)&&(k[re]=[k[re]]),k[re].push(oe)):k[re]=oe);return k},o.build=function(A){var D="",k=!1;return A.protocol&&(D+=A.protocol+":"),!A.urn&&(D||A.hostname)&&(D+="//",k=!0),D+=o.buildAuthority(A)||"",typeof A.path=="string"&&(A.path.charAt(0)!=="/"&&k&&(D+="/"),D+=A.path),typeof A.query=="string"&&A.query&&(D+="?"+A.query),typeof A.fragment=="string"&&A.fragment&&(D+="#"+A.fragment),D},o.buildHost=function(A){var D="";if(A.hostname)o.ip6_expression.test(A.hostname)?D+="["+A.hostname+"]":D+=A.hostname;else return"";return A.port&&(D+=":"+A.port),D},o.buildAuthority=function(A){return o.buildUserinfo(A)+o.buildHost(A)},o.buildUserinfo=function(A){var D="";return A.username&&(D+=o.encode(A.username)),A.password&&(D+=":"+o.encode(A.password)),D&&(D+="@"),D},o.buildQuery=function(A,D,k){var G="",ee,J,re,oe;for(J in A)if(J!=="__proto__"&&c.call(A,J))if(p(A[J]))for(ee={},re=0,oe=A[J].length;re<oe;re++)A[J][re]!==void 0&&ee[A[J][re]+""]===void 0&&(G+="&"+o.buildQueryParameter(J,A[J][re],k),D!==!0&&(ee[A[J][re]+""]=!0));else A[J]!==void 0&&(G+="&"+o.buildQueryParameter(J,A[J],k));return G.substring(1)},o.buildQueryParameter=function(A,D,k){return o.encodeQuery(A,k)+(D!==null?"="+o.encodeQuery(D,k):"")},o.addQuery=function(A,D,k){if(typeof D=="object")for(var G in D)c.call(D,G)&&o.addQuery(A,G,D[G]);else if(typeof D=="string"){if(A[D]===void 0){A[D]=k;return}else typeof A[D]=="string"&&(A[D]=[A[D]]);p(k)||(k=[k]),A[D]=(A[D]||[]).concat(k)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(A,D,k){if(typeof D=="object")for(var G in D)c.call(D,G)&&o.setQuery(A,G,D[G]);else if(typeof D=="string")A[D]=k===void 0?null:k;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(A,D,k){var G,ee,J;if(p(D))for(G=0,ee=D.length;G<ee;G++)A[D[G]]=void 0;else if(d(D)==="RegExp")for(J in A)D.test(J)&&(A[J]=void 0);else if(typeof D=="object")for(J in D)c.call(D,J)&&o.removeQuery(A,J,D[J]);else if(typeof D=="string")k!==void 0?d(k)==="RegExp"?!p(A[D])&&k.test(A[D])?A[D]=void 0:A[D]=g(A[D],k):A[D]===String(k)&&(!p(k)||k.length===1)?A[D]=void 0:p(A[D])&&(A[D]=g(A[D],k)):A[D]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(A,D,k,G){switch(d(D)){case"String":break;case"RegExp":for(var ee in A)if(c.call(A,ee)&&D.test(ee)&&(k===void 0||o.hasQuery(A,ee,k)))return!0;return!1;case"Object":for(var J in D)if(c.call(D,J)&&!o.hasQuery(A,J,D[J]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(d(k)){case"Undefined":return D in A;case"Boolean":var re=!!(p(A[D])?A[D].length:A[D]);return k===re;case"Function":return!!k(A[D],D,A);case"Array":if(!p(A[D]))return!1;var oe=G?_:x;return oe(A[D],k);case"RegExp":return p(A[D])?G?_(A[D],k):!1:!!(A[D]&&A[D].match(k));case"Number":k=String(k);case"String":return p(A[D])?G?_(A[D],k):!1:A[D]===k;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var A=[],D=[],k=0,G=0;G<arguments.length;G++){var ee=new o(arguments[G]);A.push(ee);for(var J=ee.segment(),re=0;re<J.length;re++)typeof J[re]=="string"&&D.push(J[re]),J[re]&&k++}if(!D.length||!k)return new o("");var oe=new o("").segment(D);return(A[0].path()===""||A[0].path().slice(0,1)==="/")&&oe.path("/"+oe.path()),oe.normalize()},o.commonPath=function(A,D){var k=Math.min(A.length,D.length),G;for(G=0;G<k;G++)if(A.charAt(G)!==D.charAt(G)){G--;break}return G<1?A.charAt(0)===D.charAt(0)&&A.charAt(0)==="/"?"/":"":((A.charAt(G)!=="/"||D.charAt(G)!=="/")&&(G=A.substring(0,G).lastIndexOf("/")),A.substring(0,G+1))},o.withinString=function(A,D,k){k||(k={});var G=k.start||o.findUri.start,ee=k.end||o.findUri.end,J=k.trim||o.findUri.trim,re=k.parens||o.findUri.parens,oe=/[a-z0-9-]=["']?$/i;for(G.lastIndex=0;;){var me=G.exec(A);if(!me)break;var Le=me.index;if(k.ignoreHtml){var Ge=A.slice(Math.max(Le-3,0),Le);if(Ge&&oe.test(Ge))continue}for(var pe=Le+A.slice(Le).search(ee),Te=A.slice(Le,pe),ke=-1;;){var De=re.exec(Te);if(!De)break;var Je=De.index+De[0].length;ke=Math.max(ke,Je)}if(ke>-1?Te=Te.slice(0,ke)+Te.slice(ke).replace(J,""):Te=Te.replace(J,""),!(Te.length<=me[0].length)&&!(k.ignore&&k.ignore.test(Te))){pe=Le+Te.length;var lt=D(Te,Le,pe,A);if(lt===void 0){G.lastIndex=pe;continue}lt=String(lt),A=A.slice(0,Le)+lt+A.slice(pe),G.lastIndex=Le+lt.length}}return G.lastIndex=0,A},o.ensureValidHostname=function(A,D){var k=!!A,G=!!D,ee=!1;if(G&&(ee=_(o.hostProtocols,D)),ee&&!k)throw new TypeError("Hostname cannot be empty, if protocol is "+D);if(A&&A.match(o.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+A+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(A).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+A+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(A){if(A){var D=Number(A);if(!(a(D)&&D>0&&D<65536))throw new TypeError('Port "'+A+'" is not a valid port')}},o.noConflict=function(A){if(A){var D={URI:this.noConflict()};return r.URITemplate&&typeof r.URITemplate.noConflict=="function"&&(D.URITemplate=r.URITemplate.noConflict()),r.IPv6&&typeof r.IPv6.noConflict=="function"&&(D.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&typeof r.SecondLevelDomains.noConflict=="function"&&(D.SecondLevelDomains=r.SecondLevelDomains.noConflict()),D}else r.URI===this&&(r.URI=s);return this},l.build=function(A){return A===!0?this._deferred_build=!0:(A===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function N(A){return function(D,k){return D===void 0?this._parts[A]||"":(this._parts[A]=D||null,this.build(!k),this)}}function L(A,D){return function(k,G){return k===void 0?this._parts[A]||"":(k!==null&&(k=k+"",k.charAt(0)===D&&(k=k.substring(1))),this._parts[A]=k,this.build(!G),this)}}l.protocol=N("protocol"),l.username=N("username"),l.password=N("password"),l.hostname=N("hostname"),l.port=N("port"),l.query=L("query","?"),l.fragment=L("fragment","#"),l.search=function(A,D){var k=this.query(A,D);return typeof k=="string"&&k.length?"?"+k:k},l.hash=function(A,D){var k=this.fragment(A,D);return typeof k=="string"&&k.length?"#"+k:k},l.pathname=function(A,D){if(A===void 0||A===!0){var k=this._parts.path||(this._parts.hostname?"/":"");return A?(this._parts.urn?o.decodeUrnPath:o.decodePath)(k):k}else return this._parts.urn?this._parts.path=A?o.recodeUrnPath(A):"":this._parts.path=A?o.recodePath(A):"/",this.build(!D),this},l.path=l.pathname,l.href=function(A,D){var k;if(A===void 0)return this.toString();this._string="",this._parts=o._parts();var G=A instanceof o,ee=typeof A=="object"&&(A.hostname||A.path||A.pathname);if(A.nodeName){var J=o.getDomAttribute(A);A=A[J]||"",ee=!1}if(!G&&ee&&A.pathname!==void 0&&(A=A.toString()),typeof A=="string"||A instanceof String)this._parts=o.parse(String(A),this._parts);else if(G||ee){var re=G?A._parts:A;for(k in re)k!=="query"&&c.call(this._parts,k)&&(this._parts[k]=re[k]);re.query&&this.query(re.query,!1)}else throw new TypeError("invalid input");return this.build(!D),this},l.is=function(A){var D=!1,k=!1,G=!1,ee=!1,J=!1,re=!1,oe=!1,me=!this._parts.urn;switch(this._parts.hostname&&(me=!1,k=o.ip4_expression.test(this._parts.hostname),G=o.ip6_expression.test(this._parts.hostname),D=k||G,ee=!D,J=ee&&i&&i.has(this._parts.hostname),re=ee&&o.idn_expression.test(this._parts.hostname),oe=ee&&o.punycode_expression.test(this._parts.hostname)),A.toLowerCase()){case"relative":return me;case"absolute":return!me;case"domain":case"name":return ee;case"sld":return J;case"ip":return D;case"ip4":case"ipv4":case"inet4":return k;case"ip6":case"ipv6":case"inet6":return G;case"idn":return re;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return oe}return null};var P=l.protocol,R=l.port,U=l.hostname;l.protocol=function(A,D){if(A&&(A=A.replace(/:(\/\/)?$/,""),!A.match(o.protocol_expression)))throw new TypeError('Protocol "'+A+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return P.call(this,A,D)},l.scheme=l.protocol,l.port=function(A,D){return this._parts.urn?A===void 0?"":this:(A!==void 0&&(A===0&&(A=null),A&&(A+="",A.charAt(0)===":"&&(A=A.substring(1)),o.ensureValidPort(A))),R.call(this,A,D))},l.hostname=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(A!==void 0){var k={preventInvalidHostname:this._parts.preventInvalidHostname},G=o.parseHost(A,k);if(G!=="/")throw new TypeError('Hostname "'+A+'" contains characters other than [A-Z0-9.-]');A=k.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(A,this._parts.protocol)}return U.call(this,A,D)},l.origin=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(A===void 0){var k=this.protocol(),G=this.authority();return G?(k?k+"://":"")+this.authority():""}else{var ee=o(A);return this.protocol(ee.protocol()).authority(ee.authority()).build(!D),this}},l.host=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(A===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var k=o.parseHost(A,this._parts);if(k!=="/")throw new TypeError('Hostname "'+A+'" contains characters other than [A-Z0-9.-]');return this.build(!D),this},l.authority=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(A===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var k=o.parseAuthority(A,this._parts);if(k!=="/")throw new TypeError('Hostname "'+A+'" contains characters other than [A-Z0-9.-]');return this.build(!D),this},l.userinfo=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(A===void 0){var k=o.buildUserinfo(this._parts);return k&&k.substring(0,k.length-1)}else return A[A.length-1]!=="@"&&(A+="@"),o.parseUserinfo(A,this._parts),this.build(!D),this},l.resource=function(A,D){var k;return A===void 0?this.path()+this.search()+this.hash():(k=o.parse(A),this._parts.path=k.path,this._parts.query=k.query,this._parts.fragment=k.fragment,this.build(!D),this)},l.subdomain=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(A===void 0){if(!this._parts.hostname||this.is("IP"))return"";var k=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,k)||""}else{var G=this._parts.hostname.length-this.domain().length,ee=this._parts.hostname.substring(0,G),J=new RegExp("^"+u(ee));if(A&&A.charAt(A.length-1)!=="."&&(A+="."),A.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return A&&o.ensureValidHostname(A,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(J,A),this.build(!D),this}},l.domain=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(typeof A=="boolean"&&(D=A,A=void 0),A===void 0){if(!this._parts.hostname||this.is("IP"))return"";var k=this._parts.hostname.match(/\./g);if(k&&k.length<2)return this._parts.hostname;var G=this._parts.hostname.length-this.tld(D).length-1;return G=this._parts.hostname.lastIndexOf(".",G-1)+1,this._parts.hostname.substring(G)||""}else{if(!A)throw new TypeError("cannot set domain empty");if(A.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(A,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=A;else{var ee=new RegExp(u(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(ee,A)}return this.build(!D),this}},l.tld=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(typeof A=="boolean"&&(D=A,A=void 0),A===void 0){if(!this._parts.hostname||this.is("IP"))return"";var k=this._parts.hostname.lastIndexOf("."),G=this._parts.hostname.substring(k+1);return D!==!0&&i&&i.list[G.toLowerCase()]&&i.get(this._parts.hostname)||G}else{var ee;if(A)if(A.match(/[^a-zA-Z0-9-]/))if(i&&i.is(A))ee=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(ee,A);else throw new TypeError('TLD "'+A+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");ee=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(ee,A)}else throw new TypeError("cannot set TLD empty");return this.build(!D),this}},l.directory=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(A===void 0||A===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var k=this._parts.path.length-this.filename().length-1,G=this._parts.path.substring(0,k)||(this._parts.hostname?"/":"");return A?o.decodePath(G):G}else{var ee=this._parts.path.length-this.filename().length,J=this._parts.path.substring(0,ee),re=new RegExp("^"+u(J));return this.is("relative")||(A||(A="/"),A.charAt(0)!=="/"&&(A="/"+A)),A&&A.charAt(A.length-1)!=="/"&&(A+="/"),A=o.recodePath(A),this._parts.path=this._parts.path.replace(re,A),this.build(!D),this}},l.filename=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(typeof A!="string"){if(!this._parts.path||this._parts.path==="/")return"";var k=this._parts.path.lastIndexOf("/"),G=this._parts.path.substring(k+1);return A?o.decodePathSegment(G):G}else{var ee=!1;A.charAt(0)==="/"&&(A=A.substring(1)),A.match(/\.?\//)&&(ee=!0);var J=new RegExp(u(this.filename())+"$");return A=o.recodePath(A),this._parts.path=this._parts.path.replace(J,A),ee?this.normalizePath(D):this.build(!D),this}},l.suffix=function(A,D){if(this._parts.urn)return A===void 0?"":this;if(A===void 0||A===!0){if(!this._parts.path||this._parts.path==="/")return"";var k=this.filename(),G=k.lastIndexOf("."),ee,J;return G===-1?"":(ee=k.substring(G+1),J=/^[a-z0-9%]+$/i.test(ee)?ee:"",A?o.decodePathSegment(J):J)}else{A.charAt(0)==="."&&(A=A.substring(1));var re=this.suffix(),oe;if(re)A?oe=new RegExp(u(re)+"$"):oe=new RegExp(u("."+re)+"$");else{if(!A)return this;this._parts.path+="."+o.recodePath(A)}return oe&&(A=o.recodePath(A),this._parts.path=this._parts.path.replace(oe,A)),this.build(!D),this}},l.segment=function(A,D,k){var G=this._parts.urn?":":"/",ee=this.path(),J=ee.substring(0,1)==="/",re=ee.split(G);if(A!==void 0&&typeof A!="number"&&(k=D,D=A,A=void 0),A!==void 0&&typeof A!="number")throw new Error('Bad segment "'+A+'", must be 0-based integer');if(J&&re.shift(),A<0&&(A=Math.max(re.length+A,0)),D===void 0)return A===void 0?re:re[A];if(A===null||re[A]===void 0)if(p(D)){re=[];for(var oe=0,me=D.length;oe<me;oe++)!D[oe].length&&(!re.length||!re[re.length-1].length)||(re.length&&!re[re.length-1].length&&re.pop(),re.push(b(D[oe])))}else(D||typeof D=="string")&&(D=b(D),re[re.length-1]===""?re[re.length-1]=D:re.push(D));else D?re[A]=b(D):re.splice(A,1);return J&&re.unshift(""),this.path(re.join(G),k)},l.segmentCoded=function(A,D,k){var G,ee,J;if(typeof A!="number"&&(k=D,D=A,A=void 0),D===void 0){if(G=this.segment(A,D,k),!p(G))G=G!==void 0?o.decode(G):void 0;else for(ee=0,J=G.length;ee<J;ee++)G[ee]=o.decode(G[ee]);return G}if(!p(D))D=typeof D=="string"||D instanceof String?o.encode(D):D;else for(ee=0,J=D.length;ee<J;ee++)D[ee]=o.encode(D[ee]);return this.segment(A,D,k)};var j=l.query;return l.query=function(A,D){if(A===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof A=="function"){var k=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),G=A.call(this,k);return this._parts.query=o.buildQuery(G||k,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!D),this}else return A!==void 0&&typeof A!="string"?(this._parts.query=o.buildQuery(A,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!D),this):j.call(this,A,D)},l.setQuery=function(A,D,k){var G=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof A=="string"||A instanceof String)G[A]=D!==void 0?D:null;else if(typeof A=="object")for(var ee in A)c.call(A,ee)&&(G[ee]=A[ee]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(G,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof A!="string"&&(k=D),this.build(!k),this},l.addQuery=function(A,D,k){var G=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(G,A,D===void 0?null:D),this._parts.query=o.buildQuery(G,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof A!="string"&&(k=D),this.build(!k),this},l.removeQuery=function(A,D,k){var G=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(G,A,D),this._parts.query=o.buildQuery(G,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof A!="string"&&(k=D),this.build(!k),this},l.hasQuery=function(A,D,k){var G=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(G,A,D,k)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(A){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!A)),this},l.normalizeHostname=function(A){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!A)),this},l.normalizePort=function(A){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!A)),this},l.normalizePath=function(A){var D=this._parts.path;if(!D)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!A),this;if(this._parts.path==="/")return this;D=o.recodePath(D);var k,G="",ee,J;for(D.charAt(0)!=="/"&&(k=!0,D="/"+D),(D.slice(-3)==="/.."||D.slice(-2)==="/.")&&(D+="/"),D=D.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),k&&(G=D.substring(1).match(/^(\.\.\/)+/)||"",G&&(G=G[0]));ee=D.search(/\/\.\.(\/|$)/),ee!==-1;){if(ee===0){D=D.substring(3);continue}J=D.substring(0,ee).lastIndexOf("/"),J===-1&&(J=ee),D=D.substring(0,J)+D.substring(ee+3)}return k&&this.is("relative")&&(D=G+D.substring(1)),this._parts.path=D,this.build(!A),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(A){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!A)),this},l.normalizeFragment=function(A){return this._parts.fragment||(this._parts.fragment=null,this.build(!A)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var A=o.encode,D=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=A,o.decode=D}return this},l.unicode=function(){var A=o.encode,D=o.decode;o.encode=M,o.decode=unescape;try{this.normalize()}finally{o.encode=A,o.decode=D}return this},l.readable=function(){var A=this.clone();A.username("").password("").normalize();var D="";if(A._parts.protocol&&(D+=A._parts.protocol+"://"),A._parts.hostname&&(A.is("punycode")&&e?(D+=e.toUnicode(A._parts.hostname),A._parts.port&&(D+=":"+A._parts.port)):D+=A.host()),A._parts.hostname&&A._parts.path&&A._parts.path.charAt(0)!=="/"&&(D+="/"),D+=A.path(!0),A._parts.query){for(var k="",G=0,ee=A._parts.query.split("&"),J=ee.length;G<J;G++){var re=(ee[G]||"").split("=");k+="&"+o.decodeQuery(re[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),re[1]!==void 0&&(k+="="+o.decodeQuery(re[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}D+="?"+k.substring(1)}return D+=o.decodeQuery(A.hash(),!0),D},l.absoluteTo=function(A){var D=this.clone(),k=["protocol","username","password","hostname","port"],G,ee,J;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(A instanceof o||(A=new o(A)),D._parts.protocol||(D._parts.protocol=A._parts.protocol,this._parts.hostname))return D;for(ee=0;J=k[ee];ee++)D._parts[J]=A._parts[J];return D._parts.path?(D._parts.path.substring(-2)===".."&&(D._parts.path+="/"),D.path().charAt(0)!=="/"&&(G=A.directory(),G=G||(A.path().indexOf("/")===0?"/":""),D._parts.path=(G?G+"/":"")+D._parts.path,D.normalizePath())):(D._parts.path=A._parts.path,D._parts.query||(D._parts.query=A._parts.query)),D.build(),D},l.relativeTo=function(A){var D=this.clone().normalize(),k,G,ee,J,re;if(D._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(A=new o(A).normalize(),k=D._parts,G=A._parts,J=D.path(),re=A.path(),J.charAt(0)!=="/")throw new Error("URI is already relative");if(re.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(k.protocol===G.protocol&&(k.protocol=null),k.username!==G.username||k.password!==G.password||k.protocol!==null||k.username!==null||k.password!==null)return D.build();if(k.hostname===G.hostname&&k.port===G.port)k.hostname=null,k.port=null;else return D.build();if(J===re)return k.path="",D.build();if(ee=o.commonPath(J,re),!ee)return D.build();var oe=G.path.substring(ee.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return k.path=oe+k.path.substring(ee.length)||"./",D.build()},l.equals=function(A){var D=this.clone(),k=new o(A),G={},ee={},J={},re,oe,me;if(D.normalize(),k.normalize(),D.toString()===k.toString())return!0;if(re=D.query(),oe=k.query(),D.query(""),k.query(""),D.toString()!==k.toString()||re.length!==oe.length)return!1;G=o.parseQuery(re,this._parts.escapeQuerySpace),ee=o.parseQuery(oe,this._parts.escapeQuerySpace);for(me in G)if(c.call(G,me)){if(p(G[me])){if(!x(G[me],ee[me]))return!1}else if(G[me]!==ee[me])return!1;J[me]=!0}for(me in ee)if(c.call(ee,me)&&!J[me])return!1;return!0},l.preventInvalidHostname=function(A){return this._parts.preventInvalidHostname=!!A,this},l.duplicateQueryParameters=function(A){return this._parts.duplicateQueryParameters=!!A,this},l.escapeQuerySpace=function(A){return this._parts.escapeQuerySpace=!!A,this},o})})(JE);var ZF=JE.exports;const Vr=n0(ZF);var Xi=(n=>(n[n.UNISSUED=0]="UNISSUED",n[n.ISSUED=1]="ISSUED",n[n.ACTIVE=2]="ACTIVE",n[n.RECEIVED=3]="RECEIVED",n[n.CANCELLED=4]="CANCELLED",n[n.FAILED=5]="FAILED",n))(Xi||{}),z0=(n=>(n[n.MODEL=0]="MODEL",n[n.DRAWING=1]="DRAWING",n[n.OTHER=3]="OTHER",n[n.TILES2D=4]="TILES2D",n[n.TILES3D=5]="TILES3D",n))(z0||{});let nT=class $1{constructor(e={}){f(this,"url");f(this,"requestFunction");f(this,"cancelFunction");f(this,"priorityFunction");f(this,"state",Xi.UNISSUED);f(this,"priority",0);f(this,"throttle");f(this,"throttleByServer");f(this,"type");f(this,"serverKey");f(this,"deferred");f(this,"cancelled",!1);const t=ye(e.throttleByServer,!1),i=ye(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=ye(e.priority,0),this.throttle=i,this.throttleByServer=t,this.type=ye(e.type,z0.OTHER),this.deferred=void 0}cancel(){this.cancelled=!0}clone(e=new $1(this)){return e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=Xi.UNISSUED,e.deferred=void 0,e.cancelled=!1,e}};function KF(n){const e={};if(!n)return e;const t=n.split(`\r
`);for(let i=0;i<t.length;++i){const r=t[i],s=r.indexOf(": ");if(s>0){const o=r.substring(0,s),a=r.substring(s+2);e[o]=a}}return e}class rT{constructor(e,t,i){f(this,"statusCode");f(this,"response");f(this,"responseHeaders");this.statusCode=e,this.response=t,this.responseHeaders=i,typeof this.responseHeaders=="string"&&(this.responseHeaders=KF(this.responseHeaders))}toString(){let e="Request has failed.";return O(this.statusCode)&&(e+=` Status Code: ${this.statusCode}`),e}}function H0(n,e,t){const i=n[e];n[e]=n[t],n[t]=i}class QF{constructor(e){f(this,"_comparator");f(this,"_array",[]);f(this,"_length",0);f(this,"_maximumLength",0);this._comparator=e.comparator}get length(){return this._length}get internalArray(){return this._array}get maximumLength(){return this._maximumLength}set maximumLength(e){e<0&&(e=0);const t=this._length;if(e<t){const i=this._array;for(let r=e;r<t;++r)i[r]=void 0;this._length=e,i.length=e}this._maximumLength=e}get comparator(){return this._comparator}reserve(e=this._length){this._array.length=e}heapify(e=0){const t=this._length,i=this._comparator,r=this._array;let s=-1,o=!0;for(;o;){const a=2*(e+1),l=a-1;l<t&&i(r[l],r[e])<0?s=l:s=e,a<t&&i(r[a],r[s])<0&&(s=a),s!==e?(H0(r,s,e),e=s):o=!1}}resort(){const e=this._length;for(let t=Math.ceil(e/2);t>=0;--t)this.heapify(t)}insert(e){const t=this._array,i=this._comparator,r=this._maximumLength;let s=this._length++;for(s<t.length?t[s]=e:t.push(e);s!==0;){const a=Math.floor((s-1)/2);if(i(t[s],t[a])<0)H0(t,s,a),s=a;else break}let o;return O(r)&&this._length>r&&(o=t[r],this._length=r),o}pop(e=0){if(this._length===0)return;const t=this._array,i=t[e];return H0(t,e,--this._length),this.heapify(e),t[this._length]=void 0,i}}function mr(){let n,e;const t=new Promise((i,r)=>{n=i,e=r});return{resolve:n,reject:e,promise:t}}const $F=/^blob:/i;function JF(n){return $F.test(n)}const eU=/^data:/i;function sT(n){return eU.test(n)}function tU(n,e){return n.priority-e.priority}const fs={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0};let oT=20;const Ao=new QF({comparator:tU});Ao.maximumLength=oT,Ao.reserve(oT);const Mo=[];let Ha={};const iU=typeof document<"u"?new Vr(document.location.href):new Vr;function aT(n){return n.state===Xi.UNISSUED&&(n.state=Xi.ISSUED,n.deferred=mr()),n.deferred.promise}function nU(n){return e=>{if(n.state===Xi.CANCELLED)return;const t=n.deferred;--fs.numberOfActiveRequests,--Ha[n.serverKey],Ys.RequestCompletedEvent.raiseEvent(),n.state=Xi.RECEIVED,n.deferred=void 0,t.resolve(e)}}function rU(n){return e=>{n.state!==Xi.CANCELLED&&(++fs.numberOfFailedRequests,--fs.numberOfActiveRequests,--Ha[n.serverKey],Ys.RequestCompletedEvent.raiseEvent(),n.state=Xi.FAILED,n.deferred.reject(e))}}function lT(n){const e=aT(n);return n.state=Xi.ACTIVE,Mo.push(n),++fs.numberOfActiveRequests,++fs.numberOfActiveRequestsEver,++Ha[n.serverKey],n.requestFunction().then(nU(n)).catch(rU(n)),e}function Sp(n){const e=n.state===Xi.ACTIVE;if(n.state=Xi.CANCELLED,++fs.numberOfCancelledRequests,O(n.deferred)){const t=n.deferred;n.deferred=void 0,t.reject()}e&&(--fs.numberOfActiveRequests,--Ha[n.serverKey],++fs.numberOfCancelledActiveRequests),O(n.cancelFunction)&&n.cancelFunction()}function cT(n){O(n.priorityFunction)&&(n.priority=n.priorityFunction())}const bn=class bn{get statistics(){return fs}static getServerKey(e){let t=new Vr(e);t.scheme()===""&&(t=new Vr(e).absoluteTo(iU),t.normalize());let i=t.authority();/:/.test(i)||(i=`${i}:${t.scheme()==="https"?"443":"80"}`);const r=Ha[i];return O(r)||(Ha[i]=0),i}static request(e){if(sT(e.url)||JF(e.url))return bn.RequestCompletedEvent.raiseEvent(),e.state=Xi.RECEIVED,e.requestFunction();if(++fs.numberOfAttemptedRequests,O(e.serverKey)||(e.serverKey=bn.getServerKey(e.url)),e.throttleByServer&&!bn.serverHasOpenSlots(e.serverKey))return;if(!e.throttle)return lT(e);if(Mo.length>=bn.maximumRequests)return;cT(e);const t=Ao.insert(e);if(O(t)){if(t===e)return;Sp(t)}return aT(e)}static serverHasOpenSlots(e,t=1){const i=ye(bn.requestsByServer[e],bn.maximumRequestsPerServer);return Ha[e]+t<=i}static update(){let e,t,i=0;const r=Mo.length;for(e=0;e<r;++e){if(t=Mo[e],t.cancelled&&Sp(t),t.state!==Xi.ACTIVE){++i;continue}i>0&&(Mo[e-i]=t)}Mo.length-=i;const s=Ao.internalArray,o=Ao.length;for(e=0;e<o;++e)cT(s[e]);Ao.resort();const a=Math.max(bn.maximumRequests-Mo.length,0);let l=0;for(;l<a&&Ao.length>0;){if(t=Ao.pop(),t.cancelled){Sp(t);continue}if(t.throttleByServer&&!bn.serverHasOpenSlots(t.serverKey)){Sp(t);continue}lT(t),++l}}};f(bn,"requestsByServer",{}),f(bn,"throttleRequests",!0),f(bn,"debugShowStatistics",!1),f(bn,"maximumRequests",50),f(bn,"maximumRequestsPerServer",6),f(bn,"activeRequests",Mo),f(bn,"RequestCompletedEvent",new Vn);let Ys=bn;class oc extends Error{constructor(t){super();f(this,"name","RuntimeError");f(this,"message");f(this,"stack");this.message=t;let i;try{throw new Error(t)}catch(r){i=r.stack}this.stack=i}toString(){let t=`${this.name}: ${this.message}`;return O(this.stack)&&(t+=`
${this.stack.toString()}`),t}}let hT={};function sU(n){const e=new Vr(n);e.normalize();let t=e.authority();if(t.length!==0){if(e.authority(t),t.indexOf("@")!==-1&&(t=t.split("@")[1]),t.indexOf(":")===-1){let i=e.scheme();if(i.length===0&&(i=window.location.protocol,i=i.substring(0,i.length-1)),i==="http")t+=":80";else if(i==="https")t+=":443";else return}return t}}const uT={contains(n){const e=sU(n);return!!(O(e)&&O(hT[e]))},clear(){hT={}}};function oU(n){return(n.length===0||n[n.length-1]!=="/")&&(n=n+"/"),n}function js(n,e=!1){if(n===null||typeof n!="object")return n;e=ye(e,!1);const t=new n.constructor;for(const i in n)if(n.hasOwnProperty(i)){let r=n[i];e&&(r=js(r,e)),t[i]=r}return t}function Ga(n,e,t=!1){t=ye(t,!1);const i={},r=O(n),s=O(e);let o,a,l;if(r)for(o in n)n.hasOwnProperty(o)&&(a=n[o],s&&t&&typeof a=="object"&&e.hasOwnProperty(o)?(l=e[o],typeof l=="object"?i[o]=Ga(a,l,t):i[o]=a):i[o]=a);if(s)for(o in e)e.hasOwnProperty(o)&&!i.hasOwnProperty(o)&&(l=e[o],i[o]=l);return i}function G0(n,e){let t;return typeof document<"u"&&(t=document),G0._implementation(n,e,t)}G0._implementation=function(n,e,t){if(!O(e)){if(typeof t>"u")return n;e=ye(t.baseURI,t.location.href)}const i=new Vr(n);return i.scheme()!==""?i.toString():i.absoluteTo(e).toString()};function aU(n,e=!1){if(!O(n))throw new Ze("uri is required.");var t="",i=n.lastIndexOf("/");return i!==-1&&(t=n.substring(0,i+1)),e&&(n=new Vr(n),n.query().length!==0&&(t+="?"+n.query()),n.fragment().length!==0&&(t+="#"+n.fragment())),t}const fT={};function dT(n,e,t){O(e)||(e=n.width),O(t)||(t=n.height);let i=fT[e];O(i)||(i={},fT[e]=i);let r=i[t];if(!O(r)){const s=document.createElement("canvas");s.width=e,s.height=t,r=s.getContext("2d"),r.globalCompositeOperation="copy",i[t]=r}return r.drawImage(n,0,0,e,t),r.getImageData(0,0,e,t).data}function lU(n){let e="";for(const t in n)if(n.hasOwnProperty(t)){const i=n[t],r=`${encodeURIComponent(t)}=`;if(Array.isArray(i))for(let s=0,o=i.length;s<o;++s)e+=`${r+encodeURIComponent(i[s])}&`;else e+=`${r+encodeURIComponent(i)}&`}return e=e.slice(0,-1),e}function pT(n){if(!O(n))throw new Ze("queryString is required.");const e={};if(n==="")return e;const t=n.replace(/\+/g,"%20").split(/[&;]/);for(let i=0,r=t.length;i<r;++i){const s=t[i].split("="),o=decodeURIComponent(s[0]);let a=s[1];O(a)?a=decodeURIComponent(a):a="";const l=e[o];typeof l=="string"?e[o]=[l,a]:Array.isArray(l)?l.push(a):e[o]=a}return e}const Nr=class Nr{constructor(e){f(this,"_config");Nr.config=e,Nr.config.headers=ye(Nr.config.headers,{});let i=e.baseUrl.split("/");i[2]&&(Nr.domain=i[0]+"//"+i[2]),this._config=e}static getFileGeoBBoxText(e){let t=Nr.domain,{fileId:i,layoutName:r,boundingBox:s}=e;return Hi.post({url:t+"/v1/contral/file/fileGeoBBoxText",responseType:"json",headers:{"Content-Type":"application/json"},data:JSON.stringify({layoutName:r,id:i,minX:s[0],minY:s[1],maxX:s[2],maxY:s[3]})})}static async getFileSearchText(e){let t=Nr.domain,{fileId:i,layoutName:r,boundingBox:s,searchText:o,isFullMatching:a}=e,l;return s?l={layoutName:r,id:i,boundingBox:{minX:s[0],minY:s[1],maxX:s[2],maxY:s[3]},isFullMatching:a,searchText:o}:l={layoutName:r,id:i,isFullMatching:a,searchText:o},Hi.post({url:t+"/v1/contral/file/fileSearchText",responseType:"json",headers:{"Content-Type":"application/json"},data:JSON.stringify(l)})}};f(Nr,"accessToken",null),f(Nr,"domain",""),f(Nr,"config"),f(Nr,"defaultAccessToken","Bearer eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiIxNjI2MzkyNDg3MzYwNjc5OTMwIiwiaWF0IjoxNzA4NDIwMTgxfQ.-u-fA-DzNFm4jlindfYLnEtrXj_5lAqf-zp5TmXBKec");let qs=Nr;function cU(n){return n.length===0?{}:n.indexOf("=")===-1?{[n]:void 0}:pT(n)}const hU=/^data:(.*?)(;base64)?,(.*)$/;let ac;function Ep(n,e){const t=decodeURIComponent(e);return n?atob(t):t}function mT(n,e){const t=Ep(n,e),i=new ArrayBuffer(t.length),r=new Uint8Array(i);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return i}function uU(n,e){e=ye(e,"");const t=n[1],i=!!n[2],r=n[3];let s,o;switch(e){case"":case"text":return Ep(i,r);case"arraybuffer":return mT(i,r);case"blob":return s=mT(i,r),new Blob([s],{type:t});case"document":return o=new DOMParser,o.parseFromString(Ep(i,r),t);case"json":return JSON.parse(Ep(i,r))}}const fU={loadImageElement(n,e,t){const i=new Image;i.onload=()=>{i.naturalWidth===0&&i.naturalHeight===0&&i.width===0&&i.height===0&&(i.width=300,i.height=150),t.resolve(i)},i.onerror=r=>{t.reject(r)},e&&(uT.contains(n)?i.crossOrigin="use-credentials":i.crossOrigin=""),i.src=n},createImage(n,e,t,i,r,s){const o=n.url;Hi.supportsImageBitmapOptions().then(a=>{if(!(a&&s)){Hi._Implementations.loadImageElement(o,e,t);return}const l="blob",c="GET",u=mr(),d=Hi._Implementations.loadWithXhr(o,-1,void 0,l,c,void 0,void 0,u,void 0);return O(d)&&O(d.abort)&&(n.cancelFunction=function(){d.abort()}),u.promise.then(p=>{if(!O(p)){t.reject(new oc(`Successfully retrieved ${o} but it contained no content.`));return}return Hi.createImageBitmapFromBlob(p,{flipY:i,premultiplyAlpha:!1,skipColorSpaceConversion:r})}).then(function(p){t.resolve(p)})}).catch(a=>{t.reject(a)})},loadWithXhr(n,e,t,i,r,s,o,a,l){const c=hU.exec(n);if(c!==null){a.resolve(uU(c,i));return}const u=new XMLHttpRequest;if(uT.contains(n)&&(u.withCredentials=!0),u.open(r,n,!0),O(l)&&O(u.overrideMimeType)&&u.overrideMimeType(l),O(o))for(const p in o)o.hasOwnProperty(p)&&u.setRequestHeader(p,o[p]);O(i)&&(u.responseType=i);let d=!1;return typeof n=="string"&&(d=n.indexOf("file://")===0||typeof window<"u"&&window.location.origin==="file://"),u.onload=()=>{if((u.status<200||u.status>=300)&&!(d&&u.status===0)){a.reject(new rT(u.status,u.response,u.getAllResponseHeaders()));return}const p=u.response,g=u.responseType;if(r==="HEAD"||r==="OPTIONS"){const x=u.getAllResponseHeaders().trim().split(/[\r\n]+/),b={};x.forEach(y=>{const M=y.split(": "),E=M.shift();b[E]=M.join(": ")}),a.resolve(b);return}if(u.status===204)a.resolve();else if(O(p)&&(!O(i)||g===i))a.resolve(p);else if(i==="json"&&typeof p=="string")try{a.resolve(JSON.parse(p))}catch(_){a.reject(_)}else(g===""||g==="document")&&O(u.responseXML)&&u.responseXML.hasChildNodes()?a.resolve(u.responseXML):(g===""||g==="text")&&O(u.responseText)?a.resolve(u.responseText):a.reject(new oc("Invalid XMLHttpRequest response type."))},e>0&&(u.timeout=e,u.ontimeout=()=>{a.reject(new oc(""))}),O(t)&&(u.onprogress=p=>{t({lengthComputable:p.lengthComputable,loaded:p.loaded,total:p.total,responseURL:p.currentTarget.responseURL})}),u.onerror=p=>{a.reject(new rT)},u.send(s),u}};function gT(n,e,t,i){const r=n.query();if(r.length===0)return{};let s;if(r.indexOf("=")===-1){const o={};o[r]=void 0,s=o}else s=pT(r);t?e._queryParameters=Tp(s,e._queryParameters,i):e._queryParameters=s,n.search("")}function dU(n,e){const t=e._queryParameters,i=Object.keys(t);i.length===1&&!O(t[i[0]])?n.search(i[0]):n.search(lU(t))}function Tp(n,e,t){if(!t)return Ga(n,e);const i=js(n,!0);for(const r in e)if(e.hasOwnProperty(r)){let s=i[r];const o=e[r];O(s)?(Array.isArray(s)||(s=i[r]=[s]),i[r]=s.concat(o)):i[r]=Array.isArray(o)?o.slice():o}return i}function _T(n){if(n.state===Xi.ISSUED||n.state===Xi.ACTIVE)throw new Error("The Resource is already being fetched.");n.state=Xi.UNISSUED,n.deferred=void 0}function Ap(n,e){return O(n)?O(n.clone)?n.clone():js(n):e}const Qn=class Qn{constructor(e){f(this,"_url");f(this,"retryAttempts",0);f(this,"_retryCount",0);f(this,"_templateValues");f(this,"_queryParameters",{});f(this,"request");f(this,"headers");f(this,"proxy");f(this,"retryCallback");f(this,"progressCallback");f(this,"timeout",0);typeof e=="string"&&(e={url:e}),this._templateValues=Ap(e.templateValues,{}),this._queryParameters=Ap(e.queryParameters,{}),this.headers=ye(e.headers,{}),qs.accessToken&&(this.headers.Authorization=qs.accessToken),this.timeout=ye(e.timeout,0),this.retryCallback=e.retryCallback,this.progressCallback=e.progressCallback,this.retryAttempts=ye(e.retryAttempts,0),this._retryCount=0,this.request=ye(e.request,new nT),this.proxy=e.proxy;const t=new Vr(e.url);gT(t,this,!0,!0),t.fragment(""),this._url=t.toString()}get url(){return this.getUrlComponent(!0,!0)}set url(e){let t=new Vr(e);gT(t,this,!1),t.fragment=void 0,this._url=t.toString()}get isDataUri(){return sT(this._url)}get queryParameters(){return this._queryParameters}get templateValues(){return this._templateValues}fetch(e){return e=Ap(e,{}),e.method="GET",this._makeRequest(e)}fetchJson(){return this.fetch({responseType:"text",timeout:3e5,headers:{Accept:"application/json,*/*;q=0.01"}}).then(t=>{if(O(t))return JSON.parse(t)})}static fetchJson(e){return new Qn(e).fetchJson()}fetchArrayBuffer(){return this.fetch({responseType:"arraybuffer"})}static fetchArrayBuffer(e){return new Qn(e).fetchArrayBuffer()}fetchBlob(){return this.fetch({responseType:"blob"})}static fetchBlob(e){return new Qn(e).fetchBlob()}static createImageBitmapFromBlob(e,t){return createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none",colorSpaceConversion:t.skipColorSpaceConversion?"none":"default"})}fetchImage(e={}){e=ye(e,ye.EMPTY_OBJECT);const t=ye(e.preferImageBitmap,!1);ye(e.preferBlob,!1);const i=ye(e.flipY,!1),r=ye(e.skipColorSpaceConversion,!1);return _T(this.request),vT({resource:this,flipY:i,skipColorSpaceConversion:r,preferImageBitmap:t})}static fetchImage(e){return new Qn(e).fetchImage({flipY:e.flipY,skipColorSpaceConversion:e.skipColorSpaceConversion,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})}static supportsImageBitmapOptions(){if(O(ac))return ac;if(typeof createImageBitmap!="function")return ac=Promise.resolve(!1),ac;const e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAABGdBTUEAAE4g3rEiDgAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADElEQVQI12Ng6GAAAAEUAIngE3ZiAAAAAElFTkSuQmCC";return ac=Qn.fetchBlob({url:e}).then(t=>{const i={imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"none"};return Promise.all([createImageBitmap(t,i),createImageBitmap(t)])}).then(t=>{const i=dT(t[0]),r=dT(t[1]);return i[1]!==r[1]}).catch(()=>!1),ac}_makeRequest(e){const t=this;_T(t.request);const i=t.request;i.url=t.url,i.requestFunction=()=>{const s=e.responseType,o=Ga(e.headers,t.headers),a=e.overrideMimeType,l=e.method,c=e.data,u=mr(),d=t.timeout,p=t.progressCallback,g=Qn._Implementations.loadWithXhr(t.url,d,p,s,l,c,o,u,a);return O(g)&&O(g.abort)&&(i.cancelFunction=()=>{g.abort()}),u.promise};const r=Ys.request(i);if(O(r))return r.then(s=>(i.cancelFunction=void 0,s)).catch(s=>(i.cancelFunction=void 0,i.state!==Xi.FAILED?Promise.reject(s):t.retryOnError(s).then(o=>o?(i.state=Xi.UNISSUED,i.deferred=void 0,t.fetch(e)):Promise.reject(s))))}getUrlComponent(e=!1,t=!1){if(this.isDataUri)return this._url;const i=new Vr(this._url);e&&dU(i,this);let r=i.toString().replace(/%7B/g,"{").replace(/%7D/g,"}");const s=this._templateValues;return r=r.replace(/{(.*?)}/g,function(o,a){const l=s[a];return O(l)?encodeURIComponent(l):o}),t&&O(this.proxy)&&(r=this.proxy.getURL(r)),r}retryOnError(e){const t=this.retryCallback;return typeof t!="function"||this._retryCount>=this.retryAttempts?Promise.resolve(!1):Promise.resolve(t(this,e)).then(i=>(++this._retryCount,i))}getBaseUri(e=!0){return aU(this.getUrlComponent(e),e)}post(e,t){return t=Ap(t,{}),t.method="POST",t.data=e,this._makeRequest(t)}static post(e){return new Qn(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})}static createIfNeeded(e){return e instanceof Qn?e.getDerivedResource({request:e.request}):typeof e!="string"?e:new Qn({url:e})}parseUrl(e,t,i,r){let s=new Vr(e);const o=cU(s.query());this._queryParameters=t?Tp(o,this.queryParameters,i):o,s.search(""),s.fragment(""),O(r)&&s.scheme()===""&&(s=s.absoluteTo(G0(r))),this._url=s.toString()}getDerivedResource(e){const t=this.clone();if(t._retryCount=0,O(e.url)){const i=ye(e.preserveQueryParameters,!1);t.parseUrl(e.url,!0,i,this._url)}return O(e.queryParameters)&&(t._queryParameters=Ga(e.queryParameters,t.queryParameters)),O(e.templateValues)&&(t._templateValues=Ga(e.templateValues,t.templateValues)),O(e.headers)&&(t.headers=Ga(e.headers,t.headers)),O(e.proxy)&&(t.proxy=e.proxy),O(e.request)&&(t.request=e.request),O(e.retryCallback)&&(t.retryCallback=e.retryCallback),O(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t}clone(e){return O(e)?(e._url=this._url,e._queryParameters=js(this._queryParameters),e._templateValues=js(this._templateValues),e.headers=js(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e):new Qn({url:this._url,queryParameters:this.queryParameters,templateValues:this.templateValues,headers:this.headers,proxy:this.proxy,retryCallback:this.retryCallback,retryAttempts:this.retryAttempts,request:this.request.clone(),parseUrl:!1})}setQueryParameters(e,t=!1){t?this._queryParameters=Tp(this._queryParameters,e,!1):this._queryParameters=Tp(e,this._queryParameters,!1)}appendForwardSlash(){this._url=oU(this._url)}};f(Qn,"DEFAULT",Object.freeze(new Qn({url:typeof document>"u"?"":document.location.href.split("?")[0]}))),f(Qn,"_Implementations",fU);let Hi=Qn;function vT(n){const e=n.resource,t=n.flipY,i=n.skipColorSpaceConversion,r=n.preferImageBitmap,s=e.request;s.url=e.url,s.requestFunction=function(){let a=!1;!e.isDataUri&&!e.isBlobUri&&(a=e.isCrossOriginUrl);const l=mr();return Hi._Implementations.createImage(s,a,l,t,i,r),l.promise};const o=Ys.request(s);if(O(o))return o.catch(a=>s.state!==Xi.FAILED?Promise.reject(a):e.retryOnError(a).then(l=>l?(s.state=Xi.UNISSUED,s.deferred=void 0,vT({resource:e,flipY:t,skipColorSpaceConversion:i,preferImageBitmap:r})):Promise.reject(a)))}class yT{constructor(){f(this,"_array");f(this,"_hash");this._array=[],this._hash={}}get length(){return this._array.length}get values(){return this._array}contains(e){if(typeof e!="string"&&typeof e!="number")throw new Ze("key is required to be a string or number.");return O(this._hash[e])}set(e,t){if(typeof e!="string"&&typeof e!="number")throw new Ze("key is required to be a string or number.");const i=this._hash[e];t!==i&&(this.remove(e),this._hash[e]=t,this._array.push(t))}get(e){if(typeof e!="string"&&typeof e!="number")throw new Ze("key is required to be a string or number.");return this._hash[e]}remove(e){if(O(e)&&typeof e!="string"&&typeof e!="number")throw new Ze("key is required to be a string or number.");const t=this._hash[e],i=O(t);if(i){const r=this._array;r.splice(r.indexOf(t),1),delete this._hash[e]}return i}removeAll(){const e=this._array;e.length>0&&(this._hash={},e.length=0)}}var Wr=(n=>(n[n.SHIFT=0]="SHIFT",n[n.CTRL=1]="CTRL",n[n.ALT=2]="ALT",n))(Wr||{}),vt=(n=>(n[n.LEFT_DOWN=0]="LEFT_DOWN",n[n.LEFT_UP=1]="LEFT_UP",n[n.LEFT_CLICK=2]="LEFT_CLICK",n[n.LEFT_DOUBLE_CLICK=3]="LEFT_DOUBLE_CLICK",n[n.RIGHT_DOWN=5]="RIGHT_DOWN",n[n.RIGHT_UP=6]="RIGHT_UP",n[n.RIGHT_CLICK=7]="RIGHT_CLICK",n[n.MIDDLE_DOWN=10]="MIDDLE_DOWN",n[n.MIDDLE_UP=11]="MIDDLE_UP",n[n.MIDDLE_CLICK=12]="MIDDLE_CLICK",n[n.MOUSE_MOVE=15]="MOUSE_MOVE",n[n.WHEEL=16]="WHEEL",n[n.PINCH_START=17]="PINCH_START",n[n.PINCH_END=18]="PINCH_END",n[n.PINCH_MOVE=19]="PINCH_MOVE",n))(vt||{});const Mp=window.document;function Co(n,e,t){const i=n._element;if(i===Mp)return t.x=e.clientX,t.y=e.clientY,t;const r=i.getBoundingClientRect();return t.x=e.clientX-r.left,t.y=e.clientY-r.top,t}function V0(n,e){let t=n;return O(e)&&(t+="+"+e),t}function Va(n){if(n.shiftKey)return Wr.SHIFT;if(n.ctrlKey)return Wr.CTRL;if(n.altKey)return Wr.ALT}const Ki={LEFT:0,MIDDLE:1,RIGHT:2};function gr(n,e,t,i){function r(s){i(n,s)}t.addEventListener(e,r,{capture:!1,passive:!1}),n._removalFunctions.push(function(){t.removeEventListener(e,r,!1)})}function pU(n){const e=n._element,t=O(e.disableRootEvents)?e:Mp;Ot.supportsPointerEvents()?(gr(n,"pointerdown",e,bU),gr(n,"pointerup",e,LT),gr(n,"pointermove",e,xU),gr(n,"pointercancel",e,LT)):(gr(n,"mousedown",e,xT),gr(n,"mouseup",t,ET),gr(n,"mousemove",t,TT),gr(n,"touchstart",e,vU),gr(n,"touchend",t,MT),gr(n,"touchmove",t,yU),gr(n,"touchcancel",t,MT)),gr(n,"dblclick",e,gU);let i;"onwheel"in e?i="wheel":Mp.onmousewheel!==void 0?i="mousewheel":i="DOMMouseScroll",gr(n,i,e,_U)}function mU(n){const e=n._removalFunctions;for(let t=0;t<e.length;++t)e[t]()}const bT={position:new he};function W0(n){n._lastSeenTouchEvent=_o()}function X0(n){return _o()-n._lastSeenTouchEvent>Yn.mouseEmulationIgnoreMilliseconds}function Y0(n,e,t){const i=n.x-e.x,r=n.y-e.y;return Math.sqrt(i*i+r*r)<t}function xT(n,e){if(!X0(n))return;const t=e.button;n._buttonDown[t]=!0;let i;if(t===Ki.LEFT)i=vt.LEFT_DOWN;else if(t===Ki.MIDDLE)i=vt.MIDDLE_DOWN;else if(t===Ki.RIGHT)i=vt.RIGHT_DOWN;else return;const r=Co(n,e,n._primaryPosition);n._primaryStartPosition.copy(r),n._primaryPreviousPosition.copy(r);const s=Va(e),o=n.getInputAction(i,s);O(o)&&(bT.position.copy(r),o(bT),e.preventDefault())}const wT={position:new he},ST={position:new he};function j0(n,e,t,i){const r=Va(i),s=n.getInputAction(e,r),o=n.getInputAction(t,r);if(O(s)||O(o)){const a=Co(n,i,n._primaryPosition);if(O(s)&&(wT.position.copy(a),s(wT)),O(o)){const l=n._primaryStartPosition;Y0(l,a,n._clickPixelTolerance)&&(ST.position.copy(a),o(ST))}}}function ET(n,e){if(!X0(n))return;const t=e.button;t!==Ki.LEFT&&t!==Ki.MIDDLE&&t!==Ki.RIGHT||(n._buttonDown[Ki.LEFT]&&(j0(n,vt.LEFT_UP,vt.LEFT_CLICK,e),n._buttonDown[Ki.LEFT]=!1),n._buttonDown[Ki.MIDDLE]&&(j0(n,vt.MIDDLE_UP,vt.MIDDLE_CLICK,e),n._buttonDown[Ki.MIDDLE]=!1),n._buttonDown[Ki.RIGHT]&&(j0(n,vt.RIGHT_UP,vt.RIGHT_CLICK,e),n._buttonDown[Ki.RIGHT]=!1))}const q0={startPosition:new he,endPosition:new he};function TT(n,e){if(!X0(n))return;const t=Va(e),i=Co(n,e,n._primaryPosition),r=n._primaryPreviousPosition,s=n.getInputAction(vt.MOUSE_MOVE,t);O(s)&&(q0.startPosition.copy(r),q0.endPosition.copy(i),s(q0)),r.copy(i),(n._buttonDown[Ki.LEFT]||n._buttonDown[Ki.MIDDLE]||n._buttonDown[Ki.RIGHT])&&e.preventDefault()}const AT={position:new he};function gU(n,e){const t=e.button;let i;if(t===Ki.LEFT)i=vt.LEFT_DOUBLE_CLICK;else return;const r=Va(e),s=n.getInputAction(i,r);O(s)&&(Co(n,e,AT.position),s(AT))}function _U(n,e){let t;if(O(e.deltaY)){const s=e.deltaMode;s===e.DOM_DELTA_PIXEL?t=-e.deltaY:s===e.DOM_DELTA_LINE?t=-e.deltaY*40:t=-e.deltaY*120}else e.detail>0?t=e.detail*-120:t=e.wheelDelta;if(!O(t))return;const i=Va(e),r=n.getInputAction(vt.WHEEL,i);O(r)&&(r(t),e.preventDefault())}function vU(n,e){W0(n);const t=e.changedTouches;let i;const r=t.length;let s,o;const a=n._positions;for(i=0;i<r;++i)s=t[i],o=s.identifier,a.set(o,Co(n,s,new he));Cp(n,e);const l=n._previousPositions;for(i=0;i<r;++i)s=t[i],o=s.identifier,l.set(o,a.get(o).clone())}function MT(n,e){W0(n);const t=e.changedTouches;let i;const r=t.length;let s,o;const a=n._positions;for(i=0;i<r;++i)s=t[i],o=s.identifier,a.remove(o);Cp(n,e);const l=n._previousPositions;for(i=0;i<r;++i)s=t[i],o=s.identifier,l.remove(o)}const CT={position:new he},Z0={position1:new he,position2:new he},IT={position:new he},PT={position:new he},RT={position:new he};function Cp(n,e){const t=Va(e),i=n._positions,r=i.length;let s,o;const a=n._isPinching;if(r!==1&&n._buttonDown[Ki.LEFT]){if(n._buttonDown[Ki.LEFT]=!1,O(n._touchHoldTimer)&&(clearTimeout(n._touchHoldTimer),n._touchHoldTimer=void 0),s=n.getInputAction(vt.LEFT_UP,t),O(s)&&(IT.position.copy(n._primaryPosition),s(IT)),r===0&&!n._isTouchHolding&&(o=n.getInputAction(vt.LEFT_CLICK,t),O(o))){const l=n._primaryStartPosition,c=n._previousPositions.values[0];Y0(l,c,n._clickPixelTolerance)&&(PT.position.copy(n._primaryPosition),o(PT))}n._isTouchHolding=!1}if(r===0&&a&&(n._isPinching=!1,s=n.getInputAction(vt.PINCH_END,t),O(s)&&s()),r===1&&!a){const l=i.values[0];n._primaryPosition.copy(l),n._primaryStartPosition.copy(l),n._primaryPreviousPosition.copy(l),n._buttonDown[Ki.LEFT]=!0,s=n.getInputAction(vt.LEFT_DOWN,t),O(s)&&(CT.position.copy(l),s(CT)),n._touchHoldTimer=setTimeout(function(){if(!n.isDestroyed()&&(n._touchHoldTimer=void 0,n._isTouchHolding=!0,o=n.getInputAction(vt.RIGHT_CLICK,t),O(o))){const c=n._primaryStartPosition,u=n._previousPositions.values[0];Y0(c,u,n._holdPixelTolerance)&&(RT.position.copy(n._primaryPosition),o(RT))}},Yn.touchHoldDelayMilliseconds),e.preventDefault()}r===2&&!a&&(n._isPinching=!0,s=n.getInputAction(vt.PINCH_START,t),O(s)&&(Z0.position1.copy(i.values[0]),Z0.position2.copy(i.values[1]),s(Z0),e.preventDefault()))}function yU(n,e){W0(n);const t=e.changedTouches;let i;const r=t.length;let s,o;const a=n._positions;for(i=0;i<r;++i){s=t[i],o=s.identifier;const c=a.get(o);O(c)&&Co(n,s,c)}DT(n,e);const l=n._previousPositions;for(i=0;i<r;++i)s=t[i],o=s.identifier,l.get(o).copy(a.get(o))}const K0={startPosition:new he,endPosition:new he},lc={distance:{startPosition:new he,endPosition:new he},angleAndHeight:{startPosition:new he,endPosition:new he},centerPosition:new he};function DT(n,e){const t=Va(e),i=n._positions,r=n._previousPositions,s=i.length;let o;if(s===1&&n._buttonDown[Ki.LEFT]){const a=i.values[0];n._primaryPosition.copy(a);const l=n._primaryPreviousPosition;o=n.getInputAction(vt.MOUSE_MOVE,t),O(o)&&(K0.startPosition.copy(l),K0.endPosition.copy(a),o(K0)),l.copy(a),e.preventDefault()}else if(s===2&&n._isPinching&&(o=n.getInputAction(vt.PINCH_MOVE,t),O(o))){const a=i.values[0],l=i.values[1],c=r.values[0],u=r.values[1],d=l.x-a.x,p=l.y-a.y,g=Math.sqrt(d*d+p*p)*.25,_=u.x-c.x,x=u.y-c.y,b=Math.sqrt(_*_+x*x)*.25,y=(l.y+a.y)*.125,M=(u.y+c.y)*.125,E=Math.atan2(p,d),w=Math.atan2(x,_);lc.distance.startPosition.set(0,b),lc.distance.endPosition.set(0,g),lc.angleAndHeight.startPosition.set(w,M),lc.angleAndHeight.endPosition.set(E,y),lc.centerPosition.set((a.x+l.x)/2,(a.y+l.y)/2),o(lc)}}function bU(n,e){if(e.target.setPointerCapture(e.pointerId),e.pointerType==="touch"){const t=n._positions,i=e.pointerId;t.set(i,Co(n,e,new he)),Cp(n,e),n._previousPositions.set(i,t.get(i).clone())}else xT(n,e)}function LT(n,e){if(e.pointerType==="touch"){const t=n._positions,i=e.pointerId;t.remove(i),Cp(n,e),n._previousPositions.remove(i)}else ET(n,e)}function xU(n,e){if(e.pointerType==="touch"){const t=n._positions,i=e.pointerId,r=t.get(i);if(!O(r))return;Co(n,e,r),DT(n,e),n._previousPositions.get(i).copy(t.get(i))}else TT(n,e)}const Au=class Au{constructor(e){f(this,"_inputEvents");f(this,"_buttonDown");f(this,"_isPinching");f(this,"_isTouchHolding");f(this,"_lastSeenTouchEvent");f(this,"_primaryStartPosition");f(this,"_primaryPosition");f(this,"_primaryPreviousPosition");f(this,"_positions");f(this,"_previousPositions");f(this,"_removalFunctions");f(this,"_touchHoldTimer");f(this,"_clickPixelTolerance");f(this,"_holdPixelTolerance");f(this,"_element");this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-Au.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new he,this._primaryPosition=new he,this._primaryPreviousPosition=new he,this._positions=new yT,this._previousPositions=new yT,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=ye(e,Mp),pU(this)}setInputAction(e,t,i){if(!O(e))throw new Ze("action is required.");if(!O(t))throw new Ze("type is required.");const r=V0(t,i);this._inputEvents[r]=e}getInputAction(e,t){if(!O(e))throw new Ze("type is required.");const i=V0(e,t);return this._inputEvents[i]}removeInputAction(e,t){if(!O(e))throw new Ze("type is required.");const i=V0(e,t);delete this._inputEvents[i]}isDestroyed(){return!1}destroy(){return mU(this),ht(this)}};f(Au,"mouseEmulationIgnoreMilliseconds",800),f(Au,"touchHoldDelayMilliseconds",1500);let Yn=Au;class wU{constructor({radius:e=1,widthSegments:t=32,heightSegments:i=16,phiStart:r=0,phiLength:s=Math.PI*2,thetaStart:o=0,thetaLength:a=Math.PI}){f(this,"_rayCasterGeometry");f(this,"_instance");f(this,"radius",1);f(this,"widthSegments",32);f(this,"heightSegments",16);f(this,"phiStart",0);f(this,"phiLength",Math.PI*2);f(this,"thetaStart",0);f(this,"thetaLength",Math.PI);this.radius=e,this.widthSegments=t,this.heightSegments=i,this.phiStart=r,this.phiLength=s,this.thetaStart=o,this.thetaLength=a}createGeometry(){return this._instance=new Ul(this.radius,this.widthSegments,this.heightSegments,this.phiStart),this._instance}isDestroyed(){return!1}destroy(){throw new Error("Method not implemented.")}}const SU=new WeakMap;function Q0(n){const e=document.createRange(),t=new Xn;function i(p){const g=[];let _=!1;function x(){if(_&&(_=!1,p.restore()),g.length===0)return;let b=-1/0,y=-1/0,M=1/0,E=1/0;for(let w=0;w<g.length;w++){const I=g[w];b=Math.max(b,I.x),y=Math.max(y,I.y),M=Math.min(M,I.x+I.width),E=Math.min(E,I.y+I.height)}p.save(),p.beginPath(),p.rect(b,y,M-b,E-y),p.clip(),_=!0}return{add:function(b){g.push(b),x()},remove:function(){g.pop(),x()}}}function r(p,g,_,x){x!==""&&(p.textTransform==="uppercase"&&(x=x.toUpperCase()),u.font=p.fontWeight+" "+p.fontSize+" "+p.fontFamily,u.textBaseline="top",u.fillStyle=p.color,u.fillText(x,g,_+parseFloat(p.fontSize)*.1))}function s(p,g,_,x,b){_<2*b&&(b=_/2),x<2*b&&(b=x/2),u.beginPath(),u.moveTo(p+b,g),u.arcTo(p+_,g,p+_,g+x,b),u.arcTo(p+_,g+x,p,g+x,b),u.arcTo(p,g+x,p,g,b),u.arcTo(p,g,p+_,g,b),u.closePath()}function o(p,g,_,x,b,y){const M=p[g+"Width"],E=p[g+"Style"],w=p[g+"Color"];M!=="0px"&&E!=="none"&&w!=="transparent"&&w!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=w,u.lineWidth=parseFloat(M),u.beginPath(),u.moveTo(_,x),u.lineTo(_+b,x+y),u.stroke())}function a(p,g){if(p.nodeType===Node.COMMENT_NODE||p.nodeName==="SCRIPT"||p.style&&p.style.display==="none")return;let _=0,x=0,b=0,y=0;if(p.nodeType===Node.TEXT_NODE){e.selectNode(p);const E=e.getBoundingClientRect();_=E.left-l.left-.5,x=E.top-l.top-.5,b=E.width,y=E.height,r(g,_,x,p.nodeValue.trim())}else if(p instanceof HTMLCanvasElement){const E=p.getBoundingClientRect();_=E.left-l.left-.5,x=E.top-l.top-.5,u.save();const w=window.devicePixelRatio;u.scale(1/w,1/w),u.drawImage(p,_,x),u.restore()}else if(p instanceof HTMLImageElement){const E=p.getBoundingClientRect();_=E.left-l.left-.5,x=E.top-l.top-.5,b=E.width,y=E.height,u.drawImage(p,_,x,b,y)}else{const E=p.getBoundingClientRect();_=E.left-l.left-.5,x=E.top-l.top-.5,b=E.width,y=E.height,g=window.getComputedStyle(p),s(_,x,b,y,parseFloat(g.borderRadius));const w=g.backgroundColor;w!=="transparent"&&w!=="rgba(0, 0, 0, 0)"&&(u.fillStyle=w,u.fill());const I=["borderTop","borderLeft","borderBottom","borderRight"];let B=!0,N=null;for(const L of I){if(N!==null&&(B=g[L+"Width"]===g[N+"Width"]&&g[L+"Color"]===g[N+"Color"]&&g[L+"Style"]===g[N+"Style"]),B===!1)break;N=L}if(B===!0){const L=parseFloat(g.borderTopWidth);g.borderTopWidth!=="0px"&&g.borderTopStyle!=="none"&&g.borderTopColor!=="transparent"&&g.borderTopColor!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=g.borderTopColor,u.lineWidth=L,u.stroke())}else o(g,"borderTop",_,x,b,0),o(g,"borderLeft",_,x,0,y),o(g,"borderBottom",_,x+y,b,0),o(g,"borderRight",_+b,x,0,y);if(p instanceof HTMLInputElement){let L=g.accentColor;(L===void 0||L==="auto")&&(L=g.color),t.set(L);const R=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(p.type==="radio"&&(s(_,x,b,y,y),u.fillStyle="white",u.strokeStyle=L,u.lineWidth=1,u.fill(),u.stroke(),p.checked&&(s(_+2,x+2,b-4,y-4,y),u.fillStyle=L,u.strokeStyle=R,u.lineWidth=2,u.fill(),u.stroke())),p.type==="checkbox"&&(s(_,x,b,y,2),u.fillStyle=p.checked?L:"white",u.strokeStyle=p.checked?R:L,u.lineWidth=1,u.stroke(),u.fill(),p.checked)){const U=u.textAlign;u.textAlign="center";const j={color:R,fontFamily:g.fontFamily,fontSize:y+"px",fontWeight:"bold"};r(j,_+b/2,x,""),u.textAlign=U}if(p.type==="range"){const[U,j,A]=["min","max","value"].map(k=>parseFloat(p[k])),D=(A-U)/(j-U)*(b-y);s(_,x+y/4,b,y/2,y/4),u.fillStyle=R,u.strokeStyle=L,u.lineWidth=1,u.fill(),u.stroke(),s(_,x+y/4,D+y/2,y/2,y/4),u.fillStyle=L,u.fill(),s(_+D,x,y,y,y/2),u.fillStyle=L,u.fill()}(p.type==="color"||p.type==="text"||p.type==="number")&&(d.add({x:_,y:x,width:b,height:y}),r(g,_+parseInt(g.paddingLeft),x+parseInt(g.paddingTop),p.value),d.remove())}}const M=g.overflow==="auto"||g.overflow==="hidden";M&&d.add({x:_,y:x,width:b,height:y});for(let E=0;E<p.childNodes.length;E++)a(p.childNodes[E],g);M&&d.remove()}const l=n.getBoundingClientRect();let c=SU.get(n);c===void 0&&(c=document.createElement("canvas"),c.width=l.width,c.height=l.height);const u=c.getContext("2d"),d=new i(u);return u.clearRect(0,0,c.width,c.height),a(n),c}const y6="";function OT(n,e){if(n.length!==e.length)return!1;for(let t=n.length-1;t>=0;t--)if(n[t]!==e[t])return!1;return!0}function NT(n,e,t){for(let i=0;i<n.length;i+=t)if(OT(n.slice(i,i+t),e))return i;return-1}class EU{constructor(){f(this,"_removalFunctions",[])}add(e,t,i){let r=e.addEventListener(t,i);this._removalFunctions.push(r);let s=this;return function(){r();let o=s._removalFunctions;o.splice(o.indexOf(r),1)}}removeAll(){let e=this._removalFunctions;for(let t=0,i=e.length;t<i;++t)e[t]();e.length=0}}var $0=(n=>(n[n.OUTLINE=0]="OUTLINE",n[n.FILL_COLOR=1]="FILL_COLOR",n))($0||{});const BT=new Vi,Ip=new q;class Pp extends Ma{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new $e(e,3)),this.setAttribute("uv",new $e(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Gd(t,6,1);return this.setAttribute("instanceStart",new jt(i,3,0)),this.setAttribute("instanceEnd",new jt(i,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Gd(t,6,1);return this.setAttribute("instanceColorStart",new jt(i,3,0)),this.setAttribute("instanceColorEnd",new jt(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new p_(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Vi);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),BT.setFromBufferAttribute(t),this.boundingBox.union(BT))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Ip.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Ip)),Ip.fromBufferAttribute(t,s),r=Math.max(r,i.distanceToSquared(Ip));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}He.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new xe(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Ni.line={uniforms:Tn.merge([He.common,He.fog,He.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class FT extends wi{static get type(){return"LineMaterial"}constructor(e){super({uniforms:Tn.clone(Ni.line.uniforms),vertexShader:Ni.line.vertexShader,fragmentShader:Ni.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const J0=new Gt,UT=new q,kT=new q,dn=new Gt,pn=new Gt,ds=new Gt,ev=new q,tv=new Mt,mn=new ks,zT=new q,Rp=new Vi,Dp=new qi,ps=new Gt;let ms,Wa;function HT(n,e,t){return ps.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),ps.multiplyScalar(1/ps.w),ps.x=Wa/t.width,ps.y=Wa/t.height,ps.applyMatrix4(n.projectionMatrixInverse),ps.multiplyScalar(1/ps.w),Math.abs(Math.max(ps.x,ps.y))}function TU(n,e){const t=n.matrixWorld,i=n.geometry,r=i.attributes.instanceStart,s=i.attributes.instanceEnd,o=Math.min(i.instanceCount,r.count);for(let a=0,l=o;a<l;a++){mn.start.fromBufferAttribute(r,a),mn.end.fromBufferAttribute(s,a),mn.applyMatrix4(t);const c=new q,u=new q;ms.distanceSqToSegment(mn.start,mn.end,u,c),u.distanceTo(c)<Wa*.5&&e.push({point:u,pointOnLine:c,distance:ms.origin.distanceTo(u),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function AU(n,e,t){const i=e.projectionMatrix,s=n.material.resolution,o=n.matrixWorld,a=n.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,u=Math.min(a.instanceCount,l.count),d=-e.near;ms.at(1,ds),ds.w=1,ds.applyMatrix4(e.matrixWorldInverse),ds.applyMatrix4(i),ds.multiplyScalar(1/ds.w),ds.x*=s.x/2,ds.y*=s.y/2,ds.z=0,ev.copy(ds),tv.multiplyMatrices(e.matrixWorldInverse,o);for(let p=0,g=u;p<g;p++){if(dn.fromBufferAttribute(l,p),pn.fromBufferAttribute(c,p),dn.w=1,pn.w=1,dn.applyMatrix4(tv),pn.applyMatrix4(tv),dn.z>d&&pn.z>d)continue;if(dn.z>d){const E=dn.z-pn.z,w=(dn.z-d)/E;dn.lerp(pn,w)}else if(pn.z>d){const E=pn.z-dn.z,w=(pn.z-d)/E;pn.lerp(dn,w)}dn.applyMatrix4(i),pn.applyMatrix4(i),dn.multiplyScalar(1/dn.w),pn.multiplyScalar(1/pn.w),dn.x*=s.x/2,dn.y*=s.y/2,pn.x*=s.x/2,pn.y*=s.y/2,mn.start.copy(dn),mn.start.z=0,mn.end.copy(pn),mn.end.z=0;const x=mn.closestPointToPointParameter(ev,!0);mn.at(x,zT);const b=kn.lerp(dn.z,pn.z,x),y=b>=-1&&b<=1,M=ev.distanceTo(zT)<Wa*.5;if(y&&M){mn.start.fromBufferAttribute(l,p),mn.end.fromBufferAttribute(c,p),mn.start.applyMatrix4(o),mn.end.applyMatrix4(o);const E=new q,w=new q;ms.distanceSqToSegment(mn.start,mn.end,w,E),t.push({point:w,pointOnLine:E,distance:ms.origin.distanceTo(w),object:n,face:null,faceIndex:p,uv:null,uv1:null})}}}class GT extends pt{constructor(e=new Pp,t=new FT({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)UT.fromBufferAttribute(t,o),kT.fromBufferAttribute(i,o),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+UT.distanceTo(kT);const s=new Gd(r,2,1);return e.setAttribute("instanceDistanceStart",new jt(s,1,0)),e.setAttribute("instanceDistanceEnd",new jt(s,1,1)),this}raycast(e,t){const i=this.material.worldUnits,r=e.camera;r===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;ms=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;Wa=l.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),Dp.copy(a.boundingSphere).applyMatrix4(o);let c;if(i)c=Wa*.5;else{const d=Math.max(r.near,Dp.distanceToPoint(ms.origin));c=HT(r,d,l.resolution)}if(Dp.radius+=c,ms.intersectsSphere(Dp)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),Rp.copy(a.boundingBox).applyMatrix4(o);let u;if(i)u=Wa*.5;else{const d=Math.max(r.near,Rp.distanceToPoint(ms.origin));u=HT(r,d,l.resolution)}Rp.expandByScalar(u),ms.intersectsBox(Rp)!==!1&&(i?TU(this,t):AU(this,r,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(J0),this.material.uniforms.resolution.value.set(J0.z,J0.w))}}class iv extends Pp{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class MU extends GT{constructor(e=new iv,t=new FT({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}function cc(){this.array=null}function Xr(n){var i;let e=n.attributes,t=Object.keys(e);for(let r=0;r<t.length;r++){let s=e[t[r]];s.isInterleavedBufferAttribute?s.data.onUpload(cc):s.onUpload(cc)}(i=n.index)==null||i.onUpload(cc)}const CU=`uniform vec3 diffuse;\r
uniform float opacity;\r
uniform float linewidth;\r
\r
uniform vec4 pickColor;\r
uniform float enabledPick;\r
\r
#ifdef USE_DASH\r
\r
    uniform float dashOffset;\r
    uniform float dashSize;\r
    uniform float gapSize;\r
\r
#endif\r
\r
\r
		varying float vLineDistance;\r
\r
		#ifdef WORLD_UNITS\r
\r
			varying vec4 worldPos;\r
			varying vec3 worldStart;\r
			varying vec3 worldEnd;\r
\r
			#ifdef USE_DASH\r
\r
				varying vec2 vUv;\r
\r
			#endif\r
\r
		#else\r
\r
			varying vec2 vUv;\r
\r
		#endif\r
\r
		#include <common>\r
		#include <color_pars_fragment>\r
		#include <fog_pars_fragment>\r
		#include <logdepthbuf_pars_fragment>\r
		#include <clipping_planes_pars_fragment>\r
\r
		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\r
\r
			float mua;\r
			float mub;\r
\r
			vec3 p13 = p1 - p3;\r
			vec3 p43 = p4 - p3;\r
\r
			vec3 p21 = p2 - p1;\r
\r
			float d1343 = dot( p13, p43 );\r
			float d4321 = dot( p43, p21 );\r
			float d1321 = dot( p13, p21 );\r
			float d4343 = dot( p43, p43 );\r
			float d2121 = dot( p21, p21 );\r
\r
			float denom = d2121 * d4343 - d4321 * d4321;\r
\r
			float numer = d1343 * d4321 - d1321 * d4343;\r
\r
			mua = numer / denom;\r
			mua = clamp( mua, 0.0, 1.0 );\r
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;\r
			mub = clamp( mub, 0.0, 1.0 );\r
\r
			return vec2( mua, mub );\r
\r
		}\r
\r
		void main() {\r
\r
			#include <clipping_planes_fragment>\r
\r
			#ifdef USE_DASH\r
\r
				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\r
\r
				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\r
\r
			#endif\r
\r
			float alpha = opacity;\r
\r
			#ifdef WORLD_UNITS\r
\r
				// Find the closest points on the view ray and the line segment\r
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\r
				vec3 lineDir = worldEnd - worldStart;\r
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\r
\r
				vec3 p1 = worldStart + lineDir * params.x;\r
				vec3 p2 = rayEnd * params.y;\r
				vec3 delta = p1 - p2;\r
				float len = length( delta );\r
				float norm = len / linewidth;\r
\r
				#ifndef USE_DASH\r
\r
					#ifdef USE_ALPHA_TO_COVERAGE\r
\r
						float dnorm = fwidth( norm );\r
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\r
\r
					#else\r
\r
						if ( norm > 0.5 ) {\r
\r
							discard;\r
\r
						}\r
\r
					#endif\r
\r
				#endif\r
\r
			#else\r
\r
				#ifdef USE_ALPHA_TO_COVERAGE\r
\r
					// artifacts appear on some hardware if a derivative is taken within a conditional\r
					float a = vUv.x;\r
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\r
					float len2 = a * a + b * b;\r
					float dlen = fwidth( len2 );\r
\r
					if ( abs( vUv.y ) > 1.0 ) {\r
\r
						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\r
\r
					}\r
\r
				#else\r
\r
					if ( abs( vUv.y ) > 1.0 ) {\r
\r
						float a = vUv.x;\r
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\r
						float len2 = a * a + b * b;\r
\r
						if ( len2 > 1.0 ) discard;\r
\r
					}\r
\r
				#endif\r
\r
			#endif\r
\r
			vec4 diffuseColor = vec4( diffuse, alpha );\r
\r
			#include <logdepthbuf_fragment>\r
			#include <color_fragment>\r
\r
			gl_FragColor = vec4( diffuseColor.rgb, alpha );\r
\r
            gl_FragColor = mix(gl_FragColor, pickColor, enabledPick);\r
\r
			#include <tonemapping_fragment>\r
			#include <colorspace_fragment>\r
			#include <fog_fragment>\r
			#include <premultiplied_alpha_fragment>\r
\r
		}\r
`,IU=`#include <common>\r
		#include <color_pars_vertex>\r
		#include <fog_pars_vertex>\r
		#include <logdepthbuf_pars_vertex>\r
		#include <clipping_planes_pars_vertex>\r
\r
		uniform float linewidth;\r
		uniform vec2 resolution;\r
\r
		attribute vec3 instanceStart;\r
		attribute vec3 instanceEnd;\r
\r
		attribute vec3 instanceColorStart;\r
		attribute vec3 instanceColorEnd;\r
\r
		#ifdef WORLD_UNITS\r
\r
			varying vec4 worldPos;\r
			varying vec3 worldStart;\r
			varying vec3 worldEnd;\r
\r
			#ifdef USE_DASH\r
\r
				varying vec2 vUv;\r
\r
			#endif\r
\r
		#else\r
\r
			varying vec2 vUv;\r
\r
		#endif\r
\r
		#ifdef USE_DASH\r
\r
			uniform float dashScale;\r
			attribute float instanceDistanceStart;\r
			attribute float instanceDistanceEnd;\r
			varying float vLineDistance;\r
\r
		#endif\r
\r
		void trimSegment( const in vec4 start, inout vec4 end ) {\r
\r
			// trim end segment so it terminates between the camera plane and the near plane\r
\r
			// conservative estimate of the near plane\r
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\r
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\r
			float nearEstimate = - 0.5 * b / a;\r
\r
			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\r
\r
			end.xyz = mix( start.xyz, end.xyz, alpha );\r
\r
		}\r
\r
		void main() {\r
\r
			#ifdef USE_COLOR\r
\r
				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\r
\r
			#endif\r
\r
			#ifdef USE_DASH\r
\r
				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\r
				vUv = uv;\r
\r
			#endif\r
\r
			float aspect = resolution.x / resolution.y;\r
\r
			// camera space\r
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\r
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\r
\r
			#ifdef WORLD_UNITS\r
\r
				worldStart = start.xyz;\r
				worldEnd = end.xyz;\r
\r
			#else\r
\r
				vUv = uv;\r
\r
			#endif\r
\r
			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\r
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\r
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\r
			// perhaps there is a more elegant solution -- WestLangley\r
\r
			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\r
\r
			if ( perspective ) {\r
\r
				if ( start.z < 0.0 && end.z >= 0.0 ) {\r
\r
					trimSegment( start, end );\r
\r
				} else if ( end.z < 0.0 && start.z >= 0.0 ) {\r
\r
					trimSegment( end, start );\r
\r
				}\r
\r
			}\r
\r
			// clip space\r
			vec4 clipStart = projectionMatrix * start;\r
			vec4 clipEnd = projectionMatrix * end;\r
\r
			// ndc space\r
			vec3 ndcStart = clipStart.xyz / clipStart.w;\r
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;\r
\r
			// direction\r
			vec2 dir = ndcEnd.xy - ndcStart.xy;\r
\r
			// account for clip-space aspect ratio\r
			dir.x *= aspect;\r
			dir = normalize( dir );\r
\r
			#ifdef WORLD_UNITS\r
\r
				vec3 worldDir = normalize( end.xyz - start.xyz );\r
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );\r
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );\r
				vec3 worldFwd = cross( worldDir, worldUp );\r
				worldPos = position.y < 0.5 ? start: end;\r
\r
				// height offset\r
				float hw = linewidth * 0.5;\r
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;\r
\r
				// don't extend the line if we're rendering dashes because we\r
				// won't be rendering the endcaps\r
				#ifndef USE_DASH\r
\r
					// cap extension\r
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;\r
\r
					// add width to the box\r
					worldPos.xyz += worldFwd * hw;\r
\r
					// endcaps\r
					if ( position.y > 1.0 || position.y < 0.0 ) {\r
\r
						worldPos.xyz -= worldFwd * 2.0 * hw;\r
\r
					}\r
\r
				#endif\r
\r
				// project the worldpos\r
				vec4 clip = projectionMatrix * worldPos;\r
\r
				// shift the depth of the projected points so the line\r
				// segments overlap neatly\r
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\r
				clip.z = clipPose.z * clip.w;\r
\r
			#else\r
\r
				vec2 offset = vec2( dir.y, - dir.x );\r
				// undo aspect ratio adjustment\r
				dir.x /= aspect;\r
				offset.x /= aspect;\r
\r
				// sign flip\r
				if ( position.x < 0.0 ) offset *= - 1.0;\r
\r
				// endcaps\r
				if ( position.y < 0.0 ) {\r
\r
					offset += - dir;\r
\r
				} else if ( position.y > 1.0 ) {\r
\r
					offset += dir;\r
\r
				}\r
\r
				// adjust for linewidth\r
				offset *= linewidth;\r
\r
				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\r
				offset /= resolution.y;\r
\r
				// select end\r
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\r
\r
				// back to clip space\r
				offset *= clip.w;\r
\r
				clip.xy += offset;\r
\r
			#endif\r
\r
			gl_Position = clip;\r
\r
			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\r
\r
			#include <logdepthbuf_vertex>\r
			#include <clipping_planes_vertex>\r
			#include <fog_vertex>\r
\r
		}`;class PU extends wi{constructor(t={}){super({uniforms:Tn.merge([He.fog,He.common,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new xe(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},pickColor:{value:new We},enabledPick:{value:1}}]),vertexShader:IU,fragmentShader:CU,clipping:!0,transparent:!0});f(this,"isLineMaterial",!0);f(this,"type","LineMaterial");Object.defineProperties(this,{opacity:{enumerable:!0,get:()=>this.uniforms.opacity.value,set:i=>{this.uniforms.opacity.value=i}}}),this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value.copy(t)}get pickColor(){return this.uniforms.pickColor.value}set pickColor(t){this.uniforms.pickColor.value.copy(t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get lineWidth(){return this.uniforms.linewidth.value}set lineWidth(t){this.uniforms.linewidth.value=t}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get enabledPick(){return!!this.uniforms.enabledPick.value}set enabledPick(t){this.uniforms.enabledPick.value=+t}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}}var rr=(n=>(n[n.DWG_OLE=0]="DWG_OLE",n[n.DWG_VIEWER2D=1]="DWG_VIEWER2D",n[n.ENVIRONMENT=2]="ENVIRONMENT",n[n.COMPUTE=3]="COMPUTE",n[n.OPAQUE=4]="OPAQUE",n[n.TRANSLUCENT=5]="TRANSLUCENT",n[n.OVERLAY=6]="OVERLAY",n[n.OVERLAY_POINT=7]="OVERLAY_POINT",n[n.UHD=8]="UHD",n[n.NUMBER_OF_PASSES=9]="NUMBER_OF_PASSES",n))(rr||{});const[nv,b6]=[new q,new fe];new q;const iu=new q,[rv,sv]=[new fe,new fe];class Io extends zi{constructor(t={}){super();f(this,"_width",2);f(this,"_color",new ve(16777215));f(this,"_opacity",1);f(this,"_positions",[]);f(this,"colorCommand");f(this,"_pickId");f(this,"_pass",rr.OPAQUE);f(this,"_index",0);f(this,"_id");f(this,"_polylineCollection");f(this,"boundingVolume",new Lt);f(this,"modelMatrix",new fe);f(this,"_modelMatrix",new fe);f(this,"modelMatrixInverse",new fe);f(this,"_pickInfo",{primitive:this,pickColor:void 0});f(this,"_isSegments");f(this,"_dashed",!1);f(this,"enabledPick",!0);f(this,"_depthTest",!0);f(this,"_vertexColors",!1);f(this,"_colors",[]);f(this,"_dashScale",1);f(this,"_localBoundingVolume",new Lt);f(this,"geometryNeedUpdate",!1);let i=t.positions;!O(i)||i.length<6,this._width=ye(t.width,2)*Ot.devicePixelRatio,this._color=ye(t.color,this._color),this._positions=ye(t.positions,[]),this._colors=ye(t.colors,[]),this._dashed=ye(t.dashed,!1),this._depthTest=ye(t.depthTest,!0),this._vertexColors=ye(t.vertexColors,!1),this._dashScale=ye(t.dashScale,1),this._id=t.id,this._isSegments=ye(t.isSegments,!1)}get positions(){return this._positions}set positions(t){t.length<6||(this._positions=t,this.geometryNeedUpdate=!0)}set colors(t){t.length<6||(this._colors=t,this.geometryNeedUpdate=!0)}get color(){return this._color}set color(t){this._color.copy(t),this.colorCommand.material.color.copy(t)}get opacity(){return this._opacity}set opacity(t){this._opacity=t}get width(){return this._width}set width(t){this._width===t||!O(this.colorCommand)||(this._width=t,this.colorCommand.material.width=t)}get dashed(){return this.colorCommand.material.dashed}set dashed(t){this.colorCommand.material.dashed=t}translate(t){if(this._positions.length<6)return;const{x:i,y:r}=t,s=this._positions;for(let o=0,a=s.length;o<a;o+=3)s[o]+=i,s[o+1]+=r;this.geometryNeedUpdate=!0}updateGeometry(t){var s;if(!this.geometryNeedUpdate)return;(s=this.colorCommand)==null||s.geometry.dispose();let i=this._positions;this.boundingVolume.setFromArray(i),this._localBoundingVolume.copy(this.boundingVolume),this.computeModelMatrix(t);const r=this._isSegments?new Pp:new iv;r.setPositions(this._positions),this.colorCommand.geometry=r,this.colorCommand.computeLineDistances(),this.geometryNeedUpdate=!1}computeLineDistances(){O(this.colorCommand)&&this.colorCommand.computeLineDistances()}computeModelMatrix(t){if(t.maximumRenderRange.containsBox(this._localBoundingVolume))return;this._localBoundingVolume.copy(this.boundingVolume);let{max:i,min:r}=this.boundingVolume,s=Math.max(Math.abs(r.x),Math.abs(r.y),Math.abs(r.z),Math.abs(i.x),Math.abs(i.y),Math.abs(i.z)),o=Math.ceil(s/t.maximumRenderSize);sv.makeScale(1/o,1/o,1/o),this._localBoundingVolume.applyMatrix4(sv),this._localBoundingVolume.getCenter(nv),nv.multiplyScalar(-1),rv.setPosition(nv),this._localBoundingVolume.applyMatrix4(rv);let a=new fe().multiplyMatrices(rv,sv);this.modelMatrix.copy(a),this.modelMatrix.invert(),new fe().copy(this.modelMatrix).invert();let c=this._positions,u=[];for(let d=0,p=c.length/3;d<p;d++)iu.set(c[d*3],c[d*3+1],c[d*3+2]),iu.applyMatrix4(a),u.push(iu.x,iu.y,iu.z);this._positions=u}createColorCommand(){let t=this._isSegments?new Pp:new iv;t.setPositions(this._positions),this._vertexColors&&this._colors.length===this._positions.length&&t.setColors(this._colors),this.boundingVolume.setFromArray(this._positions),Xr(t);let r=new PU({toneMapped:!1,lineWidth:this.width,color:new ve(16777215),depthTest:this._depthTest,depthWrite:this._depthTest,dashScale:this._dashScale});r.dashed=this._dashed,this.colorCommand=this._isSegments?new GT(t,r):new MU(t,r),this.colorCommand.computeLineDistances(),this.colorCommand.pass=this.pass}unpackPickInfo(t){return this._pickInfo}createPickId(t){this._pickId=t.context.createPickColorSafeRange({primitive:this,id:this.id}),this._pickInfo.pickColor=this._pickId.color}updateModelMatrix(){this.modelMatrix.equals(this._modelMatrix)||(this.colorCommand.applyMatrix4(this.modelMatrixInverse),this.colorCommand.applyMatrix4(this.modelMatrix),this._modelMatrix.copy(this.modelMatrix),this.modelMatrixInverse.copy(this._modelMatrix),this.modelMatrixInverse.invert())}update(t){if(!this.visible||this.positions.length<6||t.passes.pick&&!this.enabledPick)return;O(this.colorCommand)||this.createColorCommand(),O(this._pickId)||this.createPickId(t),this.updateGeometry(t.scene),this.updateModelMatrix();let i=this.colorCommand.material,r=t.scene.drawingBufferSize;i.resolution=r;let s=t.passes;s.pick?(i.pickColor=this._pickId.color,i.enabledPick=!0,i.transparent=!1):s.render&&(i.color=this._color,i.opacity=this._opacity,i.enabledPick=!1,i.transparent=!0),t.camera.frustum.cullVolume.intersectsBox(this.boundingVolume)&&(this.colorCommand.renderOrder=this.renderOrder,t.commandList.push(this.colorCommand))}isDestroyed(){return!1}destroy(){let{colorCommand:t,_pickId:i}=this;return O(this.colorCommand)&&(t.geometry.dispose(),t.material.dispose()),i&&i.destroy(),ht(this)}}const nu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABlSURBVHgB7ZTBDYAgDEV/iXvpNsYt3MK4DS5mFUUNcoGGAyR9p6ZJX3r5H6gdegZeMMCgh4QdG02wbuze5S2bIcFcdzYUemj8vk6BV3DoLowKVajCFKIs/7MpF54V5FsjH3fbDAdLXRDCyi28HwAAAABJRU5ErkJggg==",VT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAF/SURBVHgBvZTbTcMwFIZ/h4t4zAaECYANwgZlAlIJgSoeYAO6Ag+Ii5AoE9ANWiZomICwQR9RqWJ+nzgXFENqCfFLkWPZ5zvn2OcY+GOprg36BhGHSCZbSFUfc2+gfkSIBS74e1TBamX8huoUTysB9TX2sI5nAWlMOY6xRohmZDnXgB6tYgHnOFADceAGSnoBZvydcyVRJ3iBK4N7grU4DbEk9AypG3iHN/lxeG5BC+cTmWxivzzboLEhsWn2umASyUBS7ovNAudtj4xO31qPHmL6kyqzMkK51eI2x/BVLjaRfsB2BcSH3J6ZpfCVwrsFRzWw9hbCV/n3Qi+BmR0j+EphV8YNvFZAe6sZZz34qrDJWmVDjVgyMcsnxoqSrtKyf4gq4HKx6N+ZTDwLm329Uwdckk3ISxzCtBM3ivefYbGFhcZ5c0394jni6lTqTPPAAxpr1po5M20fBwbQ7GMnsAFOaHwJ9/M1Yv9eud7G7gfWnO2nLY2At3lsC/m/9AVbEoLrMrEsUgAAAABJRU5ErkJggg==",ov="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEcSURBVHgB5ZPBUQIxFIa/t6BnS8AOpIO1AztQTup40A7ECpSToxdbsAPpQDqAEvYKA4SXbGAZ2CUJV/6ZTHbz/n3vS94GImQ+6dgR423HmGjxytI99UJWCRkcWcbYvczpyhOjQ/6MGDqY6Cg44z1kl0i6vl/q69av5ZEhRxG2+LF0cs8b5wwcZUlMckLzxQ2GfE0nPU0GH3ZNyXNSpQnHdtSuf/NHCqES3OnUoTq7SkvdfiplE90mroRN8SyJbq2FUqpHk97uhqSOTqdCO9vlgNw5Gq60+5e+YfuEGzrhhZBKygtmPNcS+p/YVh3KQ/jONlFWhJmnM65ynGooZYvuvyzLLykSvQBWnrLt6Wy3Cm/ISVP53dTlGHB6WgHyh2kSvLj2dQAAAABJRU5ErkJggg==",av="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADHSURBVHgBzZTREYIwDIb/oAM5AiO4hOf55AgtG/jmOYYbMIKjOIExKcXjTiApvPDfBdo0fDRNrsDWRfrgO2rsELBGhBud8KzS+IIWnKxO9hGnxxiH/E2rsL+f8ANBjMUiDGlMjg1WoAl1wzzQYtgc1AMjCyqvKNZkV5rT+Tcv12CnrjQr2KKJ8aj2c4v5/Pq0VXqGkJQjSjVWgJI+NWGLoZ7WcENLmnYKSkMYugK8xfuCR3oxdGr6QlGGHWXxijVigeqttXl9AXPvpnkdo4cSAAAAAElFTkSuQmCC",x6="",Lp=new T,lv={windowPosition:new he,worldPosition:new T},cv={windowPosition:new he,worldPosition:new T},Op={worldPosition:new T,endPosition:new he,startPosition:new he},RU=new Tr,WT=new Us,[XT,hv,YT]=[new T,new T,new T],[ru,Np]=[new ks,new ks],jT={lineClosestPoint:av,lineEndPoint:nu,lineMiddlePoint:ov,facePoint:VT},hc={MiddlePoint:0,StartPoint:1,EndPoint:2,ClosestPoint:3},uc=[{position:new T,windowPosition:new he,icon:ov},{position:new T,windowPosition:new he,icon:nu},{position:new T,windowPosition:new he,icon:nu},{position:new T,windowPosition:new he,icon:av}];class DU{constructor(e){f(this,"eventHandler");f(this,"measureInstanceMap",new Map);f(this,"_enabled",!1);f(this,"snapPixelSize",8*Ot.devicePixelRatio);f(this,"snapPixelSizeSq",this.snapPixelSize*this.snapPixelSize);f(this,"_icon");f(this,"activeInstance");f(this,"currentSelectInstance");f(this,"selectChangeEvent",new Vn);f(this,"completeEvent",new Vn);f(this,"highLightPolyline",new Io({positions:[0,0,0,0,0,0],color:new ve(4030975),width:3,depthTest:!1}));f(this,"selected",!1);f(this,"closestWindowPosition",new he);this.viewer=e;let t=new Yn(this.viewer.canvas);t.setInputAction(this.onMouseMove.bind(this),vt.MOUSE_MOVE),t.setInputAction(this.onLeftClick.bind(this),vt.LEFT_CLICK),t.setInputAction(this.onRightClick.bind(this),vt.RIGHT_CLICK),t.setInputAction(this.onLeftUp.bind(this),vt.LEFT_UP),this.eventHandler=t,this._icon=document.createElement("img"),this._icon.className="vengine-adsorb-icon",this._icon.src=jT.facePoint,e.container.appendChild(this._icon),this.showLabel(!1)}get screenSpaceCameraController(){return this.scene.screenSpaceCameraController}get scene(){return this.viewer.scene}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.viewer.pickEffect=!e,this.showLabel(e);for(let t of this.measureInstanceMap.values())t.show(e);e||(this.removeInstance(this.activeInstance),this.activeInstance=null)}showLabel(e){this._icon.style.display=e?"block":"none"}_updateIconPosition(e){if(!O(e))return;const{clientWidth:t,clientHeight:i}=this._icon;this._icon.style.left=Math.round(e.x-t/2)+"px",this._icon.style.top=Math.round(e.y-i/2)+"px"}onLeftClick(e){!this.enabled||!O(this.activeInstance)||(lv.worldPosition=this.selected?Lp:null,lv.windowPosition.copy(e.position),this.activeInstance.onLeftClick(lv))}onLeftUp(){!this.enabled||!O(this.activeInstance)||this.activeInstance.onLeftUp()}onRightClick(e){!this.enabled||!O(this.activeInstance)||(cv.worldPosition=this.viewer.scene.pickPosition(e.position,Lp),cv.windowPosition.copy(e.position),this.activeInstance.onRightClick(cv))}onMouseMove(e){if(!this.enabled)return;this.closestWindowPosition.copy(e.endPosition),this.viewer.scene.pickPosition(this.closestWindowPosition,Lp);let t=this.getClosestPoint(this.closestWindowPosition,Lp);Op.worldPosition=t,Op.endPosition.copy(this.closestWindowPosition),Op.startPosition.copy(e.startPosition),this.showLabel(this.selected),this._updateIconPosition(this.closestWindowPosition),O(this.activeInstance)&&this.activeInstance.onMouseMove(Op)}getClosestPoint(e,t){this.highLightPolyline.visible=!1;let i=this.scene.pickObject(e);if(!O(i))return this.selected=!1,t;let{primitive:r,instanceId:s}=i,o=this.scene.camera.getPickRay(e,RU);WT.ray.copy(o),this.selected=!0;let a=[];if(r.raycast(WT,s,a),a.length===0)return t;let{face:l}=a[0];r.getVertexPosition(l.a,s,XT),r.getVertexPosition(l.b,s,hv),r.getVertexPosition(l.c,s,YT);let c=[XT,hv,hv,YT],u=new T,d=1/0,p=new T;for(let b=0;b<c.length;b+=2){Np.start.copy(c[b]),Np.end.copy(c[b+1]),Np.closestPointToPoint(t,!0,u);let y=u.distanceTo(t);y<d&&(ru.copy(Np),d=y,p.copy(u))}uc[hc.ClosestPoint].position.copy(p),this.scene.positionToCanvasCoordinates(p,uc[hc.ClosestPoint].windowPosition);let g=uc[hc.MiddlePoint];ru.getCenter(g.position),this.scene.positionToCanvasCoordinates(g.position,g.windowPosition);let _=uc[hc.StartPoint],x=uc[hc.EndPoint];T.clone(ru.start,_.position),T.clone(ru.end,x.position),this.scene.positionToCanvasCoordinates(_.position,_.windowPosition),this.scene.positionToCanvasCoordinates(x.position,x.windowPosition);for(let b=0;b<Object.values(hc).length;b++){const y=uc[b];if(e.distanceToSq(y.windowPosition)<this.snapPixelSizeSq)return this.updateHighLightPolyline(ru),this.closestWindowPosition.copy(y.windowPosition),this._icon.src=y.icon,t.copy(y.position)}return t}updateHighLightPolyline(e){this.highLightPolyline.positions=[...e.start.toArray(),...e.end.toArray()],this.highLightPolyline.visible=!0}execute(e){let t=this.measureInstanceMap.get(e.id);if(O(t))throw new oc("id");this.complete(!1),this.activeInstance=e,this.measureInstanceMap.set(e.id,e),e.attach(this)}unExecute(){if(!O(this.activeInstance))return;let e=this.measureInstanceMap.get(this.activeInstance.id);O(e)&&(this.measureInstanceMap.delete(this.activeInstance.id),this.activeInstance.destroy()),this.activeInstance=null}complete(e=!0){if(this.showLabel(!e),!e)return;let t=this.activeInstance;this.completeEvent.raiseEvent(t)}removeAllCompleteInstance(){for(let e of this.measureInstanceMap.values())this.activeInstance.id!==e.id&&(this.measureInstanceMap.delete(e.id),e.destroy());this.currentSelectInstance=null}removeInstance(e){O(e)&&(this.measureInstanceMap.delete(e.id),e.destroy())}getData(e,t=3,i="mm",r=!0){let s=this.measureInstanceMap.get(e);return O(s)?s.getData(t,i):null}getAllData(){let e=[];for(let t of this.measureInstanceMap.values())e.push(t.getData());return e}removeAll(){for(let e of this.measureInstanceMap.values())e.destroy();this.measureInstanceMap.clear(),this.activeInstance=null,this.enabled=!1,this.currentSelectInstance=null}updateLabels(e,t){for(let i of this.measureInstanceMap.values())i.updateLabels(e,t)}update(e){if(this.enabled){for(let t of this.measureInstanceMap.values())t.update(e);e.passes.pick||this.highLightPolyline.update(e)}}isDestroyed(){return!1}destroy(){return this.eventHandler.destroy(),this.removeAll(),ht(this)}}var qT=/((?:.*\/)|^)VEngine\.js(?:\?|\#|$)/;function LU(){for(var n=document.getElementsByTagName("script"),e=0,t=n.length;e<t;++e){var i=n[e].getAttribute("src"),r=qT.exec(i);if(r!==null)return r[1]}}var fc;function OU(n){return typeof document>"u"?n:(O(fc)||(fc=document.createElement("a")),fc.href=n,fc.href=fc.href,fc.href)}var Xa;function ZT(){if(O(Xa))return Xa;var n;if(typeof window.ENGINE_BASE_URL<"u"?n=window.ENGINE_BASE_URL:n=LU(),!O(n))throw new Ze("Unable to determine engine base URL automatically, try defining a global variable called ENGINE_BASE_URL.");return Xa=new Hi({url:OU(n)}),Xa.appendForwardSlash(),Xa}function KT(n){var e=ZT().getDerivedResource({url:n});return e.url}function gn(n){var e=KT(n);return e}gn._engineScriptRegex=qT,gn._buildModuleUrlFromBaseUrl=KT,gn._clearBaseResource=function(){Xa=void 0},gn.setBaseUrl=function(n){Xa=Hi.DEFAULT.getDerivedResource({url:n})},gn.getEngineBaseUrl=ZT;function NU(n,e=400,t="-apple-system, BlinkMacSystemFont, avenir next, avenir, helvetica neue, helvetica, ubuntu, roboto, noto, segoe ui, arial, sans-serif",i="lightgrey"){const r=document.createElement("canvas");r.width=r.height=1024;const s=r.getContext("2d");s.font="bold "+e+"px "+t,s.fillStyle=i,s.fillText(n,(r.width-s.measureText(n).width)/2,(r.height+e)/2);const o=new yi(r);return o.needsUpdate=!0,o}function uv(n,e,t="#ff0000"){let i=new fh({map:NU(n,void 0,void 0,t)}),r=new td(i);return r.scale.set(50,50,50),r.position.copy(e),r}class BU extends zi{constructor(t=1,i=0){super();f(this,"axesHelper");let r=new $w(t);r.setColors(16711680,65280,255),r.position.set(-i,-i,i),r.rotateX(-Math.PI/2),this.axesHelper=r,this.addObject(this.axesHelper),this.addObject(uv("X",new T(t-i,-i,i),"#FF0000")),this.addObject(uv("Z",new T(-i,t-i,i),"#0000FF")),this.addObject(uv("Y",new T(-i,-i,i-t),"#00FF00"))}}let FU=`

#include <logdepthbuf_pars_vertex>

varying vec2 vUv;

void main() {
    vec3 transformed = vec3( position );

    vec4 mvPosition = vec4( transformed, 1.0 );

    mvPosition = modelViewMatrix * mvPosition;
    
    gl_Position = projectionMatrix * mvPosition;
    vUv = uv;

    #include <logdepthbuf_vertex>
}
`,UU=`
uniform vec3 color;
uniform float opacity;
uniform float imagePs;
uniform sampler2D map;

varying vec2 vUv;

void main(void){
    #include <logdepthbuf_fragment>

    vec2 cusUv = vec2(imagePs + vUv.x/2.0, vUv.y);

    vec4 color1 = texture2D(map, cusUv);

    gl_FragColor = color1;

}

`;const fv={LEFT:0,RIGHT:.5};class kU extends wi{constructor(t={}){super();f(this,"isChangeMapMaterial",!0);this.lights=!1,this.uniforms={color:{value:new ve(1,1,1)},opacity:{value:1},map:{value:new yi},imagePs:{value:0}},this.vertexShader=FU,this.fragmentShader=UU,this.setValues(t)}get map(){return this.uniforms.map.value}set map(t){this.uniforms.map.value=t}get color(){return this.uniforms.color.value}set color(t){this.uniforms.color.value.copy(t)}get imagePs(){return this.uniforms.imagePs.value}set imagePs(t){this.uniforms.imagePs.value=t}}var yt=(n=>(n[n.Keep=0]="Keep",n[n.Home=135]="Home",n[n.Top=1]="Top",n[n.Bottom=2]="Bottom",n[n.Front=3]="Front",n[n.Back=4]="Back",n[n.Right=5]="Right",n[n.Left=6]="Left",n[n.TopFrontRight=431]="TopFrontRight",n[n.BottomFrontRight=520]="BottomFrontRight",n[n.BottomBackRight=631]="BottomBackRight",n[n.TopBackRight=720]="TopBackRight",n[n.TopFrontLeft=750]="TopFrontLeft",n[n.BottomFrontLeft=641]="BottomFrontLeft",n[n.BottomBackLeft=752]="BottomBackLeft",n[n.TopBackLeft=643]="TopBackLeft",n[n.TopFront=13]="TopFront",n[n.TopBack=14]="TopBack",n[n.TopRight=15]="TopRight",n[n.TopLeft=16]="TopLeft",n[n.BottomFront=23]="BottomFront",n[n.BottomBack=24]="BottomBack",n[n.BottomRight=25]="BottomRight",n[n.BottomLeft=26]="BottomLeft",n[n.FrontRight=35]="FrontRight",n[n.FrontLeft=36]="FrontLeft",n[n.BackRight=45]="BackRight",n[n.BackLeft=46]="BackLeft",n[n.TopToRight=105]="TopToRight",n[n.TopToLeft=106]="TopToLeft",n[n.TopToFront=103]="TopToFront",n[n.TopToBack=104]="TopToBack",n[n.BottomToRight=205]="BottomToRight",n[n.BottomToLeft=206]="BottomToLeft",n[n.BottomToFront=203]="BottomToFront",n[n.BottomToBack=204]="BottomToBack",n[n.FrontToTop=301]="FrontToTop",n[n.FrontToBottom=302]="FrontToBottom",n[n.FrontToRight=305]="FrontToRight",n[n.FrontToLeft=306]="FrontToLeft",n[n.BackToTop=401]="BackToTop",n[n.BackToBottom=402]="BackToBottom",n[n.BackToRight=405]="BackToRight",n[n.BackToLeft=406]="BackToLeft",n[n.RightToTop=501]="RightToTop",n[n.RightToBottom=502]="RightToBottom",n[n.RightToFront=503]="RightToFront",n[n.RightToBack=504]="RightToBack",n[n.LeftToTop=601]="LeftToTop",n[n.LeftTopBottom=602]="LeftTopBottom",n[n.LeftTopFront=603]="LeftTopFront",n[n.LeftTopBack=604]="LeftTopBack",n))(yt||{});const[zU,dv]=[new T,new T],[pv,mt,gt,mv]=[new T,new T,new T,new T],Ya=new Lt,su=new T,QT=new T,$T=new fe().makeRotationFromEuler(new Oi(-Math.PI/2)),[gv,Bp]=[new T,new T],HU={opacity:.4,color:"#919cb4",hoverColor:"#3B78EA",fontColor:"#ffffff"},dc=new he;function JT(n,e,t=new he){t.x=e.x/n.clientWidth*2-1,t.y=-(e.y/n.clientHeight)*2+1}new he;var Ci=null,pc={Big:220,Medium:150,Small:80};const Po=50,Ir=8,_v=10;let eA=13359074,tA=3779326;var mc=new ur,iA=new ur;let nA=new ur;nA.name="selectBoxGroup";function GU(n,e){const t=(n+e)/2;return[new T(t,-t,t),new T(t,-t,-t),new T(t,t,-t),new T(t,t,t),new T(-t,-t,t),new T(-t,-t,-t),new T(-t,t,-t),new T(-t,t,t)]}function VU(n,e){const t=n/2+e;return{"+Y":new T(0,0,-t),"-Y":new T(0,0,t),"+X":new T(t,0,0),"-X":new T(-t,0,0),"+Z":new T(0,t,0),"-Z":new T(0,-t,0)}}function WU(n){return{"01":new T().lerpVectors(n[0],n[1],.5),12:new T().lerpVectors(n[1],n[2],.5),23:new T().lerpVectors(n[2],n[3],.5),30:new T().lerpVectors(n[3],n[0],.5),45:new T().lerpVectors(n[4],n[5],.5),56:new T().lerpVectors(n[5],n[6],.5),67:new T().lerpVectors(n[6],n[7],.5),74:new T().lerpVectors(n[7],n[4],.5),"04":new T().lerpVectors(n[0],n[4],.5),37:new T().lerpVectors(n[3],n[7],.5),26:new T().lerpVectors(n[2],n[6],.5),15:new T().lerpVectors(n[1],n[5],.5)}}let vv=GU(Po,Ir),gc=VU(Po,Ir),XU=WU(vv);function YU(n){var e=new Ud;let t=[{image:gn("Assets/navCube/back.png"),position:gc["+Y"],rotation:new Oi(Math.PI,0,Math.PI),name:"Back POSITIVE_Y",view:yt.Back},{image:gn("Assets/navCube/front.png"),position:gc["-Y"],rotation:new Oi(0,0,0),name:"Front NEGATIVE_Y",view:yt.Front},{image:gn("Assets/navCube/right.png"),position:gc["+X"],rotation:new Oi(Math.PI,.5*Math.PI,Math.PI),name:"Right POSITIVE_X",view:yt.Right},{image:gn("Assets/navCube/left.png"),position:gc["-X"],rotation:new Oi(Math.PI,-.5*Math.PI,Math.PI),name:"Left NEGATIVE_X",view:yt.Left},{image:gn("Assets/navCube/top.png"),position:gc["+Z"],rotation:new Oi(-Math.PI/2,0,0),name:"Top POSITIVE_Z",view:yt.Top},{image:gn("Assets/navCube/bottom.png"),position:gc["-Z"],rotation:new Oi(Math.PI/2,0,Math.PI),name:"Bottom NEGATIVE_Z",view:yt.Bottom}];for(let i of t)e.load(i.image,r=>{let s=new pt(new Er(Po,Po),new kU({map:r,toneMapped:!1}));s.position.copy(i.position),s.rotation.copy(i.rotation),s.name=i.name,s.userData.view=i.view,mc.add(s)})}function jU(n){const e=[0,1,2,3,4,5,6,7],t=["Top_FrontLeft","Bottom_FrontLeft","Bottom_FrontRight","Top_FrontRight","Top_BackLeft","Bottom_BackLeft","Bottom_BackRight","Top_BackRight"],i=[yt.TopFrontLeft,yt.BottomFrontLeft,yt.BottomFrontRight,yt.TopFrontRight,yt.TopBackLeft,yt.BottomBackLeft,yt.BottomBackRight,yt.TopBackRight];var r=new zr(Ir,Ir,Ir);for(let s=0;s<e.length;s+=1){let o=new pt(r,new Pi({color:new ve(eA)}));o.position.copy(vv[e[s]]),o.name=t[s],o.userData.view=i[s],iA.add(o);let a=new zr(_v,_v,_v),l=new pt(a,new Pi({transparent:!0,color:new ve(tA),opacity:1}));l.position.copy(vv[e[s]]),l.name=t[s],l.userData.view=i[s],mc.add(l),l.visible=!1,l.userData.isBox=!0}}function qU(){const n=["30","12","74","56","04","15","37","26","01","23","45","67"],e=["Top_Front","Bottom_Front","Top_Back","Bottom_Back","Top_Left","Bottom_Left","Top_Right","Bottom_Right","LeftFront","RightFront","LeftBack","RightBack"],t=[yt.TopFront,yt.BottomFront,yt.TopBack,yt.BottomBack,yt.TopLeft,yt.BottomLeft,yt.TopRight,yt.BottomRight,yt.FrontLeft,yt.FrontRight,yt.BackLeft,yt.BackRight];let i=new zr(Ir,Po,Ir),r=new zr(Po,Ir,Ir),s=new zr(Ir,Ir,Po),o=[i,i,i,i,r,r,r,r,s,s,s,s];for(let a=0;a<n.length;a+=1){let l=new pt(o[a],new Pi({color:new ve(eA)}));l.position.copy(XU[n[a]]),l.name=e[a],l.userData.view=t[a],mc.add(l)}}class ou{constructor(e,t){f(this,"config");f(this,"container");f(this,"renderer");f(this,"camera");f(this,"raycaster");f(this,"mesh");f(this,"fov");f(this,"frustumSize");f(this,"aspect");f(this,"near");f(this,"far");f(this,"zUp");f(this,"lastAreaId");f(this,"visible",!0);f(this,"_cube",new ur);f(this,"eventHandler");f(this,"navScene",new uh);this.scene=e,this.config=Object.assign({},HU,t||{}),this.zUp=!0,this.lastAreaId=-1,this.container=document.createElement("div"),this.container.className="vengine-nav-cube",this.container.style.position="absolute",this.container.style.zIndex="9",this.container.style.right=`${this.config.right||10}px`,this.container.style.top=`${this.config.top||10}px`,this.container.style.width=`${this.config.width||150}px`,this.container.style.height=`${this.config.height||150}px`,this.scene.viewer.container.appendChild(this.container),this.fov=75,this.frustumSize=4,this.aspect=this.container.clientWidth/this.container.clientHeight,this.near=.1,this.far=2e3,this.camera=new Ns(-pc.Medium/2,pc.Medium/2,pc.Medium/2,-pc.Medium/2,-pc.Medium/2,pc.Medium/2),this.camera.up.copy(this.scene.camera.up),this.camera.lookAt(0,0,0),this.renderer=new Kf({antialias:!0,alpha:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.container.appendChild(this.renderer.domElement),this.raycaster=new Us,YU(),qU(),jU(),this._cube.add(mc),this._cube.add(iA),this._cube.add(nA),this.navScene.add(this._cube);let i=new BU(80,Po/2+Ir);this.navScene.add(i),this.eventHandler=new Yn(this.container),this.eventHandler.setInputAction(this.handleMousemove.bind(this),vt.MOUSE_MOVE),this.eventHandler.setInputAction(this.handleMouseDown.bind(this),vt.LEFT_CLICK)}handleMousemove(e){JT(this.container,e.endPosition,dc),this.raycaster.ray.origin.set(dc.x,dc.y,-1).unproject(this.camera),this.raycaster.ray.direction.set(0,0,-1).transformDirection(this.camera.matrixWorld);const t=this.raycaster.intersectObject(mc);if(t.length>0){const i=t[0];ZU(i.object)}else KU()}handleMouseDown(e){JT(this.container,e.position,dc),this.raycaster.ray.origin.set(dc.x,dc.y,-1).unproject(this.camera),this.raycaster.ray.direction.set(0,0,-1).transformDirection(this.camera.matrixWorld);const t=this.raycaster.intersectObject(mc);if(t.length===0)return;let r=t[0].object.userData.view;ou.flyToMode(this.scene,r)}static flyToMode(e,t,i){let r,s=e.axisAlignedBoundingBox;Ya.copy(s),Ya.getSize(su),Ya.getCenter(QT);let o=T.maximumComponent(su);switch(T.fromElements(o,o,o,su),Ya.setFromCenterAndSize(QT,su),Ya.expandByVector(su.multiplyScalar(1)),Ya.getCenter(pv),Ya.getSize(gt),gt.multiplyScalar(.5),mt.copy(pv),t){case yt.Top:mt.z+=gt.z,r=T.UNIT_X;break;case yt.Bottom:mt.z-=gt.z;break;case yt.Right:mt.x+=gt.x;break;case yt.Left:mt.x-=gt.x;break;case yt.Front:mt.y-=gt.x;break;case yt.Back:mt.y+=gt.x;break;case yt.TopFront:mt.x+=gt.x,mt.y-=gt.y;break;case yt.BottomBack:mt.x-=gt.x,mt.y+=gt.y;break;case yt.BottomFront:mt.x+=gt.x,mt.y+=gt.y;break;case yt.TopBack:mt.x-=gt.x,mt.y-=gt.y;break;case yt.FrontRight:mt.x+=gt.x,mt.z+=gt.z;break;case yt.FrontLeft:mt.x+=gt.x,mt.z-=gt.z;break;case yt.BackRight:mt.x-=gt.x,mt.z+=gt.z;break;case yt.BackLeft:mt.x-=gt.x,mt.z-=gt.z;break;case yt.BottomRight:mt.y+=gt.y,mt.z+=gt.z;break;case yt.BottomLeft:mt.y+=gt.y,mt.z-=gt.z;break;case yt.TopRight:mt.y-=gt.x,mt.z+=gt.z;break;case yt.TopLeft:mt.y-=gt.x,mt.z-=gt.z;break;case yt.BottomFrontRight:mt.x+=gt.x,mt.y+=gt.y,mt.z+=gt.z;break;case yt.BottomBackRight:mt.x-=gt.x,mt.y+=gt.y,mt.z+=gt.z;break;case yt.TopBackRight:mt.x-=gt.x,mt.y-=gt.y,mt.z+=gt.z;break;case yt.TopFrontRight:mt.x+=gt.x,mt.y-=gt.y,mt.z+=gt.z;break;case yt.TopBackLeft:mt.x-=gt.x,mt.y-=gt.y,mt.z-=gt.z;break;case yt.BottomBackLeft:mt.x-=gt.x,mt.y+=gt.y,mt.z-=gt.z;break;case yt.TopFrontLeft:mt.x+=gt.x,mt.y-=gt.y,mt.z-=gt.z;break;case yt.BottomFrontLeft:mt.x+=gt.x,mt.y+=gt.y,mt.z-=gt.z;break;default:return}let a=T.subtract(pv,mt,mv);a.normalize(),r||(r=T.cross(a,T.UNIT_Z,zU)),T.cross(r,a,dv),i===0?e.camera.setView({destination:mt,orientation:{direction:mv,up:dv}}):e.camera.flyTo({duration:i,destination:mt,orientation:{direction:mv,up:dv}})}enabled(e){this.setVisible(e)}setVisible(e){this.visible=e,this.navScene.visible=e,this.container.style.visibility=e?"visible":"hidden"}setSize(e,t){this.container.style.width=`${e}px`,this.container.style.height=`${t}px`,this.aspect=e/t,this.camera.left=-this.frustumSize*this.aspect/2,this.camera.right=this.frustumSize*this.aspect/2,this.camera.top=this.frustumSize/2,this.camera.bottom=-this.frustumSize/2,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}setPosition(e){this.container.style.top=`${e.top}px`,this.container.style.right=`${e.right}px`}update(e){if(!this.visible)return;const t=this.scene.camera;gv.copy(t.up),gv.applyMatrix4($T),Bp.copy(t.direction),Bp.multiplyScalar(-5),Bp.applyMatrix4($T),this.camera.position.copy(Bp),this.camera.up.copy(gv),this.camera.lookAt(0,0,0),this.renderer.render(this.navScene,this.camera)}isDestroyed(){return!1}destroy(){return this.eventHandler.removeInputAction(vt.MOUSE_MOVE),this.eventHandler.removeInputAction(vt.LEFT_CLICK),this.container.remove(),this.navScene.remove(),this.renderer.forceContextLoss(),this.renderer.dispose(),ht(this)}}var ZU=function(e){Ci!==e&&(Ci&&(Ci.material.isChangeMapMaterial&&(Ci.material.imagePs=fv.LEFT),Ci.userData.isBox&&(Ci.visible=!1),Ci.material.color.set(Ci.currentColor)),Ci=e,Ci.currentColor=Ci.material.color.clone(),Ci.name!==""&&(Ci.material.color.set(tA),Ci.userData.isBox&&(Ci.visible=!0),Ci.material.isChangeMapMaterial&&(Ci.material.imagePs=fv.RIGHT)))},KU=function(){Ci&&(Ci.material.color.set(Ci.currentColor),Ci.material.isChangeMapMaterial&&(Ci.material.imagePs=fv.LEFT),Ci.userData.isBox&&(Ci.visible=!1)),Ci=null},jn=(n=>(n.NONE="",n.ORBIT="orbit",n.FPS="fps",n))(jn||{}),si=(n=>(n.MOUSE_DOWN="mousedown",n.MOUSE_MOVE="mousemove",n.MOUSE_UP="mouseup",n.WHEEL="wheel",n.CLICK="click",n.RIGHT_CLICK="rightclick",n.DOUBLE_CLICK="dblclick",n.TOUCH_START="touchstart",n.TOUCH_MOVE="touchmove",n.TOUCH_END="touchend",n.KEY_DOWN="keydown",n.KEY_UP="keyup",n.POINTER_DOWN="pointerdown",n.POINTER_MOVE="pointermove",n.POINTER_UP="pointerup",n.POINTER_CANCEL="pointercancel",n.PICK="pick",n.PRE_UPDATE="preUpdate",n.PRERENDER="prerender",n.UPDATE="update",n.TICK="tick",n.RENDER_ERROR="renderError",n.CHANGE_NEAR="changeNear",n.CAMERA_CHANGE="cameraChange",n.CAMERA_MOVE_START="cameraMoveStart",n.CAMERA_MOVE_END="cameraMoveEnd",n.CAMERA_ROTATE="cameraRotate",n.VIEW_SYNC="viewSync",n.LOAD="load",n.SWITCH_LAYOUT="switchLayout",n))(si||{});const w6="",rA=new he,QU=new T,[$U,JU]=[new he,new he];class yv{constructor(e){f(this,"viewer");f(this,"enabled",!1);f(this,"_helperBox");f(this,"_isPointerDown",!1);f(this,"_mouseXY",[]);f(this,"enabledFly",!0);f(this,"_pointerdownLisenter");f(this,"_pointermoveLisenter");f(this,"_pointerupLisenter");f(this,"_screenSpaceEventHandler");f(this,"selectBoxSize",new zs);this.viewer=e,this._screenSpaceEventHandler=new Yn(e.scene.canvas),this._helperBox=document.createElement("div"),this._helperBox.className="rect-select",this.viewer.container.appendChild(this._helperBox)}active(){if(this.enabled)return;this.enabled=!0,this.selectBoxSize.makeEmpty(),this.viewer.pickEffect=!1,this.viewer.scene.screenSpaceCameraController.enableRotate=!1;let e=gn("Assets/UI/icon/cursor.png");this.viewer.container.style.cursor=`url(${e}),auto`,this._bindEvents()}deactive(){this.enabled&&(this.enabled=!1,this.viewer.pickEffect=!0,this.viewer.scene.screenSpaceCameraController.enableRotate=!0,this.viewer.container.style.cursor="default",this._removeEvents())}_bindEvents(){let{_screenSpaceEventHandler:e}=this;e.setInputAction(i=>{let{x:r,y:s}=i.position;this._handleStart(r,s)},vt.LEFT_DOWN);const{pointer:t}=this.viewer.input;t.addEventListener(si.POINTER_MOVE,this._pointermoveLisenter=i=>{this._onPointerMove(i[0])}),t.addEventListener(si.POINTER_UP,this._pointerupLisenter=i=>{this._onPointerUp(i[0])})}_removeEvents(){const{pointer:e}=this.viewer.input;e.removeEventListener(si.POINTER_DOWN,this._pointerdownLisenter),e.removeEventListener(si.POINTER_MOVE,this._pointermoveLisenter),e.removeEventListener(si.POINTER_UP,this._pointerupLisenter),this._pointerdownLisenter=null,this._pointermoveLisenter=null,this._pointerupLisenter=null}_onPointerDown(e){const[t,i]=e.screenCoord;$U.set(t,i),this._handleStart(t,i)}_onPointerMove(e){const[t,i]=e.screenCoord;this._handleMove(t,i)}_onPointerUp(e){const[t,i]=e.screenCoord;JU.set(t,i),this._handleEnd(t,i)}_handleStart(e,t){this._isPointerDown=!0,this._mouseXY=[e,t]}_handleMove(e,t){if(!this._isPointerDown)return;const[i,r]=this._mouseXY,s=Math.round(e-i),o=Math.round(t-r);Math.abs(s)<1||Math.abs(o)<1||(this._helperBox.style.left=(s>0?i:e)+"px",this._helperBox.style.top=(o>0?r:t)+"px",this._helperBox.style.width=Math.abs(s)+"px",this._helperBox.style.height=Math.abs(o)+"px",this._helperBox.style.display="block")}_handleEnd(e,t){this._isPointerDown&&(this._isPointerDown=!1,this._helperBox.style.display="none",this._helperBox.style.width="0",this._helperBox.style.height="0",this.enabledFly&&this._zoomTo(e,t),this.deactive())}_zoomTo(e,t){const[i,r]=this._mouseXY;if(this.viewer.cameraType===vo.ORTHOGRAPHIC){const s=this.viewer.pickAllPosition({x:i,y:r}),o=this.viewer.pickAllPosition({x:e,y:t});if(!s||!o)return;const a=[Math.min(s.x,o.x),Math.min(s.y,o.y),Math.min(s.z,o.z),Math.max(s.x,o.x),Math.max(s.y,o.y),Math.max(s.z,o.z)];this.viewer.camera.flyTo({destination:new zs(new he(a[0],a[1]),new he(a[3],a[4]))})}else{if(i-e===0||r-t===0)return;rA.set((i+e)/2,(r+t)/2);const s=this.viewer.scene.pickPosition(rA,QU);if(!s)return;const{clientWidth:o,clientHeight:a}=this.viewer.container,l=Math.max(Math.abs(i-e)/o,Math.abs(r-t)/a),c=new T().copy(this.viewer.camera.position).lerp(s,1-l);let u=T.distance(c,this.viewer.camera.position),d=T.subtract(c,this.viewer.camera.position,new T);T.normalize(d,d),this.viewer.camera.move(d,u)}}isDestroyed(){return!1}destroy(){var e;return this.deactive(),(e=this.viewer.container)==null||e.removeChild(this._helperBox),ht(this)}}f(yv,"EventType",{END:"rectSelectEnd"});var bv=(n=>(n[n.None=-1]="None",n[n.Primary=0]="Primary",n[n.Auxiliary=1]="Auxiliary",n[n.Secondary=2]="Secondary",n[n.XButton1=3]="XButton1",n[n.XButton2=4]="XButton2",n))(bv||{});function ek(n,e,t=!1){var i=/#define OUTPUT_DECLARATION/,r=n.split(`
`);if(/#version 300 es/g.test(n))return n;var s=-1,o,a;for(o=0;o<r.length;++o)if(a=r[o],i.test(a)){s=o;break}if(s===-1)throw new Ze("Could not find a #define OUTPUT_DECLARATION!");var l=[];for(o=0;o<10;o++){var c="gl_FragData\\["+o+"\\]",u="czm_out"+o,d=new RegExp(c,"g");d.test(n)&&(sA(u,l),gs(c,u,r),r.splice(s,0,"layout(location = "+o+") out vec4 "+u+";"),s+=1)}var p="czm_fragColor";ik("gl_FragColor",r)&&(sA(p,l),gs("gl_FragColor",p,r),r.splice(s,0,"layout(location = 0) out vec4 czm_fragColor;"),s+=1);var g=rk(l,r),_={};for(o=0;o<r.length;o++){a=r[o];for(var x in g)if(g.hasOwnProperty(x)){var b=new RegExp("(layout)[^]+(out)[^]+("+x+")[^]+","g");b.test(a)&&(_[a]=x)}}for(var y in _)if(_.hasOwnProperty(y)){var M=_[y],E=r.indexOf(y),w=g[M],I=w.length,B;for(B=0;B<I;B++)r.splice(E,0,w[B]);for(E+=I+1,B=I-1;B>=0;B--)r.splice(E,0,"#endif //"+w[B])}var N="WEBGL_2",L="#define "+N,P="#version 300 es";for(o=0;o<r.length;o++)if(/#version/.test(r[o])){r[o]=P;break}return r.splice(0,0,L),xv("EXT_draw_buffers",N,r),xv("EXT_frag_depth",N,r),xv("OES_standard_derivatives",N,r),gs("texture2D","texture",r),gs("texture3D","texture",r),gs("textureCube","texture",r),gs("gl_FragDepthEXT","gl_FragDepth",r),e?gs("varying","in",r):(gs("attribute","in",r),gs("varying","out",r)),nk(r)}function gs(n,e,t){for(var i="(^|[^\\w])("+n+")($|[^\\w])",r=new RegExp(i,"g"),s=t.length,o=0;o<s;++o){var a=t[o];t[o]=a.replace(r,"$1"+e+"$3")}}function tk(n,e,t){for(var i=t.length,r=0;r<i;++r){var s=t[r];t[r]=s.replace(n,e)}}function ik(n,e){for(var t="(^|[^\\w])("+n+")($|[^\\w])",i=new RegExp(t,"g"),r=e.length,s=0;s<r;++s){var o=e[s];if(i.test(o))return!0}return!1}function nk(n){for(var e="",t=n.length,i=0;i<t;++i)e+=n[i]+`
`;return e}function sA(n,e){e.indexOf(n)===-1&&e.push(n)}function rk(n,e){for(var t={},i=n.length,r=[],s=0;s<e.length;++s){var o=e[s],a=/(#ifdef|#if)/g.test(o),l=/#else/g.test(o),c=/#endif/g.test(o);if(a)r.push(o);else if(l){var u=r[r.length-1],d=u.replace("ifdef","ifndef");/if/g.test(d)&&(d=d.replace(/(#if\s+)(\S*)([^]*)/,"$1!($2)$3")),r.pop(),r.push(d)}else if(c)r.pop();else if(!/layout/g.test(o))for(var p=0;p<i;++p){var g=n[p];o.indexOf(g)!==-1&&(O(t[g])?t[g]=t[g].filter(function(_){return r.indexOf(_)>=0}):t[g]=r.slice())}}return t}function xv(n,e,t){var i="#extension\\s+GL_"+n+"\\s+:\\s+[a-zA-Z0-9]+\\s*$";tk(new RegExp(i,"g"),"",t),gs("GL_"+n,e,t)}function sk(n){return n=n.replace(/\/\/.*/g,""),n.replace(/\/\*\*[\s\S]*?\*\//gm,function(e){for(var t=e.match(/\n/gm).length,i="",r=0;r<t;++r)i+=`
`;return i})}function oA(n,e,t){var i,r,s="",o=n.sources;if(O(o))for(i=0,r=o.length;i<r;++i)s+=`
#line 0
`+o[i];s=sk(s);var a;s=s.replace(/#version\s+(.*?)\n/gm,function(g,_){if(O(a)&&a!==_)throw new Ze("inconsistent versions found: "+a+" and "+_);return a=_,`
`});var l=[];s=s.replace(/#extension.*\n/gm,function(g){return l.push(g),`
`}),s=s.replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");var c="";O(a)&&(c="#version "+a+`
`);var u=l.length;for(i=0;i<u;i++)c+=l[i];e&&(c+=`  #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
  #else
      precision mediump float;
      #define highp mediump
  #endif

`);var d=n.defines;if(O(d))for(i=0,r=d.length;i<r;++i){var p=d[i];p.length!==0&&(c+="#define "+p+`
`)}return t.webgl2&&(c+=`#define OUTPUT_DECLARATION

`),t.textureFloatLinear&&(c+=`#define OES_texture_float_linear

`),c+=`
#line 0
`,c+=s,Ot.useWebGL2&&(c=ek(c,e,!0)),c}function ok(n,e){let t;switch(e){case Uu:t="Linear";break;case Gm:t="Reinhard";break;case Vm:t="OptimizedCineon";break;case Vc:t="ACESFilmic";break;case Xm:t="AgX";break;case Ym:t="Neutral";break;case Wm:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Om=class Om{constructor(e){f(this,"defines");f(this,"sources");f(this,"pickColorQualifier");f(this,"includeBuiltIns");this.defines=O(e.defines)?e.defines.slice(0):[],this.sources=O(e.sources)?e.sources.slice(0):[],this.pickColorQualifier=e.pickColorQualifier,this.includeBuiltIns=e.includeBuiltIns??!0}static replaceMain(e,t){return t="void "+t+"()",e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)}clone(){return new Om({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})}createCombinedVertexShader(e){return oA(this,!1,e)}createCombinedFragmentShader(e){return oA(this,!0,e)}};f(Om,"resolveIncludes",aA);let _n=Om;const ak=/^[ \t]*#include +<([\w\d./]+)>/gm;function aA(n){return n.replace(ak,lk)}function lk(n,e){const t=Ft[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return aA(t)}class Fp extends wi{constructor(e={}){let{vertexShader:t,fragmentShader:i,uniforms:r}=Ni.basic;t=_n.replaceMain(t,"outputPosition"),t=`
        #ifdef USE_INSTANCING_PICKING

            attribute vec4 pickIds;
            varying vec4 v_pickIds;

        #endif
        ${t}
        void main(){
            outputPosition();
            #ifdef USE_INSTANCING_PICKING
            v_pickIds = pickIds;
            #endif
        }
        `,i=_n.replaceMain(i,"originMain"),i=`
        #ifdef USE_INSTANCING_PICKING
            varying vec4 v_pickIds;
        #endif
        ${i}
        void main(){
            originMain();
            #ifdef USE_INSTANCING_PICKING
                gl_FragColor = v_pickIds;
            #endif
        }
        `,super({vertexShader:t,fragmentShader:i,uniforms:Tn.merge([r])}),this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}get map(){return this.uniforms.map.value}set map(e){this.uniforms.map.value=e}}class Pr extends Zw{constructor(e,t=new ve(16776960)){super(e,t),this.material=new Fp({color:t}),this.geometry.attributes.position.onUpload(cc),this.pass=rr.OVERLAY}updateFromBoundingBox(e){this.box.copy(e),this.updateMatrixWorld(!0)}update(e){!this.visible||e.passes.pick||e.commandList.push(this)}isDestroyed(){return!1}destroy(){return this.geometry.dispose(),this.material.dispose(),ht(this)}}class ck{constructor(e,t){f(this,"featurePropertiesDirty",!1);f(this,"_tileset");f(this,"_tile");this._tileset=e,this._tile=t}get featuresLength(){return 0}get pointsLength(){return 0}get trianglesLength(){return 0}get geometryByteLength(){return 0}get texturesByteLength(){return 0}get batchTableByteLength(){return 0}get innerContents(){}get readyPromise(){}get tileset(){return this._tileset}get tile(){return this._tile}get url(){}get batchTable(){}applyStyle(){}update(e){}isDestroyed(){return!1}destroy(){return ht(this)}}function lA(n,e=!1){const t=n[0].index!==null,i=new Set(Object.keys(n[0].attributes)),r=new Set(Object.keys(n[0].morphAttributes)),s={},o={},a=n[0].morphTargetsRelative,l=new Tt;let c=0;for(let u=0;u<n.length;++u){const d=n[u];let p=0;if(t!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const g in d.attributes){if(!i.has(g))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+g+'" attribute exists among all geometries, or in none of them.'),null;s[g]===void 0&&(s[g]=[]),s[g].push(d.attributes[g]),p++}if(p!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const g in d.morphAttributes){if(!r.has(g))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;o[g]===void 0&&(o[g]=[]),o[g].push(d.morphAttributes[g])}if(e){let g;if(t)g=d.index.count;else if(d.attributes.position!==void 0)g=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,g,u),c+=g}}if(t){let u=0;const d=[];for(let p=0;p<n.length;++p){const g=n[p].index;for(let _=0;_<g.count;++_)d.push(g.getX(_)+u);u+=n[p].attributes.position.count}l.setIndex(d)}for(const u in s){const d=cA(s[u]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,d)}for(const u in o){const d=o[u][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let p=0;p<d;++p){const g=[];for(let x=0;x<o[u].length;++x)g.push(o[u][x][p]);const _=cA(g);if(!_)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(_)}}return l}function cA(n){let e,t,i,r=-1,s=0;for(let c=0;c<n.length;++c){const u=n[c];if(e===void 0&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=u.itemSize),t!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=u.normalized),i!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(r===-1&&(r=u.gpuType),r!==u.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=u.count*t}const o=new e(s),a=new Jt(o,t,i);let l=0;for(let c=0;c<n.length;++c){const u=n[c];if(u.isInterleavedBufferAttribute){const d=l/t;for(let p=0,g=u.count;p<g;p++)for(let _=0;_<t;_++){const x=u.getComponent(p,_);a.setComponent(p+d,_,x)}}else o.set(u.array,l);l+=u.count*t}return r!==void 0&&(a.gpuType=r),a}function hA(n,e){if(e===ab)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===wf||e===rg){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,r=[];if(e===wf)for(let o=1;o<=i;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}const _r={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},_c={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},uA={9728:xi,9729:Ei,9984:zu,9985:ll,9986:$o,9987:wr},fA={33071:or,33648:al,10497:io},wv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Sv={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex",INSTANCE_MATRIX:"instanceMatrix",BATCH_ID:"batchId"},Ro={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences",position:"position"},hk={CUBICSPLINE:void 0,LINEAR:hl,STEP:cl},Ev={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},dA="glTF",au=12,pA={JSON:1313821514,BIN:5130562};class mA extends zl{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=r-t,d=(i-t)/u,p=d*d,g=p*d,_=e*c,x=_-c,b=-2*g+3*p,y=g-p,M=1-b,E=y-p+d;for(let w=0;w!==a;w++){const I=o[x+w+a],B=o[x+w+l]*u,N=o[_+w+a],L=o[_+w]*u;s[w]=M*I+E*B+b*N+y*L}return s}}const uk=new bi;class fk extends mA{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return uk.fromArray(s).normalize().toArray(s),s}}function dk(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}function ja(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Do(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function pk(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new kl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:br})),n.DefaultMaterial}const zt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness"};function Tv(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function mk(n){let e;const t=n.extensions&&n.extensions[zt.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Tv(t.attributes):e=n.indices+":"+Tv(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,r=n.targets.length;i<r;i++)e+=":"+Tv(n.targets[i]);return e}let gk=class extends wi{constructor(t){let{vertexShader:i,fragmentShader:r,uniforms:s}=Ni.basic;i=_n.replaceMain(i,"outputPosition"),i=`

        #ifdef USE_BATCH_TABLE
            attribute float batchId;
            varying vec4 v_pickColor;
        #endif
        ${i}
        void main(){
            outputPosition();

            #ifdef USE_BATCH_TABLE
                v_pickColor = czm_batchTable_pickColor(batchId);
                vec4 instanceColor = czm_batchTable_instanceColor(batchId);

                gl_Position*=instanceColor.z;
               
            #endif
        }
        `,r=_n.replaceMain(r,"originMain"),r=`
        #ifdef USE_BATCH_TABLE
            varying vec4 v_pickColor;
        #endif
        ${r}
        void main(){
            originMain();

            // #ifdef USE_BATCH_TABLE
            //     gl_FragColor = v_pickColor;
            // #endif
        }
        `;super({vertexShader:i,fragmentShader:r,uniforms:Tn.merge([s,{batchTextureStep:{value:new nt},batchTextureDimensions:{value:new he},batchTexture:{value:void 0}}])});f(this,"isLineBasicMaterial",!0);this.toneMapped=!1,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value.copy(t)}get map(){return this.uniforms.map.value}set map(t){this.uniforms.map.value=t}get batchTextureStep(){return this.uniforms.batchTextureStep.value}set batchTextureStep(t){this.uniforms.batchTextureStep.value.copy(t)}get batchTextureDimensions(){return this.uniforms.batchTextureDimensions.value}set batchTextureDimensions(t){this.uniforms.batchTextureDimensions.value.copy(t)}get batchTexture(){return this.uniforms.batchTexture.value}set batchTexture(t){this.uniforms.batchTexture.value=t}};class _s extends wi{constructor(t){let{fragmentShader:i,vertexShader:r,uniforms:s}=Ni.physical;r=_n.replaceMain(r,"outputPosition2"),r=`

        #ifdef USE_BATCH_TABLE

            attribute float batchId;
            varying vec4 v_instanceColor;
            varying float v_visible;
            varying float v_mixFactory;

            const float SHIFT_LEFT8 = 256.0;
            const float SHIFT_RIGHT8 = 1.0 / 256.0;

        #endif

        ${r}
        void main(){
            outputPosition2();

            #ifdef USE_BATCH_TABLE
                // compressedColor, opacity, visible
                vec4 instanceColor = czm_batchTable_instanceColor(batchId);

                float temp = instanceColor.x * SHIFT_RIGHT8;
                v_instanceColor.b = (temp - floor(temp)) * SHIFT_LEFT8;
                temp = floor(temp) * SHIFT_RIGHT8;
                v_instanceColor.g = (temp - floor(temp)) * SHIFT_LEFT8;
                v_instanceColor.r = floor(temp);
                v_instanceColor /= 255.0;

                v_instanceColor.w = instanceColor.y;

                v_visible = instanceColor.z;
                v_mixFactory = instanceColor.w;
                gl_Position*=instanceColor.z;

            #endif
        }
        `,i=`

        #define TONE_MAPPING
        ${Ft.tonemapping_pars_fragment}
        ${ok("toneMapping",Vc)}

        #ifdef USE_BATCH_TABLE
            varying vec4 v_instanceColor;
            varying float v_visible;
            varying float v_mixFactory;
        #endif
        ${i}
        `,i=i.replace("vec4 diffuseColor = vec4( diffuse, opacity );",`
            vec4 diffuseColor = vec4( diffuse, opacity );
            #ifdef USE_BATCH_TABLE
                // diffuseColor.rgb = mix( diffuseColor.rgb, v_instanceColor.rgb, v_instanceColor.w );
                diffuseColor = mix( diffuseColor, v_instanceColor, v_mixFactory );


            #endif
            `);super({lights:!0,vertexShader:r,fragmentShader:i,toneMapped:!0,uniforms:Tn.merge([s,{batchTextureStep:{value:new nt},batchTextureDimensions:{value:new he},batchTexture:{value:void 0}}])});f(this,"isMeshStandardMaterial",!0);f(this,"isMeshPhysicalMaterial",!0);f(this,"color",new ve(16777215));f(this,"roughness",1);f(this,"metalness",0);f(this,"map",null);f(this,"lightMap",null);f(this,"lightMapIntensity",1);f(this,"aoMap",null);f(this,"aoMapIntensity",1);f(this,"emissive",new ve(0));f(this,"emissiveIntensity",1);f(this,"emissiveMap",null);f(this,"bumpMap",null);f(this,"bumpScale",1);f(this,"normalMap",null);f(this,"normalMapType",Br);f(this,"normalScale",new he(1,1));f(this,"displacementMap",null);f(this,"displacementScale",1);f(this,"displacementBias",0);f(this,"roughnessMap",null);f(this,"metalnessMap",null);f(this,"alphaMap",null);f(this,"envMap",null);f(this,"envMapIntensity",1);f(this,"wireframe",!1);f(this,"wireframeLinewidth",1);f(this,"wireframeLinecap","round");f(this,"wireframeLinejoin","round");f(this,"flatShading",!1);f(this,"fog",!0);f(this,"clearcoatMap",null);f(this,"clearcoatRoughness",0);f(this,"clearcoatRoughnessMap",null);f(this,"clearcoatNormalScale",new he(1,1));f(this,"clearcoatNormalMap",null);f(this,"ior",1.5);f(this,"iridescenceMap",null);f(this,"iridescenceIOR",1.3);f(this,"iridescenceThicknessRange",[100,400]);f(this,"iridescenceThicknessMap",null);f(this,"sheenColor",new ve(0));f(this,"sheenColorMap",null);f(this,"sheenRoughness",1);f(this,"sheenRoughnessMap",null);f(this,"transmissionMap",null);f(this,"thickness",0);f(this,"thicknessMap",null);f(this,"attenuationDistance",1/0);f(this,"attenuationColor",new ve(1,1,1));f(this,"specularIntensity",1);f(this,"specularIntensityMap",null);f(this,"specularColor",new ve(1,1,1));f(this,"specularColorMap",null);f(this,"_sheen",0);f(this,"_clearcoat",0);f(this,"_iridescence",0);f(this,"_transmission",0);f(this,"hasCompile",!1);this.defines={STANDARD:"",PHYSICAL:""},this.uniforms.roughness.value=0,this.uniforms.metalness.value=1,this._clearcoat,Object.defineProperty(this,"reflectivity",{get:function(){return kn.clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(o){this.ior=(1+.4*o)/(1-.4*o)}}),this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}update(t){let{scene:i}=t;this.uniforms.envMap.value=i.environment,this.uniforms.envMapRotation.value=i.environmentRotation}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}get batchTextureStep(){return this.uniforms.batchTextureStep.value}set batchTextureStep(t){this.uniforms.batchTextureStep.value.copy(t)}get batchTextureDimensions(){return this.uniforms.batchTextureDimensions.value}set batchTextureDimensions(t){this.uniforms.batchTextureDimensions.value.copy(t)}get batchTexture(){return this.uniforms.batchTexture.value}set batchTexture(t){this.uniforms.batchTexture.value=t}}function _k(n){if(typeof n!="object"||n===null)throw new TypeError("Input must be an object");return Object.entries(n).map(([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("&")}function Av(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function vk(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const yk=new fe;function bk(n,e,t,i){const r=e.attributes,s=new Lt;if(r.POSITION!==void 0){const l=i.json.accessors[r.POSITION],c=l.min,u=l.max;if(c!==void 0&&u!==void 0){if(s.set(new T(c[0],c[1],c[2]),new T(u[0],u[1],u[2])),l.normalized){const d=Av(_c[l.componentType]);s.min.multiplyScalar(d),s.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const l=new T,c=new T;for(let u=0,d=o.length;u<d;u++){const p=o[u];if(p.POSITION!==void 0){const g=i.json.accessors[p.POSITION],_=g.min,x=g.max;if(_!==void 0&&x!==void 0){if(c.setX(Math.max(Math.abs(_[0]),Math.abs(x[0]))),c.setY(Math.max(Math.abs(_[1]),Math.abs(x[1]))),c.setZ(Math.max(Math.abs(_[2]),Math.abs(x[2]))),g.normalized){const b=Av(_c[g.componentType]);c.multiplyScalar(b)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(l)}n.boundingBox=s;const a=new Mi;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=a}function xk(n,e,t){let i=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(i){const p=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;o.push(p)}if(r){const p=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(p)}if(s){const p=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(p)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],p=c[2];return i&&(n.morphAttributes.position=u),r&&(n.morphAttributes.normal=d),s&&(n.morphAttributes.color=p),n.morphTargetsRelative=!0,n})}function gA(n,e,t,i){const r=e.attributes,s=[];function o(a,l){return i.getDependency("accessor",a).then(function(c){n.setAttribute(l,c)})}for(const a in r){const l=Sv[a]||a.toLowerCase();l in n.attributes||s.push(o(r[a],l))}if(e.indices!==void 0&&!n.index){const a=i.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});s.push(a)}return Xt.workingColorSpace!==sn&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Xt.workingColorSpace}" not supported.`),Do(n,e),bk(n,e,t,i),Promise.all(s).then(function(){return e.targets!==void 0?xk(n,e.targets,i):n})}function wk(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}class Sk{constructor(e={},t={}){f(this,"json");f(this,"options");f(this,"cache",new dk);f(this,"textureLoader");f(this,"fileLoader");f(this,"plugins");f(this,"extensions");f(this,"associations",new Map);f(this,"primitiveCache",{});f(this,"nodeCache",{});f(this,"meshCache",{refs:{},uses:{}});f(this,"cameraCache",{refs:{},uses:{}});f(this,"lightCache",{refs:{},uses:{}});f(this,"sourceCache",{});f(this,"textureCache",{});f(this,"nodeNamesUsed",{});this.json=e,this.extensions={},this.plugins={},this.options=t;let i=!1,r=!1,s=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||r&&s<98?this.textureLoader=new Ud(this.options.manager):this.textureLoader=new Pw(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new fr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};return ja(s,a,r),Do(a,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[zt.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(po.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const r=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=wv[r.type],a=_c[r.componentType],l=r.normalized===!0,c=new a(r.count*o);return Promise.resolve(new Jt(c,o,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=wv[r.type],c=_c[r.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,p=r.byteOffset||0,g=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,_=r.normalized===!0;let x,b;if(g&&g!==d){const y=Math.floor(p/g),M="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+y+":"+r.count;let E=t.cache.get(M);E||(x=new c(a,y*g,r.count*g/u),E=new Pl(x,g/u),t.cache.add(M,E)),b=new jt(E,l,p%g/u,_)}else{try{a===null?x=new c(r.count*l):x=new c(a,p,r.count*l)}catch{}b=new Jt(x,l,_)}if(r.sparse!==void 0){const y=wv.SCALAR,M=_c[r.sparse.indices.componentType],E=r.sparse.indices.byteOffset||0,w=r.sparse.values.byteOffset||0,I=new M(o[1],E,r.sparse.count*y),B=new c(o[2],w,r.sparse.count*l);a!==null&&(b=new Jt(b.array.slice(),b.itemSize,b.normalized));for(let N=0,L=I.length;N<L;N++){const P=I[N];if(b.setX(P,B[N*l]),l>=2&&b.setY(P,B[N*l+1]),l>=3&&b.setZ(P,B[N*l+2]),l>=4&&b.setW(P,B[N*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e];if(!r)return Promise.resolve(null);const s=r.source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const p=(s.samplers||{})[o.sampler]||{};return u.magFilter=uA[p.magFilter]||Ei,u.minFilter=uA[p.minFilter]||wr,u.wrapS=fA[p.wrapS]||io,u.wrapT=fA[p.wrapT]||io,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const p=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(p),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(p,g){let _=p;t.isImageBitmapLoader===!0&&(_=function(b){const y=new yi(b);y.needsUpdate=!0,p(y)});let x=d.startsWith("$")?gn("Assets/DefaultMaterialTexture")+d.slice(1):po.resolveURL(d,s.path);t.load(x,_,void 0,g)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||vk(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),s.extensions[zt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[zt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[zt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(o.colorSpace=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new dd,Ji.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new gk,Ji.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return _s}loadMaterial(e){const t=this,i=this.json,r=this.extensions,s=i.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const d=r[zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=d.getMaterialType(),c.push(d.extendParams(a,s,t))}else if(l[zt.KHR_MATERIALS_UNLIT]){const d=r[zt.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,s,t))}else{const d=s.pbrMetallicRoughness||{};if(a.color=new ve(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const p=d.baseColorFactor;a.color.setRGB(p[0],p[1],p[2],sn),a.opacity=p[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture,Ai)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Jn);const u=s.alphaMode||Ev.OPAQUE;if(u===Ev.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Ev.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==Pi&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new xe(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;a.normalScale.set(d,d)}if(s.occlusionTexture!==void 0&&o!==Pi&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==Pi){const d=s.emissiveFactor;a.emissive=new ve().setRGB(d[0],d[1],d[2],sn)}return s.emissiveTexture!==void 0&&o!==Pi&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,Ai)),Promise.all(c).then(function(){const d=new o(a);return d.userData.paramsHash=_k(s),s.name&&(d.name=s.name),Do(d,s),t.associations.set(d,{materials:e}),s.extensions&&ja(r,d,s),d})}createUniqueName(e){const t=ei.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e,t){const i=this,r=this.extensions,s=this.primitiveCache;function o(l){return r[zt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,i).then(function(c){return gA(c,l,t,i)})}const a=[];for(let l=0,c=e.length;l<c;l++){const u=e[l],d=mk(u),p=s[d];if(p)a.push(p.promise);else{let g;u.extensions&&u.extensions[zt.KHR_DRACO_MESH_COMPRESSION]?g=o(u):g=gA(new Tt,u,t,i),s[d]={primitive:u,promise:g},a.push(g)}}return Promise.all(a)}loadMesh(e){const t=this,i=this.json,r=this.extensions,s=i.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?pk(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(t.loadGeometries(o,s)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let g=0,_=u.length;g<_;g++){const x=u[g],b=o[g];let y;const M=c[g];if(b.mode===_r.TRIANGLES||b.mode===_r.TRIANGLE_STRIP||b.mode===_r.TRIANGLE_FAN||b.mode===void 0)y=s.isSkinnedMesh===!0?new jg(x,M):new pt(x,M),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),b.mode===_r.TRIANGLE_STRIP?y.geometry=hA(y.geometry,rg):b.mode===_r.TRIANGLE_FAN&&(y.geometry=hA(y.geometry,wf));else if(b.mode===_r.LINES)y=new Cn(x,M);else if(b.mode===_r.LINE_STRIP)y=new ts(x,M);else if(b.mode===_r.LINE_LOOP)y=new $g(x,M);else if(b.mode===_r.POINTS)y=new gd(x,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(y.geometry.morphAttributes).length>0&&wk(y,s),y.name=t.createUniqueName(s.name||"mesh_"+e),Do(y,s),b.extensions&&ja(r,y,b),t.assignFinalMaterial(y),d.push(y)}for(let g=0,_=d.length;g<_;g++)t.associations.set(d[g],{meshes:e,primitives:g});if(d.length===1)return s.extensions&&ja(r,d[0],s),d[0];const p=new ur;s.extensions&&ja(r,p,s),t.associations.set(p,{meshes:e});for(let g=0,_=d.length;g<_;g++)p.add(d[g]);return p})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new en(kn.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(t=new Ns(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Do(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const d=o[c];if(d){a.push(d);const p=new fe;s!==null&&p.fromArray(s.array,c*16),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new gh(a,l)})}loadAnimation(e){const t=this.json,i=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],l=[],c=[],u=[];for(let d=0,p=r.channels.length;d<p;d++){const g=r.channels[d],_=r.samplers[g.sampler],x=g.target,b=x.node,y=r.parameters!==void 0?r.parameters[_.input]:_.input,M=r.parameters!==void 0?r.parameters[_.output]:_.output;x.node!==void 0&&(o.push(this.getDependency("node",b)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",M)),c.push(_),u.push(x))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(d){const p=d[0],g=d[1],_=d[2],x=d[3],b=d[4],y=[];for(let M=0,E=p.length;M<E;M++){const w=p[M],I=g[M],B=_[M],N=x[M],L=b[M];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const P=i._createAnimationTracks(w,I,B,N,L);if(P)for(let R=0;R<P.length;R++)y.push(P[R])}return new Hl(s,void 0,y)})}createNodeMesh(e){const t=this.json,i=this,r=t.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const t=this.json,i=this,r=t.nodes[e],s=i._loadNodeShallow(e),o=[],a=r.children||[];for(let c=0,u=a.length;c<u;c++)o.push(i.getDependency("node",a[c]));const l=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],d=c[1],p=c[2];p!==null&&u.traverse(function(g){g.isSkinnedMesh&&g.bind(p,yk)});for(let g=0,_=d.length;g<_;g++)u.add(d[g]);return u})}_loadNodeShallow(e){const t=this.json,i=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(s.isBone===!0?u=new sd:c.length>1?u=new ur:c.length===1?u=c[0]:u=new Dt,u!==c[0])for(let d=0,p=c.length;d<p;d++)u.add(c[d]);if(s.name&&(u.userData.name=s.name,u.name=o),Do(u,s),s.extensions&&ja(i,u,s),s.matrix!==void 0){const d=new fe;d.fromArray(s.matrix),u.applyMatrix4(d)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new ur;i.name&&(s.name=r.createUniqueName(i.name)),Do(s,i),i.extensions&&ja(t,s,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,d=l.length;u<d;u++)s.add(l[u]);const c=u=>{const d=new Map;for(const[p,g]of r.associations)(p instanceof Ji||p instanceof yi)&&d.set(p,g);return u.traverse(p=>{const g=r.associations.get(p);g!=null&&d.set(p,g)}),d};return r.associations=c(s),s})}_createAnimationTracks(e,t,i,r,s){const o=[],a=e.name?e.name:e.uuid,l=[];Ro[s.path]===Ro.weights?e.traverse(function(p){p.morphTargetInfluences&&l.push(p.name?p.name:p.uuid)}):l.push(a);let c;switch(Ro[s.path]){case Ro.weights:c=Sa;break;case Ro.rotation:c=Ea;break;case Ro.position:case Ro.scale:c=Aa;break;default:switch(i.itemSize){case 1:c=Sa;break;case 2:case 3:default:c=Aa;break}break}const u=r.interpolation!==void 0?hk[r.interpolation]:hl,d=this._getArrayFromAccessor(i);for(let p=0,g=l.length;p<g;p++){const _=new c(l[p]+"."+Ro[s.path],t.array,d,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(_),o.push(_)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Av(t.constructor),r=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)r[s]=t[s]*i;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const r=this instanceof Ea?fk:mA;return new r(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}class Ek{constructor(e){f(this,"name",zt.KHR_BINARY_GLTF);f(this,"content",null);f(this,"body",null);f(this,"header");const t=new DataView(e,0,au),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==dA)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-au,s=new DataView(e,au);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const l=s.getUint32(o,!0);if(o+=4,l===pA.JSON){const c=new Uint8Array(e,au+o,a);this.content=i.decode(c)}else if(l===pA.BIN){const c=au+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Tk{constructor(e,t){f(this,"json");f(this,"name",zt.KHR_DRACO_MESH_COMPRESSION);f(this,"dracoLoader");if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const d=Sv[u]||u.toLowerCase();a[d]=o[u]}for(const u in e.attributes){const d=Sv[u]||u.toLowerCase();if(o[u]!==void 0){const p=i.accessors[e.attributes[u]],g=_c[p.componentType];c[d]=g.name,l[d]=p.normalized===!0}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(d,p){r.decodeDracoFile(u,function(g){for(const _ in g.attributes){const x=g.attributes[_],b=l[_];b!==void 0&&(x.normalized=b)}d(g)},a,c,sn,p)})})}}class Ak{constructor(e){f(this,"parser");f(this,"name",zt.KHR_LIGHTS_PUNCTUAL);f(this,"cache",{refs:{},uses:{}});this.parser=e}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new ve(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],sn);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new Gl(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new T_(u),c.distance=d;break;case"spot":c=new S_(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Do(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),t.cache.add(i,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class Mk{constructor(e){f(this,"parser");f(this,"name",zt.KHR_MATERIALS_ANISOTROPY);this.parser=e}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class Ck{constructor(e){f(this,"parser");f(this,"name",zt.EXT_MATERIALS_BUMP);this.parser=e}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:kl}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class Ik{constructor(e){f(this,"name",zt.KHR_MATERIALS_CLEARCOAT);f(this,"parser");this.parser=e}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new xe(a,a)}return Promise.all(s)}}class Pk{constructor(e){f(this,"parser");f(this,"name",zt.KHR_MATERIALS_EMISSIVE_STRENGTH);this.parser=e}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class Rk{constructor(e){f(this,"parser");f(this,"name",zt.KHR_MATERIALS_IOR);this.parser=e}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Dk{constructor(e){f(this,"parser");f(this,"name",zt.KHR_MATERIALS_IRIDESCENCE);this.parser=e}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class _A extends _s{constructor(t){super();f(this,"isGLTFSpecularGlossinessMaterial",!0);f(this,"_extraUniforms");f(this,"_params");f(this,"hasCompile",!1);const i=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),r=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),l={specular:{value:new ve().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},specularMapTransform:{value:new at().identity()},glossinessMap:{value:null}};this._extraUniforms=l,this.onBeforeCompile=c=>{if(!this.hasCompile){this.hasCompile=!0;for(const u in l)c.uniforms[u]=l[u];c.vertexShader=this.vertexShader,c.fragmentShader=this.fragmentShader,c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)}},Object.defineProperties(this,{specular:{get:function(){return l.specular.value},set:function(c){l.specular.value=c}},specularMap:{get:function(){return l.specularMap.value},set:function(c){l.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(c){l.glossiness.value=c}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(c){l.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t),this._params=t}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Lk{constructor(){f(this,"name",zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS);f(this,"specularGlossinessParams",["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"])}getMaterialType(){return _A}extendParams(e,t,i){const r=t.extensions[this.name];e.color=new ve(1,1,1),e.opacity=1;const s=[];if(Array.isArray(r.diffuseFactor)){const o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(r.diffuseTexture!==void 0&&s.push(i.assignTexture(e,"map",r.diffuseTexture,Ai)),e.emissive=new ve(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new ve(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const o=r.specularGlossinessTexture;s.push(i.assignTexture(e,"glossinessMap",o)),s.push(i.assignTexture(e,"specularMap",o,Ai))}return Promise.all(s)}createMaterial(e){const t=new _A(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Br,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class Ok{constructor(e){f(this,"parser");f(this,"name",zt.KHR_MATERIALS_SHEEN);this.parser=e}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new ve(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],sn)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Ai)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class Nk{constructor(e){f(this,"name",zt.KHR_MATERIALS_SPECULAR);f(this,"parser");this.parser=e}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new ve().setRGB(a[0],a[1],a[2],sn),o.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,Ai)),Promise.all(s)}}class Bk{constructor(e){f(this,"parser");f(this,"name",zt.KHR_MATERIALS_TRANSMISSION);this.parser=e}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class Fk{constructor(){f(this,"name",zt.KHR_MATERIALS_UNLIT)}getMaterialType(){return Pi}extendParams(e,t,i){const r=[];e.color=new ve(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],sn),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture,Ai))}return Promise.all(r)}}class Uk{constructor(e){f(this,"parser");f(this,"name",zt.KHR_MATERIALS_VOLUME);this.parser=e,this.name=zt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:_s}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new ve().setRGB(a[0],a[1],a[2],sn),Promise.all(s)}}class kk{constructor(e){f(this,"parser");f(this,"name",zt.EXT_MESH_GPU_INSTANCING);this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=t.meshes[i.mesh];for(const c of r.primitives)if(c.mode!==_r.TRIANGLES&&c.mode!==_r.TRIANGLE_STRIP&&c.mode!==_r.TRIANGLE_FAN&&c.mode!==_r.LINES&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],p=c[0].count,g=[];for(const _ of d){let x=new Ma;x.attributes=_.geometry.attributes,x.instanceCount=p,x.boundingBox=new Lt().copy(_.geometry.boundingBox),x.boundingSphere=new Mi().copy(_.geometry.boundingSphere),x.setAttribute("instanceMatrix",new Gn(c[0].array,16)),_.material.useInstance=!0;const b=new _.constructor(x,_.material);Dt.prototype.copy.call(b,_),this.parser.assignFinalMaterial(b),g.push(b)}return u.isGroup?(u.clear(),u.add(...g),u):g[0]}))}}class zk{constructor(){f(this,"name",zt.KHR_MESH_QUANTIZATION)}}class Hk{constructor(e){f(this,"parser");f(this,"name",zt.EXT_MESHOPT_COMPRESSION);this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,c=r.byteLength||0,u=r.count,d=r.byteStride,p=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,p,r.mode,r.filter).then(function(g){return g.buffer}):o.ready.then(function(){const g=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(g),u,d,p,r.mode,r.filter),g})})}else return null}}class Gk{constructor(e){f(this,"name",zt.EXT_TEXTURE_AVIF);f(this,"parser");f(this,"isSupported",null);this.parser=e}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s||!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Vk{constructor(e){f(this,"parser");f(this,"name",zt.KHR_TEXTURE_BASISU);this.parser=e}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r||!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class Wk{constructor(){f(this,"name",zt.KHR_TEXTURE_TRANSFORM)}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Xk{constructor(e){f(this,"parser");f(this,"name",zt.EXT_TEXTURE_WEBP);f(this,"isSupported",null);this.parser=e,this.name=zt.EXT_TEXTURE_WEBP}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s||!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class vA extends In{constructor(t){super(t);f(this,"ktx2Loader");f(this,"dracoLoader");f(this,"meshoptDecoder",null);f(this,"pluginCallbacks",[]);this.register(function(i){return new Ik(i)}),this.register(function(i){return new Vk(i)}),this.register(function(i){return new Xk(i)}),this.register(function(i){return new Gk(i)}),this.register(function(i){return new Ok(i)}),this.register(function(i){return new Bk(i)}),this.register(function(i){return new Uk(i)}),this.register(function(i){return new Rk(i)}),this.register(function(i){return new Pk(i)}),this.register(function(i){return new Nk(i)}),this.register(function(i){return new Dk(i)}),this.register(function(i){return new Mk(i)}),this.register(function(i){return new Ck(i)}),this.register(function(i){return new Ak(i)}),this.register(function(i){return new Hk(i)}),this.register(function(i){return new kk(i)})}load(t,i,r,s){const o=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const u=po.extractUrlBase(t);a=po.resolveURL(u,this.path)}else a=po.extractUrlBase(t);this.manager.itemStart(t);const l=function(u){s?s(u):console.error(u),o.manager.itemError(t),o.manager.itemEnd(t)},c=new fr(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(u){try{o.parse(u,a,function(d){i(d),o.manager.itemEnd(t)},l)}catch(d){l(d)}},r,l)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,i,r,s){let o;const a={},l={},c=new TextDecoder;if(typeof t=="string")o=JSON.parse(t);else if(t instanceof ArrayBuffer)if(c.decode(new Uint8Array(t,0,4))===dA){try{a[zt.KHR_BINARY_GLTF]=new Ek(t)}catch(p){s&&s(p);return}o=JSON.parse(a[zt.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(t));else o=t;if(o.asset.version="2.0",o.asset===void 0||o.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}for(let d=0;d<o.nodes.length;d++){const p=o.nodes[d];O(p.children)}o.scene=0;const u=new Sk(o,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const p=this.pluginCallbacks[d](u);p.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[p.name]=p,a[p.name]=!0}if(o.extensionsUsed)for(let d=0;d<o.extensionsUsed.length;++d){const p=o.extensionsUsed[d],g=o.extensionsRequired||[];switch(p){case zt.KHR_MATERIALS_UNLIT:a[p]=new Fk;break;case zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[p]=new Lk;break;case zt.KHR_DRACO_MESH_COMPRESSION:a[p]=new Tk(o,this.dracoLoader);break;case zt.KHR_TEXTURE_TRANSFORM:a[p]=new Wk;break;case zt.KHR_MESH_QUANTIZATION:a[p]=new zk;break;default:g.indexOf(p)>=0&&l[p]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}u.setExtensions(a),u.setPlugins(l),u.parse(r,s)}parseAsync(t,i){const r=this;return new Promise(function(s,o){r.parse(t,i,s,o)})}}async function Yk(n,e,t=0){var i=n._tile,r=n._resource;let s=n.gltfLoader;n._rtcCenterTransform=fe.IDENTITY,n._contentModelMatrix=fe.multiply(i.computedTransform,n._rtcCenterTransform,new fe),s.parseAsync(e,r.url).then(o=>{n._gltf=o,n._readyPromise.resolve(n)})}class jk{constructor(e,t,i,r,s=0){f(this,"_tileset");f(this,"_tile");f(this,"_resource");f(this,"_gltf");f(this,"_model");f(this,"_batchTable");f(this,"_features");f(this,"_batchIdAttributeName");f(this,"_diffuseAttributeOrUniformName",{});f(this,"_rtcCenterTransform");f(this,"_contentModelMatrix");f(this,"featurePropertiesDirty",!1);f(this,"gltfLoader",new vA);f(this,"_readyPromise",mr());this._tileset=e,this._tile=t,this._resource=i,Yk(this,r,s)}get readyPromise(){return this._readyPromise.promise}update(e){}}var qk=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var r=WebAssembly.validate(t)?e:n,s,o=WebAssembly.instantiate(a(r),{}).then(function(y){s=y.instance,s.exports.__wasm_call_ctors()});function a(y){for(var M=new Uint8Array(y.length),E=0;E<y.length;++E){var w=y.charCodeAt(E);M[E]=w>96?w-97:w>64?w-39:w+4}for(var I=0,E=0;E<y.length;++E)M[I++]=M[E]<60?i[M[E]]:(M[E]-60)*64+M[++E];return M.buffer.slice(0,I)}function l(y,M,E,w,I,B){var N=s.exports.sbrk,L=E+3&-4,P=N(L*w),R=N(I.length),U=new Uint8Array(s.exports.memory.buffer);U.set(I,R);var j=y(P,E,w,R,I.length);if(j==0&&B&&B(P,L,w),M.set(U.subarray(P,P+E*w)),N(P-N(0)),j!=0)throw new Error("Malformed buffer data: "+j)}var c={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],p=0;function g(y){var M={object:new Worker(y),pending:0,requests:{}};return M.object.onmessage=function(E){var w=E.data;M.pending-=w.count,M.requests[w.id][w.action](w.value),delete M.requests[w.id]},M}function _(y){for(var M="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(r))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+b.toString(),E=new Blob([M],{type:"text/javascript"}),w=URL.createObjectURL(E),I=0;I<y;++I)d[I]=g(w);URL.revokeObjectURL(w)}function x(y,M,E,w,I){for(var B=d[0],N=1;N<d.length;++N)d[N].pending<B.pending&&(B=d[N]);return new Promise(function(L,P){var R=new Uint8Array(E),U=p++;B.pending+=y,B.requests[U]={resolve:L,reject:P},B.object.postMessage({id:U,count:y,size:M,source:R,mode:w,filter:I},[R.buffer])})}function b(y){o.then(function(){var M=y.data;try{var E=new Uint8Array(M.count*M.size);l(s.exports[M.mode],E,M.count,M.size,M.source,s.exports[M.filter]),self.postMessage({id:M.id,count:M.count,action:"resolve",value:E},[E.buffer])}catch(w){self.postMessage({id:M.id,count:M.count,action:"reject",value:w})}})}return{ready:o,supported:!0,useWorkers:function(y){_(y)},decodeVertexBuffer:function(y,M,E,w,I){l(s.exports.meshopt_decodeVertexBuffer,y,M,E,w,s.exports[c[I]])},decodeIndexBuffer:function(y,M,E,w){l(s.exports.meshopt_decodeIndexBuffer,y,M,E,w)},decodeIndexSequence:function(y,M,E,w){l(s.exports.meshopt_decodeIndexSequence,y,M,E,w)},decodeGltfBuffer:function(y,M,E,w,I,B){l(s.exports[u[I]],y,M,E,w,s.exports[c[B]])},decodeGltfBufferAsync:function(y,M,E,w,I){return d.length>0?x(y,M,E,u[w],c[I]):o.then(function(){var B=new Uint8Array(y*M);return l(s.exports[u[w]],B,y,M,E,s.exports[c[I]]),B})}}}();const Mv=new WeakMap;class Zk extends In{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){const s=new fr(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{this.parse(o,t,r)},i,r)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,Ai,i).catch(i)}decodeDracoFile(e,t,i,r,s=sn,o=()=>{}){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:s};return this.decodeGeometry(e,a).then(t).catch(o)}decodeGeometry(e,t){const i=JSON.stringify(t);if(Mv.has(e)){const l=Mv.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then(l=>(r=l,new Promise((c,u)=>{r._callbacks[s]={resolve:c,reject:u},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),Mv.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new Tt;e.index&&t.setIndex(new Jt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const r=e.attributes[i],s=r.name,o=r.array,a=r.itemSize,l=new Jt(o,a);s==="color"&&(this._assignVertexColorSpace(l,r.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),t.setAttribute(s,l)}return t}_assignVertexColorSpace(e,t){if(t!==Ai)return;const i=new ve;for(let r=0,s=e.count;r<s;r++)i.fromBufferAttribute(e,r),Xt.toWorkingColorSpace(i,Ai),e.setXYZ(r,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new fr(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,s)=>{i.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const s=Kk.toString(),o=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const o=s.data;switch(o.type){case"decode":r._callbacks[o.id].resolve(o);break;case"error":r._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Kk(){let n,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,e=new Promise(function(u){n.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(n)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(u=>{const d=u.draco,p=new d.Decoder;try{const g=t(d,p,new Int8Array(l),c),_=g.attributes.map(x=>x.array.buffer);g.index&&_.push(g.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:g},_)}catch(g){console.error(g),self.postMessage({type:"error",id:a.id,error:g.message})}finally{d.destroy(p)}});break}};function t(o,a,l,c){const u=c.attributeIDs,d=c.attributeTypes;let p,g;const _=a.GetEncodedGeometryType(l);if(_===o.TRIANGULAR_MESH)p=new o.Mesh,g=a.DecodeArrayToMesh(l,l.byteLength,p);else if(_===o.POINT_CLOUD)p=new o.PointCloud,g=a.DecodeArrayToPointCloud(l,l.byteLength,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!g.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+g.error_msg());const x={index:null,attributes:[]};for(const b in u){const y=self[d[b]];let M,E;if(c.useUniqueIDs)E=u[b],M=a.GetAttributeByUniqueId(p,E);else{if(E=a.GetAttributeId(p,o[u[b]]),E===-1)continue;M=a.GetAttribute(p,E)}const w=r(o,a,p,b,y,M);b==="color"&&(w.vertexColorSpace=c.vertexColorSpace),x.attributes.push(w)}return _===o.TRIANGULAR_MESH&&(x.index=i(o,a,p)),o.destroy(p),x}function i(o,a,l){const u=l.num_faces()*3,d=u*4,p=o._malloc(d);a.GetTrianglesUInt32Array(l,d,p);const g=new Uint32Array(o.HEAPF32.buffer,p,u).slice();return o._free(p),{array:g,itemSize:1}}function r(o,a,l,c,u,d){const p=d.num_components(),_=l.num_points()*p,x=_*u.BYTES_PER_ELEMENT,b=s(o,u),y=o._malloc(x);a.GetAttributeDataArrayForAllPoints(l,d,b,x,y);const M=new u(o.HEAPF32.buffer,y,_).slice();return o._free(y),{name:c,array:M,itemSize:p}}function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}const Rr={_maxAnisotropy:0,_maximumTextureImageUnits:0,_maximumTextureSize:0,_maximumAliasedPointSize:0,_minimumAliasedPointSize:0,get maxAnisotropy(){return Rr._maxAnisotropy},get maximumTextureImageUnits(){return Rr._maximumTextureImageUnits},get maximumTextureSize(){return Rr._maximumTextureSize},get maximumAliasedPointSize(){return Rr._maximumAliasedPointSize},get minimumAliasedPointSize(){return Rr._minimumAliasedPointSize}},Yi={UNSIGNED_BYTE:bt.UNSIGNED_BYTE,UNSIGNED_SHORT:bt.UNSIGNED_SHORT,UNSIGNED_INT:bt.UNSIGNED_INT,FLOAT:bt.FLOAT,HALF_FLOAT:bt.HALF_FLOAT_OES,UNSIGNED_INT_24_8:bt.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:bt.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:bt.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:bt.UNSIGNED_SHORT_5_6_5,sizeInBytes(n){switch(n){case Yi.UNSIGNED_BYTE:return 1;case Yi.UNSIGNED_SHORT:case Yi.UNSIGNED_SHORT_4_4_4_4:case Yi.UNSIGNED_SHORT_5_5_5_1:case Yi.UNSIGNED_SHORT_5_6_5:case Yi.HALF_FLOAT:return 2;case Yi.UNSIGNED_INT:case Yi.FLOAT:case Yi.UNSIGNED_INT_24_8:return 4}}},Qk=new nt,yA=new nt;function $k(n){let e=!1;const t=n.length;for(let i=0;i<t;++i)if(n[i].componentDatatype!==xt.UNSIGNED_BYTE){e=!0;break}return e?Yi.FLOAT:Yi.UNSIGNED_BYTE}function Jk(n,e=!1){const t=new Array(n.length);let i=0;const r=n.length;for(let s=0;s<r;++s){const a=n[s].componentDatatype;t[s]=i,a!==xt.UNSIGNED_BYTE&&e?i+=4:++i}return t}function ez(n,e,t=!1){const i=n.length,r=n[i-1];return e[i-1].componentDatatype!==xt.UNSIGNED_BYTE&&t?r+4:r+1}function bA(n,e){const t=n[e].componentsPerAttribute;return t===2?he:t===3?T:t===4?nt:Number}function tz(n){let e=n._stride;return n._textureDimensions.y===1?`uniform vec4 batchTextureStep;
            vec2 computeSt(float batchId)
            {
                float stepX = batchTextureStep.x;
                float centerX = batchTextureStep.y;
                float numberOfAttributes = float(${e});
                return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5);
            }`:`uniform vec4 batchTextureStep;
        uniform vec2 batchTextureDimensions;
        vec2 computeSt(float batchId)
        {
            float stepX = batchTextureStep.x;
            float centerX = batchTextureStep.y;
            float stepY = batchTextureStep.z;
            float centerY = batchTextureStep.w;
            float numberOfAttributes = float(${e});
            float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x);
            float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x);
            return vec2(centerX + (xId * stepX), centerY + (yId * stepY));
        }`}function iz(n){return n===1?"float":"vec"+n}function nz(n){return n===1?".x":n===2?".xy":n===3?".xyz":""}function rz(n,e){var t=n._attributes,i=t[e],r=i.componentsPerAttribute,s=i.functionName,o=iz(r),a=nz(r),l=n._offsets[e];const c=Ot.useWebGL2?"texture":"texture2D";var u=o+" "+s+`(float batchId) 
{ 
    vec2 st = computeSt(batchId); 
    st.x += batchTextureStep.x * float(`+l+`); 
`;return n._packFloats&&i.componentDatatype!==Yi.UNSIGNED_BYTE?u+=`vec4 textureValue; +
            textureValue.x = czm_unpackFloat(${c}(batchTexture, st)); +
            textureValue.y = czm_unpackFloat(${c}(batchTexture, st + vec2(batchTextureStep.x, 0.0))); +
            textureValue.z = czm_unpackFloat(${c}(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); +
            textureValue.w = czm_unpackFloat(${c}(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0)));`:u+=`   vec4 textureValue = ${c}(batchTexture, st);`,u+="    "+o+" value = textureValue"+a+`; 
`,n._pixelDatatype===Yi.UNSIGNED_BYTE&&i.componentDatatype===xt.UNSIGNED_BYTE&&!i.normalize?u+=`value *= 255.0; 
`:n._pixelDatatype===Yi.FLOAT&&i.componentDatatype===xt.UNSIGNED_BYTE&&i.normalize&&(u+=`value /= 255.0; 
`),u+=`    return value; 
} 
`,u}const sz=[void 0,void 0,new he,new T,new nt],lu=new nt;function oz(n,e,t){let i=nt.unpack(n,e,lu);const r=nt.unpackFloat(i);i=nt.unpack(n,e+4,lu);const s=nt.unpackFloat(i);i=nt.unpack(n,e+8,lu);const o=nt.unpackFloat(i);i=nt.unpack(n,e+12,lu);const a=nt.unpackFloat(i);return nt.fromElements(r,s,o,a,t)}function az(n,e,t){let i=nt.packFloat(n.x,lu);nt.pack(i,e,t),i=nt.packFloat(n.y,i),nt.pack(i,e,t+4),i=nt.packFloat(n.z,i),nt.pack(i,e,t+8),i=nt.packFloat(n.w,i),nt.pack(i,e,t+12)}function lz(n){const e=n._textureDimensions;let t=new An(n._batchValues,e.x,e.y,Ti,Ii);t.magFilter=xi,t.minFilter=xi,n._texture=t}function cz(n){const e=n._textureDimensions;n._texture.image={data:n._batchValues,width:e.x,height:e.y},n._texture.needsUpdate=!0}class Up{constructor(e,t,i){f(this,"context");f(this,"_textureDimensions");f(this,"_textureStep");f(this,"_pixelDatatype",Yi.UNSIGNED_BYTE);f(this,"_packFloats",!1);f(this,"_offsets");f(this,"_stride");f(this,"_texture");f(this,"_batchValues");f(this,"_batchValuesDirty",!1);f(this,"_numberOfInstances");f(this,"_attributes");this.context=e,this._numberOfInstances=i,this._attributes=t;const r=$k(t);let s=!1;const o=Jk(t,!1),a=ez(o,t,!1),l=Math.floor(Rr.maximumTextureSize/a),c=Math.min(i,l),u=a*c,d=Math.ceil(i/c),p=1/u,g=p*.5,_=1/d,x=_*.5;this._textureDimensions=new he(u,d),this._textureStep=new nt(p,g,_,x),this._pixelDatatype=r,this._packFloats=s,this._offsets=o,this._stride=a;const b=4*u*d;this._batchValues=new Float32Array(b)}get attributes(){return this._attributes}setBatchedAttribute(e,t,i){const r=this._attributes,s=sz[r[t].componentsPerAttribute],o=this.getBatchedAttribute(e,t,s),a=bA(this._attributes,t);if(O(a.equals)?a.equals(o,i):o===i)return;const c=Qk;c.x=O(i.x)?i.x:i,c.y=O(i.y)?i.y:0,c.z=O(i.z)?i.z:0,c.w=O(i.w)?i.w:0;const u=this._offsets[t],p=4*this._stride*e+4*u;this._packFloats&&r[t].componentDatatype!==Yi.UNSIGNED_BYTE?az(c,this._batchValues,p):nt.pack(c,this._batchValues,p),this._batchValuesDirty=!0}getBatchedAttribute(e,t,i){const r=this._attributes,s=this._offsets[t],a=4*this._stride*e+4*s;let l;this._packFloats&&r[t].componentDatatype!==Yi.UNSIGNED_BYTE?l=oz(this._batchValues,a,yA):l=nt.unpack(this._batchValues,a,yA);const c=bA(r,t);return O(c.fromVector4)?c.fromVector4(l,i):O(c.clone)?c.clone(l,i):l.x}getLayerVerteShaderCallback(){if(this._attributes.length===0)return r=>r;let t,i=this._stride;return this._textureDimensions.y===1?t=`
vec2 computeLayerTextureSt(float layerId,vec4 textureStep){
    float stepX=textureStep.x;
    float centerX=textureStep.y;
    float numberOfAttributes = float(${i});
    return vec2(centerX+(layerId*numberOfAttributes*stepX),.5);
}
            `:t=`
uniform vec2 layerTextureDimensions;
vec2 computeLayerTextureSt(float layerId,vec4 textureStep){
    float stepX=textureStep.x;
    float centerX=textureStep.y;
    float stepY=textureStep.z;
    float centerY=textureStep.w;
    float numberOfAttributes = float(${i});
    // return vec2(centerX+(layerId*numberOfAttributes*stepX),.5);
    float xId = mod(layerId * numberOfAttributes, layerTextureDimensions.x);
    float yId = floor(layerId * numberOfAttributes / layerTextureDimensions.x);
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY));
}
            `,function(r){return r.replace(/#pragma layer_replace_start\s+[^]*\s+#pragma layer_replace_end/g,t)}}getVertexShaderCallback(){let e=this._attributes;if(e.length===0)return s=>s;var t=`uniform highp sampler2D batchTexture; 
`;t+=tz(this)+`
`;for(var i=e.length,r=0;r<i;++r)t+=rz(this,r);return function(s){var o=s.indexOf("void main"),a=s.substring(0,o),l=s.substring(o);return a+`
`+t+`
`+l}}update(e){O(this._texture)&&!this._batchValuesDirty||this._attributes.length===0||(this._batchValuesDirty=!1,O(this._texture)||lz(this),cz(this))}isDestroyed(){return!1}destroy(){return this._texture.image.data=null,this._texture.dispose(),ht(this)}}function Cv(n,e){return n.distance-e.distance}class Iv{constructor(){f(this,"_properties");f(this,"_material");f(this,"visible");f(this,"_isFetchingCache");f(this,"colorCommand")}}const Mu=class Mu{constructor(){f(this,"enabled",!0);f(this,"maximumByteLength",2147483648);f(this,"modelStorageMap",new Map);f(this,"store",r0.createInstance({name:Mu.name,storeName:"modelBufferData"}));f(this,"cacheTime",r0.createInstance({name:Mu.name,storeName:"modelCacheTime"}));this.getData()}async getData(){}get maximumMeterLength(){return this.maximumByteLength/(1024*1024)}async setItem(e,t){await this.store.setItem(e,t)}async getItem(e){return await this.store.getItem(e)}};f(Mu,"name","ModelCache");let Pv=Mu,vs=new Pv;const kp=new T;function hz(n,e,t,i,r,s,o,a){let l;if(e.side===hn?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===br,a),l===null)return null;kp.copy(a),kp.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(kp);return c<t.near||c>t.far?null:{distance:c,point:kp.clone(),object:n}}const zp=new T,Hp=new T,Gp=new T,xA=new T,wA=new T,SA=new T,EA=new T;function TA(n,e,t,i,r,s,o,a){n.getVertexPosition(s,zp),n.getVertexPosition(o,Hp),n.getVertexPosition(a,Gp);const l=hz(n,e,t,i,zp,Hp,Gp,EA);if(l){r&&(xA.fromBufferAttribute(r,s),wA.fromBufferAttribute(r,o),SA.fromBufferAttribute(r,a),l.normal=$i.getInterpolation(EA,zp,Hp,Gp,xA,wA,SA,new T),l.normal.dot(i.direction)>0&&l.normal.multiplyScalar(-1));const c={a:s,b:o,c:a,normal:new T,materialIndex:0};$i.getNormal(zp,Hp,Gp,c.normal),l.face=c}return l}function AA(n,e,t,i){let r;const s=e.geometry,o=e.material,a=s.index,l=s.attributes.position,c=s.attributes.normal,u=s.drawRange;if(a!==null){const d=Math.max(0,u.start),p=Math.min(a.count,u.start+u.count);for(let g=d,_=p;g<_;g+=3){const x=a.getX(g),b=a.getX(g+1),y=a.getX(g+2);r=TA(e,o,n,i,c,x,b,y),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}else if(l!==void 0){const d=Math.max(0,u.start),p=Math.min(l.count,u.start+u.count);for(let g=d,_=p;g<_;g+=3){const x=g,b=g+1,y=g+2;r=TA(e,o,n,i,c,x,b,y),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}}class cu extends wi{constructor(e={}){let{vertexShader:t,fragmentShader:i,uniforms:r}=Ni.basic;t=_n.replaceMain(t,"outputPosition"),t=`

        #ifdef USE_BATCH_TABLE
            attribute float batchId;
            varying vec4 v_pickColor;
        #endif
        ${t}
        void main(){
            outputPosition();

            #ifdef USE_BATCH_TABLE
                v_pickColor = czm_batchTable_pickColor(batchId);
                vec4 instanceColor = czm_batchTable_instanceColor(batchId);

                #ifdef OVERLAY
                    gl_Position*=instanceColor.w;
                    v_pickColor = vec4(instanceColor.z);
                #else
                    gl_Position*=instanceColor.z;
                #endif
            #endif
        }
        `,i=_n.replaceMain(i,"originMain"),i=`
        #ifdef USE_BATCH_TABLE
            varying vec4 v_pickColor;
        #endif
        ${i}
        void main(){
            originMain();

            #ifdef USE_BATCH_TABLE
                gl_FragColor = v_pickColor;
            #endif
        }
        `,super({vertexShader:t,fragmentShader:i,uniforms:Tn.merge([r,{batchTextureStep:{value:new nt},batchTextureDimensions:{value:new he},batchTexture:{value:void 0}}])}),this.setValues(e),this.toneMapped=!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}get map(){return this.uniforms.map.value}set map(e){this.uniforms.map.value=e}get batchTextureStep(){return this.uniforms.batchTextureStep.value}set batchTextureStep(e){this.uniforms.batchTextureStep.value.copy(e)}get batchTextureDimensions(){return this.uniforms.batchTextureDimensions.value}set batchTextureDimensions(e){this.uniforms.batchTextureDimensions.value.copy(e)}get batchTexture(){return this.uniforms.batchTexture.value}set batchTexture(e){this.uniforms.batchTexture.value=e}}const vc=new fe,Rv=new fe,Vp=[],Wp=new Lt,hu=new pt,uz=new nt,{LEFT_SHIFT16:fz,LEFT_SHIFT8:dz}=Ne,MA=new Tr,CA=new fe,Xp=new nt;function uu(n,e,t){return n*fz+e*dz+t}class pz extends Iv{constructor(t){super();f(this,"modelMatrix");f(this,"pickMaterial",new cu({transparent:!1}));f(this,"_overlayMaterial",new cu({transparent:!1}));f(this,"_content");f(this,"batchTable");f(this,"pickId");f(this,"pickIds");f(this,"_properties",[]);f(this,"_instanceBoundingSphere",new Mi);f(this,"boundingVolume",new Lt);f(this,"_instanceBoundingVolume",[]);f(this,"boundingSphere",new Mi);f(this,"outlineCommand");f(this,"_indices",[]);f(this,"_modelMatrix",new fe().identity());f(this,"_modelMatrixInverse",new fe().identity());f(this,"baseCollection",new zi);f(this,"userData",{componentKey:[]});f(this,"visible",!0);f(this,"showDebuggerBoundingVolume",!1);f(this,"debuggerBoundingVolumeHelper");f(this,"_screenSpaceError",0);f(this,"_isFetchingCache",!1);f(this,"_cacheBufferData",{key:"",overTime:5,updatedTime:ni.now()});f(this,"aaa",[]);let{group:i,content:r,modelMatrix:s=new fe().identity()}=t;fe.clone(s,this._modelMatrix);let{baseCollection:o}=this;this._content=r;let a,l;i.children[0]instanceof pt?(a=i.children[0],l=i.children[1]):(a=i.children[1],l=i.children[0]),o.attach(a),a.applyMatrix4(s),a.material=a.material.clone(),a.material.defines.USE_INSTANCING="",a.geometry.computeBoundingSphere(),a.frustumCulled=!1,Object.values(a.userData).forEach(c=>{Array.isArray(c.elementId)&&this.userData.componentKey.push(...c.elementId)}),this.colorCommand=a,this._material=a.material,Xr(this.colorCommand.geometry),l&&(o.attach(l),l.applyMatrix4(s),l.geometry.computeBoundingSphere(),l.frustumCulled=!1,l.material.defines.USE_INSTANCING="",Xr(l.geometry),this.outlineCommand=l),this.computeBoundingSphere(),this.setAttributeLocalData(),this.getMeshCommand()}getMeshCommand(){let{colorCommand:t,outlineCommand:i}=this,{geometry:r}=t;const{attributes:s,instanceCount:o}=r;for(let a=0;a<o;a++){let l=new Tt;for(let d of Object.keys(s)){const p=s[d];p instanceof Gn||l.setAttribute(d,p.clone())}l.index=r.index?r.index.clone():null;let c=new pt(l,new Fd),u=new fe;this.getInstanceMatrixAt(a,u),c.applyMatrix4(u),c.applyMatrix4(t.matrix),new Ma,this.aaa.push(c)}}get content(){return this._content}get model(){return this.content.owner}get _tile(){return this.content._tile}get material(){return this.colorCommand.material}get instanceCount(){return this.colorCommand.geometry.instanceCount}get indices(){return this._indices}get computedTransform(){return this.model.modelMatrix}get positionAttr(){let t=this.colorCommand.geometry.getAttribute("position");return t instanceof jt?t.data.array:t.array}getProperty(t){return this._properties[t||0]}async setAttributeLocalData(){let t=this.model._accessId;if(!O(t))return;let{position:i,normal:r,instanceMatrix:s,index:o}=this.getGeometryBufferData(),a=[t,this.model._timeKey,...this._properties.map(c=>c.componentKey)].join("&");this._cacheBufferData.key=a;let l=await vs.getItem(a);O(l)||await vs.setItem(a,{position:i,index:o,normal:r,instanceMatrix:s})}getGeometryBufferData(){let t=this.colorCommand.geometry,[i,r,s,o]=[t.getAttribute("position"),t.getAttribute("normal"),t.getAttribute("instanceMatrix"),t.getIndex()],a=i instanceof jt?i.data.array:i.array,l=r instanceof jt?r.data.array:r.array,c=s.array,u=O(o)?o instanceof jt?o.data.array:o.array:null;return{position:a,index:u,instanceMatrix:c,normal:l}}async setCacheBufferData(){let t=this._cacheBufferData.key;if(!O(t)||this._isFetchingCache)return;let i=await vs.getItem(t);if(!O(i))return;let r=this.colorCommand.geometry,[s,o,a,l]=[r.getAttribute("position"),r.getAttribute("normal"),r.getAttribute("instanceMatrix"),r.getIndex()];s instanceof jt?s.data.array=i.position:s.array=i.position,o instanceof jt?o.data.array=i.normal:o.array=i.normal,a.array=i.instanceMatrix,O(l)&&(l instanceof jt?l.data.array=i.index:l.array=i.index),this._cacheBufferData.updatedTime=ni.now(),this._isFetchingCache=!1}raycast(t,i,r=[]){if(!O(this.positionAttr))return this.setCacheBufferData(),this._isFetchingCache=!0,r;this._cacheBufferData.updatedTime=ni.now();const s=this.colorCommand.matrixWorld;if(hu.geometry=this.colorCommand.geometry,hu.material=this.material,hu.material!==void 0){this.getInstanceMatrixAt(i,vc),Rv.multiplyMatrices(s,vc),hu.matrixWorld=Rv,CA.copy(Rv).invert(),MA.copy(t.ray).applyMatrix4(CA),AA(t,hu,Vp,MA);for(let o=0,a=Vp.length;o<a;o++){const l=Vp[o];l.instanceId=i,l.object=this,r.push(l)}return r.sort(Cv),Vp.length=0,r}}computeBoundingSphere(){const t=this.colorCommand.geometry,i=this.instanceCount;t.boundingBox===null&&(t.computeBoundingBox(),t.computeBoundingSphere()),this._instanceBoundingSphere.copy(t.boundingSphere),this._instanceBoundingSphere.applyMatrix4(this._modelMatrix),this.boundingVolume.makeEmpty();for(let r=0;r<i;r++)this.getInstanceMatrixAt(r,vc),Wp.copy(t.boundingBox).applyMatrix4(vc),this.boundingVolume.union(Wp),this._properties.push({boundingVolume:Wp,componentKey:this.userData.componentKey[r]}),this._instanceBoundingVolume.push(new Lt().copy(Wp));this.boundingVolume.applyMatrix4(this._modelMatrix),this.boundingVolume.getBoundingSphere(this.boundingSphere)}getVertexPosition(t,i,r=new T){return this.colorCommand.getVertexPosition(t,r),this.getInstanceMatrixAt(i,vc),r.applyMatrix4(vc),r.applyMatrix4(this.colorCommand.matrix),r}createPickId(t){let{instanceCount:i}=this,r=[];this.pickIds=[];for(let s=0;s<i;s++)r.push(s);this.colorCommand.geometry.setAttribute("batchId",new Gn(new Float32Array(r),1)),this.outlineCommand.geometry.setAttribute("batchId",new Gn(new Float32Array(r),1)),this.pickMaterial.defines.USE_INSTANCING="",this.pickMaterial.needsUpdate=!0,this._overlayMaterial.defines.USE_INSTANCING="",this._overlayMaterial.needsUpdate=!0}getPickColor(t){return this.pickIds[t.instanceId].color}getInstanceMatrixAt(t,i=new fe){let r=this.colorCommand.geometry.getAttribute("instanceMatrix").array;return i.elements=Array.from(r.slice(t*16,(t+1)*16)),i}createBatchTable(t){let{instanceCount:i}=this,{context:r}=t,[s]=[new nt(uu(255,255,255),1,1,1)],o=[{functionName:"czm_batchTable_instanceColor",componentDatatype:xt.FLOAT,componentsPerAttribute:4,normalize:!0},{functionName:"czm_batchTable_pickColor",componentDatatype:xt.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}];const a=new Up(r,o,i);for(let l=0;l<i;l++){let c={model:this.model,primitive:this,instanceId:l},u=t.context.createPickColorSafeRange(c);this.pickIds.push(u),a.setBatchedAttribute(l,0,s);let d=u.color,p=uz;p.x=We.floatToByte(d.red),p.y=We.floatToByte(d.green),p.z=We.floatToByte(d.blue),p.w=We.floatToByte(d.alpha),a.setBatchedAttribute(l,1,p)}this.batchTable=a,this._material.defines.USE_BATCH_TABLE="",this._material.vertexShader=a.getVertexShaderCallback()(this._material.vertexShader),this._material.batchTextureStep=a._textureStep,this._material.batchTextureDimensions=a._textureDimensions,this._material.needsUpdate=!0,this.outlineCommand.material.defines.USE_BATCH_TABLE="",this.outlineCommand.material.vertexShader=a.getVertexShaderCallback()(this.outlineCommand.material.vertexShader),this.outlineCommand.material.batchTextureStep=a._textureStep,this.outlineCommand.material.batchTextureDimensions=a._textureDimensions,this.outlineCommand.material.needsUpdate=!0,this._material.defines.USE_BATCH_TABLE="",this.pickMaterial.vertexShader=a.getVertexShaderCallback()(this.pickMaterial.vertexShader),this.pickMaterial.batchTextureStep=a._textureStep,this.pickMaterial.batchTextureDimensions=a._textureDimensions,this.pickMaterial.needsUpdate=!0,this._overlayMaterial.defines.USE_BATCH_TABLE="",this._overlayMaterial.vertexShader=a.getVertexShaderCallback()(this._overlayMaterial.vertexShader),this._overlayMaterial.batchTextureStep=a._textureStep,this._overlayMaterial.batchTextureDimensions=a._textureDimensions,this._overlayMaterial.needsUpdate=!0}unpackPickInfo(t){let i=this.getProperty(t.instanceId);return{primitive:this,pickColor:t.pickColor,info:{componentKey:i.componentKey,buildingId:O(this._tile.extras)?this._tile.extras.buildingId:"",boundingVolume:i.boundingVolume},instanceId:t.instanceId,model:this.model}}setInstanceDiffuse(t,i){let r=this.batchTable.getBatchedAttribute(i,0,Xp);r.x=uu(t.x,t.y,t.z),r.y=t.w,t.w===1?this._material.transparent&&(this._material.transparent=!1,this._material.needsUpdate=!0):t.w<1&&(this._material.transparent||(this._material.transparent=!0,this._material.needsUpdate=!0)),this.batchTable.setBatchedAttribute(i,0,r)}getInstanceVisible(t){return!!this.batchTable.getBatchedAttribute(t,0,Xp).z}resetInstanceColorAll(){for(let t=0;t<this.instanceCount;t++)this.setInstanceDiffuse(Dv,t)}setInstanceVisible(t,i){let r=this.batchTable.getBatchedAttribute(i,0,Xp);r.z=Number(t),this.batchTable.setBatchedAttribute(i,0,r)}setOverlayInstanceVisible(t,i){if(i<0||i>this.instanceCount)return;let r=this.batchTable.getBatchedAttribute(i,0,Xp),s=!!r.w;return r.w=Number(t),this.batchTable.setBatchedAttribute(i,0,r),()=>this.setOverlayInstanceVisible(s,i)}updateModelMatrix(){let t=this.model;this.colorCommand.applyMatrix4(t._modelMatrixInverse),this.colorCommand.applyMatrix4(t.modelMatrix)}updateClipPlane(){let{clippingPlanes:t,clippingEnabled:i}=this.model;i||(t=[]);let{_material:r,pickMaterial:s,_overlayMaterial:o,outlineCommand:a}=this;if(r.clippingPlanes=t,r.clipping=i,s.clippingPlanes=t,s.clipping=i,o.clippingPlanes=t,o.clipping=i,O(a)){let l=a.material;l.clippingPlanes=t,l.clipping=i}}getOverlayRenderInstance(){return this._overlayMaterial.side=this._material.side,this.colorCommand.material=this._overlayMaterial,this.colorCommand}createBoundingVolumeHelper(){O(this.debuggerBoundingVolumeHelper)||(this.debuggerBoundingVolumeHelper=new Pr(this.boundingVolume,new ve(16776960)))}getScreenSpaceError(t){let{camera:i,context:r}=t,s=this.boundingSphere.radius*this.boundingSphere.radius;var o=r.drawingBufferHeight;let a=this.boundingSphere.distanceToPoint(i.position);var l=Math.max(a,Ne.EPSILON7),c=i.frustum.sseDenominator;let u=s*o/(l*c);return u/=t.pixelRatio,u}destroyCacheBuffer(t){let{_cacheBufferData:i}=this;if(!O(this.positionAttr)||ni.secondsDifference(t.time,i.updatedTime)<i.overTime)return;this._isFetchingCache=!1;let r=this.colorCommand.geometry,[s,o,a,l]=[r.getAttribute("position"),r.getAttribute("normal"),r.getAttribute("instanceMatrix"),r.getIndex()];s instanceof jt?s.data.array=null:s.array=null,o instanceof jt?o.data.array=null:o.array=null,a.array=null,O(l)&&(l instanceof jt?l.data.array=null:l.array=null)}update(t){if(!this.visible||(this.destroyCacheBuffer(t),!t.camera.frustum.cullVolume.intersectsBox(this.boundingVolume)))return;this._screenSpaceError=this.getScreenSpaceError(t),this._screenSpaceError<512,O(this.pickIds)||this.createPickId(t),O(this.batchTable)||this.createBatchTable(t),this.colorCommand.material=this._material,t.passes.pick&&(this.pickMaterial.side=this._material.side,this.colorCommand.material=this.pickMaterial),this.updateClipPlane();let{batchTable:i}=this;this.batchTable.update(t),this.colorCommand.material.batchTexture=i._texture,O(this.model.style)&&O(this.model.style.materialStyle)&&this.model.style.materialStyle.enabled&&(this._material.roughnessMap=this.model.style.roughnessMap),!t.passes.pick&&(this.model.showOutline&&this.outlineCommand&&(this.outlineCommand.material.batchTexture=i._texture,t.commandList.push(this.outlineCommand)),t.commandList.push(...this.aaa),this.showDebuggerBoundingVolume&&(this.createBoundingVolumeHelper(),this.debuggerBoundingVolumeHelper.update(t)))}isDestroyed(){return!1}destroy(){let{colorCommand:t,outlineCommand:i,debuggerBoundingVolumeHelper:r}=this;return O(t)&&(t.geometry.dispose(),t.material.dispose()),O(i)&&(i.geometry.dispose(),i.material.dispose()),r==null||r.dispose(),this._material.dispose(),this.pickMaterial.dispose(),this._overlayMaterial.dispose(),ht(this)}}const mz=new nt,IA=new nt;class gz{constructor(e){f(this,"batchTable");f(this,"colorCommand");f(this,"_content");f(this,"_material");f(this,"boundingVolume",new Lt);f(this,"_instanceCount",0);f(this,"showDebuggerBoundingVolume",!1);f(this,"boundingVolumeHelper");f(this,"_properties",[]);f(this,"userData");f(this,"visible",!0);f(this,"_isFetchingCache",!1);f(this,"modelMatrix",new fe().identity());f(this,"_modelMatrix",new fe().identity());f(this,"_modelMatrixInverse",new fe().identity());f(this,"baseCollection",new zi);f(this,"_pickIds",[]);let{group:t,content:i,modelMatrix:r=new fe().identity()}=e;fe.clone(r,this._modelMatrix),this._content=i,this.colorCommand=t.children[0],this.baseCollection.attach(this.colorCommand),this._material=this.colorCommand.material.clone(),this.colorCommand.material=this._material,this.colorCommand.geometry.computeBoundingBox(),this.colorCommand.applyMatrix4(this._modelMatrix),this.boundingVolume.copy(this.colorCommand.geometry.boundingBox),this.boundingVolume.applyMatrix4(this._modelMatrix);let s=this.colorCommand.userData.boundingVolume;for(let o=0;o<s.length;o+=6){let a=new Lt(new T(s[o],s[o+1],s[o+2]),new T(s[o+3],s[o+4],s[o+5]));a.applyMatrix4(this._modelMatrix),this._properties.push({boundingVolume:a,componentKey:this.colorCommand.userData.componentKey[o/6]}),this.boundingVolume.union(a)}this._instanceCount=this._properties.length,Xr(this.colorCommand.geometry),this.model.useProperty&&this.model.property.addComponentsProperty(this._content._tile.extras.buildingId,this._properties)}setInstanceVisibleFromArray(e,t){if(e.length===0)return;if(e.length===1){this.setInstanceVisible(t,e[0]);return}let i=this.batchTable._batchValues;const r=Number(t);for(let s of e)i[s*8+2]=r;this.batchTable._batchValuesDirty=!0}getOverlayRenderInstance(){throw new Error("Method not implemented.")}setOverlayInstanceVisible(e,t){throw new Error("Method not implemented.")}getProperty(e){return this._properties[e||0]}getPickColor(e){return e.pickColor}setInstanceVisible(e,t){let i=this.batchTable.getBatchedAttribute(t,0,IA);i.z=Number(e),this.batchTable.setBatchedAttribute(t,0,i)}getInstanceVisible(e){return e<0||e>this.instanceCount?!1:!!this.batchTable.getBatchedAttribute(e,0,IA).z}unpackPickInfo(e){let t=this.getProperty(e.instanceId);return{primitive:this,pickColor:e.pickColor,instanceId:e.instanceId,info:{componentKey:t.componentKey,buildingId:O(this.tile.extras)?this.tile.extras.buildingId:"",boundingVolume:t.boundingVolume},componentKey:t.componentKey,model:this.model}}raycast(e,t,i){throw new Error("Method not implemented.")}get model(){return this.content.owner}get tile(){return this.content._tile}get content(){return this._content}get instanceCount(){return this._instanceCount}resetInstanceColorAll(){}setInstanceDiffuse(){}updateModelMatrix(){}updateClipPlane(){let{clippingPlanes:e,clippingEnabled:t}=this.model,{_material:i}=this;i.clippingPlanes=e,i.clipping=t}createBoundingVolumeHelper(){O(this.boundingVolumeHelper)||(this.boundingVolumeHelper=new Pr(this.boundingVolume))}createBatchTable(e){if(O(this.batchTable))return;let{_instanceCount:t}=this,[i]=[new nt(uu(255,255,255),1,1,0)],r=[{functionName:"czm_batchTable_instanceColor",componentDatatype:xt.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"czm_batchTable_pickColor",componentDatatype:xt.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}];const s=new Up(e.context,r,t);s._batchValues=new Float32Array(s._batchValues.length);for(let o=0;o<t;++o){let a=e.context.createPickColorSafeRange({primitive:this,instanceId:o}),l=a.color,c=mz;c.x=We.floatToByte(l.red),c.y=We.floatToByte(l.green),c.z=We.floatToByte(l.blue),c.w=We.floatToByte(l.alpha),s.setBatchedAttribute(o,1,l),this._pickIds.push(a),s.setBatchedAttribute(o,0,i)}this.batchTable=s,this._material.defines.USE_BATCH_TABLE="",this._material.vertexShader=s.getVertexShaderCallback()(this._material.vertexShader),this._material.batchTextureStep=s._textureStep,this._material.batchTextureDimensions=s._textureDimensions,this._material.needsUpdate=!0}update(e){!this.visible||e.passes.pick||(O(this.batchTable)||this.createBatchTable(e),e.camera.frustum.cullVolume.intersectsBox(this.boundingVolume)&&(this.batchTable.update(e),this.updateClipPlane(),this.colorCommand.material.batchTexture=this.batchTable._texture,e.commandList.push(this.colorCommand),this.showDebuggerBoundingVolume&&(this.createBoundingVolumeHelper(),e.commandList.push(this.boundingVolumeHelper))))}isDestroyed(){return!1}destroy(){var t,i;let{colorCommand:e}=this;return e.geometry.dispose(),e.material.dispose(),(t=this.batchTable)==null||t.destroy(),(i=this.boundingVolumeHelper)==null||i.dispose(),ht(this)}}const _z=new nt;new ni;const Yp=new nt;class vz extends Iv{constructor(t){super();f(this,"batchTable");f(this,"_properties",[]);f(this,"pickMaterial",new cu({transparent:!1}));f(this,"_overlayMaterial",new cu({transparent:!1}));f(this,"outlineCommand");f(this,"_content");f(this,"_instanceCount",0);f(this,"_pickIds",[]);f(this,"showDebuggerBoundingVolume",!1);f(this,"debuggerBoundingVolumeHelper");f(this,"boundingVolume",new Lt);f(this,"userData");f(this,"baseCollection",new zi);f(this,"boundingSphere",new Mi);f(this,"visible",!0);f(this,"_isFetchingCache",!1);f(this,"_cacheBufferData",{key:"",overTime:5,updatedTime:ni.now()});f(this,"bufferGeometryLoader",new M_);f(this,"modelMatrix",new fe().identity());f(this,"_modelMatrix",new fe().identity());f(this,"_modelMatrixInverse",new fe().identity());f(this,"_materialDefaultParams",{transparent:!0,opacity:1});f(this,"_mesh",new pt);let{group:i,content:r,modelMatrix:s=new fe().identity()}=t;fe.clone(s,this.modelMatrix),fe.clone(s,this._modelMatrix),this._modelMatrixInverse.copy(this.modelMatrix).invert(),this._content=r;let{baseCollection:o}=this,a,l;i.children[0]instanceof pt?(a=i.children[0],l=i.children[1]):(a=i.children[1],l=i.children[0]);let c=a.userData.boundingVolume;for(let d=0;d<c.length;d+=6){let p=new Lt(new T(c[d],c[d+1],c[d+2]),new T(c[d+3],c[d+4],c[d+5]));p.applyMatrix4(this._modelMatrix),this._properties.push({boundingVolume:p,componentKey:a.userData.componentKey[d/6]}),this.boundingVolume.union(p)}o.attach(a),a.frustumCulled=!1,a.applyMatrix4(this._modelMatrix),a.userData={},this._material=a.material.clone(),this._material.depthWrite=!0,this.colorCommand=a,Xr(this.colorCommand.geometry),l&&(o.attach(l),l.applyMatrix4(this._modelMatrix),l.frustumCulled=!1,Xr(l.geometry),this.outlineCommand=l,this.outlineCommand.material=l.material.clone(),this.outlineCommand.userData={}),this.boundingVolume.setFromObject(this.colorCommand),this.boundingVolume.getBoundingSphere(this.boundingSphere),this._instanceCount=this._properties.length,this.setAttributeLocalData(),this._materialDefaultParams={opacity:this._material.opacity,transparent:this._material.transparent};let u=this._content.model;u.useProperty&&u.property.addComponentsProperty(this._content._tile.extras.buildingId,this._properties)}get model(){return this.content.owner}get tile(){return this.content._tile}get content(){return this._content}get instanceCount(){return this._instanceCount}get positionAttr(){if(!O(this._mesh.geometry))return null;let t=this._mesh.geometry.getAttribute("position");return O(t)?t instanceof jt?t.data.array:t.array:null}get pickIds(){return this._pickIds}getProperty(t){return this._properties[t||0]}createBatchTable(t){if(O(this.batchTable))return;let{_instanceCount:i}=this,[r]=[new nt(uu(255,255,255),1,1,0)],s=[{functionName:"czm_batchTable_instanceColor",componentDatatype:xt.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"czm_batchTable_pickColor",componentDatatype:xt.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}];const o=new Up(t.context,s,i);o._batchValues=new Float32Array(o._batchValues.length);for(let a=0;a<i;++a){let l=t.context.createPickColorSafeRange({primitive:this,instanceId:a}),c=l.color,u=_z;u.x=We.floatToByte(c.red),u.y=We.floatToByte(c.green),u.z=We.floatToByte(c.blue),u.w=We.floatToByte(c.alpha),o.setBatchedAttribute(a,1,c),this._pickIds.push(l),o.setBatchedAttribute(a,0,r)}if(this.batchTable=o,this._material.defines.USE_BATCH_TABLE="",this._material.vertexShader=o.getVertexShaderCallback()(this._material.vertexShader),this._material.batchTextureStep=o._textureStep,this._material.batchTextureDimensions=o._textureDimensions,this._material.needsUpdate=!0,this.outlineCommand){const a=this.outlineCommand.material;a.defines.USE_BATCH_TABLE="",a.vertexShader=o.getVertexShaderCallback()(a.vertexShader),a.batchTextureStep=o._textureStep,a.batchTextureDimensions=o._textureDimensions,a.needsUpdate=!0}this.pickMaterial.defines.USE_BATCH_TABLE="",this.pickMaterial.vertexShader=o.getVertexShaderCallback()(this.pickMaterial.vertexShader),this.pickMaterial.batchTextureStep=o._textureStep,this.pickMaterial.batchTextureDimensions=o._textureDimensions,this.pickMaterial.needsUpdate=!0,this._overlayMaterial.defines.USE_BATCH_TABLE="",this._overlayMaterial.defines.OVERLAY="",this._overlayMaterial.vertexShader=o.getVertexShaderCallback()(this._overlayMaterial.vertexShader),this._overlayMaterial.batchTextureStep=o._textureStep,this._overlayMaterial.batchTextureDimensions=o._textureDimensions,this._overlayMaterial.needsUpdate=!0,this._overlayMaterial.depthFunc=eo}updateModelMatrix(){let t=this.model;this.colorCommand.applyMatrix4(t._modelMatrixInverse),this.colorCommand.applyMatrix4(t.modelMatrix),!this.modelMatrix.equals(this._modelMatrix)&&(this.colorCommand.applyMatrix4(this._modelMatrixInverse),this.colorCommand.applyMatrix4(this.modelMatrix),this.outlineCommand.applyMatrix4(this._modelMatrixInverse),this.outlineCommand.applyMatrix4(this.modelMatrix),this.boundingVolume.applyMatrix4(this._modelMatrixInverse),this.boundingVolume.applyMatrix4(this.modelMatrix),this._modelMatrix.copy(this.modelMatrix),this._modelMatrixInverse.copy(this._modelMatrix),this._modelMatrixInverse.invert())}async setAttributeLocalData(){let{_accessId:t,_timeKey:i}=this.model;if(!O(t))return;let r=this.colorCommand.geometry.toJSON(),s=[t,i,...this._properties.map(a=>a.componentKey)].join("&");this._cacheBufferData.key=s;let o=await vs.getItem(s);O(o)||await vs.setItem(s,r)}raycast(t,i,r){return O(this.positionAttr)?(this._cacheBufferData.updatedTime=ni.now(),this._mesh.raycast(t,r),r=r.sort(Cv),r):(this.setCacheBufferData(),this._isFetchingCache=!0,r)}async setCacheBufferData(){let t=this._cacheBufferData.key;if(!O(t)||this._isFetchingCache)return;let i=await vs.getItem(t);if(!O(i))return;let r=this.bufferGeometryLoader.parse(i);this._mesh.geometry=r,this._mesh.material=this._material,this._mesh.matrixWorld=this.colorCommand.matrixWorld,this._cacheBufferData.updatedTime=ni.now(),this._isFetchingCache=!1}destroyCacheBuffer(t){let{_cacheBufferData:i}=this;!O(this.positionAttr)||ni.secondsDifference(t.time,i.updatedTime)<i.overTime||(this._isFetchingCache=!1,this._mesh.geometry=null)}getLine(t,i=new ks){const{index:r,attributes:{position:s}}=this.outlineCommand.geometry;if(O(r)){const o=r.getX(t),a=r.getX(t+1);return i.start.fromBufferAttribute(s,o),i.end.fromBufferAttribute(s,a),i.applyMatrix4(this.outlineCommand.matrix),i}}createBoundingVolumeHelper(){O(this.debuggerBoundingVolumeHelper)||(this.debuggerBoundingVolumeHelper=new Pr(this.boundingVolume,new ve(16776960)))}getVertexPosition(t,i,r=new T){return this._mesh.getVertexPosition(t,r),r.applyMatrix4(this._mesh.matrixWorld),r}getPickColor(t){return t.pickColor}setInstanceDiffuse(t,i){let r=this.batchTable.getBatchedAttribute(i,0,Yp);r.x=uu(t.x,t.y,t.z),r.y=t.w,t.w===1?this._material.transparent&&(this._material.transparent=!1,this._material.needsUpdate=!0):t.w<1&&(this._material.transparent||(this._material.transparent=!0,this._material.needsUpdate=!0)),r.w=t.w,this.batchTable.setBatchedAttribute(i,0,r)}resetInstanceColorAll(){for(let t=0;t<this.instanceCount;t++)this.setInstanceDiffuse(Dv,t)}setInstanceVisible(t,i){let r=this.batchTable.getBatchedAttribute(i,0,Yp);r.z=Number(t),this.batchTable.setBatchedAttribute(i,0,r)}getInstanceVisible(t){return t<0||t>this.instanceCount?!1:!!this.batchTable.getBatchedAttribute(t,0,Yp).z}setInstanceVisibleFromArray(t,i){if(t.length===0)return;if(t.length===1){this.setInstanceVisible(i,t[0]);return}let r=this.batchTable._batchValues;const s=Number(i);for(let o of t)r[o*8+2]=s;this.batchTable._batchValuesDirty=!0}setOverlayInstanceVisible(t,i){if(i<0||i>this.instanceCount)return;let r=this.batchTable.getBatchedAttribute(i,0,Yp),s=!!r.z;return r.w=Number(t),this.batchTable.setBatchedAttribute(i,0,r),()=>this.setOverlayInstanceVisible(s,i)}postPassesUpdate(t){this.visible}getOverlayRenderInstance(){return this._overlayMaterial.side=this._material.side,this._overlayMaterial.batchTexture=this.batchTable._texture,this.colorCommand.material=this._overlayMaterial,this.colorCommand}updateClipPlane(){let{clippingPlanes:t,clippingEnabled:i}=this.model;i||(t=[]);let{_material:r,pickMaterial:s,outlineCommand:o,_overlayMaterial:a}=this;if(r.clippingPlanes=t,r.clipping=i,s.clippingPlanes=t,s.clipping=i,a.clippingPlanes=t,a.clipping=i,O(o)){let l=o.material;l.clippingPlanes=t,l.clipping=i}}update(t){this.visible&&(O(this.batchTable)||this.createBatchTable(t),this.destroyCacheBuffer(t),this.batchTable.update(t),t.camera.frustum.cullVolume.intersectsBox(this.boundingVolume)&&(this.colorCommand.material=this._material,t.passes.pick&&(this.pickMaterial.side=this._material.side,this.colorCommand.material=this.pickMaterial),this.colorCommand.material.batchTexture=this.batchTable._texture,t.commandList.push(this.colorCommand),!t.passes.pick&&(this.updateMaterialStyle(),this.updateClipPlane(),this.outlineCommand&&(this.outlineCommand.material.batchTexture=this.batchTable._texture,t.commandList.push(this.outlineCommand)),this.showDebuggerBoundingVolume&&(this.createBoundingVolumeHelper(),this.debuggerBoundingVolumeHelper.update(t)))))}updateMaterialStyle(){const t=this.model.style;if(this._material.setValues(this._materialDefaultParams),this.outlineCommand&&this.outlineCommand.material.setValues(this._materialDefaultParams),!O(t)||!O(t.materialStyle)||!t.materialStyle.enabled)return;this._material.roughnessMap=t.roughnessMap,O(t.roughness)&&(this._material.roughness=t.roughness);let i={...t.materialStyle};delete i.enabled,this._material.setValues({...i}),this.outlineCommand&&this.outlineCommand.material.setValues({...i,opacity:.2})}unpackPickInfo(t){let i=this.getProperty(t.instanceId);return{primitive:this,pickColor:t.pickColor,instanceId:t.instanceId,info:{componentKey:i.componentKey,buildingId:O(this.tile.extras)?this.tile.extras.buildingId:"",boundingVolume:i.boundingVolume},componentKey:i.componentKey,model:this.model}}isDestroyed(){return!1}destroy(){var s,o,a;let{outlineCommand:t,colorCommand:i,batchTable:r}=this;return O(t)&&(t.geometry.dispose(),t.material.dispose()),O(i)&&(i.geometry.dispose(),this._material.dispose(),(s=this._material.map)==null||s.dispose()),r==null||r.destroy(),this.pickMaterial.dispose(),this._overlayMaterial.dispose(),this._material.dispose(),(o=this._mesh.geometry)==null||o.dispose(),(a=this.debuggerBoundingVolumeHelper)==null||a.destroy(),ht(this)}}const PA=new Tr;class yz extends Iv{constructor(t){super();f(this,"pickMaterial",new Fp({transparent:!1,toneMapped:!1}));f(this,"_content");f(this,"batchTable");f(this,"pickId");f(this,"boundingVolume",new Lt);f(this,"outlineCommand");f(this,"_indices",[]);f(this,"_modelMatrix",new fe().identity());f(this,"_modelMatrixInverse",new fe().identity());f(this,"baseCollection",new zi);f(this,"userData",{componentKey:[]});f(this,"visible",!0);f(this,"showDebuggerBoundingVolume",!1);f(this,"debuggerBoundingVolumeHelper");f(this,"boundingSphere",new Mi);f(this,"_screenSpaceError",0);f(this,"_properties",[]);f(this,"instanceCount",0);f(this,"_cacheBufferData",{key:"",overTime:5,updatedTime:ni.now()});f(this,"_isFetchingCache",!1);f(this,"line");f(this,"modelMatrix",new fe().identity());let{group:i,content:r,modelMatrix:s=new fe().identity()}=t;fe.clone(s,this.modelMatrix),fe.clone(s,this._modelMatrix),this._modelMatrixInverse=this._modelMatrix.clone().invert(),this._content=r;let{baseCollection:o}=this,a,l;i.children[0]instanceof pt?(a=i.children[0],l=i.children[1]):(a=i.children[1],l=i.children[0]),o.attach(a),a.frustumCulled=!1,a.applyMatrix4(this._modelMatrix),this._material=a.material.clone(),this.colorCommand=a,this.colorCommand.frustumCulled=!1,Xr(this.colorCommand.geometry),l&&(o.attach(l),l.applyMatrix4(this._modelMatrix),l.frustumCulled=!1,Xr(l.geometry),this.outlineCommand=l),this.boundingVolume.setFromObject(this.colorCommand),this.boundingVolume.getBoundingSphere(this.boundingSphere);let{userData:c}=a;this._properties.push({componentKey:O(c[0])?c[0].elementId[0]:c.componentKey[0],boundingVolume:this.boundingVolume}),this.setAttributeLocalData()}get positionAttr(){let t=this.colorCommand.geometry.getAttribute("position");return t instanceof jt?t.data.array:t.array}get model(){return this.content.owner}get tile(){return this.content._tile}get content(){return this._content}get material(){return this.colorCommand.material}get indices(){return this._indices}get computedTransform(){return this.model.modelMatrix}async setAttributeLocalData(){let t=this.model._accessId;if(!O(t))return;let{position:i,normal:r,index:s}=this.getGeometryBufferData(),o=[t,this.model._timeKey,...this._properties.map(l=>l.componentKey)].join("&");this._cacheBufferData.key=o;let a=await vs.getItem(o);O(a)||await vs.setItem(o,{position:i,index:s,normal:r})}getProperty(){return this._properties[0]}raycast(t,i=0,r=[]){return O(this.positionAttr)?(this._cacheBufferData.updatedTime=ni.now(),PA.copy(t.ray).applyMatrix4(this._modelMatrixInverse),AA(t,this.colorCommand,r,PA),r.sort(Cv),r):(this.setCacheBufferData(),this._isFetchingCache=!0,r)}getGeometryBufferData(){let t=this.colorCommand.geometry,[i,r,s]=[t.getAttribute("position"),t.getAttribute("normal"),t.getIndex()],o=i instanceof jt?i.data.array:i.array,a=r instanceof jt?r.data.array:r.array,l=O(s)?s instanceof jt?s.data.array:s.array:null;return{position:o,index:l,normal:a}}async setCacheBufferData(){let t=this._cacheBufferData.key;if(!O(t)||this._isFetchingCache)return;let i=await vs.getItem(t);if(!O(i))return;let r=this.colorCommand.geometry,[s,o,a]=[r.getAttribute("position"),r.getAttribute("normal"),r.getIndex()];s instanceof jt?s.data.array=i.position:s.array=i.position,o instanceof jt?o.data.array=i.normal:o.array=i.normal,O(a)&&(a instanceof jt?a.data.array=i.index:a.array=i.index),this._cacheBufferData.updatedTime=ni.now(),this._isFetchingCache=!1}getVertexPosition(t,i,r=new T){return this.colorCommand.getVertexPosition(t,r),r.applyMatrix4(this.colorCommand.matrix),r}createPickId(t){let i={model:this.model,primitive:this},r=t.context.createPickColorSafeRange(i),s=r.color;this.pickMaterial.color.setRGB(s.x,s.y,s.z),this.pickMaterial.uniforms.opacity.value=s.w;let o=this.pickMaterial.fragmentShader;o=_n.replaceMain(o,"outputColor"),o=`
        ${o}
            void main(){
                outputColor();
                gl_FragColor = vec4(diffuse,opacity);
            }
        `,this.pickMaterial.fragmentShader=o,this.pickId=r}unpackPickInfo(t){let i=this.getProperty();return{primitive:this,pickColor:t.pickColor,info:{componentKey:i.componentKey,buildingId:O(this.tile.extras)?this.tile.extras.buildingId:"",boundingVolume:i.boundingVolume},instanceId:0,model:this.model}}getPickColor(t,i){return this.pickId.color}createBatchTable(t){}setInstanceDiffuse(t,i=0){this._material.color.setRGB(t.x/255,t.y/255,t.z/255)}resetInstanceColorAll(){this.setInstanceDiffuse(Dv)}setInstanceVisible(t,i=0){this.colorCommand.visible=t,this.outlineCommand&&(this.outlineCommand.visible=t)}getInstanceVisible(t){return this.colorCommand.visible}setInstanceVisibleFromArray(t,i){this.setInstanceVisible(i,t[0])}setOverlayInstanceVisible(t,i){let r=this.colorCommand.visible;return this.setInstanceVisible(t,i),()=>this.setInstanceVisible(r,i)}updateModelMatrix(){var i,r;let t=this.model;this.colorCommand.applyMatrix4(t._modelMatrixInverse),this.colorCommand.applyMatrix4(t.modelMatrix),!this.modelMatrix.equals(this._modelMatrix)&&(this.colorCommand.applyMatrix4(this._modelMatrixInverse),this.colorCommand.applyMatrix4(this.modelMatrix),(i=this.outlineCommand)==null||i.applyMatrix4(this._modelMatrixInverse),(r=this.outlineCommand)==null||r.applyMatrix4(this.modelMatrix),this.boundingVolume.applyMatrix4(this._modelMatrixInverse),this.boundingVolume.applyMatrix4(this.modelMatrix),this._modelMatrix.copy(this.modelMatrix),this._modelMatrixInverse.copy(this._modelMatrix),this._modelMatrixInverse.invert())}updateClipPlane(){let{clippingPlanes:t,clippingEnabled:i}=this.model;i||(t=[]);let{_material:r,pickMaterial:s,outlineCommand:o}=this;if(r.clippingPlanes=t,r.clipping=i,s.clippingPlanes=t,s.clipping=i,O(o)){let a=o.material;a.clippingPlanes=t,a.clipping=i}}createBoundingVolumeHelper(){O(this.debuggerBoundingVolumeHelper)||(this.debuggerBoundingVolumeHelper=new Pr(this.boundingVolume,new ve(16776960)))}getScreenSpaceError(t){let{camera:i,context:r}=t,s=this.boundingSphere.radius*this.boundingSphere.radius;var o=r.drawingBufferHeight;let a=this.boundingSphere.distanceToPoint(i.position);var l=Math.max(a,Ne.EPSILON7),c=i.frustum.sseDenominator;let u=s*o/(l*c);return u/=t.pixelRatio,u}update(t){this.visible&&(this.destroyCacheBuffer(t),t.camera.frustum.cullVolume.intersectsBox(this.boundingVolume)&&(this._screenSpaceError=this.getScreenSpaceError(t),this._screenSpaceError<64,O(this.pickId)||this.createPickId(t),this.colorCommand.material=this._material,t.passes.pick&&(this.pickMaterial.side=this._material.side,this.colorCommand.material=this.pickMaterial),this.updateClipPlane(),t.commandList.push(this.colorCommand),!t.passes.pick&&(O(this.model.style)&&O(this.model.style.materialStyle)&&this.model.style.materialStyle.enabled&&(this._material.roughnessMap=this.model.style.roughnessMap),this.model.showOutline&&this.outlineCommand&&t.commandList.push(this.outlineCommand),this.showDebuggerBoundingVolume&&(this.createBoundingVolumeHelper(),t.commandList.push(this.debuggerBoundingVolumeHelper)))))}destroyCacheBuffer(t){let{_cacheBufferData:i}=this;if(!O(this.positionAttr)||ni.secondsDifference(t.time,i.updatedTime)<i.overTime)return;this._isFetchingCache=!1;let r=this.colorCommand.geometry,[s,o,a]=[r.getAttribute("position"),r.getAttribute("normal"),r.getIndex()];s instanceof jt?s.data.array=null:s.array=null,o instanceof jt?o.data.array=null:o.array=null,O(a)&&(a instanceof jt?a.data.array=null:a.array=null)}getOverlayRenderInstance(){return this.colorCommand.material=this.pickMaterial,this.colorCommand}isDestroyed(){return!1}destroy(){var s;let{outlineCommand:t,colorCommand:i,batchTable:r}=this;return O(t)&&(t.geometry.dispose(),t.material.dispose()),O(i)&&(i.geometry.dispose(),i.material.dispose()),r==null||r.destroy(),this.pickMaterial.dispose(),this._material.dispose(),(s=this.debuggerBoundingVolumeHelper)==null||s.destroy(),ht(this)}}var Ln=(n=>(n[n.NEEDS_LOAD=0]="NEEDS_LOAD",n[n.LOADING=1]="LOADING",n[n.READY=2]="READY",n[n.COMBINED=3]="COMBINED",n[n.FAILED=4]="FAILED",n))(Ln||{});let Dv=new nt(255,255,255,0);class bz extends zi{constructor(t,i,r){super();f(this,"batchTable");f(this,"state",Ln.NEEDS_LOAD);f(this,"colorCommand");f(this,"colorCommands");f(this,"_material");f(this,"pickMaterial",new cu({transparent:!1}));f(this,"lineCommand");f(this,"_header");f(this,"_instanceSphere",[]);f(this,"_readyPromise",mr());f(this,"_instanceCount",0);f(this,"owner");f(this,"material",new kl);f(this,"materialShader");f(this,"showDebuggerBoundingVolume",!1);f(this,"debuggerBoundingVolumeHelper");f(this,"boundingVolume",new Lt);f(this,"gltfLoader",new vA);f(this,"_tile");f(this,"_contentModelMatrix",new fe().identity());f(this,"_properties",[]);f(this,"_pickIds",[]);this.model=t,this._header=r,this._tile=i,this.owner=t,fe.clone(this._tile.computedTransform,this._contentModelMatrix),this.boundingVolume.setFromArray(this._header.content.boundingVolume.boundingBox),this.boundingVolume.applyMatrix4(this._contentModelMatrix),this.model._contents.push(this);const s=new Zk;s.setDecoderPath(gn("Assets/draco/")),this.gltfLoader.setMeshoptDecoder(qk),this.gltfLoader.setDRACOLoader(s)}get readyPromise(){return this._readyPromise.promise}async createCommand(){this.state=Ln.LOADING,this.colorCommands=[];let t=this.owner.basePath+this._header.content.uri;try{let i=await Hi.fetchArrayBuffer({url:t}),r=(await this.gltfLoader.parseAsync(i,this.owner.basePath)).scenes,[s,o,a,l]=[!1,!1,!1,!1];r[0].children[0].children.forEach(c=>{c.children.forEach(p=>{p instanceof Cn&&(s=!0),p instanceof pt&&(o=!0,p.geometry instanceof Ma&&(a=!0),p.geometry.getAttribute("batchId")&&(l=!0))});let u;s&&!o&&(u=gz),o&&!a&&l&&(u=vz),o&&!a&&!l&&(u=yz),o&&a&&(u=pz);let d=new u({content:this,group:c,modelMatrix:this._contentModelMatrix});this.colorCommands.push(d),this._instanceCount++,[s,o,a,l]=[!1,!1,!1,!1]}),this.colorCommands.forEach(c=>{c._properties.forEach((u,d)=>{this.model.componentMap.set(u.componentKey,{command:c,instanceId:d})})}),i=null,this.owner._readyCount++,this.state=Ln.COMBINED}catch(i){this.owner.errorEvent.raiseEvent(i)}}getPickColor(t){return t.pickColor}setInstanceColor(t,i=new nt){this.batchTable.setBatchedAttribute(t,0,i)}resetInstanceColorAll(){this.colorCommands.forEach((t,i)=>{t.resetInstanceColorAll()})}createBoundingVolumeHelper(){O(this.debuggerBoundingVolumeHelper)||(this.debuggerBoundingVolumeHelper=new Pr(this.boundingVolume,new ve(16776960)))}updateModelMatrix(){this.colorCommands.forEach(t=>{t.updateModelMatrix()})}applyStyle(t){}update(t){this.visible&&(this.state===Ln.NEEDS_LOAD&&!O(this.colorCommands)&&this.createCommand(),this.colorCommands.forEach(i=>{i.update(t)}),!t.passes.pick&&this.showDebuggerBoundingVolume&&(this.createBoundingVolumeHelper(),this.debuggerBoundingVolumeHelper.update(t)))}isDestroyed(){return!1}destroy(){var t;return(t=this.debuggerBoundingVolumeHelper)==null||t.destroy(),this.colorCommands.forEach(i=>{i.destroy()}),ht(this)}}var yc=(n=>(n[n.UNLOADED=0]="UNLOADED",n[n.LOADING=1]="LOADING",n[n.PROCESSING=2]="PROCESSING",n[n.READY=3]="READY",n[n.EXPIRED=4]="EXPIRED",n[n.FAILED=5]="FAILED",n))(yc||{});const xz=new T,wz=new T,Sz=new T,Ez=new T,Tz=new T;new T;const Az=new T,Mz=new T,Cz=new T,Iz=new T,Pz=new T,Rz=new T,Dz=new at,Lz={unitary:new at,diagonal:new at},Oz=new at,Nz=new T,Bz=new T,Fz=new T,Dc=class Dc{constructor(e=T.ZERO,t=at.ZERO){f(this,"center");f(this,"halfAxes");this.center=T.clone(e),this.halfAxes=at.clone(t)}static distanceSquaredTo(e,t){var i=T.subtract(t,e.center,Tz),r=e.halfAxes,s=at.getColumn(r,0,xz),o=at.getColumn(r,1,wz),a=at.getColumn(r,2,Sz),l=T.magnitude(s),c=T.magnitude(o),u=T.magnitude(a);T.normalize(s,s),T.normalize(o,o),T.normalize(a,a);var d=Ez;d.x=T.dot(i,s),d.y=T.dot(i,o),d.z=T.dot(i,a);var p=0,g;return d.x<-l?(g=d.x+l,p+=g*g):d.x>l&&(g=d.x-l,p+=g*g),d.y<-c?(g=d.y+c,p+=g*g):d.y>c&&(g=d.y-c,p+=g*g),d.z<-u?(g=d.z+u,p+=g*g):d.z>u&&(g=d.z-u,p+=g*g),p}static fromPoints(e,t=new Dc){if(!O(e)||e.length===0)return t.halfAxes=at.ZERO,t.center=T.ZERO,t;var i,r=e.length,s=T.clone(e[0],Az);for(i=1;i<r;i++)T.add(s,e[i],s);var o=1/r;T.multiplyByScalar(s,o,s);var a=0,l=0,c=0,u=0,d=0,p=0,g;for(i=0;i<r;i++)g=T.subtract(e[i],s,Mz),a+=g.x*g.x,l+=g.x*g.y,c+=g.x*g.z,u+=g.y*g.y,d+=g.y*g.z,p+=g.z*g.z;a*=o,l*=o,c*=o,u*=o,d*=o,p*=o;var _=Dz;_.elements[0]=a,_.elements[1]=l,_.elements[2]=c,_.elements[3]=l,_.elements[4]=u,_.elements[5]=d,_.elements[6]=c,_.elements[7]=d,_.elements[8]=p;var x=at.computeEigenDecomposition(_,Lz),b=at.clone(x.unitary,t.halfAxes),y=at.getColumn(b,0,Iz),M=at.getColumn(b,1,Pz),E=at.getColumn(b,2,Rz),w=-Number.MAX_VALUE,I=-Number.MAX_VALUE,B=-Number.MAX_VALUE,N=Number.MAX_VALUE,L=Number.MAX_VALUE,P=Number.MAX_VALUE;for(i=0;i<r;i++)g=e[i],w=Math.max(T.dot(y,g),w),I=Math.max(T.dot(M,g),I),B=Math.max(T.dot(E,g),B),N=Math.min(T.dot(y,g),N),L=Math.min(T.dot(M,g),L),P=Math.min(T.dot(E,g),P);y=T.multiplyByScalar(y,.5*(N+w),y),M=T.multiplyByScalar(M,.5*(L+I),M),E=T.multiplyByScalar(E,.5*(P+B),E);var R=T.add(y,M,t.center);T.add(R,E,R);var U=Cz;return U.x=w-N,U.y=I-L,U.z=B-P,T.multiplyByScalar(U,.5,U),at.multiplyByScale(t.halfAxes,U,t.halfAxes),t}static computeTransformation(e,t=new fe){const i=e.center,r=at.multiplyByUniformScale(e.halfAxes,2,Oz);return fe.fromRotationTranslation(r,i,t)}static fromTransformation(e,t=new Dc){return t.center=fe.getTranslation(e,t.center),t.halfAxes=fe.getMatrix3(e,t.halfAxes),t.halfAxes=at.multiplyByScalar(t.halfAxes,.5,t.halfAxes),t}static computeCorners(e,t=[new T,new T,new T,new T,new T,new T,new T,new T]){const i=e.center,r=e.halfAxes,s=at.getColumn(r,0,Nz),o=at.getColumn(r,1,Bz),a=at.getColumn(r,2,Fz);return T.clone(i,t[0]),T.subtract(t[0],s,t[0]),T.subtract(t[0],o,t[0]),T.subtract(t[0],a,t[0]),T.clone(i,t[1]),T.subtract(t[1],s,t[1]),T.subtract(t[1],o,t[1]),T.add(t[1],a,t[1]),T.clone(i,t[2]),T.subtract(t[2],s,t[2]),T.add(t[2],o,t[2]),T.subtract(t[2],a,t[2]),T.clone(i,t[3]),T.subtract(t[3],s,t[3]),T.add(t[3],o,t[3]),T.add(t[3],a,t[3]),T.clone(i,t[4]),T.add(t[4],s,t[4]),T.subtract(t[4],o,t[4]),T.subtract(t[4],a,t[4]),T.clone(i,t[5]),T.add(t[5],s,t[5]),T.subtract(t[5],o,t[5]),T.add(t[5],a,t[5]),T.clone(i,t[6]),T.add(t[6],s,t[6]),T.add(t[6],o,t[6]),T.subtract(t[6],a,t[6]),T.clone(i,t[7]),T.add(t[7],s,t[7]),T.add(t[7],o,t[7]),T.add(t[7],a,t[7]),t}distanceSquaredTo(e){return Dc.distanceSquaredTo(this,e)}};f(Dc,"packedLength",T.packedLength+at.packedLength);let RA=Dc;new T,new T,new T,new T;const Dr={RENDER:0,PICK:1,SHADOW:2,PRELOAD:3,PRELOAD_FLIGHT:4,REQUEST_RENDER_MODE_DEFER_CHECK:5,MOST_DETAILED_PRELOAD:6,MOST_DETAILED_PICK:7,NUMBER_OF_PASSES:8,getPassOptions:n=>qa[n]};let qa=new Array(Dr.NUMBER_OF_PASSES);qa[Dr.RENDER]=Object.freeze({isRender:!0,requestTiles:!0,ignoreCommands:!1}),qa[Dr.PICK]=Object.freeze({isRender:!1,requestTiles:!1,ignoreCommands:!1}),qa[Dr.SHADOW]=Object.freeze({isRender:!1,requestTiles:!0,ignoreCommands:!1}),qa[Dr.PRELOAD]=Object.freeze({isRender:!1,requestTiles:!0,ignoreCommands:!0}),qa[Dr.PRELOAD_FLIGHT]=Object.freeze({isRender:!1,requestTiles:!0,ignoreCommands:!0}),qa[Dr.REQUEST_RENDER_MODE_DEFER_CHECK]=Object.freeze({isRender:!1,requestTiles:!0,ignoreCommands:!0});var Za=(n=>(n[n.ADD=0]="ADD",n[n.REPLACE=1]="REPLACE",n))(Za||{});new at,new T,new at,new T;let jp=new Lt;function Uz(n,e,t=new Lt){return jp.min.set(n[0],n[1],n[2]),jp.max.set(n[3],n[4],n[5]),jp.applyMatrix4(e),t.copy(jp),t}function kz(n){return function(){return n._priority}}function zz(n,e){return t=>{n._contentState===yc.PROCESSING?--e.statistics.numberOfTilesProcessing:--e.statistics.numberOfPendingRequests,n._contentState=yc.FAILED,n._contentReadyPromise.reject(t),n._contentReadyToProcessPromise.reject(t)}}function Hz(n,e,t){n.hasEmptyContent||n._content.update(t)}function qp(n,e,t){return Math.max(Ne.normalize(n,e,t)-Ne.EPSILON7,0)}function DA(n,e,t){var i=n*Math.pow(10,e),r=parseInt(i);return r*Math.pow(10,t)}class Zp{constructor(e,t,i,r){f(this,"_tileset");f(this,"_header");f(this,"transform");f(this,"children",[]);f(this,"parent");f(this,"refine");f(this,"_initialTransform");f(this,"computedTransform");f(this,"_boundingVolume");f(this,"_boundingSphere",new Mi);f(this,"showDebuggerBoundingVolume",!1);f(this,"boundingVolumeHelper");f(this,"geometricError");f(this,"_geometricError");f(this,"_content");f(this,"_contentResource");f(this,"_contentState");f(this,"_contentReadyToProcessPromise");f(this,"_contentReadyPromise");f(this,"_expiredContent");f(this,"hasEmptyContent",!1);f(this,"hasTilesetContent",!1);f(this,"clippingPlanesDirty",!1);f(this,"_distanceToCamera",0);f(this,"_centerZDepth",0);f(this,"_screenSpaceError",0);f(this,"_screenSpaceErrorProgressiveResolution",0);f(this,"_visibilityPlaneMask",0);f(this,"_visible",!1);f(this,"_inRequestVolume",!1);f(this,"_finalResolution",!0);f(this,"_depth",0);f(this,"_stackLength",0);f(this,"_selectionDepth",0);f(this,"_updatedVisibilityFrame",0);f(this,"_touchedFrame",0);f(this,"_visitedFrame",0);f(this,"_selectedFrame",0);f(this,"_requestedFrame",0);f(this,"_serverKey");f(this,"_priority",0);f(this,"_priorityHolder",this);f(this,"_priorityProgressiveResolution",!1);f(this,"_priorityProgressiveResolutionScreenSpaceErrorLeaf",!1);f(this,"_priorityReverseScreenSpaceError",0);f(this,"_foveatedFactor",0);f(this,"_loadTimestamp",new ni);f(this,"_request");f(this,"priorityDeferred",!1);f(this,"extras");f(this,"lastStyleTime",0);var b;this._tileset=e,this._header=i;var s=i.content;this.transform=O(i.transform)?fe.unpack(i.transform):fe.clone(fe.IDENTITY);var o=O(r)?r.computedTransform:e.modelMatrix,a=fe.multiply(o,this.transform,new fe),l=O(r)?r._initialTransform:fe.IDENTITY;this._initialTransform=fe.multiply(l,this.transform,new fe),this._boundingVolume=this.createBoundingVolume(i.boundingVolume,a),this._boundingVolume.getBoundingSphere(this._boundingSphere),this.computedTransform=a;var c;O(i.refine)?c=i.refine.toUpperCase()==="REPLACE"?Za.REPLACE:Za.ADD:O(r)?c=r.refine:c=Za.REPLACE,this.refine=c,this.geometricError=i.geometricError,this._geometricError=i.geometricError,this.parent=r;var u,d,p,g,_;if(t=Hi.createIfNeeded(t),O(s)){var x=s.uri;d=!1,p=yc.UNLOADED,g=t.getDerivedResource({url:x}),_=Ys.getServerKey(g.getUrlComponent()),u=new bz(e,this,i)}else u=new ck(e,this),d=!0,p=yc.READY;if(this._content=u,this._contentResource=g,this._contentState=p,this._serverKey=_,this.hasEmptyContent=d,this.extras=i.extras||((b=this.parent)==null?void 0:b.extras),O(this.extras)){let y=this.extras;O(y)&&O(y.buildingId)&&(this.extras={buildingId:y.buildingId,buildingName:y.buildingName})}}get tileset(){return this._tileset}get boundingVolume(){return this._boundingVolume}get content(){return this._content}get boundingSphere(){return this._boundingSphere}createBoundingVolume(e,t,i){if(O(e.boundingBox))return Uz(e.boundingBox,t,this._boundingVolume)}requestContent(){var e=this,t=this._tileset;if(this.hasEmptyContent)return!1;var i=this._contentResource.clone(),r=new nT({throttle:!0,throttleByServer:!0,type:z0.TILES3D,priorityFunction:kz(this),serverKey:this._serverKey});this._request=r,i.request=r;var s=i.fetchArrayBuffer();if(!O(s))return!1;this._contentState,this._contentState=yc.LOADING,this._contentReadyToProcessPromise=mr(),this._contentReadyPromise=mr();let o=zz(this,t);s.then(a=>{if(e.isDestroyed()){a=null,o();return}new jk(t,this,this._contentResource,a,0)})}createBoundingVolumeHelper(){O(this.boundingVolumeHelper)||(this.boundingVolumeHelper=new Pr(this.boundingVolume,new ve(16776960)))}updatePriority(){var e=this.tileset,t=e.preferLeaves,i=e._minimumPriority,r=e._maximumPriority,s=4,o=1,a=0,l=s,c=a+l,u=s,d=c+u,p=o,g=Math.pow(10,d),_=d+p,x=o,b=Math.pow(10,_),y=_+x,M=Math.pow(10,y),E=qp(this._depth,i.depth,r.depth);E=t?1-E:E;var w=!e._skipLevelOfDetail&&this.refine===Za.REPLACE,I=w?qp(this._priorityHolder._distanceToCamera,i.distance,r.distance):qp(this._priorityReverseScreenSpaceError,i.reverseScreenSpaceError,r.reverseScreenSpaceError),B=DA(I,l,a),N=this._priorityProgressiveResolution?0:g,L=qp(this._priorityHolder._foveatedFactor,i.foveatedFactor,r.foveatedFactor),P=DA(L,u,c),R=this.priorityDeferred?b:0,U=e._pass===Dr.PRELOAD_FLIGHT?0:M;this._priority=E+B+N+P+R+U}update(e){Hz(this,this._tileset,e),this.showDebuggerBoundingVolume&&(this.createBoundingVolumeHelper(),e.commandList.push(this.boundingVolumeHelper))}isDestroyed(){return!1}destroy(){return this.children.forEach(e=>{e.destroy()}),this._content.destroy(),ht(this)}}class Gz{constructor(){}selectTiles(e){e._selectedTiles.length=0;let{_root:t,_selectedTiles:i}=e;var r=[];for(r.push(t);r.length>0;){var s=r.pop(),o=s.children;if(O(o))for(var a=o.length,l=0;l<a;++l){var c=o[l];r.push(c),c.hasEmptyContent||i.push(c)}}}}class Vz{constructor(e){f(this,"buildings",[]);f(this,"_buildingComponents",{});f(this,"buildingFloorInfo");this._model=e}get useProperty(){return this._model.useProperty}get _tilesetJson(){return this._model._tilesetJson}async loadProperty(){if(!this.useProperty)return;let e=[];const t=this._tilesetJson.extras.properties;for(let i of t)e.push(await this.loadBuildingProperty(i));return this._buildingComponents={},this.buildings=e,this._filterBuildingFloor(),e}parseData({floorKey:e=""}={}){let t=this._model.root.transform;const i={};for(let r of this.buildings){const{buildingId:s,buildingName:o,properties:a,levels:l,boundingVolume:c}=r,{floorMap:u,propertiesMap:d}=this._parseBuildingData(r,e);let p=c.boundingBox,g=new Lt(new T(p[0],p[1],p[2]),new T(p[3],p[4],p[5]));g.applyMatrix4(t),i[s]={boundingBox:g,id:s,name:o,properties:d,levels:u}}return i}_parseBuildingData(e,t){const{levels:i,componentKey:r,properties:s}=e,o=new Map;s.forEach(l=>{o.set(l.elementId,l)});const a=new Map;return i.forEach(l=>{var d;let c=(d=l.boundingVolume)==null?void 0:d.boundingBox,u=c&&new Lt(new T(c[0],c[1],c[2]),new T(c[3],c[4],c[5]));u&&u.applyMatrix4(this._model.root.transform),a.set(l.id,{boundingBox:u,name:l.name,components:{}})}),a.set("undefined",{boundingBox:void 0,name:"",components:{}}),r.forEach(l=>{const c=o.get(l.elementId);let{id:u,name:d}=this._getFloorId(c.level,e.levels);if(u==="undefined"){const g=c.properties.find(_=>_.group==="");if(g){const _=g.items.find(x=>x.key===t);if(_&&_.value){let x=this.getFloorIdByFloorName(_.value,e.levels);x&&(u=x.id,d=_.value)}}}let p=a.has(u)?a.get(u):{name:d,components:{}};p.components[l.componentKey]=l}),{floorMap:a,propertiesMap:o}}_getFloorId(e,t){if(!e.id&&!e.name)return{id:"undefined",name:""};let i=e.id?"id":"name";return t.filter(r=>r[i]===e[i])[0]}getFloorIdByFloorName(e,t){return t.filter(i=>i.name===e)[0]}addComponentsProperty(e,t){this._buildingComponents[e]||(this._buildingComponents[e]=[]);let r=t.map(s=>({componentKey:s.componentKey,elementId:s.componentKey.split("$")[0],box:Lt.toArray(s.boundingVolume)}));this._buildingComponents[e]=this._buildingComponents[e].concat(r)}getProperty(e,t){let i=this.buildings.find(s=>s.buildingId===e);if(!i)return;const r=t.split("$")[0];return i.properties.find(s=>s.elementId===r)}async loadBuildingProperty(e){const t=e.uri,i=this._model.basePath,r=t.map(c=>Hi.fetchJson({url:i+c})),s=await Promise.all(r),o=this._tilesetJson.extras.properties.filter(c=>c.buildingId===e.buildingId)[0],a=this._buildingComponents[o.buildingId],l=Object.assign(o,{properties:[],componentKey:a});return s.forEach(c=>{l.properties=l.properties.concat(c.properties)}),l}_filterBuildingFloor(){const{buildings:e}=this;let t={};console.log(e);for(let i of e){const{levels:r,componentKey:s}=i;let o={};t[i.buildingId]=o;for(let a of r);}this.buildingFloorInfo=t}getComponentsByElementId(e){for(let t of this.buildings){const i=t.componentKey.filter(r=>r.elementId===e);if(i.length>0){const r={buildingId:"",buildingName:"",components:[],property:{},levelId:""};r.buildingId=t.buildingId,r.buildingName=t.buildingName,r.components=i;let s=t.properties.find(c=>c.elementId===e),{level:{id:o,name:a}}=s,l="";return o?l=t.levels.filter(c=>c.id===o)[0].id:a&&(l=t.levels.filter(c=>c.name===a)[0].id),r.levelId=l,r.property=s,r}}}}const Wz={getHeaderUrl(n){return`${qs.config.baseUrl}/${n}/header.json`}};class Xz{constructor(){f(this,"_styleDirty",!1);f(this,"_lastStyleTime",0);f(this,"_style")}makeDirty(){this._styleDirty=!0}addColorStyle(e,t){this._style.addColorStyle(e,t)}applyStyle(e){var t=this._styleDirty;t&&++this._lastStyleTime;var i=this._lastStyleTime;let r=e._selectedTiles;for(let a=0;a<r.length;a++){var s=r[a];if(s.lastStyleTime!==i){var o=s.content;s.lastStyleTime=i,o.applyStyle(this._style)}}}}function Kp(n,e,t,i){var r=e.innerContents,s=e.pointsLength,o=e.trianglesLength;let a=e.linesLength;var l=e.featuresLength,c=e.geometryByteLength,u=e.texturesByteLength,d=e.batchTableByteLength,p=e.statistics.numberOfEntities;if(i?(n.numberOfFeaturesLoaded+=t?-l:l,n.numberOfPointsLoaded+=t?-s:s,n.geometryByteLength+=t?-c:c,n.texturesByteLength+=t?-u:u,n.batchTableByteLength+=t?-d:d):(n.numberOfFeaturesSelected+=t?-l:l,n.numberOfPointsSelected+=t?-s:s,n.numberOfTrianglesSelected+=t?-o:o,n.numberOfEntitiesSelected+=t?-p:p,n.numberOfLinesSelected+=t?-a:a),O(r))for(var g=r.length,_=0;_<g;++_)Kp(n,r[_],t,i)}class LA{constructor(){f(this,"selected",0);f(this,"visited",0);f(this,"numberOfCommands",0);f(this,"numberOfAttemptedRequests",0);f(this,"numberOfPendingRequests",0);f(this,"numberOfTilesProcessing",0);f(this,"numberOfTilesWithContentReady",0);f(this,"numberOfTilesTotal",0);f(this,"numberOfLoadedTilesTotal",0);f(this,"numberOfFeaturesSelected",0);f(this,"numberOfFeaturesLoaded",0);f(this,"numberOfPointsSelected",0);f(this,"numberOfPointsLoaded",0);f(this,"numberOfTrianglesSelected",0);f(this,"numberOfEntitiesSelected",0);f(this,"numberOfLinesSelected",0);f(this,"numberOfTilesStyled",0);f(this,"numberOfFeaturesStyled",0);f(this,"numberOfTilesCulledWithChildrenUnion",0);f(this,"geometryByteLength",0);f(this,"texturesByteLength",0);f(this,"batchTableByteLength",0)}clear(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfFeaturesSelected=0,this.numberOfPointsSelected=0,this.numberOfTrianglesSelected=0,this.numberOfEntitiesSelected=0,this.numberOfLinesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0}incrementSelectionCounts(e){Kp(this,e,!1,!1)}incrementLoadCounts(e){Kp(this,e,!1,!0)}decrementLoadCounts(e){Kp(this,e,!0,!0)}static clone(e,t){t.selected=e.selected,t.visited=e.visited,t.numberOfCommands=e.numberOfCommands,t.selected=e.selected,t.numberOfAttemptedRequests=e.numberOfAttemptedRequests,t.numberOfPendingRequests=e.numberOfPendingRequests,t.numberOfTilesProcessing=e.numberOfTilesProcessing,t.numberOfTilesWithContentReady=e.numberOfTilesWithContentReady,t.numberOfTilesTotal=e.numberOfTilesTotal,t.numberOfFeaturesSelected=e.numberOfFeaturesSelected,t.numberOfFeaturesLoaded=e.numberOfFeaturesLoaded,t.numberOfPointsSelected=e.numberOfPointsSelected,t.numberOfPointsLoaded=e.numberOfPointsLoaded,t.numberOfTrianglesSelected=e.numberOfTrianglesSelected,t.numberOfEntitiesSelected=e.numberOfEntitiesSelected,t.numberOfLinesSelected=e.numberOfLinesSelected,t.numberOfTilesStyled=e.numberOfTilesStyled,t.numberOfFeaturesStyled=e.numberOfFeaturesStyled,t.numberOfTilesCulledWithChildrenUnion=e.numberOfTilesCulledWithChildrenUnion,t.geometryByteLength=e.geometryByteLength,t.texturesByteLength=e.texturesByteLength,t.batchTableByteLength=e.batchTableByteLength}}function Yz(n){const[e,t]=n.split("_"),[i,r,s]=e.split("-").map(Number),[o,a,l]=t.split(":").map(Number);return new Date(i,r-1,s,o,a,l)}let jz=0;const Nm=class Nm{constructor(e){f(this,"id",jz++);f(this,"useProperty",!1);f(this,"showOutline",!0);f(this,"showMesh",!0);f(this,"showDebuggerBoundingVolume",!1);f(this,"boundingVolumeHelper");f(this,"_data");f(this,"_readyPromise",mr());f(this,"_raiseCompleteEvent",!1);f(this,"_loadComplete",mr());f(this,"ready",!1);f(this,"clippingEnabled",!1);f(this,"clippingPlanes",[]);f(this,"componentCallback");f(this,"_taskCount",0);f(this,"urls");f(this,"state",Ln.NEEDS_LOAD);f(this,"_readyCount",0);f(this,"_contents",[]);f(this,"componentMap",new Map);f(this,"url");f(this,"_tilesetJson");f(this,"resource");f(this,"basePath");f(this,"_modelMatrixChanged",!1);f(this,"modelMatrix",new fe().identity());f(this,"_modelMatrix",new fe().identity());f(this,"_modelMatrixInverse",new fe);f(this,"_center",!1);f(this,"_allTilesAdditive",!0);f(this,"_cullWithChildrenBounds",!0);f(this,"_statistics",new LA);f(this,"_statisticsLast",new LA);f(this,"_root");f(this,"preferLeaves",!1);f(this,"_maximumPriority",{foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE});f(this,"_minimumPriority",{foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE});f(this,"skipLevelOfDetail",!1);f(this,"_skipLevelOfDetail",!1);f(this,"_disableSkipLevelOfDetail",!1);f(this,"_pass");f(this,"visible",!0);f(this,"errorEvent",new Vn);f(this,"completeEvent",new Vn);f(this,"_accessId");f(this,"_styleEngine",new Xz);f(this,"_traversal",new Gz);f(this,"_selectedTiles",[]);f(this,"absoluteBasePath");f(this,"createTime",new ni);f(this,"_timeKey");f(this,"useDefaultView",!0);f(this,"property");let{url:t,center:i=!1,useProperty:r=!1}=e;this.url=t,this.useProperty=r,this._center=i;let s=Hi.createIfNeeded(t);this.basePath=s.getBaseUri(!0),this.resource=s,this.useDefaultView=e.useDefaultView??this.useDefaultView,this.state=Ln.LOADING,Hi.fetchJson({url:t}).then(o=>{this._tilesetJson=o,O(this._tilesetJson.root)||(this.state=Ln.FAILED,this.errorEvent.raiseEvent(""));let a=Yz(o.asset.createTime);ni.fromDate(a,this.createTime),this._timeKey=ni.toIso8601(this.createTime),this._accessId&&O(this._timeKey)&&vs.cacheTime.setItem([this._accessId,this._timeKey].join("&"),this._timeKey);try{this._root=this.loadTileset(o,s)}catch(l){this.state=Ln.FAILED,this.errorEvent.raiseEvent(l)}}).catch(o=>{this.state=Ln.FAILED,this.errorEvent.raiseEvent(o)}),this.style=e.style,this.useProperty&&(this.property=new Vz(this))}get accessId(){return this._accessId}get readyPromise(){return this._readyPromise.promise}get loadCompletePromise(){return this._loadComplete.promise}get axisAlignedBoundingBox(){return this.boundingVolume}get statistics(){return this._statistics}get root(){return this._root}get boundingVolume(){return this._root.boundingVolume}get boundingSphere(){return this._root._boundingSphere}get style(){return this._styleEngine._style}set style(e){this._styleEngine._style=e}static fromAccessId(e){let t=new Nm({url:Wz.getHeaderUrl(e)});return t._accessId=e,t}loadTileset(e,t,i){let r=this._statistics,s=new Zp(this,t,e.root,i);O(i)&&(i.children.push(s),s._depth=i._depth+1);var o=[];for(o.push(s);o.length>0;){var a=o.pop();++r.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&a.refine===Za.ADD;var l=a._header.children;if(O(l))for(var c=l.length,u=0;u<c;++u){var d=l[u],p=new Zp(this,t,d,a);a.children.push(p),p._depth=a._depth+1,o.push(p)}}return this.ready=!0,this._readyPromise.resolve(this),this.state=Ln.READY,s}createBoundingVolumeHelper(){O(this.boundingVolumeHelper)||(this.boundingVolumeHelper=new Pr(this.boundingVolume,new ve(16776960)))}resetComponentColor(e){this.setComponentCssColor(e,"#ffffff")}resetComponentColorAll(){let{_contents:e}=this;e.forEach(t=>{t.resetInstanceColorAll()})}setComponentCssColor(e,t,i=1){let r=this.componentMap.get(e);if(!O(r))return;let s=We.fromCssColorString(t),o=new nt(We.floatToByte(s.x),We.floatToByte(s.y),We.floatToByte(s.z),i);r.command.setInstanceDiffuse(o,r.instanceId)}setComponentCssColorFromArray(e,t,i=[]){if(!(!Array.isArray(e)||!Array.isArray(t))&&e.length===t.length)for(let r=0;r<e.length;r++)this.setComponentCssColor(e[r],t[r],i[r])}setComponentVisible(e,t=!0){let i=this.componentMap.get(e);if(!O(i))return;let{command:r,instanceId:s}=i;r.setInstanceVisible(t,s)}setComponentVisibleFromArray(e,t=!0){const i=new Map;for(let r of e){let s=this.componentMap.get(r);if(!O(s))continue;let{command:o,instanceId:a}=s;i.has(o)||i.set(o,[]),i.get(o).push(a)}for(let r of i.keys())r.setInstanceVisibleFromArray(i.get(r),t)}getComponentVisible(e){let t=this.componentMap.get(e);if(!O(t))return;let{command:i,instanceId:r}=t;return i.getInstanceVisible(r)}setComponentsVisible(e,t=!0){for(let i of e)this.setComponentVisible(i,t)}_getComponentsScreenShot(e,t){for(let a of this.componentMap.keys()){let{command:l,instanceId:c}=this.componentMap.get(a);l.setInstanceVisible(t.includes(a),c)}const{camera:i,scene:r}=e;let s={destination:T.clone(i.position),orientation:{heading:i.heading,pitch:i.pitch,roll:i.roll}};ou.flyToMode(r,yt.Top,0);const o=e.screenShot();i.setView(s);for(let a of this.componentMap.keys()){let{command:l,instanceId:c}=this.componentMap.get(a);l.setInstanceVisible(!0,c)}return o}_getModelScreenShot(e){const{camera:t,scene:i}=e;let r={destination:T.clone(t.position),orientation:{heading:t.heading,pitch:t.pitch,roll:t.roll}};const s=e.scene.screenSpaceCameraController.enableInputs;e.scene.screenSpaceCameraController.enableInputs=!0,ou.flyToMode(i,yt.Top,0);const o=e.screenShot();//!----------------------------------
const a=e.renderer.domElement.getBoundingClientRect();let[l,c]=[new he(a.width,a.height),new he(0,0)];const[u,d]=[new T,new T];let p=new Tr;const g=new fi(T.clone(T.UNIT_Z),i.axisAlignedBoundingBox.center.z);t.getPickRay(l,p),p.intersectPlane(g,u),t.getPickRay(c,p),p.intersectPlane(g,d);const _=new he(t.position.x,t.position.y);//!----------------------------------
return t.setView(r),e.scene.screenSpaceCameraController.enableInputs=s,{image:o,imageSize:{width:a.width,height:a.height},worldSize:{center:_,min:u,max:d}}}getPickColor(e){return e.command.getPickColor(e)}prePassesUpdate(e){this.state===Ln.READY&&e.scene.axisAlignedBoundingBox.union(this.boundingVolume)}updateModelMatrix(){this.modelMatrix.equals(this._modelMatrix)||(this.boundingVolume.applyMatrix4(this._modelMatrixInverse),this.boundingVolume.applyMatrix4(this.modelMatrix),this.boundingVolume.getBoundingSphere(this.boundingSphere),this._modelMatrix.copy(this.modelMatrix),this._modelMatrixInverse.copy(this._modelMatrix),this._modelMatrixInverse.invert())}async loadProperty(){if(this.useProperty)return await this.property.loadProperty()}getProperty(e,t){return this.property.getProperty(e,t)}center(){let e=T.clone(this.boundingSphere.center,new T);this.modelMatrix.makeTranslation(-e.x,-e.y,-e.z)}updateForPass(){}update(e){!this.visible||!O(this._tilesetJson)||this.state===Ln.FAILED||(this.state!==Ln.READY&&e.scene.requestRender(),this._traversal.selectTiles(this),this._selectedTiles.forEach(t=>{t.update(e)}),this.updateModelMatrix(),this._readyCount===this._selectedTiles.length&&!this._raiseCompleteEvent&&(e.afterRender.push(()=>{this._loadComplete.resolve(),this.completeEvent.raiseEvent(this)}),this._raiseCompleteEvent=!0),this.state===Ln.READY&&this.showDebuggerBoundingVolume&&(this.createBoundingVolumeHelper(),this.boundingVolumeHelper.update(e)))}isDestroyed(){return!1}destroy(){let{_contents:e,componentMap:t}=this;return t.clear(),this._contents=[],this._root.destroy(),ht(this)}};f(Nm,"ContentScale",1);let Zs=Nm;const S6="",Lv=new qi;class qz{constructor(e){f(this,"viewer");f(this,"enabled",!1);f(this,"_helperBox");f(this,"_frustum",new fa);f(this,"_projScreenMatrix",new fe);f(this,"_isPointerDown",!1);f(this,"_mouseXY",[]);f(this,"_pointerdownLisenter");f(this,"_pointermoveLisenter");f(this,"_pointerupLisenter");this.viewer=e,this._helperBox=document.createElement("div"),this._helperBox.className="vengine-box-selection",this.viewer.container.appendChild(this._helperBox)}active(){this.enabled||(this.enabled=!0,this.viewer.pickEffect=!1,this.viewer.scene.screenSpaceCameraController.enableRotate=!1,this.viewer.container.style.cursor="crosshair",this._bindEvents())}deactive(){if(!this.enabled)return;this.enabled=!1,this.viewer.pickEffect=!0,this.viewer.scene.screenSpaceCameraController.enableRotate=!0,this.viewer.container.style.cursor="default";const{selectFillColorPass:e}=this.viewer.scene.effectComposerCollection;e.clearSelectColorId(),this._removeEvents()}_bindEvents(){const{pointer:e}=this.viewer.input;e.addEventListener(si.POINTER_DOWN,this._pointerdownLisenter=t=>{this._onPointerDown(t[0])}),e.addEventListener(si.POINTER_MOVE,this._pointermoveLisenter=t=>{this._onPointerMove(t[0])}),e.addEventListener(si.POINTER_UP,this._pointerupLisenter=t=>{this._onPointerUp(t[0])})}_removeEvents(){const{pointer:e}=this.viewer.input;e.removeEventListener(si.POINTER_DOWN,this._pointerdownLisenter),e.removeEventListener(si.POINTER_MOVE,this._pointermoveLisenter),e.removeEventListener(si.POINTER_UP,this._pointerupLisenter)}_onPointerDown(e){if(e.button!==bv.Primary)return;this._isPointerDown=!0;const[t,i]=e.screenCoord;this._mouseXY=[t,i]}_onPointerMove(e){if(!this._isPointerDown)return;const[t,i]=e.screenCoord,[r,s]=this._mouseXY,o=Math.round(t-r),a=Math.round(i-s);Math.abs(o)<1||Math.abs(a)<1||(this._helperBox.style.left=(o>0?r:t)+"px",this._helperBox.style.top=(a>0?s:i)+"px",this._helperBox.style.width=Math.abs(o)+"px",this._helperBox.style.height=Math.abs(a)+"px",this._helperBox.style.display="block")}_onPointerUp(e){if(!this._isPointerDown)return;this._isPointerDown=!1;const[t,i]=e.screenCoord;this._isPointerDown=!1,this._helperBox.style.display="none",this._helperBox.style.width="0",this._helperBox.style.height="0";const[r,s]=this._mouseXY,o=Math.min(r,t),a=Math.max(r,t),l=Math.min(s,i),c=Math.max(s,i),u=a-o,d=c-l,p=this.viewer.camera.frustum,{clientWidth:g,clientHeight:_}=this.viewer.container;p.setViewOffset(g,_,o,l,u,d),this._projScreenMatrix.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),this._frustum.setFromProjectionMatrix(this._projScreenMatrix),p.clearViewOffset();const{selectFillColorPass:x}=this.viewer.scene.effectComposerCollection;x.clearSelectColorId();const M=this.viewer.scene.primitives.children.filter(w=>w instanceof Zs)[0]._contents,E=[];for(let w=0;w<M.length;w++){const I=M[w];if(!this._frustum.intersectsBox(I.boundingVolume))continue;const B=I._instanceSphere;for(let N=0;N<B.length;N++){const[L,P,R,U]=B[N];if(Lv.center.set(L,P,R),Lv.radius=U,!this._frustum.intersectsSphere(Lv))continue;const{color:j,key:A}=I._pickIds[N];x.addSelectColorId(j),E.push(A)}}this.viewer.boxSelectionEndEvent.raiseEvent(E)}isDestroyed(){return!1}destroy(){var e;return this.deactive(),(e=this.viewer.container)==null||e.removeChild(this._helperBox),ht(this)}}new T,new T;const Zz={rayPlane(n,e,t=new T){var i=n.origin,r=n.direction,s=e.normal,o=T.dot(s,r);if(!(Math.abs(o)<Ne.EPSILON15)){var a=(-e.distance-T.dot(s,i))/o;if(!(a<0))return t=T.multiplyByScalar(r,a,t),T.add(i,t,t)}}},Kz="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMF8yMDM2NV8xMjI3OCkiPg0KPHBhdGggZD0iTTExLjk5OTUgMEMxNC4zNzI4IDAgMTYuNjkyOCAwLjcwMzc2IDE4LjY2NjEgMi4wMjIyOEMyMC42Mzk0IDMuMzQwODEgMjIuMTc3NCA1LjIxNDg4IDIzLjA4NTYgNy40MDc1QzIzLjk5MzggOS42MDAxMyAyNC4yMzE1IDEyLjAxMjggMjMuNzY4NSAxNC4zNDA1QzIzLjMwNTUgMTYuNjY4MiAyMi4xNjI2IDE4LjgwNjMgMjAuNDg0NSAyMC40ODQ1QzE4LjgwNjMgMjIuMTYyNiAxNi42NjgyIDIzLjMwNTUgMTQuMzQwNSAyMy43Njg1QzEyLjAxMjggMjQuMjMxNSA5LjYwMDEzIDIzLjk5MzggNy40MDc1IDIzLjA4NTZDNS4yMTQ4OCAyMi4xNzc0IDMuMzQwODEgMjAuNjM5NCAyLjAyMjI4IDE4LjY2NjFDMC43MDM3NiAxNi42OTI4IDAgMTQuMzcyOCAwIDExLjk5OTVDMCA4LjgxNzA1IDEuMjY0MjMgNS43NjQ5MiAzLjUxNDU4IDMuNTE0NThDNS43NjQ5MiAxLjI2NDIzIDguODE3MDUgMCAxMS45OTk1IDBaIiBmaWxsPSIjMkY4MEVEIi8+DQo8cGF0aCBkPSJNNi4wMjg4NyAxMS4zOTc5QzYuMTY3NTEgMTAuMDIwOSA2Ljc3Nzg2IDguNzM0IDcuNzU2NTMgNy43NTUzMkM4LjczNTIxIDYuNzc2NjUgMTAuMDIyMSA2LjE2NjMxIDExLjM5OTIgNi4wMjc2NlY0Ljc5OTU2SDEyLjU5OTNWNi4wMjc2NkMxMy45NzYyIDYuMTY2NTIgMTUuMjYyOCA2Ljc3Njk1IDE2LjI0MTMgNy43NTU2MUMxNy4yMTk4IDguNzM0MjYgMTcuODMgMTAuMDIxIDE3Ljk2ODYgMTEuMzk3OUgxOS4xOTg2VjEyLjU5ODFIMTcuOTY5NkMxNy44MzA3IDEzLjk3NTIgMTcuMjIwMSAxNS4yNjE5IDE2LjI0MTMgMTYuMjQwNEMxNS4yNjI0IDE3LjIxODkgMTMuOTc1NSAxNy44MjkgMTIuNTk4MyAxNy45Njc0VjE5LjE5NzRIMTEuMzk4MlYxNy45NjkzQzEwLjAyMTMgMTcuODMwNSA4LjczNDY0IDE3LjIyIDcuNzU2MTYgMTYuMjQxNEM2Ljc3NzY4IDE1LjI2MjcgNi4xNjc0OCAxMy45NzYgNi4wMjg4NyAxMi41OTkxSDQuNzk5OFYxMS4zOTg5SDYuMDI5ODNMNi4wMjg4NyAxMS4zOTc5Wk0xMS45OTk3IDE1Ljc0NzRDMTIuNzQxMSAxNS43NDcyIDEzLjQ2NTggMTUuNTI3MiAxNC4wODIyIDE1LjExNTFDMTQuNjk4NiAxNC43MDMxIDE1LjE3ODkgMTQuMTE3NSAxNS40NjI1IDEzLjQzMjVDMTUuNzQ2MSAxMi43NDc0IDE1LjgyMDIgMTEuOTkzNyAxNS42NzU1IDExLjI2NjVDMTUuNTMwNyAxMC41Mzk0IDE1LjE3MzYgOS44NzE0OSAxNC42NDkzIDkuMzQ3M0MxNC4xMjQ5IDguODIzMSAxMy40NTY5IDguNDY2MTUgMTIuNzI5OCA4LjMyMTU4QzEyLjAwMjYgOC4xNzcgMTEuMjQ4OCA4LjI1MTMgMTAuNTYzOSA4LjUzNTA3QzkuODc4OTIgOC44MTg4NSA5LjI5MzQ4IDkuMjk5MzUgOC44ODE1OSA5LjkxNTgzQzguNDY5NyAxMC41MzIzIDguMjQ5ODYgMTEuMjU3MSA4LjI0OTg2IDExLjk5ODVDOC4yNTAxMSAxMi45OTI3IDguNjQ1MTcgMTMuOTQ2MSA5LjM0ODE2IDE0LjY0OTFDMTAuMDUxMiAxNS4zNTIxIDExLjAwNDYgMTUuNzQ3MSAxMS45OTg3IDE1Ljc0NzRIMTEuOTk5N1pNMTEuOTk5NyAxMy42NDc5QzEyLjMyNTkgMTMuNjQ3OSAxMi42NDQ4IDEzLjU1MTEgMTIuOTE2IDEzLjM2OTlDMTMuMTg3MyAxMy4xODg3IDEzLjM5ODcgMTIuOTMxMSAxMy41MjM1IDEyLjYyOTdDMTMuNjQ4MyAxMi4zMjgzIDEzLjY4MSAxMS45OTY3IDEzLjYxNzQgMTEuNjc2N0MxMy41NTM3IDExLjM1NjggMTMuMzk2NiAxMS4wNjI5IDEzLjE2NiAxMC44MzIyQzEyLjkzNTMgMTAuNjAxNiAxMi42NDE0IDEwLjQ0NDUgMTIuMzIxNSAxMC4zODA4QzEyLjAwMTUgMTAuMzE3MiAxMS42Njk5IDEwLjM0OTkgMTEuMzY4NSAxMC40NzQ3QzExLjA2NzEgMTAuNTk5NSAxMC44MDk2IDEwLjgxMDkgMTAuNjI4MyAxMS4wODIyQzEwLjQ0NzEgMTEuMzUzNCAxMC4zNTA0IDExLjY3MjMgMTAuMzUwNCAxMS45OTg1QzEwLjM1MDQgMTIuNDM1OCAxMC41MjQgMTIuODU1MSAxMC44MzMxIDEzLjE2NDRDMTEuMTQyMiAxMy40NzM3IDExLjU2MTUgMTMuNjQ3NiAxMS45OTg3IDEzLjY0NzlIMTEuOTk5N1oiIGZpbGw9IndoaXRlIi8+DQo8L2c+DQo8ZGVmcz4NCjxjbGlwUGF0aCBpZD0iY2xpcDBfMjAzNjVfMTIyNzgiPg0KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBmaWxsPSJ3aGl0ZSIvPg0KPC9jbGlwUGF0aD4NCjwvZGVmcz4NCjwvc3ZnPg0K";var li=(n=>(n[n.LEFT_DRAG=0]="LEFT_DRAG",n[n.RIGHT_DRAG=1]="RIGHT_DRAG",n[n.MIDDLE_DRAG=2]="MIDDLE_DRAG",n[n.WHEEL=3]="WHEEL",n[n.PINCH=4]="PINCH",n))(li||{});function On(n,e){let t=n.toString();return O(e)&&(t+="+"+e),t}function Qz(n,e){he.clone(n.distance.startPosition,e.distance.startPosition),he.clone(n.distance.endPosition,e.distance.endPosition),he.clone(n.angleAndHeight.startPosition,e.angleAndHeight.startPosition),he.clone(n.angleAndHeight.endPosition,e.angleAndHeight.endPosition)}function OA(n,e,t){const i=On(li.PINCH,e),r=n._update,s=n._isDown,o=n._eventStartPosition,a=n._pressTime,l=n._releaseTime;r[i]=!0,s[i]=!1,o[i]=new he;let c=n._movement[i];O(c)||(c=n._movement[i]={}),c.distance={startPosition:new he,endPosition:new he},c.angleAndHeight={startPosition:new he,endPosition:new he},c.prevAngle=0,c.centerPosition=new he,n._eventHandler.setInputAction(function(u){n._buttonsDown++,s[i]=!0,a[i]=new Date,he.lerp(u.position1,u.position2,.5,o[i])},vt.PINCH_START,e),n._eventHandler.setInputAction(function(){n._buttonsDown=Math.max(n._buttonsDown-1,0),s[i]=!1,l[i]=new Date},vt.PINCH_END,e),n._eventHandler.setInputAction(function(u){if(s[i]){r[i]?(Qz(u,c),r[i]=!1,c.prevAngle=c.angleAndHeight.startPosition.x):(he.clone(u.distance.endPosition,c.distance.endPosition),he.clone(u.angleAndHeight.endPosition,c.angleAndHeight.endPosition),he.clone(u.centerPosition,c.centerPosition));let d=c.angleAndHeight.endPosition.x;const p=c.prevAngle,g=Math.PI*2;for(;d>=p+Math.PI;)d-=g;for(;d<p-Math.PI;)d+=g;c.angleAndHeight.endPosition.x=-d*t.clientWidth/12,c.angleAndHeight.startPosition.x=-p*t.clientWidth/12,he.clone(u.centerPosition,c.centerPosition)}},vt.PINCH_MOVE,e)}function NA(n,e){const t=On(li.WHEEL,e),i=n._update;i[t]=!0;let r=n._movement[t];O(r)||(r=n._movement[t]={}),r.startPosition=new he,r.endPosition=new he,n._eventHandler.setInputAction(function(s){const o=15*Ne.toRadians(s);i[t]?(he.clone(he.ZERO,r.startPosition),r.endPosition.x=0,r.endPosition.y=o,i[t]=!1):r.endPosition.y=r.endPosition.y+o},vt.WHEEL,e)}function bc(n,e,t){const i=On(t,e),r=n._isDown,s=n._eventStartPosition,o=n._pressTime,a=n._releaseTime;r[i]=!1,s[i]=new he;let l=n._lastMovement[i];O(l)||(l=n._lastMovement[i]={startPosition:new he,endPosition:new he,valid:!1});let c,u;t===li.LEFT_DRAG?(c=vt.LEFT_DOWN,u=vt.LEFT_UP):t===li.RIGHT_DRAG?(c=vt.RIGHT_DOWN,u=vt.RIGHT_UP):t===li.MIDDLE_DRAG&&(c=vt.MIDDLE_DOWN,u=vt.MIDDLE_UP),n._eventHandler.setInputAction(function(d){n._buttonsDown++,l.valid=!1,r[i]=!0,o[i]=new Date,he.clone(d.position,s[i])},c,e),n._eventHandler.setInputAction(function(){n._buttonsDown=Math.max(n._buttonsDown-1,0),r[i]=!1,a[i]=new Date},u,e)}function BA(n,e){he.clone(n.startPosition,e.startPosition),he.clone(n.endPosition,e.endPosition)}function FA(n,e){const t=n._update,i=n._movement,r=n._lastMovement,s=n._isDown;for(const o in li)if(Object.prototype.hasOwnProperty.call(li,o)){const a=li[o];if(O(a)){const l=On(a,e);t[l]=!0,O(n._lastMovement[l])||(n._lastMovement[l]={startPosition:new he,endPosition:new he,valid:!1}),O(n._movement[l])||(n._movement[l]={startPosition:new he,endPosition:new he})}}n._eventHandler.setInputAction(function(o){for(const a in li)if(Object.prototype.hasOwnProperty.call(li,a)){const l=li[a];if(O(l)){const c=On(l,e);s[c]&&(t[c]?(BA(i[c],r[c]),r[c].valid=!0,BA(o,i[c]),t[c]=!1):he.clone(o.endPosition,i[c].endPosition))}}he.clone(o.endPosition,n._currentMousePosition)},vt.MOUSE_MOVE,e)}class UA{constructor(e){f(this,"_eventHandler");f(this,"_update");f(this,"_movement");f(this,"_lastMovement");f(this,"_isDown");f(this,"_eventStartPosition");f(this,"_pressTime");f(this,"_releaseTime");f(this,"_buttonsDown");f(this,"_currentMousePosition");if(!O(e))throw new Ze("canvas is required.");this._eventHandler=new Yn(e),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new he,NA(this,void 0),OA(this,void 0,e),bc(this,void 0,li.LEFT_DRAG),bc(this,void 0,li.RIGHT_DRAG),bc(this,void 0,li.MIDDLE_DRAG),FA(this,void 0);for(const t in Wr)if(Object.prototype.hasOwnProperty.call(Wr,t)){const i=Wr[t];O(i)&&(NA(this,i),OA(this,i,e),bc(this,i,li.LEFT_DRAG),bc(this,i,li.RIGHT_DRAG),bc(this,i,li.MIDDLE_DRAG),FA(this,i))}}get currentMousePosition(){return this._currentMousePosition}get anyButtonDown(){const e=!this._update[On(li.WHEEL)]||!this._update[On(li.WHEEL,Wr.SHIFT)]||!this._update[On(li.WHEEL,Wr.CTRL)]||!this._update[On(li.WHEEL,Wr.ALT)];return this._buttonsDown>0||e}isMoving(e,t){if(!O(e))throw new Ze("type is required.");const i=On(e,t);return!this._update[i]}getMovement(e,t){if(!O(e))throw new Ze("type is required.");const i=On(e,t);return this._movement[i]}getLastMovement(e,t){if(!O(e))throw new Ze("type is required.");const i=On(e,t),r=this._lastMovement[i];if(r.valid)return r}isButtonDown(e,t){if(!O(e))throw new Ze("type is required.");const i=On(e,t);return this._isDown[i]}getStartMousePosition(e,t){if(!O(e))throw new Ze("type is required.");if(e===li.WHEEL)return this._currentMousePosition;const i=On(e,t);return this._eventStartPosition[i]}getButtonPressTime(e,t){if(!O(e))throw new Ze("type is required.");const i=On(e,t);return this._pressTime[i]}getButtonReleaseTime(e,t){if(!O(e))throw new Ze("type is required.");const i=On(e,t);return this._releaseTime[i]}reset(){for(const e in this._update)Object.prototype.hasOwnProperty.call(this._update,e)&&(this._update[e]=!0)}isDestroyed(){return!1}destroy(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),ht(this)}}let fu,xc;const $z=new Tr;new T,new he;const kA=new T,Jz=new Tr,e5=new T,zA=new T,HA=new fi,t5=new Tr,GA=new T,VA=new T,i5=new T;new he;function n5(n,e,t){let i=n._scene,r=i.camera,s;if(i.pickPositionSupported&&(s=i.pickPosition(e,e5)),O(s))return T.clone(s,t);let o=r.getPickRay(e,Jz),a=o.intersectBox(n._scene.axisAlignedBoundingBox,zA);O(a)||(a=o.intersectBox(n._sceneBoundingBox,zA));let l=O(s)?T.distance(s,r.positionWC):Number.POSITIVE_INFINITY,c=O(a)?T.distance(a,r.positionWC):Number.POSITIVE_INFINITY;return l<c?T.clone(s,t):T.clone(a,t)}function r5(n,e){if(n<0)return 0;let t=(1-e)*25;return Math.exp(-t*n)}function s5(n){return he.equalsEpsilon(n.startPosition,n.endPosition,Ne.EPSILON14)}let o5=.4;function a5(n,e,t,i,r,s,o){fu=null;let a=s[o];O(a)||(a=s[o]={startPosition:new he,endPosition:new he,motion:new he,inertiaEnabled:!0});let l=n.getButtonPressTime(e,t),c=n.getButtonReleaseTime(e,t),u=l&&c&&(c.getTime()-l.getTime())/1e3,p=c&&(new Date().getTime()-c.getTime())/1e3;if(l&&c&&u<o5){let g=r5(p,i),_=n.getLastMovement(e,t);if(!O(_)||s5(_)||!a.inertiaEnabled||(a.motion.x=(_.endPosition.x-_.startPosition.x)*.5,a.motion.y=(_.endPosition.y-_.startPosition.y)*.5,a.startPosition=he.clone(_.startPosition,a.startPosition),a.endPosition=he.multiplyByScalar(a.motion,g,a.endPosition),a.endPosition=he.add(a.startPosition,a.endPosition,a.endPosition),isNaN(a.endPosition.x)||isNaN(a.endPosition.y)||he.distance(a.startPosition,a.endPosition)<.5))return;if(!n.isButtonDown(e,t)){let x=n.getStartMousePosition(e,t);r(s,x,a)}}}function l5(n,e){if(O(e)){let t=n[e];O(t)&&(t.inertiaEnabled=!0);let i=n._inertiaDisablers[e];if(O(i)){let r=i.length;for(let s=0;s<r;++s)t=n[i[s]],O(t)&&(t.inertiaEnabled=!1)}}}let WA=[];function Ov(n,e,t,i,r,s){if(!O(t))return;let o=n._aggregator;Array.isArray(t)||(WA[0]=t,t=WA);let a=t.length;for(let l=0;l<a;++l){let c=t[l],u=O(c.eventType)?c.eventType:c,d=c.modifier,p=o.isMoving(u,d)&&o.getMovement(u,d),g=o.getStartMousePosition(u,d);n.enableInputs&&e&&(p?(i(n,g,p),l5(n,s)):r<1&&a5(o,u,d,r,i,n,s))}}const Qp=new T,Ka=new T,XA=new T;function c5(n){let{pivotPosition:e,camera:t}=n;const{viewMatrix:i,inverseViewMatrix:r,position:s}=t;fe.multiplyByPoint(i,e,Qp),Qp.z+=T.distance(s,e),fe.multiplyByPointAsVector(r,Qp,XA),T.subtract(s,e,Ka),T.add(Ka,XA,Ka),n._cameraOffset.copy(Qp),n._radius=T.magnitude(Ka),n._azimuth=Math.atan2(Ka.x,Ka.y),n._polar=Math.acos(Ka.z/n._radius)}function h5(n,e){let{_rotateDelta:t,_rotateStart:i,rotateSpeed:r}=n;t.subVectors(e.endPosition,e.startPosition).multiplyScalar(r),i.copy(e.endPosition),u5(n),n._cameraChanging=!0}const[Nv,YA,Bv,jA,wc]=[new T,new T,new T,new T,new T];function u5(n,e){let{viewer:t,_rotateDelta:i,minPolarAngle:r,maxPolarAngle:s,_pivotDom:o,_radius:a}=n;const l=t.container.clientHeight;n._azimuth+=2*Math.PI*i.x/l,n.constrainZ||(n._polar-=2*Math.PI*i.y/l),n._polar=Math.max(r+.001,Math.min(s-.001,n._polar));const c=new T(a*Math.sin(n._polar)*Math.sin(n._azimuth),a*Math.sin(n._polar)*Math.cos(n._azimuth),a*Math.cos(n._polar));T.add(c,n.pivotPosition,c);let u=T.subtract(n.pivotPosition,c,new T);T.normalize(u,u);let d=T.cross(u,T.UNIT_Z,new T).normalize(),p=T.cross(d,u,new T),g=fe.computeView(c,u,p,d,new fe);fe.inverse(g,g);let _=g.elements;wc.copy(n._cameraOffset),wc.applyMatrix3(new at().setFromMatrix4(g)),_[12]-=wc.x,_[13]-=wc.y,_[14]-=wc.z,T.subtract(c,wc,c);let x=T.clone(u,new T);x.multiplyScalar(-1);const b=[_[12]-x.x,_[13]-x.y,_[14]-x.z];T.fromElements(_[12],_[13],_[14],Bv),T.fromElements(b[0],b[1],b[2],jA),T.fromElements(_[4],_[5],_[6],YA),T.subtract(jA,Bv,Nv),Nv.normalize(),t.camera.setView({destination:Bv,orientation:{direction:Nv,up:YA}}),o&&(n._pivotDom.style.display=n._showPivot?"block":"none")}const f5=new T;function d5(n,e,t){let{_scene:i,pivotPosition:r,camera:s,screenSpaceControlPosition:o}=n,a;O(xc)?a=T.clone(n._rotateCenter,f5):(xc=new he,a=i.pickPosition(e,n.pivotPosition),O(a)||r.copy(i.axisAlignedBoundingBox.center),O(a)?he.clone(e,xc):i.positionToCanvasCoordinates(r,xc),c5(n)),ZA(n,xc),h5(n,t)}function p5(n,e,t){const{camera:i}=n;if(t.inertiaEnabled)return;if(!he.equals(e,n._panCenterMousePosition)){let o=n5(n,e,n.pivotPosition);T.clone(n.camera.direction,GA),fi.fromPointNormal(o,GA,HA),he.clone(e,n._panCenterMousePosition)}let r=i.getPickRay(ye(t.centerPosition,t.endPosition),t5),s=Zz.rayPlane(r,HA,i5);O(s)&&(T.subtract(n.pivotPosition,s,VA),T.add(i.position,VA,i.position))}const qA=new T,Sc=new T;function m5(n,e,t){const{camera:i,_scene:r,maxDistance:s,minDistance:o}=n;ZA(n,e),n.updatePivotPosition();let[a,l,c]=[0,0,0];O(t.distance)?(O(fu)||(fu=new T,n._dolly=t.distance.startPosition.y,n._scene.pickPosition(e,fu)),a=t.distance.endPosition.y-n._dolly,l=a*4/r.container.clientWidth,c=T.distance(i.position,fu)):(a=t.endPosition.y-t.startPosition.y,n._scene.pickPosition(e,n.pivotPosition),l=a<0?-.05:.05,c=T.distance(i.position,n.pivotPosition));let u=i.getPickRay(e,$z);if(T.multiplyByScalar(u.direction,c*l*n.zoomSpeed,qA),T.add(i.position,qA,Sc),T.distance(Sc,r.boundingSphere.center),T.distance(Sc,n.pivotPosition),i.frustum instanceof Gs){const d=Math.sign(l)*T.distance(Sc,i.position);Math.abs(d)>0&&(i.zoomIn(d),i._adjustOrthographicFrustum()),T.clone(Sc,i.position);return}T.clone(Sc,i.position)}function ZA(n,e){n.screenSpaceControlPosition.copy(e),n._cameraChanging=!0,n._pivotTime=0,n._pivotDom.style.display="block"}class g5{constructor(e,t){f(this,"type",jn.ORBIT);f(this,"_enableInputs",!0);f(this,"enableRotate",!0);f(this,"enablePan",!0);f(this,"enableZoom",!0);f(this,"enableZoomMouseCenter",!0);f(this,"constrainZ",!1);f(this,"rotateSpeed",1);f(this,"zoomSpeed",1.5);f(this,"minDistance",1);f(this,"dynamicMaxDistance",!1);f(this,"maxDistance",1/0);f(this,"minZoom",-1/0);f(this,"maxZoom",1/0);f(this,"minPolarAngle",0);f(this,"maxPolarAngle",Math.PI);f(this,"target",new T);f(this,"pivotPosition",new T);f(this,"_pivotTime",0);f(this,"_pivotDom");f(this,"_pivotDomLeft",0);f(this,"_pivotDomTop",0);f(this,"_cameraChanging",!1);f(this,"_showPivot",!0);f(this,"_mouse",new he);f(this,"_cameraOffset",new T);f(this,"_azimuth",0);f(this,"_polar",0);f(this,"_radius",0);f(this,"_eyeVec3",new T);f(this,"_targetVec3",new T);f(this,"_rotateStart",new he);f(this,"_rotateEnd",new he);f(this,"_rotateDelta",new he);f(this,"_panStart",new he);f(this,"_panEnd",new he);f(this,"_panVec3",new T);f(this,"_dolly",0);f(this,"screenSpaceControlPosition",new he);f(this,"_scene");f(this,"_sceneBoundingBox",new Lt);f(this,"_rotateCenter",new T);f(this,"_panCenter",new T);f(this,"_panCenterMousePosition",new he);f(this,"_aggregator");f(this,"eventHandler");f(this,"panEventTypes",[li.RIGHT_DRAG,li.MIDDLE_DRAG,li.PINCH]);f(this,"rotateEventTypes",li.LEFT_DRAG);f(this,"zoomEventTypes",[li.WHEEL,li.PINCH]);f(this,"inertiaSpin",0);f(this,"inertiaZoom",0);f(this,"_inertiaDisablers",{_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]});this.viewer=e,this._scene=t,this.eventHandler=new Yn(t.canvas),this._aggregator=new UA(t.canvas),t.renderer.domElement.addEventListener("contextmenu",i=>{i.preventDefault()})}get camera(){return this._scene.camera}get enableInputs(){return this._enableInputs}set enableInputs(e){this._enableInputs=e}createPivotDom(){this._pivotDom=document.createElement("img"),this._pivotDom.src=Kz,this._pivotDom.width=26,this._pivotDom.height=26,this._pivotDom.style.cssText="position: absolute; z-index: 999; left: 0; top: 0; display: none;pointer-events: none",this.viewer.container.appendChild(this._pivotDom)}_updatePivot(e,t=!1){if(O(this._pivotDom)){if(this._pivotTime+=e,this._pivotTime>.2){this._pivotDom.style.display="none";return}t&&this.updatePivotPosition(this.screenSpaceControlPosition)}}updatePivotPosition(e=this.screenSpaceControlPosition){const t=e;let i,r;Math.abs(this._pivotDomLeft-t.x)<=1&&Math.abs(this._pivotDomTop-t.y)<=1?(i=this._pivotDomLeft,r=this._pivotDomTop):(i=this._pivotDomLeft=t.x,r=this._pivotDomTop=t.y),this._pivotDom.style.left=i-13+"px",this._pivotDom.style.top=r-13+"px"}update(e){let t=this.viewer.scene,i=t.camera;this._sceneBoundingBox.copy(t.axisAlignedBoundingBox),this._sceneBoundingBox.expandByPoint(i.position),this._sceneBoundingBox.getSize(kA),this._sceneBoundingBox.expandByVector(kA),this._updatePivot(e,this._cameraChanging),Ov(this,this.enableRotate,this.rotateEventTypes,d5,this.inertiaSpin,"_lastInertiaSpinMovement"),Ov(this,this.enablePan,this.panEventTypes,p5,this.inertiaSpin,"_lastInertiaSpinMovement"),Ov(this,this.enableZoom,this.zoomEventTypes,m5,this.inertiaZoom,"_lastInertiaZoomMovement"),this._aggregator.isButtonDown(this.rotateEventTypes,void 0)?this._pivotTime=0:(xc=null,this._cameraChanging=!1),this._aggregator.reset()}destroy(){return this._aggregator=this._aggregator&&this._aggregator.destroy(),ht(this)}}class KA{constructor(e,t){f(this,"_viewer");f(this,"_orbitControl");f(this,"_currentControl");f(this,"_type",jn.NONE);f(this,"scene");this._viewer=e,this.scene=t,this._type=jn.ORBIT,this._orbitControl=new g5(this._viewer,this.scene),this._orbitControl.dynamicMaxDistance=!1,this._orbitControl.enableInputs=!0,this._currentControl=this._orbitControl,t.frameState.afterRender.push(()=>{this._orbitControl.createPivotDom()})}get type(){return this._type}set enabled(e){this._currentControl&&(this._currentControl.enableInputs=e)}set minZoom(e){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.minZoom=e}set maxZoom(e){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.maxZoom=e}set minDistance(e){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.minDistance=e}set maxDistance(e){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.maxDistance=e}set zoomSpeed(e){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.zoomSpeed=e}set rotateSpeed(e){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.rotateSpeed=e}enableControl(e){this.enabled=e}enableRotate(e){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.enableRotate=e}enableLeftEvent(e=!0){e?this._orbitControl.enableRotate=!0:this._orbitControl.enableRotate=!1}setPanEventTypes(e){this._orbitControl.panEventTypes=e}setRotateEventTypes(e){this._orbitControl.rotateEventTypes=e}setZoomEventTypes(e){this._orbitControl.zoomEventTypes=e}enableConstrainZ(e){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.constrainZ=e}showPivot(){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.createPivotDom()}getPivotPosition(){return this._orbitControl.pivotPosition}setPivotPosition(e,t,i){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.pivotPosition.set(e,t,i)}setPitchRange(e,t){if(this._type!==jn.ORBIT||!this._orbitControl){console.warn('VEngine-log: "orbit"');return}this._orbitControl.minPolarAngle=e,this._orbitControl.maxPolarAngle=t}update(e){var t;this._orbitControl.dynamicMaxDistance&&(this._orbitControl.maxDistance=this.scene.boundingSphere.radius*8),(t=this._orbitControl)==null||t.update(e)}destroy(){var e;(e=this._orbitControl)==null||e.destroy()}}class Fv{constructor(e,t,i){f(this,"name");f(this,"fg");f(this,"bg");f(this,"PR",Math.round(Ot.devicePixelRatio||1));f(this,"WIDTH",80*this.PR);f(this,"HEIGHT",48*this.PR);f(this,"TEXT_X",3*this.PR);f(this,"TEXT_Y",2*this.PR);f(this,"GRAPH_X",3*this.PR);f(this,"GRAPH_Y",15*this.PR);f(this,"GRAPH_WIDTH",74*this.PR);f(this,"GRAPH_HEIGHT",30*this.PR);f(this,"min",1/0);f(this,"max",0);f(this,"canvas");f(this,"context");this.name=e,this.fg=t,this.bg=i,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.cssText="width:80px; height:48px";const r=this.canvas.getContext("2d");if(!r)throw new Error("VEngine-log: stats panel canvas context lost");r.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",r.textBaseline="top",r.fillStyle=i,r.fillRect(0,0,this.WIDTH,this.HEIGHT),r.fillStyle=t,r.fillText(e,this.TEXT_X,this.TEXT_Y),r.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),r.fillStyle=i,r.globalAlpha=.9,r.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context=r}get dom(){return this.canvas}update(e,t){this.min=Math.min(this.min,e),this.max=Math.max(this.max,e),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(Math.round(e)+" "+this.name+" ("+Math.round(this.min)+"-"+Math.round(this.max)+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,Math.round((1-e/t)*this.GRAPH_HEIGHT))}}class _5{constructor(e){f(this,"_element");f(this,"_beginTime");f(this,"_prevTime");f(this,"_frames",0);f(this,"_fpsPanel");f(this,"_msPanel");f(this,"_memPanel");f(this,"_clickHandler");f(this,"_mode",0);this._element=document.createElement("div"),this._element.className="vengine-viewer-stats",e.appendChild(this._element),this._beginTime=(performance||Date).now(),this._prevTime=this._beginTime,this._fpsPanel=new Fv("FPS","#0ff","#002"),this._element.appendChild(this._fpsPanel.dom),this._msPanel=new Fv("MS","#0f0","#020"),this._element.appendChild(this._msPanel.dom),performance&&performance.memory&&(this._memPanel=new Fv("MB","#f08","#201"),this._element.appendChild(this._memPanel.dom)),this._showPanel(0),this._element.addEventListener("click",this._clickHandler=t=>{t.preventDefault(),this._showPanel(++this._mode%this._element.children.length)},!1)}_showPanel(e){const t=this._element.children;for(let i=0,r=t.length;i<r;i++)t[i].style.display=i===e?"block":"none";this._mode=e}update(){this._frames++;const e=(performance||Date).now();if(this._msPanel.update(e-this._beginTime,200),e>=this._prevTime+1e3&&(this._fpsPanel.update(this._frames*1e3/(e-this._prevTime),100),this._prevTime=e,this._frames=0,this._memPanel)){const t=performance.memory;this._memPanel.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}this._beginTime=e}setVisible(e){this._element.style.display=e?"block":"none"}destroy(){this._element.removeEventListener("click",this._clickHandler)}}const E6="";var Uv=(n=>(n.Backquote="`",n.Backslash="\\",n.Backspace="backspace",n.BracketLeft="[",n.BracketRight="]",n.Comma=",",n.Digit0="0",n.Digit1="1",n.Digit2="2",n.Digit3="3",n.Digit4="4",n.Digit5="5",n.Digit6="6",n.Digit7="7",n.Digit8="8",n.Digit9="9",n.Equal="=",n.KeyA="a",n.KeyB="b",n.KeyC="c",n.KeyD="d",n.KeyE="e",n.KeyF="f",n.KeyG="g",n.KeyH="h",n.KeyI="i",n.KeyJ="j",n.KeyK="k",n.KeyL="l",n.KeyM="m",n.KeyN="n",n.KeyO="o",n.KeyP="p",n.KeyQ="q",n.KeyR="r",n.KeyS="s",n.KeyT="t",n.KeyU="u",n.KeyV="v",n.KeyW="w",n.KeyX="x",n.KeyY="y",n.KeyZ="z",n.Minus="-",n.Period=".",n.Quote="'",n.Semicolon=";",n.Slash="/",n.AltLeft="alt",n.AltRight="alt",n.ControlLeft="ctrl",n.ControlRight="ctrl",n.MetaLeft="meta",n.MetaRight="meta",n.ShiftLeft="shift",n.ShiftRight="shift",n.CapsLock="capslock",n.ContextMenu="contextmenu",n.Enter="enter",n.Space="space",n.Tab="tab",n.Delete="delete",n.End="end",n.Home="home",n.Insert="insert",n.PageDown="pagedown",n.PageUp="pageup",n.ArrowDown="down",n.ArrowLeft="left",n.ArrowRight="right",n.ArrowUp="up",n.NumLock="numlock",n.Numpad0="num0",n.Numpad1="num1",n.Numpad2="num2",n.Numpad3="num3",n.Numpad4="num4",n.Numpad5="num5",n.Numpad6="num6",n.Numpad7="num7",n.Numpad8="num8",n.Numpad9="num9",n.NumpadAdd="numadd",n.NumpadClear="numclear",n.NumpadDecimal="numdecimal",n.NumpadDivide="numdivide",n.NumpadEnter="numenter",n.NumpadMultiply="nummultiply",n.NumpadSubtract="numsubtract",n.Escape="esc",n.F1="f1",n.F2="f2",n.F3="f3",n.F4="f4",n.F5="f5",n.F6="f6",n.F7="f7",n.F8="f8",n.F9="f9",n.F10="f10",n.F11="f11",n.F12="f12",n.F13="f13",n.F14="f14",n.F15="f15",n.PrintScreen="printscreen",n.ScrollLock="scrolllock",n.Pause="pause",n))(Uv||{});function QA(n){n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}const v5=["ctrlKey","altKey","shiftKey","metaKey"],y5={shiftKey:"shift",ctrlKey:"ctrl",altKey:"alt",metaKey:"meta"};class b5{constructor(e){f(this,"element");f(this,"_hadListener",!1);f(this,"_keyDownList",[]);f(this,"_keyUpList",[]);f(this,"_handlers",Object.create(null));f(this,"splitKey","+");this.element=e,e.tabIndex=e.tabIndex,e.focus(),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this.onFocus()}_onKeyDown(e){var l,c;const t=e.target,{tagName:i}=t;if(t.isContentEditable||i==="INPUT"||i==="TEXTAREA")return;let r=Uv[e.code];if(r==="alt"||r==="ctrl"||r==="shift"||r==="meta")return;let s=this._keyDownList.indexOf(r);s===-1&&this._keyDownList.push(r),v5.forEach(u=>{r=y5[u],s=this._keyDownList.indexOf(r),e[u]&&s===-1?this._keyDownList.push(r):!e[u]&&s>-1?this._keyDownList.splice(s,1):u==="metaKey"&&e[u]&&this._keyDownList.length===3&&(e.ctrlKey||e.shiftKey||e.altKey||(this._keyDownList=this._keyDownList.slice(s)))});const o=this._keyDownList.sort().join(""),a=this._handlers[o];if(a)for(let u=0;u<a.length;u++)(c=(l=a[u]).onkeydown)==null||c.call(l)}_onKeyUp(e){var o,a;const t=e.target,{tagName:i}=t;if(t.isContentEditable||i==="INPUT"||i==="TEXTAREA")return;const r=Uv[e.code];let s=this._keyDownList.indexOf(r);if(s>-1&&(this._keyDownList.splice(s,1),this._keyUpList.indexOf(r)===-1&&this._keyUpList.push(r)),this._keyDownList.length===0){const l=this._keyUpList.sort().join(""),c=this._handlers[l];if(c)for(let u=0;u<c.length;u++)(a=(o=c[u]).onkeyup)==null||a.call(o);this._keyUpList.length=0}}addHotkeys(e){const t=QA(e.key);let i;for(let r=0;r<t.length;r++){i=t[r].split(this.splitKey);const s=i.sort().join("").toLowerCase();this._handlers[s]?this._handlers[s].push(e):this._handlers[s]=[e]}}removeHotkeys(e){const{key:t,id:i}=e,r=QA(t);for(let s=0;s<r.length;s++){const a=r[s].split(this.splitKey).sort().join("").toLowerCase(),l=this._handlers[a];for(let c=0;c<l.length;c++)l[c].id===i&&l.splice(c,1);l.length===0&&delete this._handlers[a]}}onFocus(){this._hadListener||(this.element.addEventListener("keydown",this._onKeyDown),this.element.addEventListener("keyup",this._onKeyUp),this._hadListener=!0)}onBlur(){this._hadListener&&(this.element.removeEventListener("keydown",this._onKeyDown),this.element.removeEventListener("keyup",this._onKeyUp),this._hadListener=!1,this._keyDownList.length=0)}destroy(){this.onBlur(),this._keyDownList=null,this._handlers=null,ht(this)}}var $p=(n=>(n.DEFAULT="default",n.SELF="self",n))($p||{});class x5{constructor(e){f(this,"element");f(this,"_hadListener",!1);f(this,"_listenersMap",Object.create(null));f(this,"_pointers",[]);f(this,"_pointerPositions",Object.create(null));this.element=e,this.element.oncontextmenu=()=>!1,this._onPointerEvent=this._onPointerEvent.bind(this),this.onFocus()}_onPointerEvent(e){const t=e.target;if(!w5(t)){if(e.cancelable&&e.preventDefault(),e.type===si.POINTER_DOWN&&(this.element.focus(),e.pointerType==="touch"&&this._pointers.push(e)),this._dispatchEvents(e),e.type===si.POINTER_UP&&e.pointerType==="touch"){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId===e.pointerId){this._pointers.splice(i,1);break}delete this._pointerPositions[e.pointerId]}if(e.type===si.POINTER_CANCEL&&e.pointerType==="touch"){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId===e.pointerId){this._pointers.splice(i,1);break}delete this._pointerPositions[e.pointerId]}}}_dispatchEvents(e){const t=this._listenersMap[e.type];if(!t||t.length===0)return;const i=e.pointerType==="touch"?this._pointers:[e],r=[],s=this.element.getBoundingClientRect();this._pointerPositions[e.pointerId]=[e.clientX-s.left,e.clientY-s.top];for(let a=0;a<i.length;a++)r.push({screenCoord:this._pointerPositions[i[a].pointerId],pointerType:e.pointerType,target:e.target,time:e.timeStamp,button:e.button,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,type:e.type});let o=t.slice(0);for(let a=0;a<o.length;a++)o[a](r);o=null}addEventListener(e,t){this._listenersMap[e]||(this._listenersMap[e]=[]),this._listenersMap[e].indexOf(t)===-1&&this._listenersMap[e].push(t)}removeEventListener(e,t){const i=this._listenersMap[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}onFocus(){this._hadListener||(this.element.addEventListener("pointerdown",this._onPointerEvent),this.element.addEventListener("pointermove",this._onPointerEvent),this.element.addEventListener("pointerup",this._onPointerEvent),this.element.addEventListener("pointercancel",this._onPointerEvent),this._hadListener=!0)}onBlur(){this._hadListener&&(this.element.removeEventListener("pointerdown",this._onPointerEvent),this.element.removeEventListener("pointermove",this._onPointerEvent),this.element.removeEventListener("pointerup",this._onPointerEvent),this.element.removeEventListener("pointercancel",this._onPointerEvent),this._hadListener=!1,this._pointers.length=0,this._pointerPositions=Object.create(null))}destroy(){this.onBlur(),this._listenersMap=null,this._pointers=null,ht(this)}}function w5(n){if(n.dataset&&n.dataset.eventTrigger===$p.SELF)return!0;let e=n.parentElement;for(;e;){if(e.dataset&&e.dataset.eventTrigger===$p.SELF)return!0;e=e.parentElement}return!1}const $A="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFIAAABZCAYAAACt63NYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAVhSURBVHgB7Z1PTxtHFMDf2uZvmoS2STmgSttDEqtSKXwCQnJpTwkfIBLqF2iuOVRFqjj0hKVIvZJPkJReekkacjQghaoi6SGS9xBokYIg0JJibL/O2501a7O7nrXNM8HvJ82Od3axtT/em5nFsyJ97dpo7tKl4V8vXx623rzZXAShOZRIfP16HW/c+Aqz2dEZEJqDRBJv3+7inTvf4NWrX8zb9tgQCMnwRfrMzv6oZI4+z2bHbBDMqRdJ3L//E6r2gshMQJhIkdkEUSKJhw8XKM23r1z5fAyEeOJEEi9e/OnKBCGWTNSBe/e+g729PVhf3wDLgh0QYkkFd548eVpz8PHj335eW1sbPzjYHQchHj+19eCC+fyyu5/PL7kpLXNKM9Lq9nB6aWll6NGjXxzESm5j46/rU1O3YGRkBJaXV/o3N9f/3trazIMQS8ayipP5/MpEsbi74DjOjmWl7pJYAHT7R0TpH02w6htUet9V1ZwSuVguw8yrV388A0EQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEFoGxacIhCRVr7dVmVCFVolbKvir4ajNUiOKquqLKqyYFmWrEsKogTaqsypso3JmKefhW6HIlCVHLbOnI7m7kNHYQFboFLxiqaA3Rad6oLHsE0Sy2WvaKEFem/oBrBNkVjWEktUSoiHpRqZNjDDOmqj1489B280bvI9aC0xuJuwOpMGegrDUS/HOUf1FPAyAwkl3rz5tVuIRhKJctmtbFW+B0bYIlKnWwESks1+6dYvX/4eKxG1STcqVXik0+7uZyoqHWCAMyJbihBTibQplatt3wITLCJ13zgNrRAiL0wi1RW1KVfc5mlkml9yReRtaAJfkvtab2rkYfQx3VeSxFvAAJfICUgIBgYQr8FcIuqI1PvXgQEukcaT5GDaAh5vh/oao4/p9GaZoHOJtE1OiprSuLthkQgxgo9qGxjIAA8NO/yo0Xh29ocjaSEy4yTq1yyDDcs8ku7b4o/rWm8MoqyxRFX39gD09dCdjnXi18kVkZEEU9REYn3ax50Dsb++9tJRkUkjMU5iXP/KQcdENpOqiSQyy+yISFOJUWJOm0SCVeTmFsD2Hhy7Y6mXWC+t2udBXXcQPNfvGvTri+cBPv0E2GAV6Uqp6NeBtmBdPwmnjRU414JaiX59LAKZQ5Jt+tPsyBt2btixsPfo7wMY6DuD059WBo2wET5OIje8IvXGNMpakYjVDpMHNpEtp6rJOYFzmT0yRmQ7oszkHOQV6MM7j8TaSEkcZY3k1UU6J+x9ZNOp2oRETplsX36dZYkE+y2iaT/nn/s+SCQ6P9icgET/GCdcqb3j39uZCEokEaOP6fsZlmUrXCId2hgJgoQSIfpYJn302ScNl8jVlGUoKCpKE0qkusfruFaBAS6RzyjNomSa9HdhNWL0Ob2ZamovAgNcf/2hb/IKpTIMFQ/N0zlOYtw51D503vvLj+JDjuV9LBGpL+RBOvBpx9IZG0tEg0ikdlqJpiU+4Fojyb6s77AEcFBMHmVBUXo38lggGs/esj59QTkaAFL0qQn6O6yXiNHH6LtsLTHHJZHoyNLnSgXs/f+qa3OMosxkwk4p/fFFVafO+NJnfWGTKiKdwf6QUdxUIjaUOMn9VBj3GnI/xadI5rkBb9Jc7R/1pqFEqG2jdA5InOJMaZ+OPYuoB5+nqthFNfjsH4SketQorttonnhhEGBwwG1ywItEBzoAe0T66Aum/wGR6+31RtoPBqq3dcdkBtOeJtsXzgEMf1SVmAOvT3Sgm9EPMc0HH0gqFhH/fYf4zz7i3r5XvzuoeWSOHgCdw1Py2Jw8ZiycLv4HIuDvIYxqWpYAAAAASUVORK5CYII=",S5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFIAAABZCAYAAACt63NYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAXQSURBVHgB7Z1PT9xGFMCfWVj+pKWkTYQqenClQlClIPgEhOTSnCjqGSnqF4BrpFalqnJoL1kpUq/kE4TSSy9JIeppAQmkiCgHJLZtgNCA+JeSsmH3dZ499noX22ub8HZL308aD/Z4vfJP783Y3rFIXbnSl7l0qfOXy5c7ja2tzVkQkqFE4vPna3j9+mfY29s3AUIySCSxt7ePo6NfYk/P1UnT7O8AIR6OSIc7d75XMvsWe3v7TRCiUymSuHfvR1TbV0VmDPxEiswEBIkkHjyYpjTf6e7+tB+EcMJEEk+fPrNkghBKY1DD7dtfw8HBAaytrYNhwC4IoTR4Vx49milrfPjw15+Wl5cHjo72B0AIx0ltPbhgNjtvrWezc1ZKyzVlNFLq9vDW3NxCx9TUzznEYmZ9fePayMgwdHV1wfz8Qsvm5tqL7e3NLAihNBpGfiibXRjM5/enc7ncrmE0jJNYALT6R0TpH6NgVG5Q6T2uqrtK5GyhABMrK08egyAIgiAIgiAIgiAIgiAIgiAIgiAIgiAIgiC8NQyoIxCRZr59rsqgKjRL2FTFmQ1Hc5ByqiypMqvKtGEYMi/JixJoqnJXlR2MxyR9FuqAmkakjsAJVcZo/eUOwB8vALZUnL05tssnHwFc7a56qIwq39YyQmsmUkcSTRE2V/4EeJazxfkxMhR0DLs27LPIqTKkZOagBjRADVASqf+bOfwHzN8WAZ6sBEsMPkapLhat2qRj6mOzwy5SR+KUI3ErQTKSPKyoCyWZU7XoN1lF6j7RjURVJziGLQ986uNCWWSyzn3njsgJVWJJ/OGrm3Djxk3r7zCJOtOhULAqU5VvgBE2kTrdxn7fiBeJO9vrzlz2UIlWO6U4ujLHOVOcMyKtCKHROQnVJHr30SlOjAETLCJ1f3Vr/WWyftE+iE8EwkmJVBf14EPfydVXckUk3fbBxlasz7iSrL/1okweBrfp9CaJw8AAl8hBWuy9iv4Br0R7Q3SJnssh4howwCXSukiOktZeIUHby2oMbtPpzXKBziXSpEW1uxd0F55152+/SIQQwaXaBAYagYeqHb6vRLX4YvQ7GOjV23xkhknUf7MMNiwPLeh5F9VTM0HtFevuwq6GBxNIVHW6CaC5iR5qGGd+nlwRGQj6rVemb4Ug751MkERAn4OfITUVWS0Sibbm0r5hEn0v2BmpyWM0IorEphRAj5lQIrNM1j6ytF5RQ3iKJpXYnAZoSZ/DPnLtr/Lnj5Viwvo+93qx4sPoE3m07WK7uu75ENjgfR4ZtjEgD91YMuziXUdnu/dwnPnsgS21k468fvv6tfkdo0UNVK3N5zC1TzNo+N1bh0nkhlekXkSNstNIxLIO9exhE3nqVI2yj2dfZo+MEfk2oizKPsgr0IH3zgbLIyV2lFWTVxHpnLD3kYlTNYFETpl8vyLC+ZVIsD+0iNrPOfv+FyQStR9szkCi08YJV2rvWvdQGE1QLIkY3KbvZ1im+nGJzNEikiCIKRGC2xpTpe8+a7hELjUYEQUFRWlMiVQ32R3XEjDAJfIxpVmQzCj9nV+NGLxPutFN7VlggOvpD/2St3pcgI78m+jpHCYxbB/a3vGu/eRHcZFjSjRLROoTuZ/yfNuJdMbqEjFCJNL2VMqVeJ9rXjnbHHI9xW6VJgkc5eNHmVeUXg1s80Tjx1xzytnubPQJZWgAaKBvjdHfYaVEDG6j37K1xAznxHzWtxp0X7lYLIJJ84D03JxIURblgp1S+oP3VN1gXfIMcL4uwvqbjT6xIRWRubYWn1E8qkSsKnGI+50b9t+1dbqNkMwLrfZFs9s/6kVViVC+jdLZI3GkFu/a1MULS3k1+Bwe+aR60Ciut9F1YnsbQFurtSkH/7cXlgh9wvQ/IDLptD3SvtPq3tadkOlNe7rYbr8A0Pm+K5FeoRuolcS6Qb/UOem8qVksIubziH+/Rnx1iHhwaNevj+w2zY5+EdSEOkBeMxbqi38B9dDau6n0Hk0AAAAASUVORK5CYII=";class E5{constructor(e){f(this,"container");f(this,"virtualMouseSize",80);f(this,"_element");f(this,"_enabled",!1);f(this,"_listenersMap",Object.create(null));f(this,"_pointerDown",new xe);f(this,"_pointerCoord",new xe);f(this,"_offset",new xe);f(this,"_mouse",new xe);f(this,"_image");f(this,"_isContainerPointerDown",!1);this.container=e,this._element=document.createElement("div"),this._element.className="vengine-virtual-mouse",this._element.style.width=this.virtualMouseSize+"px",this._element.style.height=this.virtualMouseSize+"px",this._element.style.backgroundImage=`url(${$A})`,this._element.style.backgroundSize=`${this.virtualMouseSize}px ${this.virtualMouseSize}px`,this._element.setAttribute("data-event-trigger",$p.SELF),this.container.appendChild(this._element),this._onPointerEvent=this._onPointerEvent.bind(this),this._onOrientationchange=this._onOrientationchange.bind(this),this._onContainerPointerEvent=this._onContainerPointerEvent.bind(this)}get enabled(){return this._enabled}set enabled(e){Ot.isMobile&&e!==this._enabled&&(this._enabled=e,e?(this._preloadImage(),this._bindEvents(),this._centerMouse()):(this._removeEvents(),this._element.style.display="none"))}_preloadImage(){this._image||(this._image=new Image,this._image.src=S5)}_bindEvents(){this._element.addEventListener("pointerdown",this._onPointerEvent),this._element.addEventListener("pointermove",this._onPointerEvent),this._element.addEventListener("pointerup",this._onPointerEvent),window.addEventListener("orientationchange",this._onOrientationchange)}_removeEvents(){this._element.removeEventListener("pointerdown",this._onPointerEvent),this._element.removeEventListener("pointermove",this._onPointerEvent),this._element.removeEventListener("pointerup",this._onPointerEvent),window.removeEventListener("orientationchange",this._onOrientationchange)}_onOrientationchange(){setTimeout(()=>{this._centerMouse()},300)}_centerMouse(){this._element.style.left="50%",this._element.style.top="50%",this._element.style.display="block";const e=window.getComputedStyle(this._element),t=Number(e.getPropertyValue("left").slice(0,-2)),i=Number(e.getPropertyValue("top").slice(0,-2));this._mouse.set(t,i)}_onPointerEvent(e){e.cancelable&&e.preventDefault();const t={screenCoord:[],pointerType:e.pointerType,target:e.target,time:e.timeStamp,button:e.button,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey},i=e.type;switch(i){case si.POINTER_DOWN:this._pointerDown.set(e.clientX,e.clientY),this._pointerCoord.set(e.clientX,e.clientY),this._element.style.backgroundImage=`url(${this._image.src})`,t.screenCoord=this._mouse.toArray(),this._dispatchEvents(i,t);break;case si.POINTER_MOVE:this._offset.set(e.clientX-this._pointerCoord.x,e.clientY-this._pointerCoord.y),this._pointerCoord.set(e.clientX,e.clientY),this._mouse.add(this._offset),this._element.style.left=this._mouse.x+"px",this._element.style.top=this._mouse.y+"px",t.screenCoord=this._mouse.toArray(),this._dispatchEvents(i,t);break;case si.POINTER_UP:this._element.style.backgroundImage=`url(${$A})`,t.screenCoord=this._mouse.toArray(),this._dispatchEvents(i,t);const r=2*Ot.devicePixelRatio;Math.abs(Math.round(e.clientX)-this._pointerDown.x)<=r&&Math.abs(Math.round(e.clientY)-this._pointerDown.y)<=r&&this._dispatchEvents(si.CLICK,t);break}}_onContainerPointerEvent(e){const t={screenCoord:[],pointerType:e.pointerType,target:e.target,time:e.timeStamp,button:e.button,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey},i=e.type;switch(i){case si.POINTER_DOWN:this._isContainerPointerDown=!0;break;case si.POINTER_MOVE:this._isContainerPointerDown&&(t.screenCoord=this._mouse.toArray(),this._dispatchEvents(i,t));break;case si.POINTER_UP:this._isContainerPointerDown=!1;break}}_dispatchEvents(e,t){const i=this._listenersMap[e];if(!i||i.length===0)return;let r=i.slice(0);for(let s=0;s<r.length;s++)r[s](t);r=null}addEventListener(e,t){this._listenersMap[e]||(this._listenersMap[e]=[]),this._listenersMap[e].indexOf(t)===-1&&this._listenersMap[e].push(t)}removeEventListener(e,t){const i=this._listenersMap[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}destroy(){var e;this._removeEvents(),(e=this.container)==null||e.removeChild(this._element),ht(this)}}class T5{constructor(e){f(this,"element");f(this,"_hadListener",!1);f(this,"_listeners",[]);this.element=e,this._onWheelEvent=this._onWheelEvent.bind(this),this.onFocus()}_onWheelEvent(e){const t=this.element.getBoundingClientRect(),i={screenCoord:[e.clientX-t.left,e.clientY-t.top],deltaX:e.deltaX,deltaY:e.deltaY,deltaZ:e.deltaZ,time:e.timeStamp},r=this._listeners.slice(0);for(let s=0;s<r.length;s++)r[s](i)}addEventListener(e,t){e===si.WHEEL&&this._listeners.push(t)}removeEventListener(e,t){if(e!==si.WHEEL)return;const i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}onFocus(){this._hadListener||(this.element.addEventListener("wheel",this._onWheelEvent),this._hadListener=!0)}onBlur(){this._hadListener&&(this.element.removeEventListener("wheel",this._onWheelEvent),this._hadListener=!1)}destroy(){this.onBlur(),ht(this)}}class A5{constructor(e){f(this,"pointer");f(this,"wheel");f(this,"keyboard");f(this,"virtualMouse");f(this,"_hotkeysHandlerMap",Object.create(null));f(this,"_handleId",0);this.pointer=new x5(e),this.virtualMouse=new E5(e),this.wheel=new T5(e),this.keyboard=new b5(e)}get screenSpaceEvent(){return Ot.isMobile?this.virtualMouse:this.pointer}setHotkeys(e){const{command:t,key:i,onkeydown:r,onkeyup:s}=e;let o=this._hotkeysHandlerMap[t];o&&this.keyboard.removeHotkeys(o),o={id:++this._handleId,key:i,onkeydown:r,onkeyup:s},this._hotkeysHandlerMap[t]=o,this.keyboard.addHotkeys(o)}removeHotkeys(e){const t=this._hotkeysHandlerMap[e];t&&(this.keyboard.removeHotkeys(t),delete this._hotkeysHandlerMap[e])}destroy(){this.pointer.destroy(),this.wheel.destroy(),this.keyboard.destroy(),this.virtualMouse.destroy()}}Dt.prototype.enablePick=!0,Dt.prototype.pass=rr.OPAQUE,Dt.prototype.setModelMatrix=function(n){this.matrix.copy(n),this.matrix.decompose(this.position,this.quaternion,this.scale)},Dt.prototype.addObject=function(n){return this.add(n),n._collection=this,n},Dt.prototype.destroy=function(){return ht(this)},Dt.prototype.isDestroyed=function(){return!1};class Jp{constructor(e){f(this,"ready",!1);f(this,"pass");f(this,"commandList",[]);f(this,"camera");f(this,"cullingVolume");this.pass=e.pass,this.commandList=e.commandList,this.camera=e.camera,this.cullingVolume=e.cullingVolume}}class em{constructor(e){f(this,"_size");f(this,"_datatype");f(this,"getValue");this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}getDeclaration(e){let t=`uniform ${ln[this._datatype]} ${e}`;const i=this._size;return i===1?t+=";":t+=`[${i.toString()}];`,t}}const ln={};ln[bt.FLOAT]="float",ln[bt.FLOAT_VEC2]="vec2",ln[bt.FLOAT_VEC3]="vec3",ln[bt.FLOAT_VEC4]="vec4",ln[bt.INT]="int",ln[bt.INT_VEC2]="ivec2",ln[bt.INT_VEC3]="ivec3",ln[bt.INT_VEC4]="ivec4",ln[bt.BOOL]="bool",ln[bt.BOOL_VEC2]="bvec2",ln[bt.BOOL_VEC3]="bvec3",ln[bt.BOOL_VEC4]="bvec4",ln[bt.FLOAT_MAT2]="mat2",ln[bt.FLOAT_MAT3]="mat3",ln[bt.FLOAT_MAT4]="mat4",ln[bt.SAMPLER_2D]="sampler2D",ln[bt.SAMPLER_CUBE]="samplerCube";const M5={ve_frameNumber:new em({size:1,datatype:bt.FLOAT,getValue:n=>n.frameState.frameNumber}),ve_backgroundColor:new em({size:1,datatype:bt.FLOAT_VEC4,getValue:n=>n.backgroundColor}),ve_inverseView:new em({size:1,datatype:bt.FLOAT_MAT4,getValue:n=>n.inverseView}),ve_currentFrustum:new em({size:1,datatype:bt.FLOAT_VEC2,getValue:function(n){return n.currentFrustum}})},C5=new he;function I5(n){const e=[];for(const t in n)if(n.hasOwnProperty(t)){let i=t;const r=M5[i];if(!O(r))continue;e.push({automaticUniform:r,uniformName:i})}return{automaticUniforms:e}}const P5=(Ot.useWebGL2,Kf);class R5 extends P5{constructor(t={},i){i===Pt.SCENE3D&&(t.antialias=!0);super(t);f(this,"scene");f(this,"backgroundColor",new ve);f(this,"backgroundAlpha",1);f(this,"viewport",new nt);f(this,"useLogDepth",!1);const r=window.location.hostname==="localhost";this.debug.checkShaderErrors=r,this.useLogDepth=t.logarithmicDepthBuffer,this.domElement.style.outline="none",this.autoClear=!1,this.info.autoReset=!1,this.toneMapping=Uu,this.setPixelRatio(Ot.devicePixelRatio),i===Pt.SCENE3D&&(this.toneMapping=Vc,this.toneMappingExposure=2)}get drawingBufferSize(){return this.getDrawingBufferSize(C5)}setBackgroundColorFromString(t){this.backgroundColor.set(t)}execute(t){let i=t.uniforms,r=I5(i).automaticUniforms;for(let s of r)i[s.uniformName].value=s.automaticUniform.getValue(this.scene.context.uniformState)}}const Lo={DEPTH_COMPONENT:bt.DEPTH_COMPONENT,DEPTH_STENCIL:bt.DEPTH_STENCIL,ALPHA:bt.ALPHA,RGB:bt.RGB,RGBA:bt.RGBA,LUMINANCE:bt.LUMINANCE,LUMINANCE_ALPHA:bt.LUMINANCE_ALPHA,RGB_DXT1:bt.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:bt.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:bt.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:bt.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:bt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:bt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:bt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:bt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:bt.COMPRESSED_RGB_ETC1_WEBGL,componentsLength(n){switch(n){case Lo.RGB:return 3;case Lo.RGBA:return 4;case Lo.LUMINANCE_ALPHA:return 2;case Lo.ALPHA:case Lo.LUMINANCE:return 1;default:return 1}},createTypedArray(n,e,t,i){var r,s=Yi.sizeInBytes(e);s===Uint8Array.BYTES_PER_ELEMENT?r=Uint8Array:s===Uint16Array.BYTES_PER_ELEMENT?r=Uint16Array:s===Float32Array.BYTES_PER_ELEMENT&&e===Yi.FLOAT?r=Float32Array:r=Uint32Array;var o=Lo.componentsLength(n)*t*i;return new r(o)}};class D5{constructor(){f(this,"backgroundColor",new We);f(this,"frameState");f(this,"_farDepthFromNearPlusOne");f(this,"_log2FarDepthFromNearPlusOne");f(this,"_currentFrustum",new he)}get inverseView(){return this.frameState.camera.frustum.matrixWorld}get farDepthFromNearPlusOne(){return this._farDepthFromNearPlusOne}get log2FarDepthFromNearPlusOne(){return this._log2FarDepthFromNearPlusOne}get currentFrustum(){return this._currentFrustum}updateCamera(e){let{frustum:t}=e;this._farDepthFromNearPlusOne=t.far-t.near+1,this._log2FarDepthFromNearPlusOne=Math.log2(this._farDepthFromNearPlusOne),this.updateFrustum(e.frustum)}updateFrustum(e){this._currentFrustum.x=e.near,this._currentFrustum.y=e.far}update(e){this.backgroundColor.copy(e.backgroundColor),this.frameState=e,this.updateCamera(e.camera)}}new We;function L5(n,e){for(var t=e.length,i=0;i<t;++i){var r=n.getExtension(e[i]);if(r)return r}}class kv{constructor(e){f(this,"scene");f(this,"gl");f(this,"_colorRenderTarget");f(this,"_colorFrameBuffer");f(this,"_colorIdRenderTarget");f(this,"_overlayRenderTarget");f(this,"_depthRenderTarget");f(this,"pickFrameBuffer",new ji(1,1));f(this,"_nextPickColor",new Uint32Array(1));f(this,"_pickObjects",{});f(this,"_drawingPrimitives",{});f(this,"textureCache",{});f(this,"pickId",1);f(this,"uniformState",new D5);f(this,"_textureFloatLinear");f(this,"_depthBuffer",!1);this.scene=e,e.mode===Pt.SCENE3D&&(this._depthBuffer=!0);let t=this._depthBuffer,i=e.renderer.getContext();this.gl=i,this._textureFloatLinear=!!L5(i,["OES_texture_float_linear"]),console.log("support OES_texture_float_linear: ",this._textureFloatLinear),console.log("use WebGL2: ",Ot.useWebGL2),console.log("use mrt: ",Ot.useMRT);let{width:r,height:s}=e.drawingBufferSize;if(Ot.useWebGL2&&Ot.useMRT){let c=new Jw(r,s,2);for(let u=0,d=c.texture.length;u<d;u++)c.texture[u].minFilter=xi,c.texture[u].magFilter=xi,c.texture[u].format=Ti,c.texture[u].type=Ii;c.texture[0].name="diffuse",c.texture[1].name="pickColor",this._colorFrameBuffer=c}let o=this._textureFloatLinear?Ii:er;e.mode===Pt.SCENE3D&&(o=ar),this._colorRenderTarget=new ji(r,s,{format:Ti,type:er,depthBuffer:t,samples:Ot.useWebGL2?4:0}),this._colorRenderTarget.texture.name="colorBuffer";const a=e.renderer.capabilities;Rr._maxAnisotropy=a.getMaxAnisotropy(),Rr._maximumTextureImageUnits=a.maxTextures,Rr._maximumTextureSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);const l=i.getParameter(i.ALIASED_POINT_SIZE_RANGE);Rr._minimumAliasedPointSize=l[0],Rr._maximumAliasedPointSize=l[1],this.addCacheTexture(),this._colorIdRenderTarget=new ji(r,s,{format:Ti,depthBuffer:t,type:o,minFilter:xi,magFilter:xi}),this._colorIdRenderTarget.texture.name="colorIdBuffer",this._overlayRenderTarget=new ji(r,s,{format:Ti,type:o,minFilter:xi,magFilter:xi}),this._overlayRenderTarget.texture.name="overlayBuffer",t&&(this._colorIdRenderTarget.depthTexture=new Yf(r,s),this._colorIdRenderTarget.depthTexture.format=no,this._colorIdRenderTarget.depthTexture.type=Jo,this._depthRenderTarget=new ji(r,s,{stencilBuffer:!1}))}get colorRenderTarget(){return this._colorRenderTarget}get colorTexture(){return this._colorRenderTarget.texture}get colorIdTarget(){return this.scene.drawingMask.enabled?this.scene.effectComposerCollection.mainEffectComposer._colorIdWriteBuffer:this._colorIdRenderTarget}get colorIdTexture(){return this.colorIdTarget.texture}get renderer(){return this.scene.renderer}get webgl2(){return this.renderer.capabilities.isWebGL2}get textureFloatLinear(){return this._textureFloatLinear}get drawingBufferWidth(){return this.gl.drawingBufferWidth}get drawingBufferHeight(){return this.gl.drawingBufferHeight}addCacheTexture(){const e=[0,0,0,255,255,0,0,255,255,255,0,255,0,255,0,255,0,255,255,255,0,0,255,255,255,0,255,255,255,255,255,255,128,128,128,255,192,192,192,255,255,0,0,255,255,127,127,255,204,0,0,255,204,102,102,255,153,0,0,255,153,76,76,255,127,0,0,255,127,63,63,255,76,0,0,255,76,38,38,255,255,63,0,255,255,159,127,255,204,51,0,255,204,127,102,255,153,38,0,255,153,95,76,255,127,31,0,255,127,79,63,255,76,19,0,255,76,47,38,255,255,127,0,255,255,191,127,255,204,102,0,255,204,153,102,255,153,76,0,255,153,114,76,255,127,63,0,255,127,95,63,255,76,38,0,255,76,57,38,255,255,191,0,255,255,223,127,255,204,153,0,255,204,178,102,255,153,114,0,255,153,133,76,255,127,95,0,255,127,111,63,255,76,57,0,255,76,66,38,255,255,255,0,255,255,255,127,255,204,204,0,255,204,204,102,255,153,153,0,255,153,153,76,255,127,127,0,255,127,127,63,255,76,76,0,255,76,76,38,255,191,255,0,255,223,255,127,255,153,204,0,255,178,204,102,255,114,153,0,255,133,153,76,255,95,127,0,255,111,127,63,255,57,76,0,255,66,76,38,255,127,255,0,255,191,255,127,255,102,204,0,255,153,204,102,255,76,153,0,255,114,153,76,255,63,127,0,255,95,127,63,255,38,76,0,255,57,76,38,255,63,255,0,255,159,255,127,255,51,204,0,255,127,204,102,255,38,153,0,255,95,153,76,255,31,127,0,255,79,127,63,255,19,76,0,255,47,76,38,255,0,255,0,255,127,255,127,255,0,204,0,255,102,204,102,255,0,153,0,255,76,153,76,255,0,127,0,255,63,127,63,255,0,76,0,255,38,76,38,255,0,255,63,255,127,255,159,255,0,204,51,255,102,204,127,255,0,153,38,255,76,153,95,255,0,127,31,255,63,127,79,255,0,76,19,255,38,76,47,255,0,255,127,255,127,255,191,255,0,204,102,255,102,204,153,255,0,153,76,255,76,153,114,255,0,127,63,255,63,127,95,255,0,76,38,255,38,76,57,255,0,255,191,255,127,255,223,255,0,204,153,255,102,204,178,255,0,153,114,255,76,153,133,255,0,127,95,255,63,127,111,255,0,76,57,255,38,76,66,255,0,255,255,255,127,255,255,255,0,204,204,255,102,204,204,255,0,153,153,255,76,153,153,255,0,127,127,255,63,127,127,255,0,76,76,255,38,76,76,255,0,191,255,255,127,223,255,255,0,153,204,255,102,178,204,255,0,114,153,255,76,133,153,255,0,95,127,255,63,111,127,255,0,57,76,255,38,66,76,255,0,127,255,255,127,191,255,255,0,102,204,255,102,153,204,255,0,76,153,255,76,114,153,255,0,63,127,255,63,95,127,255,0,38,76,255,38,57,76,255,0,63,255,255,127,159,255,255,0,51,204,255,102,127,204,255,0,38,153,255,76,95,153,255,0,31,127,255,63,79,127,255,0,19,76,255,38,47,76,255,0,0,255,255,127,127,255,255,0,0,204,255,102,102,204,255,0,0,153,255,76,76,153,255,0,0,127,255,63,63,127,255,0,0,76,255,38,38,76,255,63,0,255,255,159,127,255,255,51,0,204,255,127,102,204,255,38,0,153,255,95,76,153,255,31,0,127,255,79,63,127,255,19,0,76,255,47,38,76,255,127,0,255,255,191,127,255,255,102,0,204,255,153,102,204,255,76,0,153,255,114,76,153,255,63,0,127,255,95,63,127,255,38,0,76,255,57,38,76,255,191,0,255,255,223,127,255,255,153,0,204,255,178,102,204,255,114,0,153,255,133,76,153,255,95,0,127,255,111,63,127,255,57,0,76,255,66,38,76,255,255,0,255,255,255,127,255,255,204,0,204,255,204,102,204,255,153,0,153,255,153,76,153,255,127,0,127,255,127,63,127,255,76,0,76,255,76,38,76,255,255,0,191,255,255,127,223,255,204,0,153,255,204,102,178,255,153,0,114,255,153,76,133,255,127,0,95,255,127,63,111,255,76,0,57,255,76,38,66,255,255,0,127,255,255,127,191,255,204,0,102,255,204,102,153,255,153,0,76,255,153,76,114,255,127,0,63,255,127,63,95,255,76,0,38,255,76,38,57,255,255,0,63,255,255,127,159,255,204,0,51,255,204,102,127,255,153,0,38,255,153,76,95,255,127,0,31,255,127,63,79,255,76,0,19,255,76,38,47,255,51,51,51,255,91,91,91,255,132,132,132,255,173,173,173,255,214,214,214,255,255,255,255,255],t=new An(new Uint8Array(e),16,16);t.name="dwgBaseColorTexture",t.needsUpdate=!0,this.textureCache.dwgBaseColorTexture=t}createPickId(e){++this._nextPickColor[0];const t=this._nextPickColor[0];if(t===0)throw new Ze("pick id");return this._pickObjects[t]=e,new JA(this._pickObjects,t,new We(t,0,0,0))}createPickColorSafeRange(e){++this._nextPickColor[0];const t=this._nextPickColor[0];if(t===0)throw new Ze("pick id");this._pickObjects[t]=e;let i=We.fromRgba(t,new We);return O(e.pickColor)||(e.pickColor=i),new JA(this._pickObjects,t,i)}removePickCommand(e){delete this._drawingPrimitives[e]}getObjectByPickColor(e){if(e.equals(We.TRANSPARENT)||e.equals(We.BLACK))return;let t;if(this._textureFloatLinear)t=e.x;else{if(e.x===void 0||e.y===void 0)return;t=e.x+(e.y<<8)}if(e.y===-1)return;let i=this._pickObjects[t];if(O(i))return O(i.primitive.unpackPickInfo)?i.primitive.unpackPickInfo(t,e):i}getObjectByPickColorSafeRange(e){let t=e.toRgba(),i=this._pickObjects[t];if(O(i))return O(i.primitive.unpackPickInfo)?i.primitive.unpackPickInfo(i):i}setSize(){var i;let{width:e,height:t}=this.scene.drawingBufferSize;this._colorRenderTarget.setSize(e,t),this._colorIdRenderTarget.setSize(e,t),(i=this._depthRenderTarget)==null||i.setSize(e,t)}draw(){}readPixels(e){let{gl:t}=this,i=Math.max(ye(e.x,0),0),r=Math.max(ye(e.y,0),0),s=ye(e.width,t.drawingBufferWidth),o=ye(e.height,t.drawingBufferHeight),a=e.renderTarget,l=Yi.UNSIGNED_BYTE,c=Lo.createTypedArray(Lo.RGBA,l,s,o);return this.renderer.readRenderTargetPixels(a,i,r,s,o,c),c}isDestroyed(){return!1}destroy(){return ht(this)}}f(kv,"DwgPackLength",1),f(kv,"DwgPackIndexInfo",{meshId:0});class JA{constructor(e,t,i){f(this,"_pickObjects");f(this,"key");f(this,"color");this._pickObjects=e,this.key=t,this.color=i}get object(){return this._pickObjects[this.key]}set object(e){this._pickObjects[this.key]=e}isDestroyed(){return!1}destroy(){return delete this._pickObjects[this.key],ht(this)}}class O5 extends zi{constructor(t=1){super();f(this,"_pickId");f(this,"colorCommand");f(this,"_pickMaterial",new rn({toneMapped:!1,fog:!1,blending:Es,depthTest:!0}));f(this,"material",new rn({vertexColors:!0,toneMapped:!1,depthTest:!0}));f(this,"m1");f(this,"modelMatrix",new fe().identity());this.scale.set(t,t,t);const i=[0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new Tt;s.setAttribute("position",new $e(i,3).onUpload(cc)),s.setAttribute("color",new $e(r,3).onUpload(cc)),this.material.onBeforeCompile=o=>{if(!Ot.useWebGL2)return;let{fragmentShader:a}=o;a=_n.replaceMain(a,"outputColor"),o.fragmentShader=`
            layout(location=1)out vec4 gPickColor;
            ${a}
                void main(){
                    outputColor();
                    gPickColor = vec4(0.0);
                }
            `},this.colorCommand=new Cn(s,this.material),this.colorCommand.pass=rr.OPAQUE,this.colorCommand.owner=this,this.addObject(this.colorCommand)}get pickColor(){return this._pickId.color}unpackPickInfo(t){return{primitive:this,pickColor:this._pickId.color}}update(t){if(this.visible){if(!O(this._pickId)){this._pickId=t.context.createPickId({primitive:this});let i=this._pickId.color;this._pickMaterial.color.setRGB(i.x,i.y,i.z),this._pickMaterial.opacity=i.w}t.passes.pick?this.colorCommand.material=this._pickMaterial:t.passes.render&&(this.colorCommand.material=this.material),t.commandList.push(this)}}isDestroyed(){return!1}destroy(){return this.colorCommand.geometry.dispose(),this._pickMaterial.dispose(),this.material.dispose(),ht(this)}}class tm{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const N5=new Ns(-1,1,1,-1,0,1);class B5 extends Tt{constructor(){super(),this.setAttribute("position",new $e([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new $e([0,2,0,0,2,0],2))}}const F5=new B5;class im{constructor(e){this._mesh=new pt(F5,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,N5)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Ec extends tm{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof wi?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Tn.clone(e.uniforms),this.material=new wi({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new im(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const U5={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new xe(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		// FXAA algorithm from NVIDIA, C# implementation by Jasper Flick, GLSL port by Dave Hoskins
		// http://developer.download.nvidia.com/assets/gamedev/files/sdk/11/FXAA_WhitePaper.pdf
		// https://catlikecoding.com/unity/tutorials/advanced-rendering/fxaa/

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;

		#define EDGE_STEP_COUNT 6
		#define EDGE_GUESS 8.0
		#define EDGE_STEPS 1.0, 1.5, 2.0, 2.0, 2.0, 4.0
		const float edgeSteps[EDGE_STEP_COUNT] = float[EDGE_STEP_COUNT]( EDGE_STEPS );

		float _ContrastThreshold = 0.0312;
		float _RelativeThreshold = 0.063;
		float _SubpixelBlending = 1.0;

		vec4 Sample( sampler2D  tex2D, vec2 uv ) {

			return texture( tex2D, uv );

		}

		float SampleLuminance( sampler2D tex2D, vec2 uv ) {

			return dot( Sample( tex2D, uv ).rgb, vec3( 0.3, 0.59, 0.11 ) );

		}

		float SampleLuminance( sampler2D tex2D, vec2 texSize, vec2 uv, float uOffset, float vOffset ) {

			uv += texSize * vec2(uOffset, vOffset);
			return SampleLuminance(tex2D, uv);

		}

		struct LuminanceData {

			float m, n, e, s, w;
			float ne, nw, se, sw;
			float highest, lowest, contrast;

		};

		LuminanceData SampleLuminanceNeighborhood( sampler2D tex2D, vec2 texSize, vec2 uv ) {

			LuminanceData l;
			l.m = SampleLuminance( tex2D, uv );
			l.n = SampleLuminance( tex2D, texSize, uv,  0.0,  1.0 );
			l.e = SampleLuminance( tex2D, texSize, uv,  1.0,  0.0 );
			l.s = SampleLuminance( tex2D, texSize, uv,  0.0, -1.0 );
			l.w = SampleLuminance( tex2D, texSize, uv, -1.0,  0.0 );

			l.ne = SampleLuminance( tex2D, texSize, uv,  1.0,  1.0 );
			l.nw = SampleLuminance( tex2D, texSize, uv, -1.0,  1.0 );
			l.se = SampleLuminance( tex2D, texSize, uv,  1.0, -1.0 );
			l.sw = SampleLuminance( tex2D, texSize, uv, -1.0, -1.0 );

			l.highest = max( max( max( max( l.n, l.e ), l.s ), l.w ), l.m );
			l.lowest = min( min( min( min( l.n, l.e ), l.s ), l.w ), l.m );
			l.contrast = l.highest - l.lowest;
			return l;

		}

		bool ShouldSkipPixel( LuminanceData l ) {

			float threshold = max( _ContrastThreshold, _RelativeThreshold * l.highest );
			return l.contrast < threshold;

		}

		float DeterminePixelBlendFactor( LuminanceData l ) {

			float f = 2.0 * ( l.n + l.e + l.s + l.w );
			f += l.ne + l.nw + l.se + l.sw;
			f *= 1.0 / 12.0;
			f = abs( f - l.m );
			f = clamp( f / l.contrast, 0.0, 1.0 );

			float blendFactor = smoothstep( 0.0, 1.0, f );
			return blendFactor * blendFactor * _SubpixelBlending;

		}

		struct EdgeData {

			bool isHorizontal;
			float pixelStep;
			float oppositeLuminance, gradient;

		};

		EdgeData DetermineEdge( vec2 texSize, LuminanceData l ) {

			EdgeData e;
			float horizontal =
				abs( l.n + l.s - 2.0 * l.m ) * 2.0 +
				abs( l.ne + l.se - 2.0 * l.e ) +
				abs( l.nw + l.sw - 2.0 * l.w );
			float vertical =
				abs( l.e + l.w - 2.0 * l.m ) * 2.0 +
				abs( l.ne + l.nw - 2.0 * l.n ) +
				abs( l.se + l.sw - 2.0 * l.s );
			e.isHorizontal = horizontal >= vertical;

			float pLuminance = e.isHorizontal ? l.n : l.e;
			float nLuminance = e.isHorizontal ? l.s : l.w;
			float pGradient = abs( pLuminance - l.m );
			float nGradient = abs( nLuminance - l.m );

			e.pixelStep = e.isHorizontal ? texSize.y : texSize.x;
			
			if (pGradient < nGradient) {

				e.pixelStep = -e.pixelStep;
				e.oppositeLuminance = nLuminance;
				e.gradient = nGradient;

			} else {

				e.oppositeLuminance = pLuminance;
				e.gradient = pGradient;

			}

			return e;

		}

		float DetermineEdgeBlendFactor( sampler2D  tex2D, vec2 texSize, LuminanceData l, EdgeData e, vec2 uv ) {

			vec2 uvEdge = uv;
			vec2 edgeStep;
			if (e.isHorizontal) {

				uvEdge.y += e.pixelStep * 0.5;
				edgeStep = vec2( texSize.x, 0.0 );

			} else {

				uvEdge.x += e.pixelStep * 0.5;
				edgeStep = vec2( 0.0, texSize.y );

			}

			float edgeLuminance = ( l.m + e.oppositeLuminance ) * 0.5;
			float gradientThreshold = e.gradient * 0.25;

			vec2 puv = uvEdge + edgeStep * edgeSteps[0];
			float pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;
			bool pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;

			for ( int i = 1; i < EDGE_STEP_COUNT && !pAtEnd; i++ ) {

				puv += edgeStep * edgeSteps[i];
				pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;
				pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;

			}

			if ( !pAtEnd ) {

				puv += edgeStep * EDGE_GUESS;

			}

			vec2 nuv = uvEdge - edgeStep * edgeSteps[0];
			float nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;
			bool nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;

			for ( int i = 1; i < EDGE_STEP_COUNT && !nAtEnd; i++ ) {

				nuv -= edgeStep * edgeSteps[i];
				nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;
				nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;

			}

			if ( !nAtEnd ) {

				nuv -= edgeStep * EDGE_GUESS;

			}

			float pDistance, nDistance;
			if ( e.isHorizontal ) {

				pDistance = puv.x - uv.x;
				nDistance = uv.x - nuv.x;

			} else {
				
				pDistance = puv.y - uv.y;
				nDistance = uv.y - nuv.y;

			}

			float shortestDistance;
			bool deltaSign;
			if ( pDistance <= nDistance ) {

				shortestDistance = pDistance;
				deltaSign = pLuminanceDelta >= 0.0;

			} else {

				shortestDistance = nDistance;
				deltaSign = nLuminanceDelta >= 0.0;

			}

			if ( deltaSign == ( l.m - edgeLuminance >= 0.0 ) ) {

				return 0.0;

			}

			return 0.5 - shortestDistance / ( pDistance + nDistance );

		}

		vec4 ApplyFXAA( sampler2D  tex2D, vec2 texSize, vec2 uv ) {

			LuminanceData luminance = SampleLuminanceNeighborhood( tex2D, texSize, uv );
			if ( ShouldSkipPixel( luminance ) ) {

				return Sample( tex2D, uv );

			}

			float pixelBlend = DeterminePixelBlendFactor( luminance );
			EdgeData edge = DetermineEdge( texSize, luminance );
			float edgeBlend = DetermineEdgeBlendFactor( tex2D, texSize, luminance, edge, uv );
			float finalBlend = max( pixelBlend, edgeBlend );

			if (edge.isHorizontal) {

				uv.y += edge.pixelStep * finalBlend;

			} else {

				uv.x += edge.pixelStep * finalBlend;

			}

			return Sample( tex2D, uv );

		}

		void main() {

			gl_FragColor = ApplyFXAA( tDiffuse, resolution.xy, vUv );
			
		}`},k5={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};let eM=new ve;class z5 extends Ec{constructor(t){super({defines:{PERSPECTIVE_CAMERA:1},uniforms:{colorTexture:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:` varying vec2 vUv;

            void main() {

                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

            }`,fragmentShader:`
            uniform sampler2D colorTexture;
            uniform float cameraNear;
            uniform float cameraFar;

            varying vec2 vUv;

            vec4 czm_packDepth(float depth)
            {
                // See Aras Pranckeviius' post Encoding Floats to RGBA
                // http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/
                vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;
                enc = fract(enc);
                enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
                return enc;
            }
    
            void main() {
    
                gl_FragColor = czm_packDepth(texture2D(colorTexture, vUv).r);
            }`});f(this,"scene");f(this,"clearAlpha",1);f(this,"clearColor",16777215);f(this,"clear",!1);this.scene=t}render2(t){if(!this.enabled||this.scene.mode===Pt.SCENE2D)return;let i=t.getRenderTarget(),{scene:r}=this,{frustum:s}=r.camera;t.getClearColor(eM);let o=t.getClearAlpha();this.uniforms.colorTexture.value=r.context._colorIdRenderTarget.depthTexture,this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,this.fsQuad.material=this.material,this.clear&&(t.setClearColor(this.clearColor,this.clearAlpha),t.clear()),t.setRenderTarget(this.scene.context._depthRenderTarget),t.clear(),this.fsQuad.render(t),t.setClearColor(eM,o),t.setRenderTarget(i)}}const H5=`//\r
uniform sampler2D colorTexture;\r
uniform sampler2D idTexture;\r
uniform sampler2D selectedIdTexture;\r
uniform float selectedIdTextureStep;\r
uniform vec2 resolution;\r
varying vec2 v_textureCoordinates;\r
\r
#define SINGLE_SELECT 1\r
\r
#if(SELECTS==1)\r
//,\r
bool czm_selected(vec2 offset){\r
    bool selected=false;\r
    vec4 id=texture2D(idTexture,v_textureCoordinates+offset);\r
    vec4 selectedId=texture2D(selectedIdTexture,vec2((.5)*selectedIdTextureStep,.5));\r
    if(all(equal(id,selectedId))){\r
        return true;\r
    }\r
    return false;\r
}\r
#else\r
bool czm_selected(vec2 offset){\r
    bool selected=false;\r
    vec4 id=texture2D(idTexture,v_textureCoordinates+offset);\r
    for(int i=0;i<SELECTS;++i)\r
    {\r
        vec4 selectedId=texture2D(selectedIdTexture,vec2((float(i)+.5)*selectedIdTextureStep,.5));\r
        if(all(equal(id,selectedId))){\r
            return true;\r
        }\r
    }\r
    return false;\r
}\r
#endif\r
\r
bool czm_selected(){\r
    return czm_selected(vec2(0.));\r
}\r
\r
uniform vec3 background;\r
\r
uniform vec4 highlightColor;\r
\r
uniform sampler2D depthTexture;\r
uniform float readDepth;\r
uniform vec2 cameraNearFar;\r
\r
\r
 //  smoothStep \r
    float edgeThreshold = 0.01;\r
\r
    // 8\r
    float totalWeight = 0.0;\r
    float maxWeight = 8.0;\r
\r
    vec2 offsets[8] = vec2[](\r
        vec2(-1., -1.), vec2(-1., 0.), vec2(-1., 1.),\r
        vec2(0., -1.), vec2(0., 1.),\r
        vec2(1., -1.), vec2(1., 0.), vec2(1., 1.)\r
    );\r
\r
void main(){\r
    vec4 color=texture2D(colorTexture,v_textureCoordinates);\r
    \r
    vec2 texel=vec2(1./resolution.x,1./resolution.y);\r
    \r
    for (int i = 0; i < 8; ++i) {\r
        if (czm_selected(texel * offsets[i])) {\r
            totalWeight += 1.0;\r
        }\r
    };\r
\r
    // \r
    bool isEdge = !czm_selected() && totalWeight > 0.0;\r
\r
    //  smoothStep \r
    //  smoothStep \r
    float smoothFactor = isEdge ? smoothstep(0.0, edgeThreshold, totalWeight / maxWeight) : 0.0;\r
\r
    // \r
    gl_FragColor = mix(color, highlightColor, smoothFactor);\r
\r
}`;let nm={uniforms:{colorTexture:{value:null},colorTextureDimensions:{value:null},idTexture:{value:null},selectedIdTexture:{value:null},selectedIdTextureStep:{value:null},highlightColor:{value:new nt},resolution:{value:new xe},depthTexture:{value:null},readDepth:{value:0},cameraNearFar:{value:new xe},overlayMaskTexture:{value:null}},vertexShader:`

        varying vec2 v_textureCoordinates;

        void main() {

            v_textureCoordinates = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

        }`,fragmentShader:H5};new xe;let tM=new ve;class G5 extends Ec{constructor(t){super({uniforms:{colorTexture:{value:null},maskTexture:{value:null},ve_backgroundColor:{value:new We},drawingBufferSize:{value:new xe},mixScalar:{value:0}},vertexShader:nm.vertexShader,fragmentShader:`
            uniform sampler2D colorTexture;
            uniform sampler2D maskTexture;
            uniform vec4 ve_backgroundColor;
            uniform vec2 drawingBufferSize;
            uniform float mixScalar;

            varying vec2 v_textureCoordinates;


            bool czm_selected(vec2 offset){
                bool selected=false;
                vec4 id=texture2D(maskTexture,v_textureCoordinates+offset);
                if(id.r==1.){
                    return true;
                }
                return false;
            }

            bool czm_selected(){
                return czm_selected(vec2(0.));
            }

            bool selectAround(vec2 texel,float offset){
                return(czm_selected(texel*vec2(-1.*offset,-1.*offset))||czm_selected(texel*vec2(-1.*offset,0.))||czm_selected(texel*vec2(-1.*offset,1.*offset))||
                czm_selected(texel*vec2(0.,-1.*offset))||czm_selected(texel*vec2(0.,1.*offset))||
                czm_selected(texel*vec2(1.*offset,-1.*offset))||czm_selected(texel*vec2(1.*offset,0.))||czm_selected(texel*vec2(1.*offset,1.*offset)));
            }

            vec4 maskColor(vec4 currentColor,vec4 bgColor){

                vec2 texel=vec2(1./drawingBufferSize.x,1./drawingBufferSize.y);

                vec4 resultColor=currentColor;

                //8,
                if(
                    selectAround(texel,1.)
                    &&!czm_selected(texel*vec2(0.,0.))
                ){
                    // resultColor=currentColor;

                    resultColor=mix(currentColor,bgColor,mixScalar);

                }else{
                    // resultColor=bgColor;
                    resultColor=mix(bgColor,currentColor,mixScalar);
                }

                if(czm_selected()){
                    // resultColor=currentColor;

                    resultColor=mix(currentColor,bgColor,mixScalar);
                }

                return resultColor;
            }

            void main(){
                vec4 color=texture2D(colorTexture,v_textureCoordinates);

                gl_FragColor=maskColor(color,ve_backgroundColor);

                // gl_FragColor.rgb = mix(color.rgb, vec3(1.0,0.0,0.0), 0.4);
                // gl_FragColor.a = 1.0;

                // gl_FragColor = color;
            }
            `});f(this,"scene");f(this,"maskFrameBuffer",new ji(1,1,{format:(Ot.useWebGL2,Ti),stencilBuffer:!1,depthBuffer:!1}));f(this,"renderScene",new uh);f(this,"maskMap",new Map);f(this,"_maskMaterial",new Pi({color:16711680,depthTest:!0}));f(this,"mixScalar",0);f(this,"_composer");f(this,"_colorTmpRenderTarget",new ji);f(this,"_idTmpRenderTarget",new ji);this.scene=t;let{width:i,height:r}=t.drawingBufferSize;this.maskFrameBuffer.setSize(i,r),this.fsQuad=new im(this.material)}get renderer(){return this.scene.renderer}get renderTarget(){return this.maskFrameBuffer}setEnabled(t=!0){this.enabled!==t&&(this.enabled=t,this._composer.swapBuffers())}hasMask(t){return this.maskMap.has(t)}addMask(t,i,r=new Mt().identity()){let s=new pt(i,this._maskMaterial);s.applyMatrix4(r),this.renderScene.add(s),this.maskMap.set(t,s)}removeMask(t){let i=this.maskMap.get(t);this.renderScene.remove(i),i.geometry.dispose(),this.maskMap.delete(t)}removeAll(){for(let t of this.maskMap.keys())this.removeMask(t);this.renderScene.children=[]}setSize(t,i){this.maskFrameBuffer.setSize(t,i)}renderMaskFrameBuffer(){if(!this.enabled||this.maskMap.size===0){this.enabled=!1;return}let t=this.scene,i=t.renderer,r=i.getRenderTarget(),s=i.getClearAlpha(),o=i.xr.enabled,a=i.shadowMap.autoUpdate,l=i.toneMapping;i.getClearColor(tM),i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.toneMapping=xr,i.setClearColor(0,1),i.setRenderTarget(this.maskFrameBuffer),i.autoClear===!1&&i.clear(),i.render(this.renderScene,t.camera.frustum),i.toneMapping=l,i.xr.enabled=o,i.shadowMap.autoUpdate=a,i.setClearColor(tM,s),i.setRenderTarget(r)}executeMask(t){}render2(){if(this._composer.swapBuffers(),!this.enabled||this.maskMap.size===0){this.enabled=!1;return}let{_composer:t}=this;const i=this.scene.context,r=this.scene.renderer;Ot.useMRT||(t._writeBuffer.texture.name!=="colorBuffer2"&&this._composer.swapBuffers(),this.uniforms.mixScalar.value=this.mixScalar,this.uniforms.drawingBufferSize.value.copy(this.scene.drawingBufferSize),this.uniforms.maskTexture.value=this.maskFrameBuffer.texture,r.setRenderTarget(t._writeBuffer),r.clear(),this.uniforms.colorTexture.value=i.colorRenderTarget.texture,r.execute({uniforms:this.uniforms}),this.fsQuad.render(r)),this._composer.swapBuffers()}renderColorIdMask(){let{_composer:t}=this;if(!t.drawingMaskPass.enabled)return;const i=this.scene.context,r=this.scene.renderer;r.setRenderTarget(t._colorIdWriteBuffer),r.clear(),this.uniforms.colorTexture.value=i._colorIdRenderTarget.texture,r.execute({uniforms:this.uniforms}),this.fsQuad.render(r)}isDestroyed(){return!1}destroy(){return this.removeAll(),this._maskMaterial.dispose(),this.maskFrameBuffer.dispose(),ht(this)}}let zv=new ve;class V5 extends tm{constructor(t){super();f(this,"selectObjects",[]);f(this,"_clearCallback",[]);this.scene=t}executeClearCallback(){this._clearCallback.forEach(t=>t()),this._clearCallback=[]}clearBuffer(){let t=this.scene,i=t.renderer,r=i.getRenderTarget(),s=i.getClearColor(zv);i.setRenderTarget(t.context._overlayRenderTarget),i.setClearColor(0,1),i.clear(),i.setRenderTarget(r),i.setClearColor(s)}render2(t){if(!this.enabled||this.selectObjects.length===0)return;t.autoClear=!1;let i=this.scene;i.frameState;let r=t.getRenderTarget(),s=t.getClearAlpha(),o=t.xr.enabled,a=t.shadowMap.autoUpdate,l=t.toneMapping,c=i.lightCollection.visible;t.getClearColor(zv),t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.toneMapping=xr,t.setClearColor(0,0),t.setRenderTarget(i.context._overlayRenderTarget),t.autoClear===!1&&t.clear(),i.lightCollection.visible=!1,i.lightCollection.update(i.frameState),this.selectObjects=this.selectObjects.filter(u=>!u.isDestroyed()&&u.getOverlayRenderInstance);for(let u=0;u<this.selectObjects.length;u++)i.add(this.selectObjects[u].getOverlayRenderInstance());t.render(i,i.camera.frustum),i.clear(),t.toneMapping=l,t.xr.enabled=o,t.shadowMap.autoUpdate=a,t.setClearColor(zv,s),t.setRenderTarget(r),i.lightCollection.visible=c}}let iM=new ve;class W5 extends tm{constructor(t){super();f(this,"_composer");this.scene=t}get camera(){return this.scene.camera}render2(t){if(!this.enabled)return;t.autoClear=!1;let i=this.scene,r=i.frameState,s=t.getRenderTarget(),o=t.getClearAlpha(),a=t.xr.enabled,l=t.shadowMap.autoUpdate,c=t.toneMapping;t.getClearColor(iM),t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.toneMapping=xr,r.passes.pick=!0,i.updateAndExecuteCommands(!1),t.setClearColor(0,0),t.setRenderTarget(i.context._colorIdRenderTarget),t.autoClear===!1&&t.clear(),i.lightCollection.update(i.frameState),i.addObject(i.drawingRenderCollection),i.addObject(i.renderCollection),t.render(i,i.camera.frustum),i.remove(i.drawingRenderCollection),i.remove(i.renderCollection),this._composer.drawingMaskPass.renderColorIdMask(),r.passes.pick=!1,t.toneMapping=c,t.xr.enabled=a,t.shadowMap.autoUpdate=l,t.setClearColor(iM,o),t.setRenderTarget(s)}isDestroyed(){return!1}destroy(){return this._composer=null,ht(this)}}class X5 extends tm{constructor(t,i,r,s=0){super();f(this,"scene");f(this,"camera");f(this,"clearColor");f(this,"clearAlpha");f(this,"overrideMaterial");f(this,"clear",!0);f(this,"clearDepth",!0);f(this,"needsSwap",!1);f(this,"_oldClearColor",new ve);f(this,"_composer");this.scene=t,this.camera=t.camera,this.clearColor=r,this.clearAlpha=s!==void 0?s:0}render2(t,i,r){const{scene:s,overrideMaterial:o,clearColor:a,clearAlpha:l,clearDepth:c,renderToScreen:u}=this,d=s.context,p=t.autoClear;t.autoClear=!1;let g,_;o!==void 0&&(_=s.overrideMaterial,s.overrideMaterial=o),Ot.useWebGL2&&Ot.useMRT&&(t.getClearColor(this._oldClearColor),g=t.getClearAlpha(),t.setClearColor(a,l)),c&&t.clearDepth();const x=Ot.useMRT?d._colorFrameBuffer:this._composer._readBuffer;t.setRenderTarget(u?null:x),t.setClearColor(t.backgroundColor,t.backgroundAlpha),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this._composer.drawingMaskPass.enabled?(s._renderObjectCollection(s.drawingRenderCollection),this._composer.drawingMaskPass.render2(),t.setRenderTarget(this._composer._readBuffer),s._renderObjectCollection(s.renderCollection)):(s.addObject(s.drawingRenderCollection),s.addObject(s.renderCollection),t.render(s,s.camera.frustum),s.remove(s.drawingRenderCollection),s.remove(s.renderCollection)),a&&t.setClearColor(this._oldClearColor,g),this.overrideMaterial!==void 0&&(s.overrideMaterial=_),t.autoClear=p}}class Y5{constructor(e){f(this,"scene");f(this,"_pixelRatio",1);f(this,"_width");f(this,"_height");f(this,"renderToScreen",!0);f(this,"passes",[]);f(this,"copyPass",new Ec(k5));f(this,"clock",new Hd);f(this,"renderPass");f(this,"colorCopyPass");f(this,"idCopyPass");f(this,"drawingMaskPass");f(this,"overlayRenderPass");f(this,"depthRenderPass");f(this,"pickRenderPass");f(this,"_writeBuffer",new ji);f(this,"_readBuffer");f(this,"_colorIdWriteBuffer");this.scene=e;let{_colorFrameBuffer:t,colorRenderTarget:i}=e.context,r=e.drawingBufferSize;this._width=r.width,this._height=r.height;let s=new X5(e,void 0,0,0);this.addPass(s),this.renderPass=s,Ot.useMRT||(this.overlayRenderPass=new V5(e),this.addPass(this.overlayRenderPass),this.pickRenderPass=new W5(e),this.addPass(this.pickRenderPass),this.depthRenderPass=new z5(e),this.addPass(this.depthRenderPass)),this.drawingMaskPass=new G5(e),this.drawingMaskPass._composer=this,this._readBuffer=i,this._writeBuffer=this._readBuffer.clone(),this._writeBuffer.texture.name="colorBuffer2",this._colorIdWriteBuffer=e.context._colorIdRenderTarget.clone(),this._colorIdWriteBuffer.texture.name="colorIdBuffer2"}get renderer(){return this.scene.renderer}get renderTarget(){return this.scene.context.colorRenderTarget}get idRenderTarget(){return this.drawingMaskPass.enabled?this._colorIdWriteBuffer:this.scene.context._colorIdRenderTarget}swapBuffers(){const e=this._readBuffer;this._readBuffer=this._writeBuffer,this._writeBuffer=e}addPass(e){this.passes.push(e),e._composer=this,e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render2(e=this.clock.getDelta()){let{renderer:t,drawingMaskPass:i,passes:r}=this;i.renderMaskFrameBuffer();const s=t.getRenderTarget();for(let o=0,a=r.length;o<a;o++){const l=r[o];l.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(o),l.render2(this.renderer,this._writeBuffer,this._readBuffer)}t.setRenderTarget(s),this._writeBuffer.dispose()}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r);this._writeBuffer.setSize(i,r),this._readBuffer.setSize(i,r),this._colorIdWriteBuffer.setSize(i,r),this.drawingMaskPass.setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.copyPass.dispose()}}new Ns(-1,1,1,-1,0,1);const nM=new Tt;nM.setAttribute("position",new $e([-1,3,0,-1,-1,0,3,-1,0],3)),nM.setAttribute("uv",new $e([0,2,0,0,2,0],2));const j5=`//\r
uniform sampler2D colorTexture;\r
uniform sampler2D idTexture;\r
uniform sampler2D selectedIdTexture;\r
uniform sampler2D overlayMaskTexture;\r
\r
uniform float selectedIdTextureStep;\r
uniform vec2 resolution;\r
varying vec2 v_textureCoordinates;\r
\r
#define SINGLE_SELECT 1\r
\r
#if(SELECTS==1)\r
//,\r
bool czm_selected(vec2 offset){\r
    bool selected=false;\r
    vec4 id=texture2D(idTexture,v_textureCoordinates+offset);\r
    vec4 selectedId=texture2D(selectedIdTexture,vec2((.5)*selectedIdTextureStep,.5));\r
    if(all(equal(id,selectedId))){\r
        return true;\r
    }\r
    return false;\r
}\r
#else\r
bool czm_selected(vec2 offset){\r
    bool selected=false;\r
    vec4 id=texture2D(idTexture,v_textureCoordinates+offset);\r
    for(int i=0;i<SELECTS;++i)\r
    {\r
        vec4 selectedId=texture2D(selectedIdTexture,vec2((float(i)+.5)*selectedIdTextureStep,.5));\r
        if(all(equal(id,selectedId))){\r
            return true;\r
        }\r
    }\r
    return false;\r
}\r
#endif\r
\r
bool czm_selected(){\r
    return czm_selected(vec2(0.));\r
}\r
\r
uniform vec3 background;\r
\r
uniform vec4 highlightColor;\r
uniform vec4 depthFailedColor;\r
\r
uniform sampler2D depthTexture;\r
uniform float readDepth;\r
uniform vec2 cameraNearFar;\r
\r
void main(){\r
    vec4 color=texture2D(colorTexture,v_textureCoordinates);\r
\r
    vec4 maskColor = texture2D(overlayMaskTexture, v_textureCoordinates);\r
    \r
    vec2 texel=vec2(1./resolution.x,1./resolution.y);\r
    \r
    //8,\r
    if(\r
        (czm_selected(texel*vec2(-1.,-1.))||czm_selected(texel*vec2(-1.,0.))||czm_selected(texel*vec2(-1.,1.))||\r
        czm_selected(texel*vec2(0.,-1.))||czm_selected(texel*vec2(0.,1.))||\r
        czm_selected(texel*vec2(1.,-1.))||czm_selected(texel*vec2(1.,0.))||czm_selected(texel*vec2(1.,1.)))\r
        &&!czm_selected(texel*vec2(0.,0.))\r
    ){\r
        \r
      \r
        gl_FragColor = vec4(highlightColor.rgb, 1.0);\r
    }else{\r
        gl_FragColor=color;\r
    }\r
\r
    if(czm_selected()) {\r
        gl_FragColor.rgb = mix(gl_FragColor.rgb, highlightColor.rgb, highlightColor.a);\r
\r
        // gl_FragColor.rgb = mix(vec3(1.0)-gl_FragColor.rgb, highlightColor.rgb, sin(czm_frameNumber / 20.0) * .3 + .3);\r
    } else if(maskColor.r > 0.) {\r
        gl_FragColor.rgb = mix(gl_FragColor.rgb, depthFailedColor.rgb, depthFailedColor.a);\r
\r
        // gl_FragColor = depthFailedColor;\r
        \r
    }\r
\r
}`;let rm={uniforms:{colorTexture:{value:null},colorTextureDimensions:{value:null},idTexture:{value:null},selectedIdTexture:{value:null},selectedIdTextureStep:{value:null},highlightColor:{value:new nt},resolution:{value:new xe},depthTexture:{value:null},readDepth:{value:0},cameraNearFar:{value:new xe},overlayMaskTexture:{value:null},depthFailedColor:{value:new nt}},vertexShader:`

        varying vec2 v_textureCoordinates;

        void main() {

            v_textureCoordinates = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

        }`,fragmentShader:j5};const du=new Uint8Array(4);du[0]=255,du[1]=255,du[2]=255,du[3]=255;let Hv=new An(du,1,1);Hv.needsUpdate=!0,_n.replaceMain(rm.fragmentShader,"outputColor");class q5 extends Ec{constructor(t){super({uniforms:Tn.clone(rm.uniforms),vertexShader:rm.vertexShader,fragmentShader:rm.fragmentShader,transparent:!0,defines:{FILL_COLOR:"",SELECTS:1}});f(this,"scene");f(this,"selectIdTexture");f(this,"selectColor",[]);f(this,"selectedIdTextureStep",0);f(this,"_composer");this.scene=t,this.uniforms.highlightColor.value=new Gt(0,1,1,.3),this.uniforms.depthFailedColor.value=new Gt(1,0,0,0),this.fsQuad=new im(this.material)}get highlightColor(){return this.uniforms.highlightColor.value}set highlightColor(t){this.uniforms.highlightColor.value.copy(t)}get depthFailedColor(){return this.uniforms.depthFailedColor.value}set depthFailedColor(t){this.uniforms.depthFailedColor.value.copy(t)}addSelectColorId(t){this.selectColor.push([t.x,t.y,t.z,t.w])}clearSelectColorId(){this.selectColor=[]}updateSelectTexture(){if(O(this.selectIdTexture)&&this.selectIdTexture!==Hv&&(this.selectIdTexture.image.data=null,this.selectIdTexture.dispose(),this.selectIdTexture=null),!O(this.selectColor)||this.selectColor.length===0){this.selectIdTexture=Hv,this.material.defines.SELECTS!==1&&(this.material.defines.SELECTS=1,this.material.needsUpdate=!0);return}let t=this.selectColor.length,i=new Float32Array(t*4);for(let r=0;r<this.selectColor.length;r++)i[r*4]=this.selectColor[r][0],i[r*4+1]=this.selectColor[r][1],i[r*4+2]=this.selectColor[r][2],i[r*4+3]=this.selectColor[r][3];this.selectIdTexture=new An(i,t,1,Ti,Ii),this.selectIdTexture.needsUpdate=!0,this.selectedIdTextureStep=1/t,this.material.defines.SELECTS!==t&&(this.material.defines.SELECTS=t,this.material.needsUpdate=!0),this.material.needsUpdate=!0}render2(t){if(!this.enabled)return;let i=this.scene.context;Ot.useWebGL2&&Ot.useMRT?(this.updateSelectTexture(),this.uniforms.resolution.value.copy(this.scene.drawingBufferSize),this.uniforms.colorTexture.value=this.scene.context.colorRenderTarget.texture,this.uniforms.idTexture.value=this.scene.context._colorFrameBuffer.texture[1],this.uniforms.selectedIdTexture.value=this.selectIdTexture,this.uniforms.selectedIdTextureStep.value=this.selectedIdTextureStep,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(this.scene.context.colorRenderTarget),this.clear&&t.clear(),this.fsQuad.render(t))):(this.updateSelectTexture(),this.uniforms.resolution.value.copy(this.scene.drawingBufferSize),this.uniforms.colorTexture.value=this._composer._readBuffer.texture,this.uniforms.idTexture.value=i.colorIdTarget.texture,this.uniforms.selectedIdTexture.value=this.selectIdTexture,this.uniforms.selectedIdTextureStep.value=this.selectedIdTextureStep,this.uniforms.overlayMaskTexture.value=this.scene.context._overlayRenderTarget.texture,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(this._composer._writeBuffer),this.clear&&t.clear(),this.fsQuad.render(t)))}isDestroyed(){return!1}destroy(){return this._composer=null,this.selectIdTexture.dispose(),ht(this)}}const pu=new Uint8Array(4);pu[0]=255,pu[1]=255,pu[2]=255,pu[3]=255;let Gv=new An(pu,1,1);Gv.needsUpdate=!0;class Z5 extends Ec{constructor(t){super({uniforms:Tn.clone(nm.uniforms),vertexShader:nm.vertexShader,fragmentShader:nm.fragmentShader,defines:{SELECTS:1},glslVersion:Sf});f(this,"scene");f(this,"selectIdTexture");f(this,"selectColor",[]);f(this,"selectedIdTextureStep",0);f(this,"_composer");f(this,"_toneMapping");f(this,"_outputColorSpace");this.scene=t,this.uniforms.highlightColor.value=new Gt(0,182/255,1,.6),this.fsQuad=new im(this.material)}get highlightColor(){return this.uniforms.highlightColor.value}set highlightColor(t){this.uniforms.highlightColor.value.copy(t)}addSelectColorId(t){this.selectColor.push([t.x,t.y,t.z,t.w])}clearSelectColorId(){this.selectColor=[]}updateSelectTexture(){if(O(this.selectIdTexture)&&this.selectIdTexture!==Gv&&(this.selectIdTexture.image.data=null,this.selectIdTexture.dispose(),this.selectIdTexture=null),!O(this.selectColor)||this.selectColor.length===0){this.selectIdTexture=Gv,this.material.defines.SELECTS!==1&&(this.material.defines.SELECTS=1,this.material.needsUpdate=!0);return}let t=this.selectColor.length,i=new Float32Array(t*4);for(let r=0;r<this.selectColor.length;r++)i[r*4]=this.selectColor[r][0],i[r*4+1]=this.selectColor[r][1],i[r*4+2]=this.selectColor[r][2],i[r*4+3]=this.selectColor[r][3];this.selectIdTexture=new An(i,t,1,Ti,Ii),this.selectIdTexture.needsUpdate=!0,this.selectedIdTextureStep=1/t,this.material.defines.SELECTS!==t&&(this.material.defines.SELECTS=t,this.material.needsUpdate=!0),this.material.needsUpdate=!0}render2(t){if(!this.enabled)return;let i=this.scene.context;Ot.useMRT?(this.updateSelectTexture(),this.uniforms.resolution.value.copy(this.scene.drawingBufferSize),this.uniforms.colorTexture.value=this.scene.context._colorFrameBuffer.texture[0],this.uniforms.idTexture.value=this.scene.context._colorFrameBuffer.texture[1],this.uniforms.selectedIdTexture.value=this.selectIdTexture,this.uniforms.selectedIdTextureStep.value=this.selectedIdTextureStep,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(this.scene.context.colorRenderTarget),this.clear&&t.clear(),this.fsQuad.render(t))):(this.updateSelectTexture(),this.uniforms.resolution.value.copy(this.scene.drawingBufferSize),this.uniforms.colorTexture.value=this._composer._readBuffer.texture,this.uniforms.idTexture.value=i.colorIdTarget.texture,this.uniforms.selectedIdTexture.value=this.selectIdTexture,this.uniforms.selectedIdTextureStep.value=this.selectedIdTextureStep,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(this._composer._writeBuffer),this.clear&&t.clear(),this.fsQuad.render(t)),this._composer.swapBuffers())}isDestroyed(){return!1}destroy(){return this._composer=null,this.selectIdTexture.dispose(),ht(this)}}class K5{constructor(e){f(this,"scene");f(this,"mainEffectComposer");f(this,"renderPass");f(this,"fxaaPass",new Ec(U5));f(this,"selectOutlinePass");f(this,"selectFillColorPass");this.scene=e,this.mainEffectComposer=new Y5(e),this.selectOutlinePass=new Z5(e),this.addPass(this.selectOutlinePass),this.selectFillColorPass=new q5(e),this.addPass(this.selectFillColorPass)}get renderer(){return this.scene.renderer}addPass(e){let t=this.mainEffectComposer;t.passes.push(e),e._composer=t,e.setSize(t._width*t._pixelRatio,t._height*t._pixelRatio)}setSize(){let{width:e,height:t}=this.scene.drawingBufferSize;this.mainEffectComposer.setSize(e,t)}render(){this.mainEffectComposer.render2()}}class Q5{constructor(e){f(this,"time");f(this,"frameNumber",0);f(this,"pixelRatio",1);f(this,"newFrame",!1);f(this,"scene");f(this,"commandList",[]);f(this,"passes",{render:!1,pick:!1,depth:!1,lineIndex:!1});f(this,"camera");f(this,"afterRender",[]);f(this,"context");f(this,"backgroundColor",new We);f(this,"tilesetPassState");f(this,"cullingVolume");f(this,"deltaTime");this.scene=e,this.context=e.context,this.camera=e.camera}get renderer(){return this.scene.renderer}get mode(){return this.scene.mode}}class $5 extends xw{constructor(e){super(e),this.type=er}parse(e){const o=function(L,P){switch(L){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(P||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(P||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(P||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(P||""))}},u=`
`,d=function(L,P,R){P=P||1024;let j=L.pos,A=-1,D=0,k="",G=String.fromCharCode.apply(null,new Uint16Array(L.subarray(j,j+128)));for(;0>(A=G.indexOf(u))&&D<P&&j<L.byteLength;)k+=G,D+=G.length,j+=128,G+=String.fromCharCode.apply(null,new Uint16Array(L.subarray(j,j+128)));return-1<A?(R!==!1&&(L.pos+=D+A+1),k+G.slice(0,A)):!1},p=function(L){const P=/^#\?(\S+)/,R=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,j=/^\s*FORMAT=(\S+)\s*$/,A=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,D={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let k,G;for((L.pos>=L.byteLength||!(k=d(L)))&&o(1,"no header found"),(G=k.match(P))||o(3,"bad initial token"),D.valid|=1,D.programtype=G[1],D.string+=k+`
`;k=d(L),k!==!1;){if(D.string+=k+`
`,k.charAt(0)==="#"){D.comments+=k+`
`;continue}if((G=k.match(R))&&(D.gamma=parseFloat(G[1])),(G=k.match(U))&&(D.exposure=parseFloat(G[1])),(G=k.match(j))&&(D.valid|=2,D.format=G[1]),(G=k.match(A))&&(D.valid|=4,D.height=parseInt(G[1],10),D.width=parseInt(G[2],10)),D.valid&2&&D.valid&4)break}return D.valid&2||o(3,"missing format specifier"),D.valid&4||o(3,"missing image size specifier"),D},g=function(L,P,R){const U=P;if(U<8||U>32767||L[0]!==2||L[1]!==2||L[2]&128)return new Uint8Array(L);U!==(L[2]<<8|L[3])&&o(3,"wrong scanline width");const j=new Uint8Array(4*P*R);j.length||o(4,"unable to allocate buffer space");let A=0,D=0;const k=4*U,G=new Uint8Array(4),ee=new Uint8Array(k);let J=R;for(;J>0&&D<L.byteLength;){D+4>L.byteLength&&o(1),G[0]=L[D++],G[1]=L[D++],G[2]=L[D++],G[3]=L[D++],(G[0]!=2||G[1]!=2||(G[2]<<8|G[3])!=U)&&o(3,"bad rgbe scanline format");let re=0,oe;for(;re<k&&D<L.byteLength;){oe=L[D++];const Le=oe>128;if(Le&&(oe-=128),(oe===0||re+oe>k)&&o(3,"bad scanline data"),Le){const Ge=L[D++];for(let pe=0;pe<oe;pe++)ee[re++]=Ge}else ee.set(L.subarray(D,D+oe),re),re+=oe,D+=oe}const me=U;for(let Le=0;Le<me;Le++){let Ge=0;j[A]=ee[Le+Ge],Ge+=U,j[A+1]=ee[Le+Ge],Ge+=U,j[A+2]=ee[Le+Ge],Ge+=U,j[A+3]=ee[Le+Ge],A+=4}J--}return j},_=function(L,P,R,U){const j=L[P+3],A=Math.pow(2,j-128)/255;R[U+0]=L[P+0]*A,R[U+1]=L[P+1]*A,R[U+2]=L[P+2]*A,R[U+3]=1},x=function(L,P,R,U){const j=L[P+3],A=Math.pow(2,j-128)/255;R[U+0]=ah.toHalfFloat(Math.min(L[P+0]*A,65504)),R[U+1]=ah.toHalfFloat(Math.min(L[P+1]*A,65504)),R[U+2]=ah.toHalfFloat(Math.min(L[P+2]*A,65504)),R[U+3]=ah.toHalfFloat(1)},b=new Uint8Array(e);b.pos=0;const y=p(b),M=y.width,E=y.height,w=g(b.subarray(b.pos),M,E);let I,B,N;switch(this.type){case Ii:N=w.length/4;const L=new Float32Array(N*4);for(let R=0;R<N;R++)_(w,R*4,L,R*4);I=L,B=Ii;break;case er:N=w.length/4;const P=new Uint16Array(N*4);for(let R=0;R<N;R++)x(w,R*4,P,R*4);I=P,B=er;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:M,height:E,data:I,header:y.string,gamma:y.gamma,exposure:y.exposure,type:B}}setDataType(e){return this.type=e,this}load(e,t,i,r){function s(o,a){switch(o.type){case Ii:case er:o.colorSpace=sn,o.minFilter=Ei,o.magFilter=Ei,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,s,i,r)}}class J5{constructor(e){f(this,"visible",!0);f(this,"ambientLight",new A_(16777215,.4));f(this,"dirLight",new Gl(16777215,1));f(this,"dirLight2",new Gl(16777215,3));f(this,"envMap");f(this,"scene");f(this,"showBackground",!0);f(this,"enableEnvironment",!0);f(this,"backgroundTexture");this.scene=e,this.ambientLight.pass=rr.ENVIRONMENT,this.loadEnvAssets()}async loadEnvAssets(){const t=await new $5().loadAsync(gn("Assets/studio_small_08_1k.hdr"));t.mapping=sl,Ot.supportWebgl2||(this.scene.backgroundIntensity=3),this.envMap=t;const i=new Ud;this.backgroundTexture=await i.loadAsync(gn("Assets/background.jpg")),this.scene.backgroundRotation.x+=Math.PI/2}update(e){if(!this.visible||e.scene.mode===Pt.SCENE2D||e.passes.pick){e.scene.background=null,e.scene.environment=null;return}this.showBackground&&(e.scene.background=this.backgroundTexture),this.enableEnvironment&&(e.scene.environment=this.envMap)}isDestroyed(){return!1}destroy(){return this.envMap.dispose(),this.backgroundTexture.dispose(),this.envMap.image.data=null,ht(this)}}var rM=new T,sM=new T,oM=new fe;const sm={transformWindowToDrawingBuffer(n,e,t){let i=n.canvas,r=n.drawingBufferWidth/i.clientWidth,s=n.drawingBufferHeight/i.clientHeight;return t.set(e.x*r,e.y*s),t},clipToGLWindowCoordinates(n,e,t){return T.divideByScalar(e,e.w,rM),fe.computeViewportTransformation(n,0,1,oM),fe.multiplyByPoint(oM,rM,sM),he.fromCartesian3(sM,t)},drawingBufferToWgs84Coordinates(n=new T){}},Vv=new he;let om=new he;const qn=new We,e4=new T;var aM=new nt,lM=new nt(1,1/255,1/65025,1/16581375);class t4{constructor(e){f(this,"scene");f(this,"needsUpdate",!1);f(this,"raycaster",new Us);f(this,"pickSize",new he(Math.round(3*Ot.devicePixelRatio),Math.round(3*Ot.devicePixelRatio)));f(this,"_pickPositionCache",{});f(this,"_pickPositionCacheDirty",!1);f(this,"removeCallback",null);this.scene=e,this.removeCallback=this.scene.camera.change.addEventListener(()=>{this.needsUpdate=!0})}get container(){return this.scene.container}get camera(){return this.scene.camera}pickPosition2D(e,t=new T){const{clientWidth:i,clientHeight:r}=this.container;return Vv.x=e.x/i*2-1,Vv.y=-(e.y/r)*2+1,this.raycaster.setFromCamera(Vv,this.camera.frustum),this.raycaster.ray.intersectPlane(this.scene.dwg2DViewPlane,t)}pickPosition(e,t=new T){var i=e.toString();if(this._pickPositionCacheDirty)this._pickPositionCache={},this._pickPositionCacheDirty=!1;else if(this._pickPositionCache.hasOwnProperty(i))return T.clone(this._pickPositionCache[i],t);let{scene:r}=this,o=r.context.uniformState,a=sm.transformWindowToDrawingBuffer(r,e,om);a.y=r.drawingBufferHeight-a.y;let l=r.context.readPixels({x:a.x,y:a.y,width:1,height:1,renderTarget:r.context._depthRenderTarget}),c=nt.unpack(l,0,aM);nt.divideByScalar(c,255,c);let u=nt.dot(c,lM);if(u>0&&u<1){let{near:g,far:_}=r.camera.frustum;if(r.renderer.useLogDepth){var d=u*o.log2FarDepthFromNearPlusOne,p=Math.pow(2,d)-1;u=_*(1-g/(p+g))/(_-g)}let x=r.renderer.drawingBufferSize;return t.x=a.x/x.width*2-1,t.y=a.y/x.height*2-1,t.z=u*2-1,t.unproject(r.camera.frustum),this._pickPositionCache[i]=T.clone(t),t}this._pickPositionCache[i]=void 0}pickWorldPosition(e,t=new T){let{scene:i}=this,r=sm.transformWindowToDrawingBuffer(i,e,om),s=i.context._depthRenderTarget,o=this.pickColor(i,s,r.x,r.y,1,1),a=nt.unpack(o,0,aM);nt.divideByScalar(a,255,a);let l=nt.dot(a,lM)*2-1;l==-1&&(l=1);var c=T.clone(T.UNIT_Z,e4);const u=i.renderer.viewport;return c.x=r.x/u.width*2-1,c.y=-(r.y/u.height)*2+1,c.z=l,c.unproject(i.camera.frustum),t.set(c.x,c.y,c.z),t}pickColor(e,t,i,r,s=3,o=3){let a=e.drawingBufferSize;i=Math.max(ye(i,0),0),r=Math.max(ye(a.height-r,0),0);let l=(s-1)/2;const c=t.texture.type,u=4*s*o;let d;if(c===Ii?d=new Float32Array(u):c===er?d=new Uint16Array(u):c===ar&&(d=new Uint8Array(u)),e.renderer.readRenderTargetPixels(t,i-l,r-l,s,o,d),c===er){const p=new Uint16Array(u);for(let g=0;g<d.length;g++)p[g]=d[g]===0?0:i4(d[g]);return p}return d}pick(e,t,i=3,r=3){let s=sm.transformWindowToDrawingBuffer(e,t,om),o=e.context.colorIdTarget,a=this.pickColor(e,e.context.colorIdTarget,s.x,s.y,i,r),l=Math.max(i,r),c=l*l,u=Math.floor(i*.5),d=Math.floor(r*.5),[p,g,_,x]=[0,0,0,-1];for(let b=0;b<c;++b){if(-u<=p&&p<=u&&-d<=g&&g<=d){const y=4*((d-g)*i+p+u);let M;if(o.texture.type===ar){if(qn.red=We.byteToFloat(a[y]),qn.green=We.byteToFloat(a[y+1]),qn.blue=We.byteToFloat(a[y+2]),qn.alpha=We.byteToFloat(a[y+3]),M=e.context.getObjectByPickColorSafeRange(qn),O(M))return M}else if(qn.red=a[y],qn.green=a[y+1],qn.blue=a[y+2],qn.alpha=a[y+3],M=e.context.getObjectByPickColor(qn),O(M))return M}if(p===g||p<0&&-p===g||p>0&&p===1-g){const y=_;_=-x,x=y}p+=_,g+=x}}pickRectangle(e,t,i=3,r=3){let s=sm.transformWindowToDrawingBuffer(e,t,om),o=this.pickColor(e,e.context.colorIdTarget,s.x,s.y,i,r),a=Math.max(i,r),l=a*a,c=Math.floor(i*.5),u=Math.floor(r*.5),[d,p,g,_]=[0,0,0,-1],x,b,y,M;const E=new Set,w=[];for(let B=0;B<l;++B){if(-c<=d&&d<=c&&-u<=p&&p<=u){const N=4*((u-p)*i+d+c);x=o[N],b=o[N+1],y=o[N+2],M=o[N+3];const L=x+(b<<8)+(y<<16)+(M<<24);E.has(L)||(E.add(L),w.push([x,b,y,M]))}if(d===p||d<0&&-d===p||d>0&&d===1-p){const N=g;g=-_,_=N}d+=g,p+=_}E.clear();const I=[];for(let B=0;B<w.length;B++){qn.red=We.byteToFloat(w[B][0]),qn.green=We.byteToFloat(w[B][1]),qn.blue=We.byteToFloat(w[B][2]),qn.alpha=We.byteToFloat(w[B][3]);const N=e.context.getObjectByPickColorSafeRange(qn);N&&I.push(N)}if(I.length)return I}drillPick(e=3,t=3){}update(){this._pickPositionCacheDirty=!0}isDestroyed(){return!1}destroy(){return this.removeCallback(),this._pickPositionCache=null,ht(this)}}function i4(n){let e=(n&31744)>>10,t=n&1023,i=n&32768?-1:1;return e===0?i*Math.pow(2,-14)*(t/1024):e===31?i*(t?NaN:1/0):i*Math.pow(2,e-15)*(1+t/1024)}class n4 extends zi{constructor(t,i=new fi,r=new T(1,1),s=16711680){super();f(this,"colorCommand");f(this,"pickId");f(this,"material");f(this,"enablePick",!0);f(this,"pickMaterial",new Fp({transparent:!1,toneMapped:!1,side:Jn}));f(this,"plane",new fi);f(this,"size",new T(1,1));f(this,"modelMatrix",new fe);f(this,"_modelMatrix",new fe);f(this,"modelMatrixInverse",new fe);f(this,"helper");f(this,"picked",!1);f(this,"_controls");this._controls=t;const o=[1,-1,0,1,1,0,1,1,0,-1,1,0,-1,1,0,-1,-1,0,-1,-1,0,1,-1,0],a=new Tt;a.setAttribute("position",new $e(o,3)),a.computeBoundingSphere();let l=new ts(a,new rn({color:s,toneMapped:!1}));this.helper=l,this.plane.copy(i),this.size.copy(r);const c=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],u=new Tt;u.setAttribute("position",new $e(c,3)),u.computeBoundingSphere(),l.add(new pt(u,new Pi({color:s,opacity:.1,transparent:!0,depthWrite:!1,toneMapped:!1,side:Jn}))),this.colorCommand=l,this.material=this.colorCommand.children[0].material,this.updateCommandMatrixWorld(!0),Xr(a),Xr(u)}setColor(t){this.material.color=t,this.helper.material.color=t}updateCommandMatrixWorld(t=!0,i){let{colorCommand:r}=this;r.position.set(0,0,0),r.scale.set(.5*this.size.x,.5*this.size.y,1),r.lookAt(this.plane.normal),O(i)&&this.colorCommand.position.copy(i),r.updateMatrixWorld(t)}getPlane(){return this.plane}setPlane(t,i=this.position){this.plane.copy(t),this.updateCommandMatrixWorld(!0,i)}createPickId(t){let i=t.context.createPickColorSafeRange({primitive:this}),r=i.color;this.pickMaterial.uniforms.diffuse.value.setRGB(r.x,r.y,r.z),this.pickMaterial.uniforms.opacity.value=r.w;let s=this.pickMaterial.fragmentShader;s=_n.replaceMain(s,"outputColor"),s=`
        ${s}
            void main(){
                outputColor();
                gl_FragColor = vec4(diffuse,opacity);
            }
        `,this.pickMaterial.fragmentShader=s,this.pickId=i}updateModelMatrix(){fe.equals(this.modelMatrix,this._modelMatrix)||(this.plane.applyMatrix4(this.modelMatrixInverse),this.plane.applyMatrix4(this.modelMatrix),fe.inverse(this.modelMatrix,this.modelMatrixInverse),fe.clone(this.modelMatrix,this._modelMatrix))}getPickColor(t,i){}reset(){this.plane=new fi,this.modelMatrix.identity()}update(t){if(!this.visible)return;O(this.pickId)||this.createPickId(t),this.updateModelMatrix();let i=this.colorCommand.children[0];if(i.material=this.material,t.passes.pick){i.visible=!0,i.material=this.pickMaterial,t.commandList.push(this.colorCommand);return}i.visible=this.picked||O(this._controls.transformCtrl.axis),t.commandList.push(this.colorCommand)}}function am(n,e){const t=new ba(n,.0075,3,64,e*Math.PI*2);return t.rotateY(Math.PI/2),t.rotateX(Math.PI/2),t}class r4 extends zi{constructor(t){super();f(this,"components",new zi);f(this,"pickComponents",new zi);f(this,"axisObjects",new zi);f(this,"gizmoMaterial",new Pi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}));f(this,"rotateRadius",.3);f(this,"_gizmo");f(this,"rotateObject",{X:[],Y:[]});this._gizmo=t,this.add(this.components),this.pickComponents.visible=!1,this.add(this.pickComponents),this.createComponents(),this.createAxis(),this.createPickComponents()}get gizmo(){return this._gizmo}get worldPosition(){return this.gizmo.worldPosition}get worldPositionStart(){return this.gizmo.worldPositionStart}get worldQuaternion(){return this.gizmo.worldQuaternion}get worldQuaternionStart(){return this.gizmo.worldQuaternionStart}get pointStart(){return this.gizmo.pointStart}get pointEnd(){return this.gizmo.pointEnd}get rotationAxis(){return this.gizmo.rotationAxis}get rotationAngle(){return this.gizmo.rotationAngle}get eye(){return this.gizmo.eye}get camera(){return this.gizmo.camera}get object(){return this.gizmo.object}get enabled(){return this.gizmo.enabled}get axis(){return this.gizmo.axis}get size(){return this.gizmo.size}get dragging(){return this.gizmo.dragging}get rotateXObject(){return this.rotateObject.X[0]}get rotateXObjectHelper(){return this.axisObjects.userData.XMesh}get rotateYObject(){return this.rotateObject.Y[0]}get rotateYObjectHelper(){return this.axisObjects.userData.YMesh}createAxis(){let t=this.rotateRadius;const i=this.gizmoMaterial.clone();i.color.setHex(16776960);const[r,s]=[new pt(am(t,1),i),new pt(am(t,1),i)];r.visible=!1,r.name="ROTATE_X_HELPER",s.visible=!1,s.name="ROTATE_Y_HELPER";const o={ROTATE_X_HELPER:[[r,[0,0,0],[0,0,0]]],ROTATE_Y_HELPER:[[s,[0,0,0],[0,0,-Math.PI/2]]]};Zn(o.ROTATE_X_HELPER,"ROTATE_X_HELPER",this.axisObjects),Zn(o.ROTATE_Y_HELPER,"ROTATE_Y_HELPER",this.axisObjects),this.axisObjects.name="axis",this.axisObjects.userData.XMesh=r,this.axisObjects.userData.YMesh=s,this.add(this.axisObjects)}createPickComponents(){const t=this.gizmoMaterial.clone();t.opacity=.15;let i=this.rotateRadius,r=.02;const s={ROTATE_X:[[new pt(new ba(i,r,4,24,Math.PI*.5),t),[0,0,0],[0,-Math.PI/2,0]]],ROTATE_Y:[[new pt(new ba(i,r,4,24,Math.PI*.5),t),[0,0,0],[Math.PI/2,0,0]]]};Zn(s.ROTATE_X,"ROTATE_X",this.pickComponents),Zn(s.ROTATE_Y,"ROTATE_Y",this.pickComponents)}createComponents(){const t=this.gizmoMaterial.clone();t.color.setHex(16711680);const i=this.gizmoMaterial.clone();i.color.setHex(65280);let r=this.rotateRadius;const[s,o]=[new pt(am(r,.25),t),new pt(am(r,.25),i)];s.userData.color=new ve().copy(t.color),o.userData.color=new ve().copy(i.color),s.userData.highLightColor=new ve(16776960),o.userData.highLightColor=new ve(16776960),s.userData.inVisibleColor=new ve(13421772),o.userData.inVisibleColor=new ve(13421772);const a={ROTATE_X:[[s,[0,0,0],[0,0,0]]],ROTATE_Y:[[o,[0,0,0],[0,0,-Math.PI/2]]]};this.rotateObject.X=[s],this.rotateObject.Y=[o],Zn(a.ROTATE_X,"ROTATE_X",this.components),Zn(a.ROTATE_Y,"ROTATE_Y",this.components)}getMeshes(){return[...this.components.children,...this.pickComponents.children,...this.axisObjects.children]}update(t){const i=this.worldQuaternion;let r=this.getMeshes();for(let s=0;s<r.length;s++){const o=r[s];o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a=this.gizmo.factor;o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.quaternion.copy(i)}this.updateComponents()}reset(){this.rotateXObject.visible=!0,this.rotateYObject.visible=!0,this.rotateXObjectHelper.visible=!1,this.rotateYObjectHelper.visible=!1,this.updateComponentsColor(this.rotateObject.X,"color"),this.updateComponentsColor(this.rotateObject.Y,"color")}updateComponents(){if(this.reset(),this.axis==="ROTATE_X"){this.rotateXObject.visible=!1,this.dragging?this.rotateYObject.visible=!1:this.updateComponentsColor(this.rotateObject.Y,"inVisibleColor"),this.rotateXObjectHelper.visible=!0;return}if(this.axis==="ROTATE_Y"){this.rotateYObject.visible=!1,this.dragging?this.rotateXObject.visible=!1:this.updateComponentsColor(this.rotateObject.X,"inVisibleColor"),this.rotateYObjectHelper.visible=!0;return}if(this.axis==="Z"){this.dragging?(this.rotateXObject.visible=!1,this.rotateYObject.visible=!1):(this.updateComponentsColor(this.rotateObject.Y,"inVisibleColor"),this.updateComponentsColor(this.rotateObject.X,"inVisibleColor"));return}}updateComponentsColor(t,i){for(let r of t)r.material.color=r.userData[i]}}new T(0,1,0),new T(0,0,1);class s4 extends zi{constructor(t){super();f(this,"components",new zi);f(this,"pickComponents",new zi);f(this,"axisCollection",new zi);f(this,"startRotateAxisCollection",new zi);f(this,"gizmoMaterial",new Pi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}));f(this,"_gizmo");f(this,"translateObject",{Z:[],TRANSLATE_XY:[]});f(this,"axisObject",{x:void 0,y:void 0,z:void 0,px:void 0,py:void 0,pz:void 0});f(this,"translateAxisMaterial",new Pi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:1038335}));this._gizmo=t,this.add(this.components),this.pickComponents.visible=!1,this.add(this.pickComponents);const i=new Bs(.0075,.0075,.5,3);i.translate(0,.25,0);const r=this.gizmoMaterial.clone();r.color.setHex(16776960);let s=new Er(.1,.1);s.translate(.1,.1,0),this.createPickComponents(s),this.createComponents(i,s,1),this.createAxis(i,r,2),this.createStartRotateAxis(i)}get gizmo(){return this._gizmo}get showZ(){return this.gizmo.showZ}get worldPosition(){return this.gizmo.worldPosition}get worldPositionStart(){return this.gizmo.worldPositionStart}get worldQuaternion(){return this.gizmo.worldQuaternion}get worldQuaternionStart(){return this.gizmo.worldQuaternionStart}get cameraPosition(){return this.gizmo.cameraPosition}get cameraQuaternion(){return this.gizmo.cameraQuaternion}get pointStart(){return this.gizmo.pointStart}get pointEnd(){return this.gizmo.pointEnd}get rotationAxis(){return this.gizmo.rotationAxis}get rotationAngle(){return this.gizmo.rotationAngle}get eye(){return this.gizmo.eye}get camera(){return this.gizmo.camera}get object(){return this.gizmo.object}get enabled(){return this.gizmo.enabled}get axis(){return this.gizmo.axis}get mode(){return this.gizmo.mode}get space(){return this.gizmo.space}get size(){return this.gizmo.size}get dragging(){return this.gizmo.dragging}createStartRotateAxis(t,i=3){const r=this.gizmoMaterial.clone();r.color.setHex(16776960);const s=new pt(t,r);s.scale.y=.6,s.name="START_AXIS_Z";const o={START_AXIS_Z:[[s,[0,0,0],[Math.PI/2,0,0]]]};Zn(o.START_AXIS_Z,"START_AXIS_Z",this.startRotateAxisCollection,i),this.startRotateAxisCollection.visible=!1,this.add(this.startRotateAxisCollection)}createAxis(t,i,r=2){let s=this.gizmoMaterial.clone();s.color.setHex(13421772);let o=this.gizmoMaterial.clone();o.color.setHex(1038335);let a=new Ul(.025,32,32);const[l,c,u,d,p,g]=[new pt(t,s),new pt(t,s),new pt(t,i),new pt(a,s),new pt(a,s),new pt(a,o)];l.scale.y=.6,c.scale.y=.6,u.scale.y=.6,u.visible=!1;const _={X:[[l,[0,0,0],[0,0,-Math.PI/2]]],Y:[[c,[0,0,0],[0,0,0]]],Z:[[u,[0,0,0],[Math.PI/2,0,0]]],PX:[[d,[.3,0,0],[0,0,0]]],PY:[[p,[0,.3,0],[0,0,0]]],PZ:[[g,[0,0,.3],[0,0,0]]]};Zn(_.X,"X",this.axisCollection,r),Zn(_.Y,"Y",this.axisCollection,r),Zn(_.Z,"Z",this.axisCollection,r),Zn(_.PX,"PX",this.axisCollection,r),Zn(_.PY,"PY",this.axisCollection,r),Zn(_.PZ,"PZ",this.axisCollection,r),this.axisObject.x=l,this.axisObject.y=c,this.axisObject.z=u,this.axisObject.px=d,this.axisObject.py=p,this.axisObject.pz=g,this.axisCollection.name="axis",this.add(this.axisCollection)}createPickComponents(t){const i=this.gizmoMaterial.clone();i.opacity=.15,new pt(t,i);const r={Z:[[new pt(new Bs(.1,0,.8,4),i),[0,0,.45],[Math.PI/2,0,0]]]};Zn(r.Z,"Z",this.pickComponents)}createComponents(t,i,r=1){let{translateAxisMaterial:s}=this;const o=new Bs(0,.04,.1,12);o.translate(0,.05,0);let[a,l]=[new pt(o,s),new pt(t,s)];a.userData.color=new ve().copy(s.color),l.userData.color=new ve().copy(s.color),l.scale.y=1.5,a.userData.highLightColor=new ve(16776960),l.userData.highLightColor=new ve(16776960),a.userData.inVisibleColor=new ve(13421772),l.userData.inVisibleColor=new ve(13421772),this.translateObject.Z=[a,l];const c=this.gizmoMaterial.clone();c.color.setHex(16733184);let u=new pt(i,c);this.translateObject.TRANSLATE_XY=[u];const d={Z:[[a,[0,0,.75],[Math.PI/2,0,0]],[l,[0,0,0],[Math.PI/2,0,0]]]};Zn(d.Z,"Z",this.components,r)}getMeshes(){return[...this.components.children,...this.pickComponents.children,...this.axisCollection.children]}update(t){const i=this.worldQuaternion;let r=this.getMeshes();for(let o=0;o<r.length;o++){const a=r[o];a.rotation.set(0,0,0),a.position.copy(this.worldPosition);let l=this.gizmo.factor;a.scale.set(1,1,1).multiplyScalar(l*this.size/4),a.quaternion.copy(i)}let s=this.startRotateAxisCollection.children;for(let o=0;o<s.length;o++){const a=s[o];a.rotation.set(0,0,0),a.position.copy(this.worldPosition);let l=this.gizmo.factor;a.scale.set(1,1,1).multiplyScalar(l*this.size/4),a.quaternion.copy(this.worldQuaternionStart)}this.updateComponents()}updateComponents(){if(this.axisObject.x.visible=!0,this.axisObject.y.visible=!0,this.axisObject.px.visible=!0,this.axisObject.py.visible=!0,this.axisObject.pz.visible=!0,this.axisObject.py.visible=!0,this.axisObject.pz.material.color.setHex(1038335),this.axisObject.z.visible=!1,this.startRotateAxisCollection.visible=!1,!O(this.axis)){this.updateComponentsColor(this.translateObject.Z,"color");return}if(this.axis==="Z"){this.updateComponentsColor(this.translateObject.Z,"highLightColor"),this.axisObject.pz.visible=!1;return}this.axis!=="TRANSLATE_XY"&&(this.updateComponentsColor(this.translateObject.Z,"inVisibleColor"),this.axisObject.pz.material.color.setHex(13421772),this.dragging&&(this.axisObject.x.visible=!1,this.axisObject.y.visible=!1,this.axisObject.px.visible=!1,this.axisObject.py.visible=!1,this.axisObject.pz.visible=!0,this.axisObject.pz.material.color.setHex(16776960),this.axisObject.z.visible=!0,this.startRotateAxisCollection.visible=!0))}updateComponentsColor(t,i){for(let r of t)r.material.color=r.userData[i]}}new q,new Oi,new q(0,1,0),new q(0,0,0),new fe,new q,new fe,new q(1,0,0),new q(0,1,0),new q(0,0,1),new q,new q,new q;function Zn(n,e,t,i=1/0){for(let r=n.length;r--;){const s=n[r][0],o=n[r][1],a=n[r][2],l=n[r][4];s.name=e,s.tag=l,s.position.set(o[0],o[1],o[2]),s.rotation.set(a[0],a[1],a[2]),s.updateMatrix();const c=s.geometry.clone();c.applyMatrix4(s.matrix),s.geometry=c,s.renderOrder=i,s.position.set(0,0,0),s.rotation.set(0,0,0),t.add(s)}return t}class o4 extends Dt{constructor(t){super();f(this,"controls");f(this,"isTransformControlsGizmo",!0);f(this,"type","TransformControlsGizmo");f(this,"translateHelper",new s4(this));f(this,"rotateHelper",new r4(this));f(this,"factor");this.controls=t,this.add(this.translateHelper),this.add(this.rotateHelper)}get showZ(){return this.controls.showZ}get worldPosition(){return this.controls.worldPosition}get worldPositionStart(){return this.controls.worldPositionStart}get worldQuaternion(){return this.controls.worldQuaternion}get worldQuaternionStart(){return this.controls.worldQuaternionStart}get cameraPosition(){return this.controls.cameraPosition}get cameraQuaternion(){return this.controls.cameraQuaternion}get pointStart(){return this.controls.pointStart}get pointEnd(){return this.controls.pointEnd}get rotationAxis(){return this.controls.rotationAxis}get rotationAngle(){return this.controls.rotationAngle}get eye(){return this.controls.eye}get camera(){return this.controls.camera}get object(){return this.controls.object}get enabled(){return this.controls.enabled}get axis(){return this.controls.axis}get mode(){return this.controls.mode}get space(){return this.controls.space}get size(){return this.controls.size}get dragging(){return this.controls.dragging}updateMatrixWorld(t){this.factor=this.camera._camera.getScaleFactor(this.worldPosition),super.updateMatrixWorld(t)}update(t){this.translateHelper.update(t),this.rotateHelper.update(t)}}class a4 extends pt{constructor(t){super(new Er(1e5,1e5,2,2),new Pi({visible:!1,wireframe:!0,side:Jn,transparent:!0,opacity:.1,toneMapped:!1}));f(this,"controls");f(this,"isTransformControlsPlane",!0);f(this,"type","TransformControlsPlane");this.controls=t}get cameraQuaternion(){return this.controls.cameraQuaternion}get worldPosition(){return this.controls.worldPosition}updateMatrixWorld(t){this.position.copy(this.worldPosition),this.quaternion.copy(this.cameraQuaternion),super.updateMatrixWorld(t)}}const Qa=new Us,Tc=new T;new T;const cM=new Li,hM={X:new T(1,0,0),Y:new T(0,1,0),Z:new T(0,0,1),ROTATE_X:T.UNIT_X,ROTATE_Y:T.UNIT_Y,ROTATE_Z:T.UNIT_Z};new fi,new fi;const uM=new T;new T,new T;const Wv=new T,Xv=new T;new T,new fe;const lm=new Lt,Yv={type:"change"},fM={type:"mouseDown"},dM={type:"mouseUp",mode:null},pM={type:"objectChange"},vn=[[new fi,new fi],[new fi,new fi],[new fi,new fi],[new fi,new fi]];function l4(n,e,t){let i=Lt.getPoints(t,[]);vn[0][0].setFromNormalAndCoplanarPoint(e,i[0]),vn[0][1].setFromNormalAndCoplanarPoint(e,i[7]);let r=vn[0][0].distanceToPoint(n),s=vn[0][1].distanceToPoint(n);vn[1][0].setFromNormalAndCoplanarPoint(e,i[1]),vn[1][1].setFromNormalAndCoplanarPoint(e,i[6]);let o=vn[1][0].distanceToPoint(n),a=vn[1][1].distanceToPoint(n);vn[2][0].setFromNormalAndCoplanarPoint(e,i[2]),vn[2][1].setFromNormalAndCoplanarPoint(e,i[5]);let l=vn[2][0].distanceToPoint(n),c=vn[2][1].distanceToPoint(n);vn[3][0].setFromNormalAndCoplanarPoint(e,i[3]),vn[3][1].setFromNormalAndCoplanarPoint(e,i[4]);let u=vn[3][0].distanceToPoint(n),d=vn[3][1].distanceToPoint(n),p=[Math.abs(r-s),Math.abs(o-a),Math.abs(l-c),Math.abs(u-d)],g=[r*s,o*a,l*c,u*d],_=p.indexOf(Math.max(...p));return{planes:vn[_],range:g[_],points:[i[_],i[7-_]]}}const Nn=[[new T,new T],[new T,new T],[new T,new T],[new T,new T]],Di=[new T,new T,new T,new T];function c4(n,e,t){let i=Lt.getPoints(t,[]);e.projectPoint(i[0],Nn[0][0]),e.projectPoint(i[7],Nn[0][1]),T.subtract(Nn[0][0],Nn[0][1],Di[0]),Di[0].applyQuaternion(n._worldQuaternionInv),T.abs(Di[0],Di[0]),e.projectPoint(i[1],Nn[1][0]),e.projectPoint(i[6],Nn[1][1]),T.subtract(Nn[1][0],Nn[1][1],Di[1]),Di[1].applyQuaternion(n._worldQuaternionInv),T.abs(Di[1],Di[1]),e.projectPoint(i[2],Nn[2][0]),e.projectPoint(i[5],Nn[2][1]),T.subtract(Nn[2][0],Nn[2][1],Di[2]),Di[2].applyQuaternion(n._worldQuaternionInv),T.abs(Di[2],Di[2]),e.projectPoint(i[3],Nn[3][0]),e.projectPoint(i[4],Nn[3][1]),T.subtract(Nn[3][0],Nn[3][1],Di[3]),Di[3].applyQuaternion(n._worldQuaternionInv),T.abs(Di[3],Di[3]);let r=Math.max(Di[0].x,Di[1].x,Di[2].x,Di[3].x),s=Math.max(Di[0].y,Di[1].y,Di[2].y,Di[3].y);return[r,s]}class h4 extends Dt{constructor(t,i,r){super();f(this,"domElement");f(this,"isTransformControls",!0);f(this,"_gizmo");f(this,"_plane");f(this,"camera");f(this,"_object");f(this,"_enabled",!0);f(this,"_axis");f(this,"_mode","translate");f(this,"_space","local");f(this,"_size",1);f(this,"_dragging",!1);f(this,"_showX",!0);f(this,"_showY",!0);f(this,"_showZ",!0);f(this,"_draggingStart",!1);f(this,"_lastActiveOffset",new T);f(this,"_offset",new T);f(this,"_startNorm",new T);f(this,"_endNorm",new T);f(this,"_cameraScale",new T);f(this,"_parentPosition",new T);f(this,"_parentQuaternion",new Li);f(this,"_parentQuaternionInv",new Li);f(this,"_parentScale",new T);f(this,"_worldScaleStart",new T);f(this,"_worldQuaternionInv",new Li);f(this,"_worldScale",new T);f(this,"_positionStart",new T);f(this,"_quaternionStart",new Li);f(this,"_scaleStart",new T);f(this,"_getPointer",u4.bind(this));f(this,"_onPointerDown",d4.bind(this));f(this,"_onPointerHover",f4.bind(this));f(this,"_onPointerMove",p4.bind(this));f(this,"_onPointerUp",m4.bind(this));f(this,"worldPosition",new T);f(this,"worldPositionStart",new T);f(this,"worldQuaternion",new Li);f(this,"worldQuaternionStart",new Li);f(this,"cameraPosition",new T);f(this,"cameraQuaternion",new Li);f(this,"pointStart",new T);f(this,"pointEnd",new T);f(this,"rotationAxis",new T);f(this,"rotationAngle",0);f(this,"eye",new T);f(this,"clipControls");this.clipControls=t,this.visible=!1,this.domElement=r,this.domElement.style.touchAction="none";const s=new o4(this);this._gizmo=s,this.add(s);const o=new a4(this);this._plane=o,this.add(o),this._showZ=!0,this.camera=i,this.enabled=!0,this.axis=null,this.mode="translate",this.space="local",this.size=1,this.dragging=!1,this.showX=!0,this.showY=!0,this.showZ=!0,this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}get object(){return this._object}set object(t){this._object!==t&&(this._object=t,this.raiseEvent("object",t))}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(this._enabled=t,this.raiseEvent("enabled",t))}get axis(){return this._axis}set axis(t){this._axis!==t&&(this._axis=t,this.raiseEvent("axis",t))}get mode(){return this._mode}set mode(t){this._mode!==t&&(this._mode=t,this.raiseEvent("mode",t))}get space(){return this._space}set space(t){this._space!==t&&(this._space=t,this.raiseEvent("space",t))}get size(){return this._size}set size(t){this._size!==t&&(this._size=t,this.raiseEvent("size",t))}get dragging(){return this._dragging}set dragging(t){this._dragging!==t&&(this._dragging=t,this.raiseEvent("dragging",t))}get showX(){return this._showX}set showX(t){this._showX!==t&&(this._showX=t,this.raiseEvent("showX",t))}get showY(){return this._showY}set showY(t){this._showY!==t&&(this._showY=t,this.raiseEvent("showY",t))}get showZ(){return this._showZ}set showZ(t){this._showZ!==t&&(this._showZ=t,this.raiseEvent("showZ",t))}get boundingBox(){return this.object.userData.boundingBox}raiseEvent(t,i){this.dispatchEvent({type:t+"-changed",value:i}),this.dispatchEvent(Yv)}updateMatrixWorld(t){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera instanceof Gs?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(t)}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&Qa.setFromCamera(t,this.camera);const i=g4([this._gizmo.translateHelper.pickComponents,this._gizmo.rotateHelper.pickComponents],Qa);i?this.axis=i.object.name:this.axis=null}pointerDown(t){if(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0||this.axis===null)return;t!==null&&Qa.setFromCamera(t,this.camera);const i=mM(this._plane,Qa,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this._draggingStart=!0,fM.mode=this.mode,this.dispatchEvent(fM)}pointerMove(t){const i=this.axis,r=this.object;let s=this.space;if(r===void 0||i===null||this._draggingStart===!1||t!==null&&t.button!==-1)return;t!==null&&Qa.setFromCamera(t,this.camera);const o=mM(this._plane,Qa,!0);if(o){if(this.dragging=!0,this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="Z")this._offset.copy(this.pointEnd).sub(this.pointStart),this._offset.applyQuaternion(this._worldQuaternionInv),this._offset.x=0,this._offset.y=0,this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.object.getWorldDirection(uM),this.limitTranslate(uM);else if(i!=="TRANSLATE_XY"){if(i.startsWith("ROTATE_")){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Tc.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;(i==="ROTATE_X"||i==="ROTATE_Y"||i==="ROTATE_Z")&&(this.rotationAxis.copy(hM[i]),Tc.copy(hM[i]),s==="local"&&Tc.applyQuaternion(this.worldQuaternion),Tc.cross(this.eye),Tc.length()===0?l=!0:this.rotationAngle=this._offset.dot(Tc.normalize())*a),(i==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),s==="local"&&i!=="ROTATE_E"&&i!=="ROTATE_XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(cM.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(cM.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}}this.limitPlanSize(),this.dispatchEvent(Yv),this.dispatchEvent(pM)}}limitTranslate(t){const i=this.object;lm.copy(this.boundingBox);let r=l4(i.position,t,lm);r.range>0&&(r.planes[0].projectPoint(i.position,Wv),r.planes[1].projectPoint(i.position,Xv),Wv.distanceTo(this.object.position)<Xv.distanceTo(this.object.position)?i.position.copy(Wv):i.position.copy(Xv))}limitPlanSize(){this.object,lm.copy(this.boundingBox);let t=c4(this,this.clipControls.clipPlaneHelper.plane,lm);this.clipControls.clipPlaneHelper.size.set(t[0]*this.clipControls.planeScaleOffset,t[1]*this.clipControls.planeScaleOffset),this.clipControls.clipPlaneHelper.updateCommandMatrixWorld()}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(dM.mode=this.mode,this.dispatchEvent(dM)),this._draggingStart=!1,this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Yv),this.dispatchEvent(pM),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Qa}getMode(){return this.mode}setMode(t){this.mode=t}setSize(t){this.size=t}setSpace(t){this.space=t}update(t){t.commandList.push(this),this._gizmo.update(t)}}function u4(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function f4(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function d4(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function p4(n){this.enabled&&this.pointerMove(this._getPointer(n))}function m4(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function mM(n,e,t){const i=e.intersectObject(n,!0);for(let r=0;r<i.length;r++)if(i[r].object.visible||t)return i[r];return!1}function g4(n,e,t){const i=e.intersectObjects(n,!0);for(let r=0;r<i.length;r++)if(i[r].object.visible||t)return i[r];return!1}const jv=new fi,qv=new T;new T;const _4=T.clone(T.UNIT_X),v4=T.clone(T.UNIT_Y);T.clone(T.UNIT_Z);const Ac=new T,Mc=new T;new fe;const Zv=new fe,y4={axisX:{color:new ve(255),axis:T.UNIT_X,offset:"x",visible:{X:!0,Y:!1,Z:!1},setPlane(n){let{axisPlaneScale:e}=n;n.clipPlaneHelper.size.copy(e.get(T.UNIT_X)),n.attachedSimulatedObject.quaternion.setFromAxisAngle(v4,Math.PI/2),n.attachedSimulatedObject.updateMatrix()},negate(n){}},axisY:{color:new ve(255),axis:T.UNIT_Y,offset:"y",visible:{X:!1,Y:!0,Z:!1},setPlane(n){let{axisPlaneScale:e}=n;n.clipPlaneHelper.size.copy(e.get(T.UNIT_Y)),n.attachedSimulatedObject.quaternion.setFromAxisAngle(_4,-Math.PI/2),n.attachedSimulatedObject.updateMatrix()},negate(n){}},axisZ:{color:new ve(255),axis:T.UNIT_Z,offset:"z",visible:{X:!1,Y:!1,Z:!0},setPlane(n){let{axisPlaneScale:e}=n;n.clipPlaneHelper.size.copy(e.get(T.UNIT_Z))},negate(n){const{attachedSimulatedObject:e}=n;e.getWorldDirection(Mc),Mc.negate(),Ac.copy(e.position),e.position.set(0,0,0),e.lookAt(Mc),e.position.copy(Ac),n.attachedSimulatedObject.updateMatrix(),Zv.makeTranslation(Ac);let t=n.clipPlaneHelper.plane,i=new fi().copy(t);i.negate(),n.object.clippingPlanes=[i]}}};class b4 extends zi{constructor(t,i){super();f(this,"transformCtrl");f(this,"clipPlaneHelper",new n4(this));f(this,"attachedSimulatedObject",new Dt);f(this,"_startMatrixInverse",new fe);f(this,"object");f(this,"clipMode");f(this,"eventHandler");f(this,"planeScaleOffset",1.2);f(this,"axisPlaneScale",new WeakMap);this.scene=t,this.owner=i,i.add(this),this.scene=t;let r=new h4(this,t.camera.frustum,t.renderer.domElement);this.transformCtrl=r,this.eventHandler=new Yn(t.container),this.eventHandler.setInputAction(this.handleMousemove.bind(this),vt.MOUSE_MOVE),r.addEventListener("dragging-changed",function(s){t.screenSpaceCameraController.enableInputs=!s.value}),r.addEventListener("change",()=>{r.dragging&&this.updateTransformMatrix()})}setClipMode(t,i){this.clipMode=i;let{transformCtrl:r}=this;t.getCenter(qv);let s=y4[i];jv.setFromNormalAndCoplanarPoint(T.clone(s.axis),t.max),(i===rc.AXIS_X||i===rc.AXIS_Y||i===rc.AXIS_Z)&&(r.showX=s.visible.X),this.computeClipPlaneSize(t),s.setPlane(this),this.clipPlaneHelper.setColor(s.color),jv.negate()}computeClipPlaneSize(t){let i=t.size,{planeScaleOffset:r}=this;this.axisPlaneScale.set(T.UNIT_X,new he(i.z*r,i.y*r)),this.axisPlaneScale.set(T.UNIT_Y,new he(i.x*r,i.z*r)),this.axisPlaneScale.set(T.UNIT_Z,new he(i.x*r,i.y*r))}setMode(t){this.transformCtrl.setMode(t)}clipNegate(){const{attachedSimulatedObject:t}=this;t.getWorldDirection(Mc),Mc.negate(),Ac.copy(t.position),t.position.set(0,0,0),t.lookAt(Mc),t.position.copy(Ac),this.attachedSimulatedObject.updateMatrix(),Zv.makeTranslation(Ac),this.clipPlaneHelper.modelMatrix.multiply(Zv),this.scene.frameState.afterRender.push(()=>{this.updateTransformMatrix(),this.clipPlaneHelper.visible=!0}),this.clipPlaneHelper.visible=!1}attachObject(t,i=rc.AXIS_Z){this.object=t,this.object.clippingEnabled=!0,this.remove(this.attachedSimulatedObject),this.attachedSimulatedObject=new Dt,this.add(this.attachedSimulatedObject),this.clipPlaneHelper.reset(),this.setClipMode(t.axisAlignedBoundingBox,i),this.attachedSimulatedObject.position.copy(qv),this.attachedSimulatedObject.updateMatrix();let r=new Lt().copy(t.axisAlignedBoundingBox);this.attachedSimulatedObject.userData.boundingBox=r,fe.clone(this.attachedSimulatedObject.matrix,this._startMatrixInverse),fe.inverse(this._startMatrixInverse,this._startMatrixInverse),this.clipPlaneHelper.setPlane(jv,qv),this.visible=!0,this.transformCtrl.attach(this.attachedSimulatedObject),this.scene.renderer.localClippingEnabled=!0,this.updateTransformMatrix()}detachObject(){this.visible=!1,this.scene.renderer.localClippingEnabled=!1,this.object.clippingPlanes=[],this.object.clippingEnabled=!1,this.transformCtrl.detach()}updateTransformMatrix(){let t=this.transformCtrl;const{worldPosition:i}=t;let r=this.clipPlaneHelper.colorCommand;r.rotation.set(0,0,0),r.position.copy(t.worldPosition),r.quaternion.copy(this.transformCtrl.worldQuaternion),r.updateMatrixWorld(),this.clipPlaneHelper.plane.setFromNormalAndCoplanarPoint(this.attachedSimulatedObject.getWorldDirection(new T),i),this.clipPlaneHelper.plane.negate(),this.object.clippingPlanes=[this.clipPlaneHelper.plane]}limitPlanSize(){}handleMousemove(t){let i=this.scene.pickObject(t.endPosition);if(!O(i)){this.clipPlaneHelper.picked=!1;return}i.primitive===this.clipPlaneHelper&&(this.clipPlaneHelper.picked=!0)}update(t){!this.visible||!O(this.transformCtrl.object)||(this.clipPlaneHelper.update(t),!t.passes.pick&&(this.transformCtrl.update(t),this.updateTransformMatrix(),this.transformCtrl.visible=this.clipPlaneHelper.colorCommand.children[0].visible))}}var cm=(n=>(n.Polygon="Polygon",n.Line="Line",n))(cm||{});const Bn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Oo(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Bn[n&255]+Bn[n>>8&255]+Bn[n>>16&255]+Bn[n>>24&255]+"-"+Bn[e&255]+Bn[e>>8&255]+"-"+Bn[e>>16&15|64]+Bn[e>>24&255]+"-"+Bn[t&63|128]+Bn[t>>8&255]+"-"+Bn[t>>16&255]+Bn[t>>24&255]+Bn[i&255]+Bn[i>>8&255]+Bn[i>>16&255]+Bn[i>>24&255]).toLowerCase()}class mu{constructor({id:e=Oo(),color:t=new ve(30932),width:i=3}={}){f(this,"visible",!0);f(this,"type",cm.Polygon);f(this,"owner");f(this,"enabled",!0);f(this,"_complete",!1);f(this,"positions",[]);f(this,"polyline");f(this,"selectPosition",[]);f(this,"id",Oo());f(this,"color",new ve(30932));f(this,"width",3);f(this,"depthTest",!1);this.id=e,this.color=t,this.width=i}updatePolyline(){if(this.positions.length===0)return;if(!O(this.polyline)){this.polyline=new Io({positions:[...this.positions,...this.selectPosition],color:this.color,width:this.width,depthTest:this.depthTest});return}if(this.selectPosition.length===0&&this.positions.length===3){this.polyline.destroy(),this.polyline=void 0;return}let e=[...this.positions,...this.selectPosition,this.positions[0],this.positions[1],this.positions[2]];this.polyline.positions=e,this.depthTest||(this.polyline.renderOrder=10)}attach(e){this.owner=e}onLeftUp(){}onLeftClick(e){const{worldPosition:t}=e;!this.enabled||!O(t)||this._complete===!0||this.positions.push(...t.toArray())}onRightClick(e){this._complete=!0,this.selectPosition=[],this.updatePolyline(),this.owner.complete()}onMouseMove(e){if(!this.enabled||this._complete===!0)return;const{worldPosition:t}=e;this.selectPosition=t.toArray(),this.updatePolyline()}update(e){var t;!this.enabled||!this.visible||e.passes.pick||(t=this.polyline)==null||t.update(e)}getData(){return{id:this.id,positions:[...this.polyline.positions],color:this.color.getHex(),width:this.width,type:this.type}}static formData(e,t){let i=new mu({id:t.id,color:new ve(t.color),width:t.width});return i.owner=e,i._complete=!0,i.polyline=new Io({positions:[...t.positions],color:i.color,width:i.width,depthTest:!1}),e.drawInstanceMap.set(t.id,i),i}isDestroyed(){return!1}destroy(){var e;return(e=this.polyline)==null||e.destroy(),ht(this)}}const x4={[cm.Polygon]:mu},hm=new T,w4=new Tr,gM=new Us,[_M,Kv,vM]=[new T,new T,new T],[um,fm]=[new ks,new ks],Qv={windowPosition:new he,worldPosition:new T},$v={windowPosition:new he,worldPosition:new T},dm={worldPosition:new T,endPosition:new he,startPosition:new he},$a={MiddlePoint:0,StartPoint:1,EndPoint:2,ClosestPoint:3,facePoint:4},Ja=[{position:new T,windowPosition:new he,icon:ov},{position:new T,windowPosition:new he,icon:nu},{position:new T,windowPosition:new he,icon:nu},{position:new T,windowPosition:new he,icon:av},{position:new T,windowPosition:new he,icon:VT}];class yM{constructor(e,t){f(this,"eventHandler");f(this,"snapPixelSize",8*Ot.devicePixelRatio);f(this,"snapPixelSizeSq",this.snapPixelSize*this.snapPixelSize);f(this,"_icon");f(this,"activeInstance");f(this,"_enabled",!1);f(this,"drawInstanceMap",new Map);f(this,"closestWindowPosition",new he);f(this,"completeEvent",new Vn);f(this,"selected",!1);f(this,"drawPlane",new fi(new T(0,0,-1),0));f(this,"intersectDrawPlane",!0);f(this,"drawPlaneHelper",new Kw(this.drawPlane,1e4,44799));f(this,"showDrawPlane",!1);f(this,"_computeKeyPoint",!0);this.scene=e;let i=new Yn(this.scene.canvas);t.add(this),i.setInputAction(this.onMouseMove.bind(this),vt.MOUSE_MOVE),i.setInputAction(this.onLeftClick.bind(this),vt.LEFT_CLICK),i.setInputAction(this.onRightClick.bind(this),vt.RIGHT_CLICK),i.setInputAction(this.onLeftUp.bind(this),vt.LEFT_UP),this._icon=document.createElement("img"),this._icon.className="vengine-adsorb-icon",this._icon.src=jT.facePoint,this.scene.viewer.container.appendChild(this._icon),this.showLabel(!1)}get screenSpaceCameraController(){return this.scene.screenSpaceCameraController}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._icon.style.display=e?"block":"none";for(let t of this.drawInstanceMap.values())t.visible=e;e||(this.removeInstance(this.activeInstance),this.activeInstance=null)}get computeKeyPoint(){return this._computeKeyPoint}set computeKeyPoint(e){this._computeKeyPoint!==e&&(this._computeKeyPoint=e,e?this.scene.viewer.container.appendChild(this._icon):this.scene.viewer.container.removeChild(this._icon))}showLabel(e){if(this._computeKeyPoint){this._icon.style.display=e?"block":"none";return}}_updateIconPosition(e){if(!O(e))return;const{clientWidth:t,clientHeight:i}=this._icon;this._icon.style.transform=`translate(${e.x-t/2}px, ${e.y-i/2}px)`}onLeftClick(e){!this.enabled||!O(this.activeInstance)||(Qv.worldPosition=hm,Qv.windowPosition.copy(e.position),this.activeInstance.onLeftClick(Qv))}onLeftUp(){!this.enabled||!O(this.activeInstance)||this.activeInstance.onLeftUp()}onRightClick(e){!this.enabled||!O(this.activeInstance)||($v.worldPosition=this.scene.pickPosition(e.position,hm),$v.windowPosition.copy(e.position),this.activeInstance.onRightClick($v))}onMouseMove(e){if(!this.enabled)return;this.closestWindowPosition.copy(e.endPosition);let t=this.scene.pickPosition(this.closestWindowPosition,hm),i=this.scene.camera.getPickRay(this.closestWindowPosition,w4);if(gM.ray.copy(i),this.showLabel(!0),!O(t)&&this.intersectDrawPlane&&(t=i.intersectPlane(this.drawPlane,hm),this.showLabel(!1)),!O(t))return;let r=this.getClosestPoint(this.closestWindowPosition,t,gM);dm.worldPosition=r,dm.endPosition.copy(this.closestWindowPosition),dm.startPosition.copy(e.startPosition),this._updateIconPosition(this.closestWindowPosition),O(this.activeInstance)&&this.activeInstance.onMouseMove(dm)}getClosestPoint(e,t,i){let r=this.scene.pickObject(e);if(!O(r))return t;let{primitive:s,instanceId:o}=r,a=[];if(s.raycast(i,o,a),a.length===0)return t;let{face:l}=a[0];s.getVertexPosition(l.a,o,_M),s.getVertexPosition(l.b,o,Kv),s.getVertexPosition(l.c,o,vM);let c=[_M,Kv,Kv,vM],u=new T,d=1/0,p=new T;for(let b=0;b<c.length;b+=2){fm.start.copy(c[b]),fm.end.copy(c[b+1]),fm.closestPointToPoint(t,!0,u);let y=u.distanceTo(t);y<d&&(um.copy(fm),d=y,p.copy(u))}Ja[$a.ClosestPoint].position.copy(p),this.scene.positionToCanvasCoordinates(p,Ja[$a.ClosestPoint].windowPosition);let g=Ja[$a.MiddlePoint];um.getCenter(g.position),this.scene.positionToCanvasCoordinates(g.position,g.windowPosition);let _=Ja[$a.StartPoint],x=Ja[$a.EndPoint];T.clone(um.start,_.position),T.clone(um.end,x.position),this.scene.positionToCanvasCoordinates(_.position,_.windowPosition),this.scene.positionToCanvasCoordinates(x.position,x.windowPosition);for(let b=0;b<Object.values($a).length;b++){const y=Ja[b];if(e.distanceToSq(y.windowPosition)<this.snapPixelSizeSq)return this.closestWindowPosition.copy(y.windowPosition),this._icon.src=y.icon,t.copy(y.position)}return this._icon.src=Ja[$a.facePoint].icon,t}execute(e){let t=this.drawInstanceMap.get(e.id);if(O(t))throw new oc("id");this.complete(!1),this.activeInstance=e,this.drawInstanceMap.set(e.id,e),e.attach(this)}unExecute(){if(!O(this.activeInstance))return;let e=this.drawInstanceMap.get(this.activeInstance.id);O(e)&&!e._complete&&(this.drawInstanceMap.delete(this.activeInstance.id),this.activeInstance.destroy()),this.activeInstance=null}complete(e=!0){if(this.showLabel(!e),!e)return;let t=this.activeInstance;this.completeEvent.raiseEvent(t)}getInstance(e){return this.drawInstanceMap.get(e)}removeAllCompleteInstance(){for(let e of this.drawInstanceMap.values())this.activeInstance.id!==e.id&&(this.drawInstanceMap.delete(e.id),e.destroy())}removeInstance(e){O(e)&&(this.drawInstanceMap.delete(e.id),e.destroy())}removeInstanceById(e){O(e)&&this.removeInstance(this.drawInstanceMap.get(e))}createInstanceFromData(e){Array.isArray(e)||(e=[e]);let t=[];for(let i of e)t.push(x4[i.type].formData(this,i));return t}removeAll(){for(let e of this.drawInstanceMap.values())e.destroy();this.drawInstanceMap.clear(),this.activeInstance=null,this.enabled=!1}isDestroyed(){return!1}update(e){if(this.enabled){for(let t of this.drawInstanceMap.values())t.update(e);e.passes.pick||this.showDrawPlane&&e.commandList.push(this.drawPlaneHelper)}}destroy(){var e;return(e=this.eventHandler)==null||e.destroy(),this.removeAll(),this.drawPlaneHelper.destroy(),this.drawPlaneHelper=void 0,ht(this)}}const S4=new T,E4=new T,T4=new T,A4=1e-10;class pm{constructor(e=new T(0,0,0),t=new T(0,1,0),i=1){this.start=e,this.end=t,this.radius=i}clone(){return new pm(this.start.clone(),this.end.clone(),this.radius)}set(e,t,i){this.start.copy(e),this.end.copy(t),this.radius=i}copy(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius}getCenter(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)}translate(e){this.start.add(e),this.end.add(e)}checkAABBAxis(e,t,i,r,s,o,a,l,c){return(s-e<c||s-i<c)&&(e-o<c||i-o<c)&&(a-t<c||a-r<c)&&(t-l<c||r-l<c)}intersectsBox(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)}lineLineMinimumPoints(e,t){const i=S4.copy(e.end).sub(e.start),r=E4.copy(t.end).sub(t.start),s=T4.copy(t.start).sub(e.start),o=i.dot(r),a=i.dot(i),l=r.dot(r),c=r.dot(s),u=i.dot(s);let d,p;const g=a*l-o*o;if(Math.abs(g)<A4){const b=-c/l,y=(o-c)/l;Math.abs(b-.5)<Math.abs(y-.5)?(d=0,p=b):(d=1,p=y)}else d=(c*o+u*l)/g,p=(d*o-c)/l;p=Math.max(0,Math.min(1,p)),d=Math.max(0,Math.min(1,d));const _=i.multiplyScalar(d).add(e.start),x=r.multiplyScalar(p).add(t.start);return[_,x]}}const Cc=new T,gu=new T,ys=new fi,Jv=new ks,M4=new ks,mm=new Mi,el=new pm;class ey{constructor(e){f(this,"triangles",[]);f(this,"box");f(this,"subTrees",[]);f(this,"bounds");f(this,"floorPlane");this.box=e}addTriangle(e){return this.bounds||(this.bounds=new Lt),this.bounds.min.x=Math.min(this.bounds.min.x,e.a.x,e.b.x,e.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,e.a.y,e.b.y,e.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,e.a.z,e.b.z,e.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,e.a.x,e.b.x,e.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,e.a.y,e.b.y,e.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,e.a.z,e.b.z,e.c.z),this.triangles.push(e),this}calcBox(){return this.box=this.bounds.clone(),this}split(e){if(!this.box)return;const t=[],i=gu.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let s=0;s<2;s++)for(let o=0;o<2;o++)for(let a=0;a<2;a++){const l=new Lt,c=Cc.set(s,o,a);l.min.copy(this.box.min).add(c.multiply(i)),l.max.copy(l.min).add(i),t.push(new ey(l))}let r;for(;r=this.triangles.pop();)for(let s=0;s<t.length;s++)t[s].box.intersectsTriangle(r)&&t[s].triangles.push(r);for(let s=0;s<t.length;s++){const o=t[s].triangles.length;o>8&&e<16&&t[s].split(e+1),o!==0&&this.subTrees.push(t[s])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(e,t){for(let i=0;i<this.subTrees.length;i++){const r=this.subTrees[i];if(e.intersectsBox(r.box))if(r.triangles.length>0)for(let s=0;s<r.triangles.length;s++)t.indexOf(r.triangles[s])===-1&&t.push(r.triangles[s]);else r.getRayTriangles(e,t)}return t}triangleCapsuleIntersect(e,t){t.getPlane(ys);const i=ys.distanceToPoint(e.start)-e.radius,r=ys.distanceToPoint(e.end)-e.radius;if(i>0&&r>0||i<-e.radius&&r<-e.radius)return!1;const s=Math.abs(i/(Math.abs(i)+Math.abs(r))),o=Cc.copy(e.start).lerp(e.end,s);if(t.containsPoint(o))return{normal:ys.normal.clone(),point:o.clone(),depth:Math.abs(Math.min(i,r))};const a=e.radius*e.radius,l=Jv.set(e.start,e.end),c=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let u=0;u<c.length;u++){const d=M4.set(c[u][0],c[u][1]),[p,g]=e.lineLineMinimumPoints(l,d);if(p.distanceToSquared(g)<a)return{normal:p.clone().sub(g).normalize(),point:g.clone(),depth:e.radius-p.distanceTo(g)}}return!1}triangleSphereIntersect(e,t){if(t.getPlane(ys),!e.intersectsPlane(ys))return!1;const i=Math.abs(ys.distanceToSphere(e)),r=e.radius*e.radius-i*i,s=ys.projectPoint(e.center,Cc);if(t.containsPoint(e.center))return{normal:ys.normal.clone(),point:s.clone(),depth:Math.abs(ys.distanceToSphere(e))};const o=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let a=0;a<o.length;a++){Jv.set(o[a][0],o[a][1]),Jv.closestPointToPoint(s,!0,gu);const l=gu.distanceToSquared(e.center);if(l<r)return{normal:e.center.clone().sub(gu).normalize(),point:gu.clone(),depth:e.radius-Math.sqrt(l)}}return!1}getSphereTriangles(e,t){for(let i=0;i<this.subTrees.length;i++){const r=this.subTrees[i];if(e.intersectsBox(r.box))if(r.triangles.length>0)for(let s=0;s<r.triangles.length;s++)t.indexOf(r.triangles[s])===-1&&t.push(r.triangles[s]);else r.getSphereTriangles(e,t)}}getCapsuleTriangles(e,t){for(let i=0;i<this.subTrees.length;i++){const r=this.subTrees[i];if(e.intersectsBox(r.box))if(r.triangles.length>0)for(let s=0;s<r.triangles.length;s++)t.indexOf(r.triangles[s])===-1&&t.push(r.triangles[s]);else r.getCapsuleTriangles(e,t)}}sphereIntersect(e){mm.copy(e);const t=[];let i,r=!1;this.getSphereTriangles(e,t);for(let s=0;s<t.length;s++)(i=this.triangleSphereIntersect(mm,t[s]))&&(r=!0,mm.center.add(i.normal.multiplyScalar(i.depth)));if(r){const s=mm.center.clone().sub(e.center),o=s.length();return{normal:s.normalize(),depth:o}}return!1}planeCapsuleIntersect(e,t){const i=t.distanceToPoint(e.start)-e.radius,r=t.distanceToPoint(e.end)-e.radius;if(i>0&&r>0||i<-e.radius&&r<-e.radius)return!1;const s=Math.abs(i/(Math.abs(i)+Math.abs(r))),o=Cc.copy(e.start).lerp(e.end,s);return{normal:t.normal.clone(),point:o.clone(),depth:Math.abs(Math.min(i,r))}}capsuleIntersect(e){el.copy(e);const t=[];let i,r=!1;this.getCapsuleTriangles(el,t);for(let s=0;s<t.length;s++)(i=this.triangleCapsuleIntersect(el,t[s]))&&(r=!0,el.translate(i.normal.multiplyScalar(i.depth)));if(O(this.floorPlane)&&(i=this.planeCapsuleIntersect(el,this.floorPlane))&&(r=!0,el.translate(i.normal.multiplyScalar(i.depth))),r){const s=el.getCenter(new T).sub(e.getCenter(Cc)),o=s.length();return{normal:s.normalize(),depth:o}}return!1}rayIntersect(e){if(e.direction.length()===0)return;const t=[];let i,r,s=1e100;this.getRayTriangles(e,t);for(let o=0;o<t.length;o++){const a=e.intersectTriangle(t[o].a,t[o].b,t[o].c,!0,Cc);if(a){const l=a.sub(e.origin).length();s>l&&(r=a.clone().add(e.origin),s=l,i=t[o])}}return s<1e100?{distance:s,triangle:i,position:r}:!1}fromBufferGeometry(e){return e.forEach(t=>{let i,r=!1;t.index!==null?(r=!0,i=t.toNonIndexed()):i=t;const s=i.getAttribute("position");for(let o=0;o<s.count;o+=3){const a=new T().fromBufferAttribute(s,o),l=new T().fromBufferAttribute(s,o+1),c=new T().fromBufferAttribute(s,o+2);this.addTriangle(new $i(a,l,c))}r&&i.dispose()}),this.build(),this}fromGraphNode(e){return e.updateWorldMatrix(!0,!0),e.traverse(t=>{if(t instanceof pt){let i,r=!1;t.geometry.index!==null?(r=!0,i=t.geometry.toNonIndexed()):i=t.geometry;const s=i.getAttribute("position");for(let o=0;o<s.count;o+=3){const a=new T().fromBufferAttribute(s,o),l=new T().fromBufferAttribute(s,o+1),c=new T().fromBufferAttribute(s,o+2);a.applyMatrix4(t.matrixWorld),l.applyMatrix4(t.matrixWorld),c.applyMatrix4(t.matrixWorld),this.addTriangle(new $i(a,l,c))}r&&i.dispose()}}),this.build(),this}}class C4{constructor(e){f(this,"visible",!0);f(this,"colorCommand");f(this,"collisionVolume",{triangles:{floor:[new $i]}});let t=new Tt,i=[.5,.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,.5];t.setAttribute("position",new $e(i,3)),this.colorCommand=new pt(t,new Fd({side:br}));let{size:r,center:s}=e;t.scale(r.x,r.y,r.z),t.translate(s.x,s.y,s.z),Xr(this.colorCommand.geometry)}update(e){!this.visible||e.passes.pick||e.commandList.push(this.colorCommand)}isDestroyed(){return!1}destroy(){return this.colorCommand.geometry.dispose(),this.colorCommand.material.dispose(),ht(this)}}const[I4,bM]=[30,5];let gm=!1;const bs=new T,No=new T,[ty,Bo]=[new T,new T];function xM(n){return T.clone(n.direction,No),No.z=0,No.normalize(),No}function wM(n){return T.clone(n.right,No),No.z=0,No.normalize(),No}const iy=new he;function P4(n,e,t){if(!n._enabled)return;let{camera:i}=n;const r=n.rotateSpeed*.4;he.subtract(t.endPosition,t.startPosition,iy);let{pitch:s,heading:o}=i,a=s-iy.y*r;a=kn.clamp(a,-Math.PI/2*.9,Math.PI/2*.9);let l=o+iy.x*r;i.setView({orientation:{pitch:a,heading:l}})}const _u=new T,Yr=new Tr,Fo=new T,_i={w:!1,s:!1,a:!1,d:!1,ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1,reset(){_i.w=!1,_i.s=!1,_i.a=!1,_i.d=!1,_i.ArrowUp=!1,_i.ArrowDown=!1,_i.ArrowLeft=!1,_i.ArrowRight=!1},get moveForward(){return _i.w},get moveBackward(){return _i.s},get moveLeft(){return _i.a},get moveRight(){return _i.d},get rotateLeft(){return _i.ArrowLeft},get rotateRight(){return _i.ArrowRight},get rotateUp(){return _i.ArrowUp},get rotateDown(){return _i.ArrowDown}};class R4{constructor(e,t){f(this,"_enabled",!1);f(this,"playerCollider",new pm(new T(0,0,.5),new T(0,0,1.5),1));f(this,"worldCollisionVolume",new ey);f(this,"preCollisionTestBoundingBox",new Lt);f(this,"collisionBoundingBox",new Lt);f(this,"sceneCollisionBoundingBox",new Lt);f(this,"showDebuggerBoundingBoxHelper",!1);f(this,"preCollisionTestBoundingBoxHelper");f(this,"collisionBoundingBoxHelper");f(this,"collisionGeometry");f(this,"rotateSpeed",.005);f(this,"moveSpeed",10);f(this,"_aggregator");f(this,"rotateEventTypes",li.LEFT_DRAG);f(this,"collisionHelper");f(this,"destinationOffset",new T(0,0,3));f(this,"_floorHeight",0);f(this,"removeKeyDownEventCallback");f(this,"removeKeyUpEventCallback");f(this,"visibilitychangeCallback");this.scene=e,this.owner=t,t.add(this),this._aggregator=new UA(e.canvas),this.worldCollisionVolume.floorPlane=new fi(T.clone(T.UNIT_Z),0),this.removeKeyDownEventCallback=i=>{i.preventDefault(),this._enabled&&i.key&&(_i[i.key]=!0)},this.container.addEventListener("keydown",this.removeKeyDownEventCallback.bind(this)),this.removeKeyUpEventCallback=i=>{i.preventDefault(),i.key&&(_i[i.key]=!1)},this.container.addEventListener("keyup",this.removeKeyUpEventCallback.bind(this)),this.visibilitychangeCallback=()=>{document.hidden&&_i.reset()},document.addEventListener("visibilitychange",this.visibilitychangeCallback),this.container.onblur=()=>{_i.reset()}}get container(){return this.scene.container}get camera(){return this.scene.camera}get screenSpaceCameraController(){return this.scene.screenSpaceCameraController}async setEnabled(e){const{camera:t,screenSpaceCameraController:i}=this;this.scene.viewer.navCube.setVisible(!e),e||(_i.reset(),t.cancelFlight(),this._enabled=!1,i.enableInputs=!0),e&&await this.setStartView()}get floorHeight(){return this._floorHeight}async setFloorHeight(e=this.minimumHeight){if(!this.enabled){console.warn("FirstPersonControl must be enabled to set floor height");return}this.worldCollisionVolume.floorPlane.constant=-e,this._floorHeight=e,this.setEnabled(!1),await this.setStartView(),this.setEnabled(!0)}get FloorHeight(){return this._floorHeight}setStartDestination(e){if(!this.enabled)return;const{camera:t,screenSpaceCameraController:i}=this;this.setEnabled(!1),this.updateBoundingBox(),e.z=this.floorHeight,T.subtract(e,this.playerCollider.end,_u),_u.z=0,this.playerCollider.translate(_u),this.camera.position.setX(e.x),this.camera.position.setY(e.y),i.enableInputs=!1,this.scene.viewer.navCube.setVisible(!1),this._enabled=!0}async setStartView(e=1){const{camera:t,screenSpaceCameraController:i}=this;t.position,this.scene.viewer.element.focus(),i.enableInputs=!1,this.updateBoundingBox();let{preCollisionTestBoundingBox:r,collisionBoundingBox:s}=this,o={};if(s.containsPoint(t.position))T.clone(t.position,Fo),o={pitch:0,heading:t.heading};else{let a=s.center;Yr.origin.copy(t.position),Yr.origin.z=Math.max(Yr.origin.z,3),T.subtract(new T(a.x,a.y,Yr.origin.z),Yr.origin,Yr.direction),Yr.direction.normalize(),s.containsPoint(Yr.origin)?(T.clone(Yr.origin,Fo),o={pitch:0,heading:t.heading}):(Yr.intersectBox(r,Fo),o={up:new T(0,0,1),direction:T.clone(Yr.direction,new T)})}return Fo.z=this.floorHeight,T.add(Fo,this.destinationOffset,Fo),T.subtract(Fo,this.playerCollider.end,_u),this.playerCollider.translate(_u),new Promise(a=>{this.camera.flyTo({destination:Fo,duration:e,orientation:o,complete:()=>{i.enableInputs=!1,this._enabled=!0,a()}})})}get enabled(){return this._enabled}get minimumHeight(){return Number(this.collisionBoundingBox.min.z.toFixed(2))}updateControls(e){let{rotateSpeed:t,moveSpeed:i}=this;const r=e*10*i;if(_i.moveForward&&bs.add(xM(this.camera).multiplyScalar(r)),_i.moveBackward&&bs.add(xM(this.camera).multiplyScalar(-r)),_i.moveLeft&&bs.add(wM(this.camera).multiplyScalar(-r)),_i.moveRight&&bs.add(wM(this.camera).multiplyScalar(r)),_i.rotateLeft&&this.camera.rotateLeft(t),_i.rotateRight&&this.camera.rotateRight(t),_i.rotateUp){let{pitch:s}=this.camera,o=s+t;o=kn.clamp(o,-Math.PI/2*.9,Math.PI/2*.9),this.camera.setView({orientation:{pitch:o}})}if(_i.rotateDown){let{pitch:s}=this.camera,o=s-t;o=kn.clamp(o,-Math.PI/2*.9,Math.PI/2*.9),this.camera.setView({orientation:{pitch:o}})}}playerCollisions(){const e=this.worldCollisionVolume.capsuleIntersect(this.playerCollider);gm=!1,e&&(gm=e.normal.z>0,gm||bs.addScaledVector(e.normal,-e.normal.dot(bs)),this.playerCollider.translate(e.normal.multiplyScalar(e.depth)))}updatePlayer(e){let t=Math.exp(-4*e)-1;gm||(bs.z-=I4*e,t*=0),bs.addScaledVector(bs,t);const i=bs.clone().multiplyScalar(e);this.playerCollider.translate(i),this.playerCollisions(),this.camera.position.copy(this.playerCollider.end)}updateBoundingBox(){let{scene:{axisAlignedBoundingBox:e},sceneCollisionBoundingBox:t,collisionBoundingBox:i,preCollisionTestBoundingBox:r}=this;if(Lt.equals(t,e))return;Lt.clone(e,t),t.getCenter(ty),t.getSize(Bo);const o=T.maximumComponent(Bo)*10,a=new T(Bo.x*2,Bo.y*2,Bo.z);i.setFromCenterAndSize(ty,a),i.maximum.z=i.minimum.z+o,r.setFromCenterAndSize(ty,new T(Bo.x*1.5,Bo.y*1.5,Bo.z)),r.maximum.z=r.minimum.z+o,this.collisionHelper=new C4(this.collisionBoundingBox),this.worldCollisionVolume.fromGraphNode(this.collisionHelper.colorCommand)}createBoundingBoxHelper(e){if(!this.showDebuggerBoundingBoxHelper)return;let{preCollisionTestBoundingBoxHelper:t,collisionBoundingBoxHelper:i}=this;O(t)||(this.preCollisionTestBoundingBoxHelper=new Pr(this.preCollisionTestBoundingBox,new ve(16711680))),O(i)||(this.collisionBoundingBoxHelper=new Pr(this.collisionBoundingBox,new ve(16776960)))}updateBoundingBoxHelper(e){this.showDebuggerBoundingBoxHelper&&(O(this.preCollisionTestBoundingBoxHelper)||this.createBoundingBoxHelper(e),this.preCollisionTestBoundingBoxHelper.updateFromBoundingBox(this.preCollisionTestBoundingBox),this.collisionBoundingBoxHelper.updateFromBoundingBox(this.collisionBoundingBox),this.preCollisionTestBoundingBoxHelper.update(e),this.collisionBoundingBoxHelper.update(e),this.collisionHelper.update(e))}update(e){if(D4(this,!0,this.rotateEventTypes,P4),this._aggregator.reset(),!this._enabled||e.passes.pick)return;this.updateBoundingBox(),this.updateBoundingBoxHelper(e);let{deltaTime:t}=e;const i=Math.min(.05,t)/bM;for(let r=0;r<bM;r++)this.updateControls(i),this.updatePlayer(i)}isDestroyed(){return!1}destroy(){var e,t;return(e=this.collisionBoundingBoxHelper)==null||e.destroy(),(t=this.preCollisionTestBoundingBoxHelper)==null||t.destroy(),this.container.removeEventListener("keydown",this.removeKeyDownEventCallback),this.container.removeEventListener("keyup",this.removeKeyUpEventCallback),document.removeEventListener("visibilitychange",this.visibilitychangeCallback),ht(this)}}let SM=[];function D4(n,e,t,i){if(!O(t))return;let r=n._aggregator;Array.isArray(t)||(SM[0]=t,t=SM);let s=t.length;for(let o=0;o<s;++o){let a=t[o],l=O(a.eventType)?a.eventType:a,c=a.modifier,u=r.isMoving(l,c)&&r.getMovement(l,c),d=r.getStartMousePosition(l,c);n.enabled&&e&&u&&i(n,d,u)}}class L4{constructor(e){f(this,"destroyPlugins",!0);f(this,"plugins",[]);f(this,"_guid",Zl());f(this,"visible",!0);f(this,"clippingControl");f(this,"firstPersonControl");f(this,"drawHelper");this.scene=e,this.firstPersonControl=new R4(e,this),this.clippingControl=new b4(e,this),this.drawHelper=new yM(e,this)}get length(){return this.plugins.length}add(e,t){const i=O(t),r=e._external=e._external||{},s=r._composites=r._composites||{};return s[this._guid]={collection:this},i?this.plugins.splice(t,0,e):this.plugins.push(e),e}removeObject(e){if(this.contains(e)){const t=this.plugins.indexOf(e);if(t!==-1)return this.plugins.splice(t,1),delete e._external._composites[this._guid],this.destroyPlugins&&e.destroy(),!0}return!1}contains(e){return!!(O(e)&&e._external&&e._external._composites&&e._external._composites[this._guid])}get(e){return this.plugins[e]}update(e){if(!this.visible)return;const t=this.plugins;for(let i=0;i<t.length;++i)t[i].update(e)}prePassesUpdate(e){const t=this.plugins;for(let i=0;i<t.length;++i){const r=t[i];O(r.prePassesUpdate)&&r.prePassesUpdate(e)}}updateForPass(e){const t=this.plugins;for(let i=0;i<t.length;++i){const r=t[i];O(r.updateForPass)&&r.updateForPass(e)}}postPassesUpdate(e){const t=this.plugins;for(let i=0;i<t.length;++i){const r=t[i];O(r.postPassesUpdate)&&r.postPassesUpdate(e)}}removeAll(){const e=this.plugins,t=e.length;for(let i=0;i<t;++i)delete e[i]._external._composites[this._guid],this.destroyPlugins&&e[i].destroy();this.plugins=[]}isDestroyed(){return!1}destroy(){return this.removeAll(),ht(this)}}class ny extends zi{constructor(){super();f(this,"destroyChildren",!0);f(this,"children",[]);f(this,"_guid",Zl())}get length(){return this.children.length}addObject(t,i){const r=O(i),s=t._external=t._external||{},o=s._composites=s._composites||{};return o[this.uuid]={collection:this},r?this.children.splice(i,0,t):this.children.push(t),t}removeObject(t){if(this.contains(t)){const i=this.children.indexOf(t);if(i!==-1)return this.children.splice(i,1),delete t._external._composites[this.uuid],this.destroyChildren&&t.destroy(),!0}return!1}contains(t){return!!(O(t)&&t._external&&t._external._composites&&t._external._composites[this.uuid])}get(t){return this.children[t]}update(t){if(!this.visible)return;const i=this.children;for(let r=0;r<i.length;++r)i[r].update(t)}prePassesUpdate(t){const i=this.children;for(let r=0;r<i.length;++r){const s=i[r];O(s.prePassesUpdate)&&s.prePassesUpdate(t)}}updateForPass(t,i){const r=this.children;for(let s=0;s<r.length;++s){const o=r[s];O(o.updateForPass)&&o.updateForPass(t,i)}}postPassesUpdate(t){const i=this.children;for(let r=0;r<i.length;++r){const s=i[r];O(s.postPassesUpdate)&&s.postPassesUpdate(t)}}removeAll(){const t=this.children,i=t.length;for(let r=0;r<i;++r)delete t[r]._external._composites[this._guid],this.destroyChildren&&t[r].destroy();this.children=[]}destroy(){return this.removeAll(),ht(this)}}class EM{constructor(e,t,i,r,s,o,a,l,c,u){f(this,"tweens");f(this,"tweenjs");f(this,"startObject");f(this,"stopObject");f(this,"duration");f(this,"delay");f(this,"easingFunction");f(this,"update");f(this,"complete");f(this,"cancel");f(this,"needsStart",!0);this.tweens=e,this.tweenjs=t,this.startObject=js(i),this.stopObject=js(r),this.duration=s,this.delay=o,this.easingFunction=a,this.update=l,this.complete=c,this.cancel=u}cancelTween(){this.tweens.remove(this)}}class O4{constructor(){f(this,"_tweens",[])}get length(){return this._tweens.length}add(e){if(!O(e.startObject)||!O(e.stopObject))throw new Ze("options.startObject and options.stopObject are required.");if(!O(e.duration)||e.duration<0)throw new Ze("options.duration is required and must be positive.");if(e.duration===0)return O(e.complete)&&e.complete(),new EM(this);const t=e.duration/Dn.SECONDS_PER_MILLISECOND,i=ye(e.delay,0),r=i/Dn.SECONDS_PER_MILLISECOND,s=ye(e.easingFunction,Qd.LINEAR_NONE),o=e.startObject,a=new R2(o);a.to(js(e.stopObject),t),a.delay(r),a.easing(s),O(e.update)&&a.onUpdate(()=>{e.update(o)}),a.onComplete(ye(e.complete,null)),a.repeat(ye(e._repeat,0));const l=new EM(this,a,e.startObject,e.stopObject,e.duration,i,s,e.update,e.complete,e.cancel);return this._tweens.push(l),l}addProperty(e){e=ye(e,ye.EMPTY_OBJECT);const t=e.object,i=e.property,r=e.startValue,s=e.stopValue;if(!O(t)||!O(e.property))throw new Ze("options.object and options.property are required.");if(!O(t[i]))throw new Ze("options.object must have the specified property.");if(!O(r)||!O(s))throw new Ze("options.startValue and options.stopValue are required.");function o(a){t[i]=a.value}return this.add({startObject:{value:r},stopObject:{value:s},duration:ye(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:o,complete:e.complete,cancel:e.cancel,_repeat:e._repeat})}remove(e){if(!O(e))return!1;const t=this._tweens.indexOf(e);return t!==-1?(e.tweenjs.stop(),O(e.cancel)&&e.cancel(),this._tweens.splice(t,1),!0):!1}removeAll(){const e=this._tweens;for(let t=0;t<e.length;++t){const i=e[t];i.tweenjs.stop(),O(i.cancel)&&i.cancel()}e.length=0}contains(e){return O(e)&&this._tweens.indexOf(e)!==-1}get(e){return this._tweens[e]}update(e){const t=this._tweens;let i=0;for(e=O(e)?e/Dn.SECONDS_PER_MILLISECOND:_o();i<t.length;){const r=t[i],s=r.tweenjs;r.needsStart?(r.needsStart=!1,s.start(e)):s.update(e)?i++:(s.stop(),t.splice(i,1))}}}class N4{constructor(e=0,t=0){f(this,"near",0);f(this,"far",0);f(this,"commands");f(this,"indices");this.near=e,this.far=t;const i=rr.NUMBER_OF_PASSES,r=new Array(i),s=new Array(i);for(let o=0;o<i;++o)r[o]=[],s[o]=0;this.commands=r,this.indices=s}}const TM=new T,AM=new T,MM=new T,CM=new T;function B4(n,e){const t=Math.max(Math.abs(n.x),Math.abs(e.x)),i=Math.max(Math.abs(n.y),Math.abs(e.y)),r=Math.max(Math.abs(n.z),Math.abs(e.z));return Math.max(Math.max(t,i),r)}function F4(n,e,t){const i=1/Math.max(1,B4(n.position,e.position));TM.copy(n.position).multiplyScalar(i),AM.copy(e.position).multiplyScalar(i);let r=n.view.target,s=e.view.target;return MM.set(r[0],r[1],r[2]),CM.set(s[0],s[1],s[2]),T.equalsEpsilon(TM,AM,t)&&T.equalsEpsilon(MM,CM,t)&&T.equalsEpsilon(n.up,e.up,t)&&fe.equalsEpsilon(n.frustum.projectionMatrix,e.frustum.projectionMatrix,t)}class U4{constructor(e){f(this,"scene");f(this,"cameraClone");f(this,"_cameraStartFired",!1);f(this,"_cameraMovedTime",_o());f(this,"frustumCommand",new N4);this.scene=e,this.cameraClone=yo.clone(this.camera)}get camera(){return this.scene.camera}get renderer(){return this.scene.renderer}checkForCameraUpdates(e){const t=this.camera,i=this.cameraClone;return F4(t,i,Ne.EPSILON7)?(this._cameraStartFired&&_o()-this._cameraMovedTime>e.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=_o(),yo.clone(t,i),!0)}createPotentiallyVisibleSet(){let e=this.frustumCommand;this.frustumCommand.near=this.camera.near,this.frustumCommand.far=this.camera.far;const t=this.scene.frameState.commandList,i=rr.NUMBER_OF_PASSES;for(let s=0;s<i;++s)this.frustumCommand.indices[s]=0,this.frustumCommand.commands[s]=[];const r=t.length;for(let s=0;s<r;++s){const o=t[s],a=o.pass,l=e.indices[a]++;e.commands[a][l]=o}}}let k4=new Jp({pass:Dr.RENDER}),ry=new Jp({pass:Dr.PRELOAD});new Jp({pass:Dr.PRELOAD_FLIGHT});const z4=new Jp({pass:Dr.REQUEST_RENDER_MODE_DEFER_CHECK});new ve;const Uo=new T,[sy,IM]=[new T,new T],H4=n=>()=>{n.frameState.afterRender.push(()=>{n.requestRender()})};function G4(n){const e=n.frameState.afterRender;for(let t=0,i=e.length;t<i;++t)e[t](),n.requestRender();e.length=0}function V4(n){n.effectComposerCollection.render()}function W4(n){n.clearBoundingVolume();const e=n.frameState;n.primitives.prePassesUpdate(e),n.pluginCollection.prePassesUpdate(e),n.picking.update()}function X4(n){const e=n.frameState;ry.camera=e.camera,ry.cullingVolume=e.cullingVolume,n.primitives.updateForPass(e,ry)}function Y4(n){n.primitives.updateForPass(n.frameState,z4)}function j4(n){let{showAxisAlignedBoundingBox:e,axisAlignedBoundingBoxHelper:t,_axisAlignedBoundingBox:i,axisAlignedBoundingBox:r}=n;r.isEmpty()||(n.axisAlignedBoundingBox.getBoundingSphere(n.boundingSphere),i.equals(r)||i.copy(r),e&&(O(t)?n.axisAlignedBoundingBoxHelper.updateFromBoundingBox(r):n.axisAlignedBoundingBoxHelper=new Pr(r),n.frameState.commandList.push(n.axisAlignedBoundingBoxHelper)))}function q4(n){const e=n.frameState;n.updateFrameState(),e.passes.render=!0,e.tilesetPassState=k4,n.context.uniformState.update(e),j4(n),n.updateEnvironment(e),n.updateAndExecuteCommands(!0),V4(n)}function Z4(n){const e=n.frameState;n.primitives.postPassesUpdate(e),Ys.update()}function vu(n,e){try{e(n)}catch(t){n.renderError.raiseEvent(t),n.rethrowRenderErrors&&console.error(t)}}const PM={[Pt.SCENE2D]:{axesSize:1e4,camera:{type:vo.ORTHOGRAPHIC,near:1,far:1e6}},[Pt.SCENE3D]:{axesSize:1e6,camera:{type:vo.PERSPECTIVE}}};class RM extends uh{constructor(t,i,r){super();f(this,"frameState");f(this,"renderer");f(this,"dwg2DViewPlane",new es(new T(0,0,1),0));f(this,"maximumRenderSize",1e8);f(this,"maximumRenderRange",new Lt().setFromCenterAndSize(new T,new T(2e8,2e8,2e8)));f(this,"container");f(this,"camera");f(this,"picking");f(this,"context");f(this,"tweens",new O4);f(this,"effectComposerCollection");f(this,"primitiveCollection",new ny);f(this,"pluginCollection");f(this,"htmlOverlayCollection",new wS);f(this,"drawingRenderCollection",new ny);f(this,"renderCollection",new ny);f(this,"_mode");f(this,"cameraEventWaitTime",200);f(this,"view");f(this,"requestRenderMode",!1);f(this,"_renderRequested",!0);f(this,"backgroundColor",new We(0,0,0,1));f(this,"maximumRenderTimeChange",0);f(this,"viewer");f(this,"rethrowRenderErrors",!1);f(this,"clock",new Hd);f(this,"enabledPickVertices",!1);f(this,"_cameraControl");f(this,"_removeRequestListenerCallback",Ys.RequestCompletedEvent.addEventListener(H4(this)));f(this,"lightCollection");f(this,"_cameraUnderground",!1);f(this,"cameraControl");f(this,"pickPositionSupported",!0);f(this,"_boundingSphere",new Mi);f(this,"showAxisAlignedBoundingBox",!1);f(this,"axisAlignedBoundingBoxHelper");f(this,"_axisAlignedBoundingBox",new Lt);f(this,"axisAlignedBoundingBox",new Lt);f(this,"preUpdate",new Vn);f(this,"postUpdate",new Vn);f(this,"preRender",new Vn);f(this,"postRender",new Vn);f(this,"renderError",new Vn);this.up.set(0,0,1),this.viewer=t,this.mode=r.mode;const{clientWidth:s,clientHeight:o}=i;this.renderer=new R5({antialias:!0,logarithmicDepthBuffer:!1},this.mode),this.renderer.setSize(s,o),this.renderer.scene=this,this.container=i,this.camera=new yo(this),this.camera.constrainedAxis=T.UNIT_Z,this.view=new U4(this),this.picking=new t4(this),this.context=new kv(this),this.frameState=new Q5(this),this.effectComposerCollection=new K5(this),this.renderCollection.frustumCulled=!1,this.drawingRenderCollection.frustumCulled=!1,r.axes&&this.primitives.addObject(new O5(PM[this.mode].axesSize)),this.lightCollection=new J5(this),this.cameraControl=new KA(t,this),this.camera.switchCamera(PM[Pt.SCENE3D].camera),this.pluginCollection=new L4(this)}get screenSpaceCameraController(){return this.cameraControl._currentControl}get drawingMask(){return this.effectComposerCollection.mainEffectComposer.drawingMaskPass}get canvas(){return this.renderer.domElement}get drawingBufferSize(){return this.renderer.drawingBufferSize}get primitives(){return this.primitiveCollection}get pixelResolution(){const{position:t,target:i}=this.camera.getView();return this.camera.getThresholdBySize(t,i,1,this.container)}get mode(){return this._mode}set mode(t){t===Pt.SCENE2D&&(this.renderer.sortObjects=!1,this.cameraControl.enableRotate(!1),this.cameraControl.enableLeftEvent()),this._mode=t}get cameraUnderground(){return this._cameraUnderground}get boundingSphere(){return this._boundingSphere}get drawingBufferWidth(){return this.context.drawingBufferWidth}get drawingBufferHeight(){return this.context.drawingBufferHeight}addPrimitive(t){return this.primitiveCollection.addObject(t)}forceRender(t){this._renderRequested=!0,this.render(t)}requestRender(){this._renderRequested=!0}setSize(t,i){this.renderer.setSize(t,i),this.camera.resize(t,i),this.effectComposerCollection.setSize(),this.context.setSize()}initializeFrame(){this.tweens.update(),this.renderer.getViewport(this.renderer.viewport),this.cameraControl.update(this.frameState.deltaTime),this.camera.update(this.mode),this.camera._updateCameraChanged()}updateEnvironment(t){this.lightCollection.update(t)}render(t=ni.now()){const i=this.frameState;i.newFrame=!1;const r=this.view.checkForCameraUpdates(this);r&&this.camera._updateCameraChanged();let s=!this.requestRenderMode||this._renderRequested||r;this.preUpdate.raiseEvent(),s&&(this._renderRequested=!1,this.renderer.info.reset(),i.frameNumber=Ne.incrementWrap(i.frameNumber,15e6,1),i.time=ni.clone(t,i.time),i.deltaTime=this.clock.getDelta(),i.newFrame=!0),vu(this,W4),this.primitives.visible&&(vu(this,X4),s||vu(this,Y4)),this.postUpdate.raiseEvent(),s&&(this.preRender.raiseEvent(),vu(this,q4)),vu(this,Z4),G4(this),s&&this.postRender.raiseEvent()}clearPasses(t){t.depth=!1,t.pick=!1,t.depth=!1}clearBoundingVolume(){this._boundingSphere.makeEmpty(),this.axisAlignedBoundingBox.makeEmpty()}updateAndExecuteCommands(t,i=[]){t||(this.frameState.commandList.length=0),this.updateCommands(this.frameState),this.view.createPotentiallyVisibleSet(),this.renderCollection.children=[],this.drawingRenderCollection.children=[],this.view.frustumCommand.commands.forEach((s,o)=>{o===rr.DWG_OLE||o===rr.DWG_VIEWER2D?this.drawingRenderCollection.children=this.drawingRenderCollection.children.concat(s):this.renderCollection.children=this.renderCollection.children.concat(s)})}updateCommands(t){this.primitives.update(t),this.pluginCollection.update(t),this.htmlOverlayCollection.update(t)}updateFrameState(){const t=this.camera,i=this.frameState;i.commandList.length=0,i.camera=t,i.context=this.context,i.cullingVolume=t._orthoFrustum.cullVolume;const{r,g:s,b:o}=this.renderer.backgroundColor;this.frameState.backgroundColor.set(r,s,o,this.renderer.backgroundAlpha),this.clearPasses(i.passes),i.tilesetPassState=void 0}_renderObjectCollection(t){const{renderer:i,camera:r}=this;this.addObject(t),i.render(this,r.frustum),this.remove(t)}pickRectangle(t,i=3,r=3){return this.picking.pickRectangle(this,t,i,r)}pickObject(t,i=3,r=3){return this.picking.pick(this,t,i,r)}pickPosition(t,i=new T){return this.picking.pickPosition(t,i)}pickPosition2D(t,i=new T){return this.picking.pickPosition2D(t,i)}worldToScreen(t,i=!0){if(this.mode===Pt.SCENE2D){Uo.x=t.x,Uo.y=t.y,Uo.z=t instanceof T?t.z:0;const r=Uo.project(this.camera.frustum),s=this.container.clientWidth/2,o=this.container.clientHeight/2;return i?[Math.floor(r.x*s+s),Math.floor(-r.y*o+o)]:[r.x*s+s,-r.y*o+o]}return console.warn("scene.positionToCanvasCoordinates"),this.positionToCanvasCoordinates(t).toArray()}positionToCanvasCoordinates(t,i=new he){if(this.mode===Pt.SCENE2D){Uo.x=t.x,Uo.y=t.y,Uo.z=t instanceof T?t.z:0;const a=Uo.project(this.camera.frustum),l=this.container.clientWidth/2,c=this.container.clientHeight/2;return i.set(a.x*l+l,-a.y*c+c)}IM.copy(t);let{frustum:r}=this.camera;const{clientWidth:s,clientHeight:o}=this.container;return sy.copy(IM.project(r)),i.x=(sy.x+1)*s/2,i.y=-(sy.y-1)*o/2,i}drillPick(t,i,r=3,s=3){}}function DM(n){const e=n.attributes,t=Object.keys(e);for(let i=0;i<t.length;i++){const r=e[t[i]];r instanceof jt?r.data=null:(r.array=null,r.buffer=null)}n.index&&(n.index.array=null)}class K4{constructor(e,t={}){f(this,"_instance");f(this,"depth",3);this.shape=e,this.depth=t.depth??this.depth}createGeometry(){const e=new Rd(this.shape,{bevelEnabled:!1,depth:this.depth});return this.shape=null,this._instance=new u_(e),DM(e),this._instance}isDestroyed(){return!1}destroy(){return ht(this)}}class _m{constructor(e=!0){f(this,"value");this.value=_m.toValue(e)}get componentDatatype(){return xt.UNSIGNED_BYTE}get componentsPerAttribute(){return 1}get normalize(){return!1}static toValue(e,t){return O(t)?(t[0]=Number(e),t):new Uint8Array([Number(e)])}}class LM extends wi{constructor(t={}){let{fragmentShader:i,vertexShader:r,uniforms:s}=Ni.basic;super({fragmentShader:i,vertexShader:r,lights:!1,uniforms:Tn.merge([s,{batchTextureStep:{value:new nt},batchTextureDimensions:{value:new he},batchTexture:{value:void 0}}])});f(this,"isLineBasicMaterial",!0);f(this,"color",new ve(16711680));f(this,"map",null);f(this,"linewidth",1);f(this,"linecap","round");f(this,"linejoin","round");f(this,"fog",!0);this.setValues(t)}get batchTextureStep(){return this.uniforms.batchTextureStep.value}set batchTextureStep(t){this.uniforms.batchTextureStep.value.copy(t)}get batchTextureDimensions(){return this.uniforms.batchTextureDimensions.value}set batchTextureDimensions(t){this.uniforms.batchTextureDimensions.value.copy(t)}get batchTexture(){return this.uniforms.batchTexture.value}set batchTexture(t){this.uniforms.batchTexture.value=t}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class OM extends wi{constructor(t={}){const{fragmentShader:i,vertexShader:r,uniforms:s}=Ni.physical;super({lights:!0,vertexShader:r,fragmentShader:i,toneMapped:!0,uniforms:Tn.merge([s,{batchTextureStep:{value:new nt},batchTextureDimensions:{value:new he},batchTexture:{value:void 0}}])});f(this,"isMeshStandardMaterial",!0);f(this,"isMeshPhysicalMaterial",!0);f(this,"color",new ve(16777215));f(this,"roughness",1);f(this,"metalness",0);f(this,"map");f(this,"lightMap",null);f(this,"lightMapIntensity",1);f(this,"aoMap",null);f(this,"aoMapIntensity",1);f(this,"emissive",new ve(0));f(this,"emissiveIntensity",1);f(this,"emissiveMap",null);f(this,"bumpMap",null);f(this,"bumpScale",1);f(this,"normalMap",null);f(this,"normalMapType",Br);f(this,"normalScale",new he(1,1));f(this,"displacementMap",null);f(this,"displacementScale",1);f(this,"displacementBias",0);f(this,"roughnessMap",null);f(this,"metalnessMap",null);f(this,"alphaMap",null);f(this,"envMap",null);f(this,"envMapIntensity",1);f(this,"wireframe",!1);f(this,"wireframeLinewidth",1);f(this,"wireframeLinecap","round");f(this,"wireframeLinejoin","round");f(this,"flatShading",!1);f(this,"fog",!0);f(this,"clearcoatMap",null);f(this,"clearcoatRoughness",0);f(this,"clearcoatRoughnessMap",null);f(this,"clearcoatNormalScale",new he(1,1));f(this,"clearcoatNormalMap",null);f(this,"ior",1.5);f(this,"iridescenceMap",null);f(this,"iridescenceIOR",1.3);f(this,"iridescenceThicknessRange",[100,400]);f(this,"iridescenceThicknessMap",null);f(this,"sheenColor",new ve(0));f(this,"sheenColorMap",null);f(this,"sheenRoughness",1);f(this,"sheenRoughnessMap",null);f(this,"transmissionMap",null);f(this,"thickness",0);f(this,"thicknessMap",null);f(this,"attenuationDistance",1/0);f(this,"attenuationColor",new ve(1,1,1));f(this,"specularIntensity",1);f(this,"specularIntensityMap",null);f(this,"specularColor",new ve(1,1,1));f(this,"specularColorMap",null);f(this,"_sheen",0);f(this,"_clearcoat",0);f(this,"_iridescence",0);f(this,"_transmission",0);f(this,"hasCompile",!1);this.defines={STANDARD:"",PHYSICAL:""},this.uniforms.roughness.value=0,this.uniforms.metalness.value=1,this._clearcoat,Object.defineProperty(this,"reflectivity",{get:function(){return kn.clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(o){this.ior=(1+.4*o)/(1-.4*o)}}),this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}update(t){let{scene:i}=t;this.uniforms.environment.value=i.environment,this.uniforms.envMap.value=i.environment,this.uniforms.envMapRotation.value=i.environmentRotation}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}get batchTextureStep(){return this.uniforms.batchTextureStep.value}set batchTextureStep(t){this.uniforms.batchTextureStep.value.copy(t)}get batchTextureDimensions(){return this.uniforms.batchTextureDimensions.value}set batchTextureDimensions(t){this.uniforms.batchTextureDimensions.value.copy(t)}get batchTexture(){return this.uniforms.batchTexture.value}set batchTexture(t){this.uniforms.batchTexture.value=t}}class NM extends wi{constructor(t={}){let{fragmentShader:i,vertexShader:r,uniforms:s}=Ni.basic;super({fragmentShader:i,vertexShader:r,lights:!1,uniforms:Tn.merge([s,{batchTextureStep:{value:new nt},batchTextureDimensions:{value:new he},batchTexture:{value:void 0}}])});f(this,"isMeshBasicMaterial",!0);f(this,"color",new ve(16777215));f(this,"map");f(this,"lightMap");f(this,"lightMapIntensity",1);f(this,"aoMap");f(this,"aoMapIntensity",1);f(this,"specularMap");f(this,"alphaMap");f(this,"envMap");f(this,"envMapRotation",new Oi);f(this,"combine",rl);f(this,"reflectivity",1);f(this,"refractionRatio",.98);f(this,"wireframe",!1);f(this,"wireframeLinewidth",1);f(this,"wireframeLinecap","round");f(this,"wireframeLinejoin","round");f(this,"fog",!0);this.setValues(t)}get batchTextureStep(){return this.uniforms.batchTextureStep.value}set batchTextureStep(t){this.uniforms.batchTextureStep.value.copy(t)}get batchTextureDimensions(){return this.uniforms.batchTextureDimensions.value}set batchTextureDimensions(t){this.uniforms.batchTextureDimensions.value.copy(t)}get batchTexture(){return this.uniforms.batchTexture.value}set batchTexture(t){this.uniforms.batchTexture.value=t}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}var tl=(n=>(n[n.DISABLED=0]="DISABLED",n[n.ENABLED=1]="ENABLED",n[n.CAST_ONLY=2]="CAST_ONLY",n[n.RECEIVE_ONLY=3]="RECEIVE_ONLY",n))(tl||{});const Q4={combineGeometry(n){const{instances:e,modelMatrix:t,compressVertices:i}=n,r=e.map((o,a)=>{const l=o.geometry,c=new Array(l.getAttribute("position").count).fill(a);return l.setAttribute("batchId",new $e(c,1)),o.geometry}),s=lA(r);return i&&r.forEach(o=>DM(o)),{geometry:s}}};var il=(n=>(n[n.READY=0]="READY",n[n.CREATING=1]="CREATING",n[n.CREATED=2]="CREATED",n[n.COMBINING=3]="COMBINING",n[n.COMBINED=4]="COMBINED",n[n.COMPLETE=5]="COMPLETE",n[n.FAILED=6]="FAILED",n))(il||{});function $4(n,e,t){return function(){var i=n.getBatchedAttribute(e,t),r=n.attributes[t],s=r.componentsPerAttribute,o=xt.createTypedArray(r.componentDatatype,s);return O(i.constructor.pack)?i.constructor.pack(i,o,0):o[0]=i,o}}function J4(n,e,t,i,r){return function(s){var o=FM(s);n.setBatchedAttribute(e,t,o)}}function eH(n,e,t){e.pickId={get:function(){return n._pickIds[t]}}}function tH(n,e){return{geometry:e,attributes:n.attributes,modelMatrix:fe.clone(n.modelMatrix),id:n.id}}function iH(n){let e=`varying vec4 v_pickColor;
    `+n;e=_n.replaceMain(e,"czm_pick_main");const t=`void main(){
        czm_pick_main();
        gl_FragColor = v_pickColor;
        
    }`;return e+`
`+t}function nH(n){const e=n.length,t=[],i=n[0].attributes;let r;for(r in i)if(Object.prototype.hasOwnProperty.call(i,r)&&O(i[r])){const s=i[r];let o=!0;for(let a=1;a<e;++a){const l=n[a].attributes[r];if(!O(l)||s.componentDatatype!==l.componentDatatype||s.componentsPerAttribute!==l.componentsPerAttribute||s.normalize!==l.normalize){o=!1;break}}o&&t.push(r)}return t}const rH=new he,sH=new T,BM=new nt;function FM(n){const e=n.length;if(e===1)return n[0];if(e===2)return he.unpack(n,0,rH);if(e===3)return T.unpack(n,0,sH);if(e===4)return nt.unpack(n,0,BM)}function oH(n,e){n._state=il.CREATING}function aH(n,e){const{geometryInstances:t,_instanceIds:i}=n,r=t.length,s=new Array(t.length);let o=0,a;for(let c=0;c<r;c++){a=t[c];const u=a.geometry.createGeometry();u.applyMatrix4(a.modelMatrix),u.computeBoundingBox(),n.boundingVolume.union(u.boundingBox),s[o++]=tH(a,u),i.push(a.id)}s.length=o;const l=Q4.combineGeometry({instances:s,modelMatrix:n.modelMatrix,compressVertices:n.compressVertices});n._geometry=l.geometry,n.boundingVolume.getBoundingSphere(n.boundingSphere),n._state=il.COMBINED}function UM(n){const e=_n.replaceMain(n,"czm_non_pick_main"),t=`varying vec4 v_pickColor; 
void main() 
{ 
    czm_non_pick_main(); 
    v_pickColor = czm_batchTable_pickColor(batchId); 
}`;return e+`
`+t}const lH=new Pi;new Us;class xs extends zi{constructor(t){super();f(this,"_state",il.READY);f(this,"_instanceIds",[]);f(this,"_geometry");f(this,"_colorCommand");f(this,"_pickMaterial",new NM);f(this,"_overlayMaterial",new NM({transparent:!1}));f(this,"pass",rr.OPAQUE);f(this,"modelMatrix",fe.clone(fe.IDENTITY));f(this,"_modelMatrix",fe.clone(fe.IDENTITY));f(this,"_modelMatrixInverse",fe.clone(fe.IDENTITY));f(this,"_batchTable");f(this,"_pickIds",[]);f(this,"_batchTableAttributeIndices",{});f(this,"asynchronous",!1);f(this,"compressVertices",!0);f(this,"allowPicking",!0);f(this,"shadows",tl.DISABLED);f(this,"geometryInstances",[]);f(this,"material");f(this,"boundingSphere",new Mi);f(this,"boundingVolume",new Lt);f(this,"_lastPerInstanceAttributeIndex",0);f(this,"_perInstanceAttributeCache",[]);f(this,"debugShowBoundingVolume",!1);f(this,"debuggerBoundingVolumeHelper");f(this,"_rayCasterMesh",new pt(new Er(1,1),lH));f(this,"_rayCasterLine",new Cn(void 0,new rn));f(this,"_readyPromise",mr());const{geometryInstances:i,material:r,asynchronous:s=!1,allowPicking:o=!0,shadows:a=tl.DISABLED,compressVertices:l=!0,debugShowBoundingVolume:c=!1}=t;this.allowPicking=o,this.asynchronous=s,this.shadows=a,this.geometryInstances=i,this.material=r,this.modelMatrix=fe.clone(t.modelMatrix??fe.IDENTITY),this.debugShowBoundingVolume=c,this.compressVertices=l}get readyPromise(){return this._readyPromise.promise}getObject(){return this._colorCommand}createColorCommand(){const{_batchTable:t}=this,i=this.material;let r=t.getVertexShaderCallback()(i.vertexShader);r=xs._appendBatchColorToShader(this,r),r=xs._appendShowToShader(this,r),r=UM(r),r=xs._updateColorAttribute(this,r,!1);let s=i.fragmentShader;s=`
            varying vec4 v_batch_color;
            ${s}
        `,s=s.replace(/vec4\s+diffuseColor\s+=\s+vec4\(\s+diffuse,\s+opacity\s+\);/g,"vec4 diffuseColor = v_batch_color;"),i.vertexShader=r,i.fragmentShader=s,i.batchTexture=t._texture,i.batchTextureStep=t._textureStep,i.batchTextureDimensions=t._textureDimensions,i instanceof LM?this._colorCommand=new Cn(this._geometry,i):this._colorCommand=new pt(this._geometry,i)}updatePickMaterial(){if(!this.allowPicking)return;let{vertexShader:t,fragmentShader:i}=this._pickMaterial;const r=this._batchTable;let s=r.getVertexShaderCallback()(t);s=xs._appendBatchColorToShader(this,s),s=xs._appendShowToShader(this,s),s=UM(s),s=xs._updateColorAttribute(this,s,!1),i=iH(i),this._pickMaterial.fragmentShader=i,this._pickMaterial.vertexShader=s,this._pickMaterial.batchTexture=r._texture,this._pickMaterial.batchTextureStep=r._textureStep,this._pickMaterial.batchTextureDimensions=r._textureDimensions,this._overlayMaterial.fragmentShader=i,this._overlayMaterial.vertexShader=s,this._overlayMaterial.batchTexture=r._texture,this._overlayMaterial.batchTextureStep=r._textureStep,this._overlayMaterial.batchTextureDimensions=r._textureDimensions}getOverlayRenderInstance(){return this._overlayMaterial.side=this.material.side,this._overlayMaterial.batchTexture=this._batchTable._texture,this._colorCommand.material=this._overlayMaterial,this._colorCommand}raycast(t,i,r){}getVertexPosition(t,i,r=new T){if(!(!this._colorCommand||this._colorCommand instanceof Cn))return this._colorCommand.getVertexPosition(t,r),r.applyMatrix4(this.modelMatrix),r}updateModelMatrix(){const t=this.modelMatrix;fe.equals(this._modelMatrix,t)||!this._colorCommand||(this._colorCommand.applyMatrix4(this._modelMatrixInverse),this.boundingVolume.applyMatrix4(this._modelMatrixInverse),this._colorCommand.applyMatrix4(this.modelMatrix),this.boundingVolume.applyMatrix4(this.modelMatrix),this.boundingVolume.getBoundingSphere(this.boundingSphere),fe.clone(t,this._modelMatrix),fe.clone(t,this._modelMatrixInverse),this._modelMatrixInverse.invert())}createBatchTable(t){const i=this.geometryInstances,r=Array.isArray(i)?i:[i],s=r.length;if(s===0)return;const{context:o}=t,a=nH(r),l=a.length,c=[],u={};let p=r[0].attributes,g,_,x;for(g=0;g<l;++g)_=a[g],x=p[_],u[_]=g,c.push({functionName:"czm_batchTable_"+_,componentDatatype:x.componentDatatype,componentsPerAttribute:x.componentsPerAttribute,normalize:x.normalize});c.push({functionName:"czm_batchTable_pickColor",componentDatatype:xt.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});const b=c.length,y=new Up(o,c,s);for(y._pixelDatatype=Yi.FLOAT,g=0;g<s;++g){const M=r[g];p=M.attributes;for(let N=0;N<l;++N){_=a[N],x=p[_];const L=FM(x.value),P=u[_];y.setBatchedAttribute(g,P,L)}const E={instanceId:g,primitive:ye(M.pickPrimitive,this)};O(M.id)&&(E.id=M.id);const w=o.createPickColorSafeRange(E);this._pickIds.push(w);const I=w.color,B=BM;B.x=We.floatToByte(I.red),B.y=We.floatToByte(I.green),B.z=We.floatToByte(I.blue),B.w=We.floatToByte(I.alpha),y.setBatchedAttribute(g,b-1,B)}this._batchTable=y,this._batchTableAttributeIndices=u}static _appendShowToShader(t,i){if(!O(t._batchTableAttributeIndices.show))return i;const r=_n.replaceMain(i,"czm_non_show_main"),s=`void main() 
{ 
    czm_non_show_main(); 
    gl_Position *= czm_batchTable_show(batchId); 
}`;return r+`
`+s}static _appendBatchColorToShader(t,i){return O(t._batchTableAttributeIndices.color)&&(i=_n.replaceMain(i,"outputPosition"),i=`
            attribute float batchId;
            attribute vec4 batch_color;
            varying vec4 v_batch_color;
            ${i}
            
            void main(){
                v_batch_color = batch_color;
                outputPosition();
            }
        `),i}static _updateColorAttribute(t,i,r){if(!O(t._batchTableAttributeIndices.color)&&!O(t._batchTableAttributeIndices.depthFailColor)||i.search(/attribute\s+vec4\s+batch_color;/g)===-1)return i;let s=i;return s=s.replace(/attribute\s+vec4\s+batch_color;/g,""),r?s=s.replace(/(\b)batch_color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):s=s.replace(/(\b)batch_color(\b)/g,"$1czm_batchTable_color(batchId)$2"),s}updateShadow(){const{_colorCommand:t,shadows:i}=this;switch(i){case tl.DISABLED:t.receiveShadow=!1,t.castShadow=!1;break;case tl.ENABLED:t.receiveShadow=!0,t.castShadow=!0;break;case tl.RECEIVE_ONLY:t.receiveShadow=!0,t.castShadow=!1;break;case tl.CAST_ONLY:t.receiveShadow=!1,t.castShadow=!0;break}}unpackPickInfo(t){return{primitive:this,id:t.id,pickColor:t.pickColor}}getGeometryInstanceAttributes(t){for(var i=-1,r=this._lastPerInstanceAttributeIndex,s=this._instanceIds,o=s.length,a=0;a<o;++a){var l=(r+a)%o;if(t===s[l]){i=l;break}}if(i!==-1){var c=this._perInstanceAttributeCache[i];if(O(c))return c;var u=this._batchTable,d=this._batchTableAttributeIndices;c={};var p={};for(var g in d)if(d.hasOwnProperty(g)){var _=d[g];p[g]={get:$4(u,i,_),set:J4(u,i,_)}}return eH(this,p,i),Object.defineProperties(c,p),this._lastPerInstanceAttributeIndex=i,this._perInstanceAttributeCache[i]=c,c}}getPickColor(t){return t.pickColor}prePassesUpdate(t){this._state===il.COMBINED&&t.scene.axisAlignedBoundingBox.union(this.boundingVolume)}createBoundingVolumeHelper(){O(this.debuggerBoundingVolumeHelper)||(this.debuggerBoundingVolumeHelper=new Pr(this.boundingVolume,new Xn(16776960)))}update(t){this.visible&&(t.passes.pick&&!this.allowPicking||(O(this._batchTable)||this.createBatchTable(t),this._state!==il.COMPLETE&&this._state!==il.COMBINED&&(this.asynchronous?oH(this):aH(this)),this._batchTable.update(t),O(this._colorCommand)||(this.createColorCommand(),this.updatePickMaterial(),t.afterRender.push(()=>{this._readyPromise.resolve(this)})),this.updateModelMatrix(),this._colorCommand.material=this.material,this.updateShadow(),t.passes.pick&&this.allowPicking&&(this._colorCommand.castShadow=!1,this._colorCommand.receiveShadow=!1,this._colorCommand.material=this._pickMaterial),t.commandList.push(this._colorCommand),!t.passes.pick&&this.debugShowBoundingVolume&&(this.createBoundingVolumeHelper(),this.debuggerBoundingVolumeHelper.update(t))))}isDestroyed(){return!1}destroy(){var t,i,r;return this._overlayMaterial.dispose(),this._pickMaterial.dispose(),(i=(t=this._colorCommand)==null?void 0:t.geometry)==null||i.dispose(),this.material.dispose(),(r=this._batchTable)==null||r.destroy(),ht(this)}}const oy=new Us,Bm=class Bm{constructor(e){f(this,"url");f(this,"defaultColor","#FF0000cc");f(this,"visible",!0);f(this,"floorHeight",20);f(this,"extrudeHeight",3);f(this,"height",1);f(this,"data");f(this,"state",0);f(this,"basePath");f(this,"resource");f(this,"floorMap",new Map);f(this,"_transparent",!1);f(this,"_opacity",.8);f(this,"_transform",new fe);f(this,"model");f(this,"boundingVolume",new Lt);f(this,"boundingSphere",new Mi);f(this,"_readyPromise",mr());f(this,"_instanceProperties");f(this,"_buildingSuffix","F");f(this,"_suffix","F");f(this,"floorBoundingVolume",new Lt);f(this,"_spaceId2ComponentKey",new Map);f(this,"_componentKey2Box",new Map);if(this.url=e.url,this.defaultColor=e.defaultColor??this.defaultColor,this._instanceProperties=e.properties??{},O(this.url)){let t=Hi.createIfNeeded(this.url);this.basePath=t.getBaseUri(!0),this.resource=t}this.height=e.height??this.height,this.floorHeight=e.floorHeight??this.floorHeight,this.extrudeHeight=e.extrudeHeight??this.extrudeHeight,this._transparent=e.transparent??this._transparent,this._opacity=e.opacity??this._opacity,this.data=e.data}get readyPromise(){return this._readyPromise.promise}get transparent(){return this._transparent}set transparent(e){this._transparent=e}async loadData(){let e=this.url;const t=O(this.data)?this.data:await Hi.fetchJson({url:e});this.state=2,this.data=t}parseData(){const{data:e}=this;e.objects.floors.forEach((i,r)=>this.parseFloor(i))}async parseModel(){this.state=3,this.updateFloorHeight(),this.updateExtrudeHeight();let e=[];for(let t of this.floorMap.values())e.push(t.primitive.readyPromise);Promise.all(e).then(t=>{this.updateBoundingVolume(),this._readyPromise.resolve()}),this.state=4}parseFloor(e){const{geometries:t,floorName:i}=e,r=Number(i.slice(0,-this._suffix.length)),s=[],o=[];for(const c of t)c.properties,this.createGeometryInstance(c,s,o);const a=new xs({geometryInstances:s,material:new OM({transparent:this._transparent})});a.name=r.toString(),a.unpackPickInfo=c=>({...c,properties:t.filter(u=>u.properties.componentKey===c.id)[0].properties,primitive:a,dataSource:this,componentKey:c.id,floorId:e.floorId,floorName:e.floorName}),a.raycast=(c,u,d)=>this.raycast(a,c,u,d),a.getVertexPosition=(c,u,d=new T)=>this.getVertexPosition(a,c,u,d);const l=new xs({geometryInstances:o,allowPicking:!1,material:new LM});this.floorMap.set(e.floorId,{floorName:e.floorName,height:t[0].properties.height,primitive:a,outlinePrimitive:l,visible:!0,componentKey:t[0].properties.componentKey})}raycast(e,t,i,r){const s=e.geometryInstances[i];return oy.ray.copy(t.ray),oy.ray.applyMatrix4(e._modelMatrixInverse),e._rayCasterMesh.geometry=s.geometry._rayCasterGeometry??s.geometry._instance,r=oy.intersectObject(e._rayCasterMesh,!0,r),r}getVertexPosition(e,t,i,r=new T){return r.fromBufferAttribute(e._rayCasterMesh.geometry.getAttribute("position"),t),r.applyMatrix4(e.modelMatrix),r}createGeometryInstance(e,t,i){const{arcs:r,properties:s,type:o}=e,{componentKey:a,color:l,spaceId:c,height:u}=s;if(c&&c!==""){let g=this._spaceId2ComponentKey.get(c)??new Set;g.add(a??c),this._spaceId2ComponentKey.set(c,g)}let d,p;if(o==="Polygon"||o==="MultiPolygon"){this.data;let g=[];r.forEach((I,B)=>{for(let N=0;N<I.length;N++){const L=r[B][N],P=this.data.arcs[L[0]].map(U=>[U[0],U[1]]),R=new uo;R.moveTo(P[0][0],P[0][1]);for(let U=1;U<P.length;U++)R.lineTo(P[U][0],P[U][1]);for(let U=1;U<L.length;U++){const j=this.data.arcs[L[U]],A=new Bl;A.moveTo(j[0][0],j[0][1]);for(let D=1;D<j.length;D++)A.lineTo(j[D][0],j[D][1]);R.holes.push(A)}g.push(R)}}),d=new XE(g,{depth:1});let _=lA(g.map(I=>new Ch(I)));_.computeBoundingBox(),this._componentKey2Box.set(a,_.boundingBox),d._rayCasterGeometry=_;const x=this._instanceProperties[a];let b;O(x)&&O(x.color)?b=x.color:O(l)?b=l:b=this.defaultColor,a&&a!==""&&!this._instanceProperties[a]&&(this._instanceProperties[a]={},this._instanceProperties[a].color=b);let{instanceColor:y,outlineColor:M}=this.computeInstanceColorFromCssString(We.fromCssColorString(b));const E=new N0({geometry:d,attributes:{show:new _m(!0),color:sc.fromColor(We.clone(y))},id:a});t.push(E),p=new K4(g,{depth:1});const w=new N0({geometry:p,attributes:{show:new _m(!0),color:sc.fromColor(M)},id:a});i.push(w)}}getJsonGeometry(e,t){const i=this.data.objects.floors.find(r=>r.floorId===e);return i?i.geometries.find(r=>r.properties.componentKey===t):null}computeInstanceColorFromCssString(e){let t=We.clone(e).withAlpha(this._opacity),i=We.clone(t).brighten(.5,new We).withAlpha(1);return{instanceColor:t,outlineColor:i}}setComponentColor(e,t,i){let{instanceColor:r,outlineColor:s}=this.computeInstanceColorFromCssString(We.fromCssColorString(i)),o=e.primitive.getGeometryInstanceAttributes(t);o&&(o.color=r.toBytes());let a=e.outlinePrimitive.getGeometryInstanceAttributes(t);a&&(a.color=We.clone(s).toBytes())}setComponentColorFromArray(e,t,i){const r=this.floorMap.get(e);if(r){t=Array.isArray(t)?t:[t],i=Array.isArray(i)?i:[i];for(let s=0;s<t.length;s++)this.setComponentColor(r,t[s],i[s])}}setFloorVisible(e,t=!0){const i=this.floorMap.get(e);i&&(i.visible=t)}getFloorVisible(e){const t=this.floorMap.get(e);return t?t.visible:!1}setFloorVisibleFromArray(e,t=!0){e=Array.isArray(e)?e:[e];for(let i=0;i<e.length;i++)this.setFloorVisible(e[i],t)}getFloorBoundingSphere(e){const t=this.floorMap.get(e);return t?t.primitive.boundingSphere:null}updateFloorHeight(e=this.floorHeight){this.floorHeight=e;for(const t of this.floorMap.values()){const{primitive:i,outlinePrimitive:r}=t,s=t.height;fe.setTranslation(i.modelMatrix,new T(0,0,s),i.modelMatrix),fe.setTranslation(r.modelMatrix,new T(0,0,s),r.modelMatrix)}this.updateBoundingVolume()}updateExtrudeHeight(e=this.extrudeHeight){e>=this.floorHeight&&console.warn("Extrude height cannot be greater than floor height"),e=Math.max(Bm.minimumExtrudeHeight,e);const t=Array.from(this.floorMap.values());for(let i=0;i<t.length;i++){const{primitive:r,outlinePrimitive:s}=t[i];r.modelMatrix=fe.setScale(r.modelMatrix,new T(1,1,e),r.modelMatrix),s.modelMatrix=fe.setScale(s.modelMatrix,new T(1,1,e),s.modelMatrix)}this.extrudeHeight=e,this.updateBoundingVolume()}updateBoundingVolume(){this.boundingVolume.makeEmpty();for(let e of this.floorMap.values())this.boundingVolume.union(e.primitive.boundingVolume);this.boundingVolume.getBoundingSphere(this.boundingSphere)}getBoundingBox(e,t=new Lt){t.makeEmpty();for(let i of e){const r=this._componentKey2Box.get(i);O(r)&&t.union(r)}return t}prePassesUpdate(e){this.visible&&e.scene.axisAlignedBoundingBox.union(this.boundingVolume)}update(e){if(this.visible){if(this.state===0&&(this.state=1,this.loadData()),this.state===2&&(this.parseData(),this.parseModel()),this.state===4)for(const t of this.floorMap.values())t.visible&&(t.primitive.update(e),t.outlinePrimitive.update(e));e.passes.pick}}isDestroyed(){return!1}destroy(){for(const e of this.floorMap.values())e.primitive.destroy(),e.outlinePrimitive.destroy();return ht(this)}};f(Bm,"minimumExtrudeHeight",Ne.EPSILON10);let jr=Bm;const vm=new he,kM=new T;function Ic(n,e){if(n){n.clearSelectColorId();for(let t=0;t<e.length;t+=4)n.selectColor.push([e[t],e[t+1],e[t+2],e[t+3]])}}function cH(n){let e=n._zoomTarget;if(!(!O(e)||n.scene.mode===Pt.MORPHING)){var t=n.scene,i=t.camera;n._zoomPromise;var r=ye(n._zoomOptions,{}),s;if(e instanceof Zs)return e.readyPromise.then(function(){let{_tilesetJson:{view:o}}=e;if(O(o)&&e.useDefaultView){let{offset:l=new jl,duration:c}=r,{destination:u,orientation:{direction:d,up:p}}=o,[g,_]=[new T(...d).normalize(),new T(...p)],x={},b=i0({direction:g,up:_},x);x.heading=b.heading,x.pitch=b.pitch;let y=new T(...u);T.multiplyByScalar(g,l.range,kM),T.add(y,kM,y),s={duration:c,destination:y,orientation:{heading:x.heading,pitch:x.pitch,roll:0},complete:function(){n._completeZoom(!0)},cancel:function(){n._completeZoom(!1)}},n.camera.flyTo(s),ym(n);return}var a=e.boundingSphere;O(r.offset)||(r.offset=yo.DEFAULT_OFFSET),s={offset:r.offset,duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){n._completeZoom(!0)},cancel:function(){n._completeZoom(!1)}},n._zoomIsFlight?i.flyToBoundingSphere(e.boundingSphere,s):(i.viewBoundingSphere(a,r.offset),i.lookAtTransform(fe.IDENTITY),n._completeZoom(!0)),ym(n)});if(e instanceof jr)return e.readyPromise.then(function(){n._completeZoom(!0),ym(n)})}}function ym(n){n._zoomPromise=void 0,n._zoomTarget=void 0,n._zoomOptions=void 0}function hH(n){const e=n._zoomPromise;O(e)&&(ym(n),n._completeZoom(!1))}function zM(n,e,t,i=!0){hH(n);const r=new Promise(s=>{n._completeZoom=function(o){o&&s(o)}});return n._zoomPromise=r,n._zoomIsFlight=i,n._zoomOptions=t,Promise.resolve(e).then(function(s){if(n._zoomPromise===r&&(s instanceof Zs||s instanceof jr)){n._zoomTarget=s;return}}),n.scene.requestRender(),r}class ay{constructor(e){f(this,"element");f(this,"container");f(this,"scene");f(this,"input");f(this,"_bgColor","#D6E0EB");f(this,"_bgAlpha",1);f(this,"_hexBgColor",0);f(this,"_enableFps",!1);f(this,"_stats");f(this,"_skipFrameTime",0);f(this,"_lastTime",0);f(this,"_fullscreenElement");f(this,"_canRender",!1);f(this,"_completeZoom");f(this,"_pickEffect",!0);f(this,"pickPixelSize",3);f(this,"_enableMultiSelect",!1);f(this,"enableHighlight",!0);f(this,"mouseMoveSelectColor",[]);f(this,"mouseDownSelectColor",[]);f(this,"mouseDownFileId",[]);f(this,"_zoomPromise");f(this,"_zoomTarget");f(this,"_zoomIsFlight",!1);f(this,"_zoomOptions");f(this,"_pickObject");f(this,"eventHelper",new EU);f(this,"navCube");f(this,"eventHandler");f(this,"serverResource");f(this,"boxSelectionEndEvent",new Vn);f(this,"rectSelect");f(this,"boxSelection");f(this,"measure3d");f(this,"mapSelectEvent");f(this,"_autoResize",!0);e.mode=Pt.SCENE3D,this.element=document.createElement("div"),this.element.className="vengine-viewer",e.container.appendChild(this.element),this.container=e.container,this.input=new A5(this.element),this.scene=new RM(this,this.element,e),this.bgColor="#D6E0EB",this.bgAlpha=1,this.enableFps=e.enableFps??!1,this.renderer.setAnimationLoop(this._tick.bind(this)),this.element.appendChild(this.renderer.domElement),this.renderer.domElement.style.position="absolute",this.configureCanvasSize(),this._fullscreenElement=this.container,this.eventHelper.add(this.scene.postRender,ay.prototype._postRender,this),this.navCube=new ou(this.scene,{}),this.pluginCollection.add(this.navCube),this.eventHandler=new Yn(this.element),this._bindEvents(),this.setZoomSpeed(3),this.rectSelect=new yv(this),this.boxSelection=new qz(this),this.measure3d=new DU(this),this.pluginCollection.add(this.measure3d),this.serverResource=new qs({env:e.env,baseUrl:e.baseUrl})}set isDirty(e){this.scene.requestRender()}get bgColor(){return this._bgColor}set bgColor(e){e!==this._bgColor&&(this._bgColor=e,this._hexBgColor=new ve().set(e).getHex(),this.renderer.setBackgroundColorFromString(this._bgColor),this.isDirty=!0)}set bgAlpha(e){e!==this._bgAlpha&&(this._bgAlpha=e,this.renderer.setBackgroundColorFromString(this._bgColor),this.isDirty=!0)}get hexBgColor(){return this._hexBgColor}set enableFps(e){var t;e!==this._enableFps&&(e&&!this._stats&&(this._stats=new _5(this.element)),(t=this._stats)==null||t.setVisible(e),this._enableFps=e)}get camera(){return this.scene.camera}get cameraType(){return this.camera.cameraType}get picking(){return this.scene.picking}get cameraView(){return this.camera.view}get renderer(){return this.scene.renderer}get canvas(){return this.renderer.domElement}get cameraControl(){return this.scene.cameraControl}get pluginCollection(){return this.scene.pluginCollection}get pickObject(){return this._pickObject}get pickEffect(){return this._pickEffect}get firstPersonControl(){return this.pluginCollection.firstPersonControl}get clippingCtrl(){return this.pluginCollection.clippingControl}get drawHelper(){return this.pluginCollection.drawHelper}set pickEffect(e){this._pickEffect=e,this.mouseMoveSelectColor=[],this.mouseDownSelectColor=[];let{selectOutlinePass:t,selectFillColorPass:i}=this.scene.effectComposerCollection;Ic(t,this.mouseMoveSelectColor),Ic(i,this.mouseDownSelectColor)}get enableMultiSelect(){return this._enableMultiSelect}updateServerConfig(e){qs.config=Ga(qs.config,e)}_bindEvents(){let{selectOutlinePass:e,selectFillColorPass:t}=this.scene.effectComposerCollection,{eventHandler:i}=this;i.setInputAction(r=>{if(!this.pickEffect||!this._enableMultiSelect&&!this.enableHighlight)return;this.scene.requestRender();const s=Math.round(this.pickPixelSize*Ot.devicePixelRatio);let o=this.scene.pickObject(vm.copy(r.endPosition),s,s);if(O(o)&&O(o.primitive.getPickColor)){this.scene.requestRender();let a=o.primitive.getPickColor(o,$0.OUTLINE);O(a)?a.toArray(this.mouseMoveSelectColor):this.mouseMoveSelectColor=[]}else this.mouseMoveSelectColor=[];Ic(e,this.mouseMoveSelectColor)},vt.MOUSE_MOVE),i.setInputAction(r=>{if(!this.pickEffect)return;const s=Math.round(this.pickPixelSize*Ot.devicePixelRatio);let o=this.scene.pickObject(vm.copy(r.position),s,s);if(this._pickObject=o,O(o)&&O(o.primitive.getPickColor)){this.scene.requestRender();let a=o.primitive.getPickColor(o,$0.FILL_COLOR);if(this._enableMultiSelect&&O(a)){const l=a.toArray(),c=NT(this.mouseDownSelectColor,l,4);c!==-1?(this.mouseDownSelectColor.splice(c,4),this.mouseDownFileId.splice(c/4,1),this.mouseMoveSelectColor=[],Ic(e,this.mouseDownSelectColor)):(this.mouseDownSelectColor.push(...l),this.mouseDownFileId.push(o.primitive.owner.owner.fileId))}else O(a)&&(this.mouseDownSelectColor=a.toArray())}else this._enableMultiSelect||(this.mouseDownSelectColor=[]);Ic(t,this.mouseDownSelectColor)},vt.LEFT_CLICK),this.scene.renderError.addEventListener(r=>{console.error(r)})}activeMultiSelect(){this._enableMultiSelect=!0}quitMultiSelect(){this._enableMultiSelect=!1;const e=[];for(let t=0;t<this.mouseDownSelectColor.length;t+=4)e.push({id:this.mouseDownSelectColor[t],layerId:this.mouseDownSelectColor[t+3],fileId:this.mouseDownFileId[t/4]});return this.mouseDownFileId=[],this.mouseDownSelectColor=[],Ic(this.scene.effectComposerCollection.selectFillColorPass,this.mouseDownSelectColor),this.scene.requestRender(),e}_tick(e){var i;e-this._lastTime<this._skipFrameTime||(this._lastTime=e,this._autoResize&&this.autoResize(),this._canRender&&(this.scene.initializeFrame(),this.scene.render(),(i=this._stats)==null||i.update()))}autoResize(){const{clientWidth:e,clientHeight:t}=this.container,i=this.renderer.domElement,r=Ot.devicePixelRatio,s=2*r;(Math.abs(i.width-e*r)>s||Math.abs(i.height-t*r)>s)&&(this.element.style.width=`${e}px`,this.element.style.height=`${t}px`,this.resize())}configureCanvasSize(){const e=this.canvas;let t=e.clientWidth,i=e.clientHeight;this._canRender=t!==0&&i!==0}resize(){const{clientWidth:e,clientHeight:t}=this.element;this.scene.setSize(e,t),this.configureCanvasSize(),this.isDirty=!0}extend(e,t){return e(this,t)}setCamera(e){this.camera.switchCamera(e),this.isDirty=!0}getCameraView(){return this.camera.view}setOrthoCameraView(e,t,i,r){this.cameraType===vo.ORTHOGRAPHIC&&(this.camera.setOrthoCameraView(e,t,i,r),this.isDirty=!0)}getOrthoCameraView(){return this.camera.getOrthoCameraView()}pickPosition(e,t=new T){return this.scene.mode===Pt.SCENE2D?this.picking.pickPosition2D(vm.set(e.x,e.y),t):this.picking.pickPosition(vm.set(e.x,e.y),t)}worldToScreen(e,t=!0){return this.scene.worldToScreen(e,t)}getThresholdBySize(e){const{position:t,target:i}=this.getCameraView();return this.camera.getThresholdBySize(t,i,e,this.element)}getRenderInfo(){return this.renderer.info}setClipEnabled(e){this.renderer.localClippingEnabled=e}_postRender(){cH(this)}screenShot(e=ye.EMPTY_OBJECT){let t=e.rect,i=ye(e.type,"image/jpeg"),r=ye(e.quality,.92);if(!O(t))return this.scene.forceRender(),this.renderer.domElement.toDataURL(i,r);t=t.map(g=>g*Ot.devicePixelRatio);const[s,o,a,l]=t,c=Math.abs(s-a),u=Math.abs(o-l);this.scene.forceRender();const d=document.createElement("canvas");d.width=c,d.height=u;const p=d.getContext("2d");if(p){const g=Math.min(s,a),_=Math.min(o,l);p.drawImage(this.renderer.domElement,g,_,c,u,0,0,c,u)}return d.toDataURL(i,r)}setZoomSpeed(e=1.5){e=e<=0?1.5:e,this.cameraControl instanceof KA&&(this.cameraControl.zoomSpeed=e)}fullScreen(e=this._fullscreenElement){Cr.fullscreen?Cr.exitFullscreen():Cr.requestFullscreen(e)}switchCamera(e){this.getCameraView();const t=this.camera.near,i=this.camera.far;if(e===vo.ORTHOGRAPHIC){const{position:r,target:s}=this.getCameraView(),o=new T().fromArray(r),a=new T().fromArray(s),l=o.distanceTo(a)/2,c=this.camera.aspect??1;this.setCamera({type:e,left:-l,right:l,top:l/c,bottom:-l/c,near:t,far:i})}else this.setCamera({type:e,fov:37.8,near:t,far:i})}pickAllPosition(e,t=new T){return this.pickPosition(e,t)}zoomTo(e,t){var i={offset:t};return zM(this,e,i,!1)}flyTo(e,t={}){return zM(this,e,t,!0)}isDestroyed(){return!1}destroy(){var e;return this.renderer.setAnimationLoop(null),this.renderer.forceContextLoss(),this.renderer.dispose(),ns.clear(),this.scene.background=null,this.scene.environment=null,this.scene.lightCollection.destroy(),this.scene.htmlOverlayCollection.removeAll(),this.scene.primitiveCollection.destroy(),this.scene.pluginCollection.destroy(),(e=this._stats)==null||e.destroy(),this.input.destroy(),this.eventHelper.removeAll(),this.eventHandler.destroy(),this.pluginCollection.destroy(),this.rectSelect.destroy(),this.boxSelection.destroy(),this.element&&this.container.removeChild(this.element),ht(this)}}class uH{constructor(e={}){f(this,"_color",new WeakMap);f(this,"roughnessMap");f(this,"roughness");f(this,"materialStyle",{enabled:!1});const{materialStyle:t}=e;O(t)&&(this.roughnessMap=t.roughnessMap,this.roughness=t.roughness),this.materialStyle={...t}}addColorStyle(e,t){let i=this._color.get(t);if(!O(i)){this._color.set(t,[e]);return}i.includes(e)||i.push(e)}}class fH extends vd{constructor(t){super(Q0(t));f(this,"anisotropy",16);f(this,"colorSpace",Ai);f(this,"minFilter",Ei);f(this,"magFilter",Ei);f(this,"generateMipmaps",!1);f(this,"observer");f(this,"scheduleUpdate");this.dom=t;const i=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),r={attributes:!0,childList:!0,subtree:!0,characterData:!0};i.observe(t,r),this.observer=i}get width(){return this.image.width}get height(){return this.image.height}dispatchDOMEvent(t){t.data&&dH(this.dom,t.type,t.data.x,t.data.y)}update(){this.image=Q0(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}isDestroyed(){return!1}destroy(){return this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose(),ht(this)}}function dH(n,e,t,i){const r={clientX:t*n.offsetWidth+n.offsetLeft,clientY:i*n.offsetHeight+n.offsetTop,view:n.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,r));const s=n.getBoundingClientRect();t=t*s.width+s.left,i=i*s.height+s.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const l=a.getBoundingClientRect();if(t>l.left&&t<l.right&&i>l.top&&i<l.bottom&&(a.dispatchEvent(new MouseEvent(e,r)),a instanceof HTMLInputElement&&a.type==="range"&&(e==="mousedown"||e==="click"))){const[c,u]=["min","max"].map(_=>parseFloat(a[_])),d=l.width,g=(t-l.x)/d;a.value=c+(u-c)*g,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let c=0;c<a.childNodes.length;c++)o(a.childNodes[c])}}o(n)}const pH=`precision highp float;\r
\r
uniform sampler2D u_atlas;\r
uniform float u_usePickColor;\r
\r
varying vec2 vUv;\r
varying float vScale;\r
varying vec4 v_pickColor;\r
varying vec4 v_translucentColor;\r
#include <logdepthbuf_pars_fragment>\r
void main() {\r
\r
#include <logdepthbuf_fragment>\r
\r
    if(u_usePickColor == 1.0){\r
        gl_FragColor = v_pickColor;\r
        return;\r
    }\r
\r
    vec4 color = texture2D( u_atlas, vUv );\r
  \r
\r
\r
    // if (color.a < 0.995)  {\r
    //     color.rgb = v_translucentColor.xyz;\r
    // }\r
    // // Fully transparent parts of the billboard are not pickable.\r
    // #if !defined(OPAQUE) && !defined(TRANSLUCENT)\r
    //     if (color.a < 0.005)   // matches 0/255 and 1/255\r
    //     {\r
    //         discard;\r
    //     }\r
    //     #else\r
    //     // The billboard is rendered twice. The opaque pass discards translucent fragments\r
    //     // and the translucent pass discards opaque fragments.\r
    //     #ifdef OPAQUE\r
    //         if (color.a < 0.995)   // matches < 254/255\r
    //         {\r
    //             discard;\r
    //         }\r
    //     #else\r
    //         if (color.a >= 0.995)  // matches 254/255 and 255/255\r
    //         {\r
    //             discard;\r
    //         }\r
    //     #endif\r
    // #endif\r
\r
      \r
    //   if(u_usePickColor){\r
    //     gl_FragColor = v_pickColor;\r
    //   } else {\r
\r
    //   }\r
\r
    // #ifdef USE_PICK_COLOR\r
    //     gl_FragColor = v_pickColor;\r
    // #endif\r
    // gl_FragColor = color;\r
\r
    gl_FragColor = color;\r
    \r
\r
     \r
}\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
// #ifdef GL_OES_standard_derivatives\r
// #extension GL_OES_standard_derivatives : enable\r
// #endif\r
\r
// uniform sampler2D u_atlas;\r
\r
// #ifdef VECTOR_TILE\r
// uniform vec4 u_highlightColor;\r
// #endif\r
\r
// varying vec2 v_textureCoordinates;\r
// varying vec4 v_pickColor;\r
// varying vec4 v_color;\r
\r
// #include <logdepthbuf_pars_fragment>\r
\r
// void main()\r
// {\r
//     vec4 color = texture2D(u_atlas, v_textureCoordinates);\r
\r
\r
\r
//     // Fully transparent parts of the billboard are not pickable.\r
//     #if !defined(OPAQUE) && !defined(TRANSLUCENT)\r
//         if (color.a < 0.005)   // matches 0/255 and 1/255\r
//         {\r
//             discard;\r
//         }\r
//         #else\r
//         // The billboard is rendered twice. The opaque pass discards translucent fragments\r
//         // and the translucent pass discards opaque fragments.\r
//         #ifdef OPAQUE\r
//             if (color.a < 0.995)   // matches < 254/255\r
//             {\r
//                 discard;\r
//             }\r
//         #else\r
//             if (color.a >= 0.995)  // matches 254/255 and 255/255\r
//             {\r
//                 discard;\r
//             }\r
//         #endif\r
//     #endif\r
\r
//     gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r
//     // gl_FragColor = color;\r
\r
//     #include <tonemapping_fragment>\r
// 	#include <colorspace_fragment>\r
//     #include <premultiplied_alpha_fragment>\r
// 	#include <dithering_fragment>\r
// }`,mH=`precision highp float;\r
\r
uniform float u_scaleFactor;\r
\r
attribute vec4 positionScale;\r
attribute vec2 imageSize;\r
attribute vec4 textureCoordinatesOffsetRange;\r
attribute vec4 pickColor;\r
attribute vec4 translucentColor;\r
\r
varying vec2 vUv;\r
varying float vScale;\r
varying vec4 v_pickColor;\r
varying vec4 v_translucentColor;\r
\r
\r
#include <logdepthbuf_pars_vertex>\r
void main() {\r
\r
\r
    vec3 translate = positionScale.xyz;\r
    float scale = positionScale.w;\r
\r
    float factor = distance(cameraPosition, translate) *  u_scaleFactor *scale * 0.0009;\r
\r
    vec4 mvPosition = modelViewMatrix * vec4( translate, 1.0 );\r
\r
    mvPosition.xyz += position * vec3(imageSize, 1.0)* factor;\r
    \r
    gl_Position = projectionMatrix * mvPosition;\r
\r
    vUv =textureCoordinatesOffsetRange.xy +  uv * textureCoordinatesOffsetRange.zw;;\r
\r
    // vUv = uv;\r
\r
    v_pickColor = pickColor;\r
    v_translucentColor = translucentColor;\r
\r
    #include <logdepthbuf_vertex>\r
}\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
\r
// #ifdef INSTANCED\r
// attribute vec2 direction;\r
// #endif\r
\r
// attribute vec4 positionScale;\r
// attribute vec2 imageSize;\r
\r
// varying vec2 v_textureCoordinates;\r
\r
// varying vec4 v_color;\r
\r
\r
// const float UPPER_BOUND = 32768.0;\r
\r
// const float SHIFT_LEFT16 = 65536.0;\r
// const float SHIFT_LEFT12 = 4096.0;\r
// const float SHIFT_LEFT8 = 256.0;\r
// const float SHIFT_LEFT7 = 128.0;\r
// const float SHIFT_LEFT5 = 32.0;\r
// const float SHIFT_LEFT3 = 8.0;\r
// const float SHIFT_LEFT2 = 4.0;\r
// const float SHIFT_LEFT1 = 2.0;\r
\r
// const float SHIFT_RIGHT12 = 1.0 / 4096.0;\r
// const float SHIFT_RIGHT8 = 1.0 / 256.0;\r
// const float SHIFT_RIGHT7 = 1.0 / 128.0;\r
// const float SHIFT_RIGHT5 = 1.0 / 32.0;\r
// const float SHIFT_RIGHT3 = 1.0 / 8.0;\r
// const float SHIFT_RIGHT2 = 1.0 / 4.0;\r
// const float SHIFT_RIGHT1 = 1.0 / 2.0;\r
\r
// uniform float u_scaleFactor;\r
\r
// #include <logdepthbuf_pars_vertex>\r
\r
// void main(){ \r
//     vec3 worldPosition = positionScale.xyz;\r
//     float scale = positionScale.w;\r
\r
//     float factor = distance(cameraPosition, worldPosition) *  u_scaleFactor *scale;\r
\r
//     // \r
//     vec3 camRight = vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]);\r
//     vec3 camUp = vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]);\r
\r
//     // \r
//     vec3 vertexPosition =  \r
//          camRight * position.x * imageSize.x * factor\r
//         + camUp * position.y* imageSize.y * factor;\r
\r
     \r
\r
//     //  UV \r
//     v_textureCoordinates = vec2(position.x + 0.5, position.y  + 0.5); //  [0, 1]\r
\r
//     // \r
//     gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);\r
\r
// }\r
\r
\r
\r
\r
`;class HM extends wi{constructor(t={}){Ni.basic;super({vertexShader:mH,fragmentShader:pH,uniforms:Tn.merge([He.fog,{u_atlas:{value:new yi},u_usePickColor:{value:0},u_scaleFactor:{value:1}}]),lights:!1,fog:!0});f(this,"color",new Xn(16777215));this.setValues(t)}get map(){return this.uniforms.u_atlas.value}set map(t){this.uniforms.u_atlas.value=t}get u_atlas(){return this.uniforms.u_atlas.value}set u_atlas(t){this.uniforms.u_atlas.value=t}get u_scaleFactor(){return this.uniforms.u_scaleFactor.value}set u_scaleFactor(t){this.uniforms.u_scaleFactor.value=t}get u_usePickColor(){return this.uniforms.u_usePickColor.value}set u_usePickColor(t){this.uniforms.u_usePickColor.value=t}}class Pc{constructor(e=0,t=0,i=0,r=0){f(this,"x",0);f(this,"y",0);f(this,"width",0);f(this,"height",0);this.x=e,this.y=t,this.width=i,this.height=r}static equals(e,t){return e===t||O(e)&&O(t)&&e instanceof Pc&&t instanceof Pc&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}}class ly{constructor(e){f(this,"_instance");f(this,"url");f(this,"state",0);f(this,"_context");f(this,"_width");f(this,"_height");f(this,"_pixelFormat");f(this,"_initialized",!0);f(this,"imageReadyCallback");f(this,"_dimensions");f(this,"_owner");this._context=e.context,this.url="",this._width=e.width,this._height=e.height,this._pixelFormat=e.pixelFormat,this._dimensions=new he(this._width,this._height),this._instance=new e_(this._width,this._height),this._instance.flipY=!0,this._instance.needsUpdate=!0,this._instance.anisotropy=this._context.renderer.capabilities.getMaxAnisotropy()}get width(){return this._instance.image.width}get height(){return this._instance.image.height}get dimensions(){return this._dimensions}copyFrom(e,t=0,i=0){const r=this._context.renderer;let s;if(e instanceof HTMLCanvasElement){const o=new vd(e);o.needsUpdate=!0,r.copyTextureToTexture(o,this._instance,null,new he(t,i),null),o.dispose()}else s=new yi,s.image=e,s.needsUpdate=!0,r.copyTextureToTexture(s,this._instance,null,new he(t,i),null)}copyFromFramebuffer(e=0,t=0,i=0,r=0,s=this._width,o=this._height,a){this._instance=new e_(s,o),this._instance.flipY=!0,this._width=s,this._height=o;const l=this._context.renderer;l.copyTextureToTexture(a,this._instance,null,new he(e,t),null),l.copyFramebufferToTexture(this._instance),this._initialized=!0}getObject(){return this._instance}isDestroyed(){return!1}destroy(){return this._instance.dispose(),ht(this)}}class ws{constructor(e=he.ZERO,t=he.ZERO,i,r,s){this.bottomLeft=e,this.topRight=t,this.childNode1=i,this.childNode2=r,this.imageIndex=s}}const gH=new he(1024,1024);class _H{constructor(e){f(this,"_context");f(this,"_pixelFormat");f(this,"_borderWidthInPixels");f(this,"_textureCoordinates");f(this,"_guid",Zl());f(this,"_idHash",{});f(this,"_initialSize");f(this,"_root");f(this,"_texture");const t=ye(e.borderWidthInPixels,1),i=ye(e.initialSize,gH);if(!O(e.context))throw new Ze("context is required.");if(t<0)throw new Ze("borderWidthInPixels must be greater than or equal to zero.");if(i.x<1||i.y<1)throw new Ze("initialSize must be greater than zero.");this._context=e.context,this._pixelFormat=ye(e.pixelFormat,Ti),this._borderWidthInPixels=t,this._textureCoordinates=[],this._idHash={},this._initialSize=i}get borderWidthInPixels(){return this._borderWidthInPixels}get textureCoordinates(){return this._textureCoordinates}get texture(){return O(this._texture)||(this._texture=new ly({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}get numberOfImages(){return this._textureCoordinates.length}get guid(){return this._guid}addImage(e,t){let i=this._idHash[e];if(O(i))return i;if(typeof t=="function"){if(t=t(e),!O(t))throw new Ze("image is required.")}else(typeof t=="string"||t instanceof Hi)&&(t=Hi.createIfNeeded(t).fetchImage());return i=Promise.resolve(t).then(r=>{if(this.isDestroyed())return-1;const s=this.numberOfImages;return GM(this,r,s),s}),this._idHash[e]=i,i}addSubRegion(e,t){if(!O(e))throw new Ze("id is required.");if(!O(t))throw new Ze("subRegion is required.");const i=this._idHash[e];if(!O(i))throw new oc('image with id "'+e+'" not found in the atlas.');return Promise.resolve(i).then(r=>{if(r===-1)return-1;const s=this._texture.width,o=this._texture.height,a=this.numberOfImages,l=this._textureCoordinates[r],c=l.x+t.x/s,u=l.y+t.y/o,d=t.width/s,p=t.height/o;return this._textureCoordinates.push(new Pc(c,u,d,p)),this._guid=Zl(),a})}isDestroyed(){return!1}destroy(){return this._texture=this._texture&&this._texture.destroy(),ht(this)}}function vH(n,e){n._context;const t=n.numberOfImages,i=2,r=n._borderWidthInPixels;if(t>0){const s=n._texture.width,o=n._texture.height,a=i*(s+e.width+r),l=i*(o+e.height+r),c=s/a,u=o/l,d=new ws(new he(s+r,r),new he(a,o)),p=new ws(new he,new he(a,o),n._root,d),g=new ws(new he(r,o+r),new he(a,l)),_=new ws(new he,new he(a,l),p,g);for(let b=0;b<n._textureCoordinates.length;b++){const y=n._textureCoordinates[b];O(y)&&(y.x*=c,y.y*=u,y.width*=c,y.height*=u)}const x=new ly({context:n._context,width:a,height:l,pixelFormat:n._pixelFormat});x.copyFromFramebuffer(0,0,0,0,a,l,n.texture._instance),n._texture=n._texture&&n._texture.destroy(),n._texture=x,n._root=_}else{let s=i*(e.width+2*r),o=i*(e.height+2*r);s<n._initialSize.x&&(s=n._initialSize.x),o<n._initialSize.y&&(o=n._initialSize.y),n._texture=n._texture&&n._texture.destroy(),n._texture=new ly({context:n._context,width:s,height:o,pixelFormat:n._pixelFormat}),n._root=new ws(new he(r,r),new he(s,o))}}function bm(n,e,t){if(O(e)){if(!O(e.childNode1)&&!O(e.childNode2)){if(O(e.imageIndex))return;const i=e.topRight.x-e.bottomLeft.x,r=e.topRight.y-e.bottomLeft.y,s=i-t.width,o=r-t.height;if(s<0||o<0)return;if(s===0&&o===0)return e;if(s>o){e.childNode1=new ws(new he(e.bottomLeft.x,e.bottomLeft.y),new he(e.bottomLeft.x+t.width,e.topRight.y));const a=e.bottomLeft.x+t.width+n._borderWidthInPixels;a<e.topRight.x&&(e.childNode2=new ws(new he(a,e.bottomLeft.y),new he(e.topRight.x,e.topRight.y)))}else{e.childNode1=new ws(new he(e.bottomLeft.x,e.bottomLeft.y),new he(e.topRight.x,e.bottomLeft.y+t.height));const a=e.bottomLeft.y+t.height+n._borderWidthInPixels;a<e.topRight.y&&(e.childNode2=new ws(new he(e.bottomLeft.x,a),new he(e.topRight.x,e.topRight.y)))}return bm(n,e.childNode1,t)}return bm(n,e.childNode1,t)||bm(n,e.childNode2,t)}}function GM(n,e,t){const i=bm(n,n._root,e);if(O(i)&&i instanceof ws){i.imageIndex=t;const r=n._texture.width,s=n._texture.height,o=i.topRight.x-i.bottomLeft.x,a=i.topRight.y-i.bottomLeft.y,l=i.bottomLeft.x/r,c=i.bottomLeft.y/s,u=o/r,d=a/s;n._textureCoordinates[t]=new Pc(l,c,u,d),n._texture.copyFrom(e,i.bottomLeft.x,i.bottomLeft.y)}else vH(n,e),GM(n,e,t);n._guid=Zl()}function xm(n,e){const t=n._billboardCollection;O(t)&&(t._updateBillboard(n,e),n._dirty=!0)}const Gi=class Gi{constructor(e,t){f(this,"_index",-1);f(this,"_dirty",!1);f(this,"_image");f(this,"_imageIndexPromise");f(this,"_imageId");f(this,"_imageIndex",-1);f(this,"_imageWidth");f(this,"_imageHeight");f(this,"_imageSubRegion");f(this,"_ready");f(this,"_position",T.clone(T.ZERO));f(this,"_actualPosition",T.clone(this._position));f(this,"_clampedPosition");f(this,"_removeCallbackFunc");f(this,"_clusterShow",!0);f(this,"_outlineColor",We.clone(We.BLACK));f(this,"_outlineWidth",0);f(this,"_show",!0);f(this,"_scale",1);f(this,"_pickId");f(this,"_id");f(this,"_pickPrimitive");f(this,"translucentColor",We.clone(We.WHITE));this._billboardCollection=t,this._show=ye(e.show,!0),this._position=T.clone(ye(e.position,T.ZERO)),this._actualPosition=T.clone(this._position),this._id=e.id,this._pickPrimitive=e.pickPrimitive??this;const i=e.image;let r=e.imageId;O(i)&&(O(r)||(typeof i=="string"&&(r=i),this._imageId=r,this._image=i,O(this._imageId)||(this._imageId=Oo()))),O(this._billboardCollection._textureAtlas)&&this._loadImage(),this._removeCallbackFunc=void 0,this._clusterShow=!0,this._outlineColor=We.clone(ye(e.outlineColor,We.BLACK)),this._outlineWidth=ye(e.outlineWidth,0),this._updateClamping(),this._scale=ye(e.scale,1)}static _computeActualPosition(e,t,i,r){return t}get scale(){return this._scale}set scale(e){this._scale!==e&&(this._scale=e,xm(this,yH))}get position(){return this._position}set position(e){const t=this._position;T.equals(t,e)||(T.clone(e,t),T.clone(e,this._actualPosition),this._updateClamping(),xm(this,VM))}static _updateClamping(e,t){}_updateClamping(){Gi._updateClamping(this._billboardCollection,this)}_loadImage(){const e=this._billboardCollection._textureAtlas,t=this._imageId,i=this._image,r=this._imageSubRegion;let s;O(i)&&(s=e.addImage(t,i)),r&&(s=e.addSubRegion(t,r)),this._imageIndexPromise=s,O(s)&&s.then(o=>{if(this._imageId!==t||this._image!==i||!Pc.equals(this._imageSubRegion,r))return;const a=e.textureCoordinates[o];this._imageWidth=e.texture.width*a.width,this._imageHeight=e.texture.height*a.height,this._imageIndex=o,this._ready=!0,this._image=void 0,this._imageIndexPromise=void 0,xm(this,bH)}).catch(o=>{console.error("Error loading image for billboard: "+o),this._imageIndexPromise=void 0})}_setActualPosition(e){O(this._clampedPosition)||T.clone(e,this._actualPosition),xm(this,VM)}getPickId(e){return O(this._pickId)||(this._pickId=e.createPickColorSafeRange({primitive:this._pickPrimitive,collection:this._billboardCollection,id:this._id})),this._pickId}_destroy(){this._image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0}};f(Gi,"SHOW_INDEX",0),f(Gi,"POSITION_INDEX",1),f(Gi,"PIXEL_OFFSET_INDEX",2),f(Gi,"EYE_OFFSET_INDEX",3),f(Gi,"HORIZONTAL_ORIGIN_INDEX",4),f(Gi,"VERTICAL_ORIGIN_INDEX",5),f(Gi,"SCALE_INDEX",6),f(Gi,"IMAGE_INDEX_INDEX",7),f(Gi,"COLOR_INDEX",8),f(Gi,"ROTATION_INDEX",9),f(Gi,"ALIGNED_AXIS_INDEX",10),f(Gi,"SCALE_BY_DISTANCE_INDEX",11),f(Gi,"TRANSLUCENCY_BY_DISTANCE_INDEX",12),f(Gi,"PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX",13),f(Gi,"DISTANCE_DISPLAY_CONDITION",14),f(Gi,"DISABLE_DEPTH_DISTANCE",15),f(Gi,"TEXTURE_COORDINATE_BOUNDS",16),f(Gi,"SDF_INDEX",17),f(Gi,"NUMBER_OF_PROPERTIES",18);let Ks=Gi;const VM=Ks.POSITION_INDEX,yH=Ks.SCALE_INDEX,bH=Ks.IMAGE_INDEX_INDEX;var xH=Ks.SCALE_INDEX,WM=Ks.NUMBER_OF_PROPERTIES;function wH(n){for(var e=n.length,t=0;t<e;++t)n[t]&&n[t]._destroy()}function XM(n){if(n._billboardsRemoved){n._billboardsRemoved=!1;for(var e=[],t=n._billboards,i=t.length,r=0,s=0;r<i;++r){var o=t[r];o&&(o._index=s++,e.push(o))}n._billboards=e}}function SH(n,e,t,i,r,s){const o=n._baseVolume;n._boundingVolumeDirty=!0;const a=[];for(let l=0;l<t;++l){const c=e[l],u=c.position,d=Ks._computeActualPosition(c,u,i,r);O(d)&&(c._setActualPosition(d),s?a.push(d):Mi.expand(o,d,o))}s&&Mi.fromPoints(a,o)}function YM(n,e,t,i,r){const s=r.position;Mi.expand(n._baseVolume,s,n._baseVolume),n._boundingVolumeDirty=!0;let o=i.getAttribute("positionScale");o.setXYZW(r._index,s.x,s.y,s.z,r.scale),o.needsUpdate=!0}function EH(n,e,t,i,r){let s=i.getAttribute("imageSize");s.setXY(r._index,r._imageWidth,r._imageHeight),s.needsUpdate=!0}function TH(n,e,t,i,r){const s=t[r._imageIndex];let o=i.getAttribute("textureCoordinatesOffsetRange");o.setXYZW(r._index,s.x,s.y,s.width,s.height),o.needsUpdate=!0}function AH(n,e,t,i,r){let s=i.getAttribute("pickColor");const o=r.getPickId(e.context).color;s.setXYZW(r._index,o.x,o.y,o.z,o.w),s.needsUpdate=!0}function MH(n,e,t,i,r){let s=i.getAttribute("translucentColor");const o=r.translucentColor;s.setXYZW(r._index,o.x,o.y,o.z,o.w),s.needsUpdate=!0}function CH(n,e,t,i,r){YM(n,e,t,i,r),EH(n,e,t,i,r),TH(n,e,t,i,r),AH(n,e,t,i,r),MH(n,e,t,i,r)}function IH(n,e){const t=n._billboards;n._billboardsToUpdate;const i=n._modelMatrix;n._createVertexArray&&(fe.clone(n.modelMatrix,i),n._createVertexArray=!0,SH(n,t,t.length,e,i,!0))}class PH{constructor(){f(this,"visible",!0);f(this,"geometry");f(this,"material",new HM({toneMapped:!0,transparent:!0,depthTest:!1}));f(this,"colorCommand");f(this,"_billboards",[]);f(this,"_billboardsToUpdate",[]);f(this,"_billboardsToUpdateIndex",0);f(this,"_billboardsRemoved",!1);f(this,"_createVertexArray",!1);f(this,"_propertiesChanged",new Uint32Array(WM));f(this,"_textureAtlas");f(this,"modelMatrix",fe.clone(fe.IDENTITY));f(this,"_modelMatrix",fe.clone(fe.IDENTITY));f(this,"_baseVolume",new Mi);f(this,"_boundingVolumeDirty",!1);f(this,"_textureAtlasGUID");f(this,"depthTest",!0)}get(e){return XM(this),this._billboards[e]}add(e){let t=new Ks(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t}contains(e){return O(e)&&e._billboardCollection===this}remove(e){return this.contains(e)?(this._billboards[e._index]=null,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1}_updateBillboard(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]}removeAll(){wH(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy(),this._createVertexArray=!0}update(e){var b;XM(this);var t=this._billboards,i=t.length,r=e.context,s=this._textureAtlas;if(!O(s)){s=this._textureAtlas=new _H({context:r});for(var o=0;o<i;++o)t[o]._loadImage()}const a=s.textureCoordinates;if(a.length===0)return;IH(this,e),i=t.length;const l=this._billboardsToUpdate,c=this._billboardsToUpdateIndex,u=this._propertiesChanged,d=s.guid,p=this._createVertexArray||this._textureAtlasGUID!==d;if(this._textureAtlasGUID=d,p&&i===a.length){this._createVertexArray=!1;for(let I=0;I<WM;++I)u[I]=0;this._billboardsToUpdate=[],(b=this.geometry)==null||b.dispose();const y=new Er(1,1);let M=new Ma;M.index=y.index,M.attributes=y.attributes,M.setAttribute("positionScale",new Gn(new Float32Array(4*i),4)),M.setAttribute("imageSize",new Gn(new Float32Array(2*i),2)),M.setAttribute("textureCoordinatesOffsetRange",new Gn(new Float32Array(4*i),4)),M.setAttribute("pickColor",new Gn(new Float32Array(4*i),4)),M.setAttribute("translucentColor",new Gn(new Float32Array(4*i),4)),this.geometry=M;for(var g=0;g<i;++g){var _=this._billboards[g];_._dirty=!1,CH(this,e,a,this.geometry,_)}this._billboardsToUpdateIndex=0;let E=new HM({transparent:!1}),w=new pt(this.geometry,E);w.geometry=this.geometry,this.colorCommand=w,this.colorCommand.frustumCulled=!1}else if(c>0)for(let y=0;y<c;++y)u[xH]&&YM(this,e,a,this.geometry,l[y]);if(!this.colorCommand||!this.visible)return;e.commandList.push(this.colorCommand);const x=e.passes.pick;this.colorCommand.material.u_usePickColor=Number(x),this.colorCommand.material.transparent=!x,this.colorCommand.material.depthTest=this.depthTest,this.colorCommand.renderOrder=1e3,e.camera._perspectiveFrustum,this.colorCommand.material.u_atlas=s.texture._instance}isDestroyed(){return!1}destroy(){return this.geometry.dispose(),this.material.dispose(),this.material.u_atlas.dispose(),ht(this)}}class RH extends Gl{constructor(t=16777215,i=1){super(t,i);f(this,"pass",rr.ENVIRONMENT);f(this,"updateForPass");f(this,"prePassesUpdate");f(this,"preUpdate")}update(t){!this.visible||t.passes.pick||t.commandList.push(this)}isDestroyed(){return!1}destroy(){return this.dispose(),ht(this)}}class DH extends b_{constructor(t=16777215,i=16777215,r=1){super(t,i,r);f(this,"pass",rr.ENVIRONMENT);f(this,"updateForPass");f(this,"prePassesUpdate");f(this,"preUpdate")}update(t){!this.visible||t.passes.pick||t.commandList.push(this)}destroy(){return this.dispose(),ht(this)}}class cy{constructor(){f(this,"basePath");f(this,"dataSourceMap",new Map);f(this,"visible",!0);f(this,"_readyPromise",mr())}get readyPromise(){return this._readyPromise.promise}static async fromUrl({url:e,extrudeHeight:t=jr.minimumExtrudeHeight,defaultColor:i="#f99548"}){let r=new cy,s=Hi.createIfNeeded(e);r.basePath=s.getBaseUri(!0);let o=await s.fetchJson(),a=[];for(let l of o){let c=new jr({url:r.basePath+l.uri,defaultColor:i,extrudeHeight:t});r.dataSourceMap.set(l.buildingId,c),a.push(c.readyPromise)}return Promise.all(a).then(()=>r._readyPromise.resolve()),r}getDataSource(e){return this.dataSourceMap.get(e)}removeDataSource(e){let t=this.dataSourceMap.get(e);t&&t.destroy(),this.dataSourceMap.delete(e)}getFloorBoundingSphere(e,t){return this.dataSourceMap.get(e).getFloorBoundingSphere(t)}update(e){if(this.visible)for(const t of this.dataSourceMap.values())t.update(e)}isDestroyed(){return!1}destroy(){for(const e of this.dataSourceMap.values())e.destroy();return this.dataSourceMap.clear(),ht(this)}}function ko(n,e){const t=n._pointPrimitiveCollection;O(t)&&(t._updatePointPrimitive(n,e),n._dirty=!0)}class ti{constructor(e={},t){f(this,"_visible",!0);f(this,"_position",new T);f(this,"_oldPosition",new T);f(this,"_color");f(this,"_outlineColor");f(this,"_outlineWidth");f(this,"_pixelSize");f(this,"_scaleByDistance");f(this,"_translucencyByDistance");f(this,"_distanceDisplayCondition");f(this,"_disableDepthTestDistance",0);f(this,"_id");f(this,"_clusterShow",!0);f(this,"_pickId");f(this,"_pointPrimitiveCollection");f(this,"_collection");f(this,"_dirty",!1);f(this,"userData",{});f(this,"_index",-1);f(this,"isPointPrimitive",!0);let i=e.translucencyByDistance,r=e.scaleByDistance,s=e.distanceDisplayCondition;this._color=We.clone(ye(e.color,We.WHITE)),this._outlineColor=We.clone(ye(e.outlineColor,We.TRANSPARENT)),this._outlineWidth=ye(e.outlineWidth,0),this._pixelSize=ye(e.pixelSize,10),this._scaleByDistance=r,this._translucencyByDistance=i,this._distanceDisplayCondition=s,this._disableDepthTestDistance=ye(e.disableDepthTestDistance,0),this._id=e.id,this._collection=ye(e.collection,t),this._pointPrimitiveCollection=t,this._position=ye(e.position,this._position),this._oldPosition.copy(this._position)}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,ko(this,jM))}get position(){return this._position}set position(e){if(!O(e))return;const t=this._position;T.equals(t,e)||(t.copy(e),ko(this,qM))}get pixelSize(){return this._pixelSize}set pixelSize(e){this._pixelSize=e,ko(this,BH)}get color(){return this._color}set color(e){const t=this._color;t.equals(e)||(We.clone(e,t),ko(this,LH))}get outlineColor(){return this._outlineColor}set outlineColor(e){const t=this._outlineColor;t.equals(e)||(t.copy(e),ko(this,OH))}get outlineWidth(){return this._outlineWidth}set outlineWidth(e){this._outlineWidth!==e&&(this._outlineWidth=e,ko(this,NH))}get id(){return this._id}set id(e){this._id=e,O(this._pickId)&&(this._pickId.object.id=e)}get pickId(){return this._pickId}get clusterShow(){return this._clusterShow}set clusterShow(e){this._clusterShow!==e&&(this._clusterShow=e,ko(this,jM))}get translucencyByDistance(){return this._translucencyByDistance}get scaleByDistance(){return this._scaleByDistance}get distanceDisplayCondition(){return this._distanceDisplayCondition}get disableDepthTestDistance(){return this._disableDepthTestDistance}getPickId(e){return O(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._collection,id:this._id}),this._pickId.color.w=1),this._pickId}equals(e){return this===e||O(e)&&this._id===e._id&&this._position.equals(e._position)&&this._color.equals(e._color)&&this._pixelSize===e._pixelSize&&this._outlineWidth===e._outlineWidth&&this._visible===e._visible&&this._outlineColor.equals(e._outlineColor)&&this._disableDepthTestDistance===e._disableDepthTestDistance}update(e){this.visible&&(this._oldPosition.equals(this._position)||(ko(this,qM),this._oldPosition.copy(this._position)))}_destroy(){this._pickId=this._pickId&&this._pickId.destroy(),this._pointPrimitiveCollection=null}}f(ti,"SHOW_INDEX",0),f(ti,"POSITION_INDEX",1),f(ti,"COLOR_INDEX",2),f(ti,"OUTLINE_COLOR_INDEX",3),f(ti,"OUTLINE_WIDTH_INDEX",4),f(ti,"PIXEL_SIZE_INDEX",5),f(ti,"SCALE_BY_DISTANCE_INDEX",6),f(ti,"TRANSLUCENCY_BY_DISTANCE_INDEX",7),f(ti,"DISTANCE_DISPLAY_CONDITION_INDEX",8),f(ti,"DISABLE_DEPTH_DISTANCE_INDEX",9),f(ti,"NUMBER_OF_PROPERTIES",10);const jM=ti.SHOW_INDEX,qM=ti.POSITION_INDEX,LH=ti.COLOR_INDEX,OH=ti.OUTLINE_COLOR_INDEX,NH=ti.OUTLINE_WIDTH_INDEX,BH=ti.PIXEL_SIZE_INDEX;ti.SCALE_BY_DISTANCE_INDEX,ti.TRANSLUCENCY_BY_DISTANCE_INDEX,ti.DISTANCE_DISPLAY_CONDITION_INDEX,ti.DISABLE_DEPTH_DISTANCE_INDEX;const FH=`uniform float u_usePickColor;\r
uniform float u_enabledPick;\r
\r
varying vec4 v_color;\r
varying vec4 v_outlineColor;\r
varying float v_innerPercent;\r
varying float v_pixelDistance;\r
varying vec4 v_pickColor;\r
\r
#ifndef USE_WEBGL1\r
    layout(location=1)out vec4 gPickColor;\r
#endif\r
\r
void main()\r
{\r
\r
    float distanceToCenter=length(gl_PointCoord-vec2(.5));\r
\r
    float maxDistance=max(0.,.5-v_pixelDistance);\r
    float wholeAlpha=1.-smoothstep(maxDistance,.5,distanceToCenter);\r
    float innerAlpha=1.-smoothstep(maxDistance*v_innerPercent,.5*v_innerPercent,distanceToCenter);\r
\r
    vec4 color=mix(v_outlineColor,v_color,innerAlpha);\r
    color.a*=wholeAlpha;\r
\r
    #if!defined(OPAQUE)&&!defined(TRANSLUCENT)\r
        if(color.a<.005)\r
        {\r
            discard;\r
        }\r
        #else\r
\r
        #ifdef OPAQUE\r
        if(color.a<.995)\r
        {\r
            discard;\r
        }\r
        #else\r
        if(color.a>=.995)\r
        {\r
            discard;\r
        }\r
        #endif\r
    #endif\r
\r
    gl_FragColor=mix(color, v_pickColor, u_usePickColor);\r
    // gl_FragColor = czm_gammaCorrect(color);\r
    // czm_writeLogDepth();\r
    #ifndef USE_WEBGL1\r
        gPickColor = mix(vec4(0.0), v_pickColor, u_enabledPick);\r
    #endif\r
\r
}\r
`,UH=`\r
\r
float czm_nearFarScalar(vec4 nearFarScalar,float cameraDistSq)\r
{\r
    float valueAtMin=nearFarScalar.y;\r
    float valueAtMax=nearFarScalar.w;\r
    float nearDistanceSq=nearFarScalar.x*nearFarScalar.x;\r
    float farDistanceSq=nearFarScalar.z*nearFarScalar.z;\r
    \r
    float t=(cameraDistSq-nearDistanceSq)/(farDistanceSq-nearDistanceSq);\r
    \r
    t=pow(clamp(t,0.,1.),.2);\r
    \r
    return mix(valueAtMin,valueAtMax,t);\r
}\r
\r
uniform float czm_sceneMode;\r
uniform mat4 czm_modelViewRelativeToEye;\r
\r
uniform float u_pixelRatio;\r
\r
#line 0\r
\r
#line 0\r
uniform float u_maxTotalPointSize;\r
\r
attribute vec4 positionHighAndSize;\r
attribute vec4 positionLowAndOutline;\r
attribute vec4 compressedAttribute0;\r
attribute vec4 compressedAttribute1;\r
attribute vec4 scaleByDistance;\r
attribute vec3 distanceDisplayConditionAndDisableDepth;\r
attribute vec4 pickColor;\r
\r
varying vec4 v_color;\r
varying vec4 v_outlineColor;\r
varying float v_innerPercent;\r
varying float v_pixelDistance;\r
varying vec4 v_pickColor;\r
\r
const float SHIFT_LEFT8=256.;\r
const float SHIFT_RIGHT8=1./256.;\r
\r
void main()\r
{\r
    \r
    vec3 positionHigh=positionHighAndSize.xyz;\r
    vec3 positionLow=positionLowAndOutline.xyz;\r
    float outlineWidthBothSides=2.*positionLowAndOutline.w;\r
    float totalSize=positionHighAndSize.w+outlineWidthBothSides;\r
    float outlinePercent=outlineWidthBothSides/totalSize;\r
    \r
    totalSize*=u_pixelRatio;\r
    \r
    totalSize+=3.;\r
    \r
    float temp=compressedAttribute1.x*SHIFT_RIGHT8;\r
    float show=floor(temp);\r
    \r
    #ifdef EYE_DISTANCE_TRANSLUCENCY\r
    vec4 translucencyByDistance;\r
    translucencyByDistance.x=compressedAttribute1.z;\r
    translucencyByDistance.z=compressedAttribute1.w;\r
    \r
    translucencyByDistance.y=((temp-floor(temp))*SHIFT_LEFT8)/255.;\r
    \r
    temp=compressedAttribute1.y*SHIFT_RIGHT8;\r
    translucencyByDistance.w=((temp-floor(temp))*SHIFT_LEFT8)/255.;\r
    #endif\r
    \r
    vec4 color;\r
    vec4 outlineColor;\r
    // vec4 pickColor;\r
    \r
    // temp=compressedAttribute0.z*SHIFT_RIGHT8;\r
    // pickColor.b=(temp-floor(temp))*SHIFT_LEFT8;\r
    // temp=floor(temp)*SHIFT_RIGHT8;\r
    // pickColor.g=(temp-floor(temp))*SHIFT_LEFT8;\r
    // pickColor.r=floor(temp);\r
    \r
    temp=compressedAttribute0.x*SHIFT_RIGHT8;\r
    color.b=(temp-floor(temp))*SHIFT_LEFT8;\r
    temp=floor(temp)*SHIFT_RIGHT8;\r
    color.g=(temp-floor(temp))*SHIFT_LEFT8;\r
    color.r=floor(temp);\r
    \r
    temp=compressedAttribute0.y*SHIFT_RIGHT8;\r
    outlineColor.b=(temp-floor(temp))*SHIFT_LEFT8;\r
    temp=floor(temp)*SHIFT_RIGHT8;\r
    outlineColor.g=(temp-floor(temp))*SHIFT_LEFT8;\r
    outlineColor.r=floor(temp);\r
    \r
    temp=compressedAttribute0.w*SHIFT_RIGHT8;\r
    // pickColor.a=(temp-floor(temp))*SHIFT_LEFT8;\r
    // pickColor=pickColor/255.;\r
    \r
    temp=floor(temp)*SHIFT_RIGHT8;\r
    outlineColor.a=(temp-floor(temp))*SHIFT_LEFT8;\r
    outlineColor/=255.;\r
    color.a=floor(temp);\r
    color/=255.;\r
    \r
    // vec4 p=czm_translateRelativeToEye(positionHigh,positionLow);\r
    // vec4 positionEC=czm_modelViewRelativeToEye*p;\r
    \r
    vec4 positionEC=vec4(positionHigh-cameraPosition,1.);\r
    \r
    #if defined(EYE_DISTANCE_SCALING)||defined(EYE_DISTANCE_TRANSLUCENCY)||defined(DISTANCE_DISPLAY_CONDITION)||defined(DISABLE_DEPTH_DISTANCE)\r
    float lengthSq;\r
    lengthSq=dot(positionEC.xyz,positionEC.xyz);\r
    #endif\r
    \r
    #ifdef EYE_DISTANCE_SCALING\r
    totalSize*=czm_nearFarScalar(scaleByDistance,lengthSq);\r
    #endif\r
    \r
    totalSize=min(totalSize,u_maxTotalPointSize);\r
    \r
    if(totalSize<1.)\r
    {\r
        positionEC.xyz=vec3(0.);\r
        totalSize=1.;\r
    }\r
    \r
    float translucency=1.;\r
    #ifdef EYE_DISTANCE_TRANSLUCENCY\r
    translucency=czm_nearFarScalar(translucencyByDistance,lengthSq);\r
    \r
    if(translucency<.004)\r
    {\r
        positionEC.xyz=vec3(0.);\r
    }\r
    #endif\r
    \r
    #ifdef DISTANCE_DISPLAY_CONDITION\r
    float nearSq=distanceDisplayConditionAndDisableDepth.x;\r
    float farSq=distanceDisplayConditionAndDisableDepth.y;\r
    if(lengthSq<nearSq||lengthSq>farSq){\r
        \r
        positionEC.xyz=vec3(0.,0.,1.);\r
    }\r
    #endif\r
    \r
    // gl_Position=czm_projection*positionEC;\r
    gl_Position=projectionMatrix*modelViewMatrix*vec4(positionHigh,1.);\r
    // czm_vertexLogDepth();\r
    \r
    #ifdef DISABLE_DEPTH_DISTANCE\r
    float disableDepthTestDistance=distanceDisplayConditionAndDisableDepth.z;\r
    if(disableDepthTestDistance==0.&&czm_minimumDisableDepthTestDistance!=0.)\r
    {\r
        disableDepthTestDistance=czm_minimumDisableDepthTestDistance;\r
    }\r
    \r
    if(disableDepthTestDistance!=0.)\r
    {\r
        \r
        float zclip=gl_Position.z/gl_Position.w;\r
        bool clipped=(zclip<-1.||zclip>1.);\r
        if(!clipped&&(disableDepthTestDistance<0.||(lengthSq>0.&&lengthSq<disableDepthTestDistance)))\r
        {\r
            \r
            gl_Position.z=-gl_Position.w;\r
            #ifdef LOG_DEPTH\r
            // czm_vertexLogDepth(vec4(czm_currentFrustum.x));\r
            #endif\r
        }\r
    }\r
    #endif\r
    \r
    v_color=color;\r
    v_color.a*=translucency*show;\r
    v_outlineColor=outlineColor;\r
    v_outlineColor.a*=translucency*show;\r
    \r
    v_innerPercent=1.-outlinePercent;\r
    v_pixelDistance=2./totalSize;\r
    gl_PointSize=totalSize*show;\r
    gl_Position*=show;\r
    \r
    v_pickColor=pickColor;\r
}\r
`;class ZM extends wi{constructor(){super({vertexShader:UH,fragmentShader:FH,uniforms:{u_maxTotalPointSize:{value:0},u_pixelRatio:{value:1},u_usePickColor:{value:0},u_enabledPick:{value:1}},transparent:!0}),Ot.useWebGL2||(this.defines.USE_WEBGL1="")}get maxTotalPointSize(){return this.uniforms.u_maxTotalPointSize.value}set maxTotalPointSize(e){this.uniforms.u_maxTotalPointSize.value=e}get pixelRatio(){return this.uniforms.u_pixelRatio.value}set pixelRatio(e){this.uniforms.u_pixelRatio.value=e}get usePickColor(){return!!this.uniforms.u_usePickColor.value}set usePickColor(e){this.uniforms.u_usePickColor.value=Number(e)}get enabledPick(){return!!this.uniforms.u_enabledPick.value}set enabledPick(e){this.uniforms.u_enabledPick.value=+e}}const kH=[(n,e,t)=>(i,r)=>{e[i*t]=r,n.needsCommit=!0},(n,e,t)=>(i,r,s)=>{const o=i*t;e[o]=r,e[o+1]=s,n.needsCommit=!0},(n,e,t)=>(i,r,s,o)=>{const a=i*t;e[a]=r,e[a+1]=s,e[a+2]=o,n.needsCommit=!0},(n,e,t)=>(i,r,s,o,a)=>{const l=i*t;e[l]=r,e[l+1]=s,e[l+2]=o,e[l+3]=a,n.needsCommit=!0}];function zH(n,e){if(e.needsCommit&&e.vertexSizeInBytes>0){e.needsCommit=!1;const t=e.vertexBuffer,i=n._size*e.vertexSizeInBytes;if(!O(t)||(t==null?void 0:t.stride)<i)return e.vertexBuffer=new Pl(new Float32Array(e.arrayBuffer),e.vertexSizeInBytes/4),e.vertexBuffer.vertexArrayDestroyable=!1,!0}return!1}class zo{constructor(e,t,i,r){f(this,"_size",0);f(this,"_allBuffers",[]);f(this,"_instanced",!1);f(this,"_precreated");f(this,"_context");f(this,"writers");f(this,"va");const s=zo._verifyAttributes(t);i=ye(i,0);const o=[],a={};let l,c;const u=s.length;for(let p=0;p<u;++p){const g=s[p];if(g.vertexBuffer){o.push(g);continue}c=g.usage,l=a[c],O(l)||(l=a[c]=[]),l.push(g)}function d(p,g){return xt.getSizeInBytes(g.componentDatatype)-xt.getSizeInBytes(p.componentDatatype)}for(c in a)if(a.hasOwnProperty(c)){l=a[c],l.sort(d);const p=zo._vertexSizeInBytes(l),g=l[0].usage,_={vertexSizeInBytes:p,vertexBuffer:void 0,usage:g,needsCommit:!1,arrayBuffer:void 0,arrayViews:zo._createArrayViews(l,p)};this._allBuffers.push(_)}this._instanced=ye(r,!1),this._precreated=o,this._context=e,this.writers=void 0,this.resize(i)}static _verifyAttributes(e){const t=[];for(let r=0;r<e.length;++r){const s=e[r],o={index:ye(s.index,r),enabled:ye(s.enabled,!0),componentsPerAttribute:s.componentsPerAttribute,componentDatatype:ye(s.componentDatatype,Ii),normalize:ye(s.normalize,!1),vertexBuffer:s.vertexBuffer,usage:ye(s.usage,un),name:s.name};if(t.push(o),o.componentsPerAttribute!==1&&o.componentsPerAttribute!==2&&o.componentsPerAttribute!==3&&o.componentsPerAttribute!==4)throw new Ze("attribute.componentsPerAttribute must be in the range [1, 4].")}const i=new Array(t.length);for(let r=0;r<t.length;++r){const o=t[r].index;if(i[o])throw new Ze(`Index ${o} is used by more than one attribute.`);i[o]=!0}return t}static _vertexSizeInBytes(e){let t=0;const i=e.length;for(let a=0;a<i;++a){const l=e[a];t+=l.componentsPerAttribute*xt.getSizeInBytes(l.componentDatatype)}const r=i>0?xt.getSizeInBytes(e[0].componentDatatype):0,s=r>0?t%r:0,o=s===0?0:r-s;return t+=o,t}static _createArrayViews(e,t){const i=[];let r=0;const s=e.length;for(let o=0;o<s;++o){const a=e[o],l=a.componentDatatype;i.push({index:a.index,enabled:a.enabled,componentsPerAttribute:a.componentsPerAttribute,componentDatatype:l,normalize:a.normalize,offsetInBytes:r,vertexSizeInComponentType:t/xt.getSizeInBytes(l),view:void 0,name:a.name}),r+=a.componentsPerAttribute*xt.getSizeInBytes(l)}return i}static _resize(e,t){if(e.vertexSizeInBytes>0){const i=new ArrayBuffer(t*e.vertexSizeInBytes);if(O(e.arrayBuffer)){const o=new Uint8Array(i),a=new Uint8Array(e.arrayBuffer),l=a.length;for(let c=0;c<l;++c)o[c]=a[c]}const r=e.arrayViews,s=r.length;for(let o=0;o<s;++o){const a=r[o];a.view=xt.createArrayBufferView(a.componentDatatype,i,a.offsetInBytes)}e.arrayBuffer=i}}resize(e){this._size=e;const t=this._allBuffers;this.writers=[];for(let i=0,r=t.length;i<r;++i){const s=t[i];zo._resize(s,this._size),zo._appendWriters(this.writers,s)}hy(this)}static _appendWriters(e,t){const i=t.arrayViews,r=i.length;for(let s=0;s<r;++s){const o=i[s];e[o.index]=kH[o.componentsPerAttribute-1](t,o.view,o.vertexSizeInComponentType)}}static _appendAttributes(e,t,i,r){const s=t.arrayViews,o=s.length;for(let a=0;a<o;++a){const l=s[a];let c=new jt(t.vertexBuffer,l.componentsPerAttribute,i+l.offsetInBytes/4,l.normalize);e.setAttribute(l.name,c)}}commit(e){let t=!1;const i=this._allBuffers;let r,s,o;for(s=0,o=i.length;s<o;++s)r=i[s],t=zH(this,r)||t;if(t||!O(this.va)){hy(this);const a=this.va=[],l=Ne.SIXTY_FOUR_KILOBYTES-4,c=O(e)&&!this._instanced?Math.ceil(this._size/l):1;for(let u=0;u<c;++u){let d=new Tt;for(Object.defineProperties(d.attributes,{position:{get:()=>d.attributes.positionHighAndSize}}),s=0,o=i.length;s<o;++s){r=i[s];const p=u*(r.vertexSizeInBytes*l);zo._appendAttributes(d,r,p,this._instanced)}a.push(d)}}}isDestroyed(){return!1}destroy(){const e=this._allBuffers;for(let t=0,i=e.length;t<i;++t){const r=e[t];r.vertexBuffer=r.vertexBuffer&&(r.vertexBuffer.array=null)}return hy(this),ht(this)}}function hy(n){const e=n.va;if(!O(e))return;const t=e.length;for(let i=0;i<t;++i)e[i].dispose(),e[i].isDestroyed=!0;n.va=void 0}const HH=[],KM=new fe;function QM(n){const e=n.length;for(let t=0;t<e;++t)n[t]&&n[t]._destroy()}const GH=ti.SHOW_INDEX,uy=ti.POSITION_INDEX,$M=ti.COLOR_INDEX,VH=ti.OUTLINE_COLOR_INDEX,WH=ti.OUTLINE_WIDTH_INDEX,XH=ti.PIXEL_SIZE_INDEX,JM=ti.SCALE_BY_DISTANCE_INDEX,e1=ti.TRANSLUCENCY_BY_DISTANCE_INDEX,fy=ti.DISTANCE_DISPLAY_CONDITION_INDEX,YH=ti.DISABLE_DEPTH_DISTANCE_INDEX,dy=ti.NUMBER_OF_PROPERTIES,sr={positionHighAndSize:0,positionLowAndOutline:1,compressedAttribute0:2,compressedAttribute1:3,scaleByDistance:4,distanceDisplayConditionAndDisableDepth:5,pickColor:6};function py(n){if(n._pointPrimitivesRemoved){n._pointPrimitivesRemoved=!1;const e=[],t=n._pointPrimitives,i=t.length;for(let r=0,s=0;r<i;++r){const o=t[r];o&&(o._index=s++,e.push(o))}n._pointPrimitives=e}}function jH(n,e,t){return new zo(n,[{index:sr.positionHighAndSize,componentsPerAttribute:4,componentDatatype:xt.FLOAT,usage:t[uy],name:"positionHighAndSize"},{index:sr.positionLowAndShow,componentsPerAttribute:4,componentDatatype:xt.FLOAT,usage:t[uy],name:"positionLowAndOutline"},{index:sr.compressedAttribute0,componentsPerAttribute:4,componentDatatype:xt.FLOAT,usage:t[$M],name:"compressedAttribute0"},{index:sr.compressedAttribute1,componentsPerAttribute:4,componentDatatype:xt.FLOAT,usage:t[e1],name:"compressedAttribute1"},{index:sr.scaleByDistance,componentsPerAttribute:4,componentDatatype:xt.FLOAT,usage:t[JM],name:"scaleByDistance"},{index:sr.distanceDisplayConditionAndDisableDepth,componentsPerAttribute:3,componentDatatype:xt.FLOAT,usage:t[fy],name:"distanceDisplayConditionAndDisableDepth"},{index:sr.pickColor,componentsPerAttribute:4,componentDatatype:xt.FLOAT,usage:t[fy],name:"pickColor"}],e)}function t1(n,e,t,i){const r=i._index,s=i.position;n._boundingSphere.expandByPoint(s),n._boundingBox.expandByPoint(s),n._boundingVolumeDirty=!0;const o=i.pixelSize,a=i.outlineWidth;n._maxPixelSize=Math.max(n._maxPixelSize,o+a);const l=t[sr.positionHighAndSize];l(r,s.x,s.y,s.z,o);const c=t[sr.positionLowAndOutline];c(r,0,0,0,a)}const wm=65536,yu=256;function i1(n,e,t,i){const r=i._index,s=i.color,o=i.getPickId(e).color,a=i.outlineColor;let l=We.floatToByte(s.red),c=We.floatToByte(s.green),u=We.floatToByte(s.blue);const d=l*wm+c*yu+u;l=We.floatToByte(a.red),c=We.floatToByte(a.green),u=We.floatToByte(a.blue);const p=l*wm+c*yu+u;l=We.floatToByte(o.red),c=We.floatToByte(o.green),u=We.floatToByte(o.blue);const g=l*wm+c*yu+u,_=We.floatToByte(s.alpha)*wm+We.floatToByte(a.alpha)*yu+We.floatToByte(o.alpha),x=t[sr.compressedAttribute0];x(r,d,p,g,_)}function n1(n,e,t,i){const r=i._index;let s=0,o=1,a=1,l=1;const c=i.translucencyByDistance;O(c)&&(s=c.near,o=c.nearValue,a=c.far,l=c.farValue,(o!==1||l!==1)&&(n._shaderTranslucencyByDistance=!0));let u=i.visible&&i.clusterShow;i.color.alpha===0&&i.outlineColor.alpha===0&&(u=!1),o=kn.clamp(o,0,1),o=o===1?255:o*255|0;const d=(u?1:0)*yu+o;l=kn.clamp(l,0,1),l=l===1?255:l*255|0;const p=l,g=t[sr.compressedAttribute1];g(r,d,p,s,a)}function r1(n,e,t,i){const r=i._index,s=t[sr.scaleByDistance];let o=0,a=1,l=1,c=1;const u=i.scaleByDistance;O(u)&&(o=u.near,a=u.nearValue,l=u.far,c=u.farValue,(a!==1||c!==1)&&(n._shaderScaleByDistance=!0)),s(r,o,a,l,c)}function qH(n,e,t,i){const r=i._index;let s=i.pickId.color;const o=t[sr.pickColor];o(r,s.x,s.y,s.z,s.w)}function s1(n,e,t,i){const r=i._index,s=t[sr.distanceDisplayConditionAndDisableDepth];let o=0,a=Number.MAX_VALUE;const l=i.distanceDisplayCondition;O(l)&&(o=l.near,a=l.far,o*=o,a*=a,n._shaderDistanceDisplayCondition=!0);let c=i.disableDepthTestDistance;c*=c,c>0&&(n._shaderDisableDepthDistance=!0,c===Number.POSITIVE_INFINITY&&(c=-1)),s(r,o,a,c)}function ZH(n,e,t,i){t1(n,e,t,i),i1(n,e,t,i),n1(n,e,t,i),r1(n,e,t,i),s1(n,e,t,i),qH(n,e,t,i)}class Sm{constructor(e={}){f(this,"visible",!0);f(this,"_pointPrimitives",[]);f(this,"_pointPrimitivesToUpdate",[]);f(this,"_pointPrimitivesToUpdateIndex",0);f(this,"_pointPrimitivesRemoved",!1);f(this,"_createVertexArray",!1);f(this,"_shaderScaleByDistance",!1);f(this,"_compiledShaderScaleByDistance",!1);f(this,"_shaderTranslucencyByDistance",!1);f(this,"_compiledShaderTranslucencyByDistance",!1);f(this,"_shaderDistanceDisplayCondition",!1);f(this,"_compiledShaderDistanceDisplayCondition",!1);f(this,"_shaderDisableDepthDistance",!1);f(this,"_compiledShaderDisableDepthDistance",!1);f(this,"_propertiesChanged",new Uint32Array(dy));f(this,"_maxPixelSize",1);f(this,"_buffersUsage",[un,un,un,un,un,un,un,un,un,un]);f(this,"_vaf");f(this,"_boundingSphere",new Mi);f(this,"_boundingBox",new Lt);f(this,"_boundingVolumeDirty",!1);f(this,"_colorCommands",[]);f(this,"_material",new ZM);f(this,"_translucentMaterial",new ZM);f(this,"_maxTotalPointSize",1);f(this,"modelMatrix",new fe);f(this,"_modelMatrix",new fe);f(this,"enabledPick",!0);this.visible=ye(e.visible,!0)}_computeBoundingVolume(){if(!this._boundingBox.isEmpty())return;let e=this.length;for(let t=0;t<e;t++){let i=this.get(t).position;this._boundingSphere.expandByPoint(i),this._boundingBox.expandByPoint(i),this._boundingVolumeDirty=!0}}get length(){return py(this),this._pointPrimitives.length}_updatePointPrimitive(e,t){e._dirty||(this._pointPrimitivesToUpdate[this._pointPrimitivesToUpdateIndex++]=e),++this._propertiesChanged[t]}contains(e){return O(e)&&e._pointPrimitiveCollection===this}get(e){return py(this),this._pointPrimitives[e]}add(e){const t=new ti(e,this);return t._index=this._pointPrimitives.length,this._pointPrimitives.push(t),this._createVertexArray=!0,t}remove(e){return this.contains(e)?(this._pointPrimitives[e._index]=null,this._pointPrimitivesRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1}removeAll(){QM(this._pointPrimitives),this._pointPrimitives=[],this._pointPrimitivesToUpdate=[],this._pointPrimitivesToUpdateIndex=0,this._pointPrimitivesRemoved=!1,this._createVertexArray=!0}computeNewBuffersUsage(){const e=this._buffersUsage;let t=!1;const i=this._propertiesChanged;for(let r=0;r<dy;++r){const s=i[r]===0?un:vb;t=t||e[r]!==s,e[r]=s}return t}update(e){if(py(this),!this.visible||this.length===0||e.passes.pick&&!this.enabledPick)return;for(let b=0;b<this.length;b++)this.get(b).update(e);this._maxTotalPointSize=Rr.maximumAliasedPointSize;const i=this._pointPrimitives.length,r=this._pointPrimitivesToUpdate,s=this._pointPrimitivesToUpdateIndex,o=this._propertiesChanged,a=this._createVertexArray;let l;const c=e.context,u=e.passes,d=u.pick;if(a||!d&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let b=0;b<dy;++b)o[b]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),i>0){this._vaf=jH(c,i,this._buffersUsage),l=this._vaf.writers;for(let b=0;b<i;++b){const y=this._pointPrimitives[b];y._dirty=!1,ZH(this,c,l,y)}this._vaf.commit()}this._pointPrimitivesToUpdateIndex=0}else if(s>0){const b=HH;b.length=0,(o[uy]||o[WH]||o[XH])&&b.push(t1),(o[$M]||o[VH])&&b.push(i1),(o[GH]||o[e1])&&b.push(n1),o[JM]&&b.push(r1),(o[fy]||o[YH])&&b.push(s1);const y=b.length;if(l=this._vaf.writers,this._boundingBox.makeEmpty(),this._boundingSphere.makeEmpty(),s/i>.01){for(let M=0;M<s;++M){const E=r[M];E._dirty=!1;for(let w=0;w<y;++w)b[w](this,c,l,E)}this._vaf.commit()}}this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,this._boundingSphere.applyMatrix4(this.modelMatrix),this._boundingBox.applyMatrix4(this.modelMatrix));let p,g,_;const x=e.commandList;if(u.render||d){const b=this._colorCommands;p=this._vaf.va,g=p.length;for(let y=0;y<g;y++)_=b[y],(!O(_)||_.geometry.isDestroyed)&&(_=b[y]=new gd,_.pass=rr.OVERLAY_POINT,_.frustumCulled=!1),_.geometry=p[y],this._translucentMaterial.pixelRatio=e.pixelRatio,this._translucentMaterial.maxTotalPointSize=this._maxTotalPointSize,Ot.useMRT?this._translucentMaterial.enabledPick=this.enabledPick:(this._translucentMaterial.usePickColor=d,this._translucentMaterial.blending=d?Qr:Es),_.material=this._translucentMaterial,this.modelMatrix.equals(this._modelMatrix)&&(KM.copy(this._modelMatrix),KM.invert(),_.applyMatrix4(this._modelMatrix),this._modelMatrix.copy(this.modelMatrix)),x.push(_)}}isDestroyed(){return!1}destroy(){return this._material.dispose(),this._translucentMaterial.dispose(),this._vaf=this._vaf&&this._vaf.destroy(),QM(this._pointPrimitives),ht(this)}}class my{constructor(){f(this,"_polylines",[]);f(this,"_polylinesRemoved",!1);f(this,"visible",!0)}get length(){return this._polylines.length}get(e){return this._polylines[e]}add(e){const t=new Io(e);return t._index=this._polylines.length,this._polylines.push(t),t}remove(e){return this.contains(e)?(this._polylinesRemoved=!0,e.destroy(),!0):!1}removeAll(){o1(this),this._polylinesRemoved=!1,this._polylines.length=0}contains(e){return O(e)&&O(e._polylineCollection)&&e._polylineCollection===this}update(e){if(this.visible)for(let t=0;t<this.length;t++)this._polylines[t].update(e)}isDestroyed(){return!1}destroy(){return o1(this),ht(this)}}function o1(n){const e=n._polylines,t=e.length;for(let i=0;i<t;++i)e[i].isDestroyed||(e[i].destroy(),n._polylines.splice(e[i]._index,1))}let KH=`
varying vec3 vWorldPosition;

			void main() {

				vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
				vWorldPosition = worldPosition.xyz;

				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			}
`,QH=`
uniform vec3 topColor;
			uniform vec3 bottomColor;
			uniform float offset;
			uniform float exponent;

			varying vec3 vWorldPosition;

			void main() {

				float h = normalize( vWorldPosition + offset ).z;
				gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );

			}
`;class $H{constructor({topColor:e="#568dcd",bottomColor:t="#466881"}={}){f(this,"colorCommand");f(this,"ground");f(this,"visible",!0);f(this,"_topColor");f(this,"_bottomColor");f(this,"updateForPass");f(this,"prePassesUpdate");f(this,"preUpdate");f(this,"isDestroyed");f(this,"destroy");this._topColor=We.fromCssColorString(e),this._bottomColor=We.fromCssColorString(t);const i={topColor:{value:new Xn(this._topColor.red,this._topColor.green,this._topColor.blue)},bottomColor:{value:new Xn(16777215)},offset:{value:33},exponent:{value:.6}},r=new Ul(4e3,32,15),s=new wi({uniforms:i,vertexShader:KH,fragmentShader:QH,side:hn}),o=new pt(r,s);this.colorCommand=o,this.colorCommand.renderOrder=-10;const a=new Er(1e4,1e4),l=new Pi({color:new Xn(this._bottomColor.red,this._bottomColor.green,this._bottomColor.blue)}),c=new pt(a,l);c.position.z=-33,this.ground=c}get topColor(){return this._topColor}set topColor(e){this._topColor=e,this.colorCommand.material.uniforms.topColor.value.set(e.red,e.green,e.blue)}get bottomColor(){return this._bottomColor}set bottomColor(e){this._bottomColor=e,this.ground.material.color.set(e.red,e.green,e.blue)}update(e){!this.visible||e.passes.pick||e.commandList.push(this.colorCommand,this.ground)}}class JH{constructor(){f(this,"_sprites",new Map);f(this,"visible",!0)}add({id:e,image:t,position:i,center:r=new he(.5,1)}){if(this._sprites.has(e)){console.warn("id");return}const s=new he(t.width,t.height);s.normalize().multiplyScalar(10);let o=new vd(t);o.center=r;const a=new fh({map:o}),l=new td(a);return l.position.copy(i),l.userData.id=e,l.scale.set(s.x,s.y,1),this._sprites.set(e,l),l}remove(e){let t=e.userData.id;this._sprites.has(t)&&(this._sprites.delete(t),this.destroySprite(e))}destroySprite(e){e.geometry.dispose(),e.material.dispose(),e.material.map.dispose()}update(e){if(this.visible&&!e.passes.pick)for(let t of this._sprites.values())e.commandList.push(t)}isDestroyed(){return!1}destroy(){for(let e of this._sprites.values())this.destroySprite(e);return ht(this)}}class a1{constructor(){f(this,"_firstListeners",Object.create(null));f(this,"_listeners",Object.create(null))}on(e,t,i=!1,r=!1){const s=i?this._firstListeners:this._listeners;s[e]||(s[e]=[]),t.once=r,s[e].indexOf(t)===-1&&s[e].push(t)}off(e,t){let i=this._firstListeners,r=i[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}if(i=this._listeners,r=i[e],r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}fire(e,t){let i=this._firstListeners,r=i[e];if(r!==void 0){const s=r.slice(0);for(let o=0,a=s.length;o<a;o++){let l=s[o];l.call(this,t),l.once&&this.off(e,l)}}if(i=this._listeners,r=i[e],r!==void 0){const s=r.slice(0);for(let o=0,a=s.length;o<a;o++){let l=s[o];l.call(this,t),l.once&&this.off(e,l)}}}clear(){this._firstListeners=Object.create(null),this._listeners=Object.create(null)}}const gy=new T,l1=new T(0,1,0),eG=new T(0,0,1),c1=new T,h1=new T;class tG extends a1{constructor(t){super();f(this,"viewer");f(this,"_currentAngle",0);f(this,"_cameraRotateListener");this.viewer=t,this._currentAngle=this.getAngle(),t.camera.change.addEventListener(this._cameraRotateListener=()=>{this._currentAngle=this.getAngle(),this.fire(si.CAMERA_ROTATE,this._currentAngle)})}getAngle(){const{direction:t}=this.viewer.camera;gy.set(t.x,t.y,0).normalize(),c1.crossVectors(gy,l1);let i=gy.angleTo(l1);return c1.z>0&&(i=2*Math.PI-i),i*180/Math.PI}setAngle(t,i=0){if(t<0||t>360){console.warn("angle0~360");return}const r=(t+360-this._currentAngle)%360;this._currentAngle=t;const{camera:s}=this.viewer,o=new bi().setFromAxisAngle(eG,r/180*Math.PI),a=this.viewer.cameraControl.getPivotPosition(),l=new T().subVectors(s.position,a).applyQuaternion(o);if(i<=0)s.position.copy(a).add(l),s.direction.applyQuaternion(o),s.up.applyQuaternion(o),s.right.crossVectors(s.direction,s.up).normalize(),s.up.crossVectors(s.right,s.direction).normalize();else{const c=a.clone().add(l),u=s.direction.clone().applyQuaternion(o),d=s.up.clone().applyQuaternion(o);this.viewer.camera.flyTo({destination:c,orientation:{direction:u,up:d},duration:i})}}zoomIn(t=.1,i=0){const{scene:r,camera:s,cameraControl:o}=this.viewer,a=r._axisAlignedBoundingBox,{clientWidth:l,clientHeight:c}=r.container,u=r.pickPosition(new he(l/2,c/2))||a.center;let d=s.position.distanceTo(u);if(t>0&&d<=o._currentControl.minDistance||t<0&&d>=o._currentControl.maxDistance)return;const p=a.min.distanceTo(a.max)*.01;if(d=Math.max(d,p),i<=0)s.zoomIn(d*t);else{const g=s.direction.clone().multiplyScalar(d*t),_=s.position.clone().add(g),{orientation:x}=s.getViewSync();this.viewer.camera.flyTo({destination:_,orientation:x,duration:i})}}zoomOut(t=.1,i=0){this.zoomIn(-t,i)}moveView(t,i=.1,r=0){const{scene:s,camera:o}=this.viewer,a=s._axisAlignedBoundingBox,l=a.min.distanceTo(a.max)*.01,u=Math.max(o.position.distanceTo(a.center),l)*i;let d,p;switch(t){case"left":d=o.right,p=-u;break;case"right":d=o.right,p=u;break;case"up":d=o.up,p=-u;break;case"down":d=o.up,p=u;break;default:throw new Error(".")}if(r<=0)o.move(d,p);else{const g=d.clone().multiplyScalar(p),_=o.position.clone().add(g),{orientation:x}=o.getViewSync();this.viewer.camera.flyTo({destination:_,orientation:x,duration:r})}}flyTo(t,i,r){const{direction:s}=t.orientation,{radius:o,center:a}=i;h1.copy(s).negate().multiplyScalar(o);const l=a.clone().add(h1);this.viewer.camera.flyTo({destination:l,orientation:t.orientation,...r})}destroy(){this.viewer.camera.change.removeEventListener(this._cameraRotateListener)}}var Em={},u1={exports:{}};(function(n){(function(){var e={};e.version="6.4.2.2",e.use_lines=!0,e.use_xyz=!1;var t=!1;n.exports?(n.exports=e,t=!0):typeof document<"u"?window.ClipperLib=e:self.ClipperLib=e;var i;if(t){var r="chrome";i="Netscape"}else{var r=navigator.userAgent.toString().toLowerCase();i=navigator.appName}var s={};r.indexOf("chrome")!=-1&&r.indexOf("chromium")==-1?s.chrome=1:s.chrome=0,r.indexOf("chromium")!=-1?s.chromium=1:s.chromium=0,r.indexOf("safari")!=-1&&r.indexOf("chrome")==-1&&r.indexOf("chromium")==-1?s.safari=1:s.safari=0,r.indexOf("firefox")!=-1?s.firefox=1:s.firefox=0,r.indexOf("firefox/17")!=-1?s.firefox17=1:s.firefox17=0,r.indexOf("firefox/15")!=-1?s.firefox15=1:s.firefox15=0,r.indexOf("firefox/3")!=-1?s.firefox3=1:s.firefox3=0,r.indexOf("opera")!=-1?s.opera=1:s.opera=0,r.indexOf("msie 10")!=-1?s.msie10=1:s.msie10=0,r.indexOf("msie 9")!=-1?s.msie9=1:s.msie9=0,r.indexOf("msie 8")!=-1?s.msie8=1:s.msie8=0,r.indexOf("msie 7")!=-1?s.msie7=1:s.msie7=0,r.indexOf("msie ")!=-1?s.msie=1:s.msie=0,e.biginteger_used=null;var o;function a(h,m,v){e.biginteger_used=1,h!=null&&(typeof h=="number"&&typeof m>"u"?this.fromInt(h):typeof h=="number"?this.fromNumber(h,m,v):m==null&&typeof h!="string"?this.fromString(h,256):this.fromString(h,m))}function l(){return new a(null,void 0,void 0)}function c(h,m,v,S,C,F){for(;--F>=0;){var H=m*this[h++]+v[S]+C;C=Math.floor(H/67108864),v[S++]=H&67108863}return C}function u(h,m,v,S,C,F){for(var H=m&32767,K=m>>15;--F>=0;){var $=this[h]&32767,ue=this[h++]>>15,Pe=K*$+ue*H;$=H*$+((Pe&32767)<<15)+v[S]+(C&1073741823),C=($>>>30)+(Pe>>>15)+K*ue+(C>>>30),v[S++]=$&1073741823}return C}function d(h,m,v,S,C,F){for(var H=m&16383,K=m>>14;--F>=0;){var $=this[h]&16383,ue=this[h++]>>14,Pe=K*$+ue*H;$=H*$+((Pe&16383)<<14)+v[S]+C,C=($>>28)+(Pe>>14)+K*ue,v[S++]=$&268435455}return C}i=="Microsoft Internet Explorer"?(a.prototype.am=u,o=30):i!="Netscape"?(a.prototype.am=c,o=26):(a.prototype.am=d,o=28),a.prototype.DB=o,a.prototype.DM=(1<<o)-1,a.prototype.DV=1<<o;var p=52;a.prototype.FV=Math.pow(2,p),a.prototype.F1=p-o,a.prototype.F2=2*o-p;var g="0123456789abcdefghijklmnopqrstuvwxyz",_=new Array,x,b;for(x="0".charCodeAt(0),b=0;b<=9;++b)_[x++]=b;for(x="a".charCodeAt(0),b=10;b<36;++b)_[x++]=b;for(x="A".charCodeAt(0),b=10;b<36;++b)_[x++]=b;function y(h){return g.charAt(h)}function M(h,m){var v=_[h.charCodeAt(m)];return v??-1}function E(h){for(var m=this.t-1;m>=0;--m)h[m]=this[m];h.t=this.t,h.s=this.s}function w(h){this.t=1,this.s=h<0?-1:0,h>0?this[0]=h:h<-1?this[0]=h+this.DV:this.t=0}function I(h){var m=l();return m.fromInt(h),m}function B(h,m){var v;if(m==16)v=4;else if(m==8)v=3;else if(m==256)v=8;else if(m==2)v=1;else if(m==32)v=5;else if(m==4)v=2;else{this.fromRadix(h,m);return}this.t=0,this.s=0;for(var S=h.length,C=!1,F=0;--S>=0;){var H=v==8?h[S]&255:M(h,S);if(H<0){h.charAt(S)=="-"&&(C=!0);continue}C=!1,F==0?this[this.t++]=H:F+v>this.DB?(this[this.t-1]|=(H&(1<<this.DB-F)-1)<<F,this[this.t++]=H>>this.DB-F):this[this.t-1]|=H<<F,F+=v,F>=this.DB&&(F-=this.DB)}v==8&&h[0]&128&&(this.s=-1,F>0&&(this[this.t-1]|=(1<<this.DB-F)-1<<F)),this.clamp(),C&&a.ZERO.subTo(this,this)}function N(){for(var h=this.s&this.DM;this.t>0&&this[this.t-1]==h;)--this.t}function L(h){if(this.s<0)return"-"+this.negate().toString(h);var m;if(h==16)m=4;else if(h==8)m=3;else if(h==2)m=1;else if(h==32)m=5;else if(h==4)m=2;else return this.toRadix(h);var v=(1<<m)-1,S,C=!1,F="",H=this.t,K=this.DB-H*this.DB%m;if(H-- >0)for(K<this.DB&&(S=this[H]>>K)>0&&(C=!0,F=y(S));H>=0;)K<m?(S=(this[H]&(1<<K)-1)<<m-K,S|=this[--H]>>(K+=this.DB-m)):(S=this[H]>>(K-=m)&v,K<=0&&(K+=this.DB,--H)),S>0&&(C=!0),C&&(F+=y(S));return C?F:"0"}function P(){var h=l();return a.ZERO.subTo(this,h),h}function R(){return this.s<0?this.negate():this}function U(h){var m=this.s-h.s;if(m!=0)return m;var v=this.t;if(m=v-h.t,m!=0)return this.s<0?-m:m;for(;--v>=0;)if((m=this[v]-h[v])!=0)return m;return 0}function j(h){var m=1,v;return(v=h>>>16)!=0&&(h=v,m+=16),(v=h>>8)!=0&&(h=v,m+=8),(v=h>>4)!=0&&(h=v,m+=4),(v=h>>2)!=0&&(h=v,m+=2),(v=h>>1)!=0&&(h=v,m+=1),m}function A(){return this.t<=0?0:this.DB*(this.t-1)+j(this[this.t-1]^this.s&this.DM)}function D(h,m){var v;for(v=this.t-1;v>=0;--v)m[v+h]=this[v];for(v=h-1;v>=0;--v)m[v]=0;m.t=this.t+h,m.s=this.s}function k(h,m){for(var v=h;v<this.t;++v)m[v-h]=this[v];m.t=Math.max(this.t-h,0),m.s=this.s}function G(h,m){var v=h%this.DB,S=this.DB-v,C=(1<<S)-1,F=Math.floor(h/this.DB),H=this.s<<v&this.DM,K;for(K=this.t-1;K>=0;--K)m[K+F+1]=this[K]>>S|H,H=(this[K]&C)<<v;for(K=F-1;K>=0;--K)m[K]=0;m[F]=H,m.t=this.t+F+1,m.s=this.s,m.clamp()}function ee(h,m){m.s=this.s;var v=Math.floor(h/this.DB);if(v>=this.t){m.t=0;return}var S=h%this.DB,C=this.DB-S,F=(1<<S)-1;m[0]=this[v]>>S;for(var H=v+1;H<this.t;++H)m[H-v-1]|=(this[H]&F)<<C,m[H-v]=this[H]>>S;S>0&&(m[this.t-v-1]|=(this.s&F)<<C),m.t=this.t-v,m.clamp()}function J(h,m){for(var v=0,S=0,C=Math.min(h.t,this.t);v<C;)S+=this[v]-h[v],m[v++]=S&this.DM,S>>=this.DB;if(h.t<this.t){for(S-=h.s;v<this.t;)S+=this[v],m[v++]=S&this.DM,S>>=this.DB;S+=this.s}else{for(S+=this.s;v<h.t;)S-=h[v],m[v++]=S&this.DM,S>>=this.DB;S-=h.s}m.s=S<0?-1:0,S<-1?m[v++]=this.DV+S:S>0&&(m[v++]=S),m.t=v,m.clamp()}function re(h,m){var v=this.abs(),S=h.abs(),C=v.t;for(m.t=C+S.t;--C>=0;)m[C]=0;for(C=0;C<S.t;++C)m[C+v.t]=v.am(0,S[C],m,C,0,v.t);m.s=0,m.clamp(),this.s!=h.s&&a.ZERO.subTo(m,m)}function oe(h){for(var m=this.abs(),v=h.t=2*m.t;--v>=0;)h[v]=0;for(v=0;v<m.t-1;++v){var S=m.am(v,m[v],h,2*v,0,1);(h[v+m.t]+=m.am(v+1,2*m[v],h,2*v+1,S,m.t-v-1))>=m.DV&&(h[v+m.t]-=m.DV,h[v+m.t+1]=1)}h.t>0&&(h[h.t-1]+=m.am(v,m[v],h,2*v,0,1)),h.s=0,h.clamp()}function me(h,m,v){var S=h.abs();if(!(S.t<=0)){var C=this.abs();if(C.t<S.t){m!=null&&m.fromInt(0),v!=null&&this.copyTo(v);return}v==null&&(v=l());var F=l(),H=this.s,K=h.s,$=this.DB-j(S[S.t-1]);$>0?(S.lShiftTo($,F),C.lShiftTo($,v)):(S.copyTo(F),C.copyTo(v));var ue=F.t,Pe=F[ue-1];if(Pe!=0){var Me=Pe*(1<<this.F1)+(ue>1?F[ue-2]>>this.F2:0),Xe=this.FV/Me,St=(1<<this.F1)/Me,Vt=1<<this.F2,Wt=v.t,vi=Wt-ue,xn=m??l();for(F.dlShiftTo(vi,xn),v.compareTo(xn)>=0&&(v[v.t++]=1,v.subTo(xn,v)),a.ONE.dlShiftTo(ue,xn),xn.subTo(F,F);F.t<ue;)F[F.t++]=0;for(;--vi>=0;){var Ss=v[--Wt]==Pe?this.DM:Math.floor(v[Wt]*Xe+(v[Wt-1]+Vt)*St);if((v[Wt]+=F.am(0,Ss,v,vi,0,ue))<Ss)for(F.dlShiftTo(vi,xn),v.subTo(xn,v);v[Wt]<--Ss;)v.subTo(xn,v)}m!=null&&(v.drShiftTo(ue,m),H!=K&&a.ZERO.subTo(m,m)),v.t=ue,v.clamp(),$>0&&v.rShiftTo($,v),H<0&&a.ZERO.subTo(v,v)}}}function Le(h){var m=l();return this.abs().divRemTo(h,null,m),this.s<0&&m.compareTo(a.ZERO)>0&&h.subTo(m,m),m}function Ge(h){this.m=h}function pe(h){return h.s<0||h.compareTo(this.m)>=0?h.mod(this.m):h}function Te(h){return h}function ke(h){h.divRemTo(this.m,null,h)}function De(h,m,v){h.multiplyTo(m,v),this.reduce(v)}function Je(h,m){h.squareTo(m),this.reduce(m)}Ge.prototype.convert=pe,Ge.prototype.revert=Te,Ge.prototype.reduce=ke,Ge.prototype.mulTo=De,Ge.prototype.sqrTo=Je;function lt(){if(this.t<1)return 0;var h=this[0];if(!(h&1))return 0;var m=h&3;return m=m*(2-(h&15)*m)&15,m=m*(2-(h&255)*m)&255,m=m*(2-((h&65535)*m&65535))&65535,m=m*(2-h*m%this.DV)%this.DV,m>0?this.DV-m:-m}function rt(h){this.m=h,this.mp=h.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<h.DB-15)-1,this.mt2=2*h.t}function _t(h){var m=l();return h.abs().dlShiftTo(this.m.t,m),m.divRemTo(this.m,null,m),h.s<0&&m.compareTo(a.ZERO)>0&&this.m.subTo(m,m),m}function Ee(h){var m=l();return h.copyTo(m),this.reduce(m),m}function Oe(h){for(;h.t<=this.mt2;)h[h.t++]=0;for(var m=0;m<this.m.t;++m){var v=h[m]&32767,S=v*this.mpl+((v*this.mph+(h[m]>>15)*this.mpl&this.um)<<15)&h.DM;for(v=m+this.m.t,h[v]+=this.m.am(0,S,h,m,0,this.m.t);h[v]>=h.DV;)h[v]-=h.DV,h[++v]++}h.clamp(),h.drShiftTo(this.m.t,h),h.compareTo(this.m)>=0&&h.subTo(this.m,h)}function Q(h,m){h.squareTo(m),this.reduce(m)}function Ye(h,m,v){h.multiplyTo(m,v),this.reduce(v)}rt.prototype.convert=_t,rt.prototype.revert=Ee,rt.prototype.reduce=Oe,rt.prototype.mulTo=Ye,rt.prototype.sqrTo=Q;function Be(){return(this.t>0?this[0]&1:this.s)==0}function it(h,m){if(h>4294967295||h<1)return a.ONE;var v=l(),S=l(),C=m.convert(this),F=j(h)-1;for(C.copyTo(v);--F>=0;)if(m.sqrTo(v,S),(h&1<<F)>0)m.mulTo(S,C,v);else{var H=v;v=S,S=H}return m.revert(v)}function ze(h,m){var v;return h<256||m.isEven()?v=new Ge(m):v=new rt(m),this.exp(h,v)}a.prototype.copyTo=E,a.prototype.fromInt=w,a.prototype.fromString=B,a.prototype.clamp=N,a.prototype.dlShiftTo=D,a.prototype.drShiftTo=k,a.prototype.lShiftTo=G,a.prototype.rShiftTo=ee,a.prototype.subTo=J,a.prototype.multiplyTo=re,a.prototype.squareTo=oe,a.prototype.divRemTo=me,a.prototype.invDigit=lt,a.prototype.isEven=Be,a.prototype.exp=it,a.prototype.toString=L,a.prototype.negate=P,a.prototype.abs=R,a.prototype.compareTo=U,a.prototype.bitLength=A,a.prototype.mod=Le,a.prototype.modPowInt=ze,a.ZERO=I(0),a.ONE=I(1);function wt(){var h=l();return this.copyTo(h),h}function et(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Z(){return this.t==0?this.s:this[0]<<24>>24}function V(){return this.t==0?this.s:this[0]<<16>>16}function de(h){return Math.floor(Math.LN2*this.DB/Math.log(h))}function Ae(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Re(h){if(h==null&&(h=10),this.signum()==0||h<2||h>36)return"0";var m=this.chunkSize(h),v=Math.pow(h,m),S=I(v),C=l(),F=l(),H="";for(this.divRemTo(S,C,F);C.signum()>0;)H=(v+F.intValue()).toString(h).substr(1)+H,C.divRemTo(S,C,F);return F.intValue().toString(h)+H}function Ce(h,m){this.fromInt(0),m==null&&(m=10);for(var v=this.chunkSize(m),S=Math.pow(m,v),C=!1,F=0,H=0,K=0;K<h.length;++K){var $=M(h,K);if($<0){h.charAt(K)=="-"&&this.signum()==0&&(C=!0);continue}H=m*H+$,++F>=v&&(this.dMultiply(S),this.dAddOffset(H,0),F=0,H=0)}F>0&&(this.dMultiply(Math.pow(m,F)),this.dAddOffset(H,0)),C&&a.ZERO.subTo(this,this)}function ut(h,m,v){if(typeof m=="number")if(h<2)this.fromInt(1);else for(this.fromNumber(h,v),this.testBit(h-1)||this.bitwiseTo(a.ONE.shiftLeft(h-1),st,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(m);)this.dAddOffset(2,0),this.bitLength()>h&&this.subTo(a.ONE.shiftLeft(h-1),this);else{var S=new Array,C=h&7;S.length=(h>>3)+1,m.nextBytes(S),C>0?S[0]&=(1<<C)-1:S[0]=0,this.fromString(S,256)}}function je(){var h=this.t,m=new Array;m[0]=this.s;var v=this.DB-h*this.DB%8,S,C=0;if(h-- >0)for(v<this.DB&&(S=this[h]>>v)!=(this.s&this.DM)>>v&&(m[C++]=S|this.s<<this.DB-v);h>=0;)v<8?(S=(this[h]&(1<<v)-1)<<8-v,S|=this[--h]>>(v+=this.DB-8)):(S=this[h]>>(v-=8)&255,v<=0&&(v+=this.DB,--h)),S&128&&(S|=-256),C==0&&(this.s&128)!=(S&128)&&++C,(C>0||S!=this.s)&&(m[C++]=S);return m}function tt(h){return this.compareTo(h)==0}function Ht(h){return this.compareTo(h)<0?this:h}function Ue(h){return this.compareTo(h)>0?this:h}function ot(h,m,v){var S,C,F=Math.min(h.t,this.t);for(S=0;S<F;++S)v[S]=m(this[S],h[S]);if(h.t<this.t){for(C=h.s&this.DM,S=F;S<this.t;++S)v[S]=m(this[S],C);v.t=this.t}else{for(C=this.s&this.DM,S=F;S<h.t;++S)v[S]=m(C,h[S]);v.t=h.t}v.s=m(this.s,h.s),v.clamp()}function Et(h,m){return h&m}function At(h){var m=l();return this.bitwiseTo(h,Et,m),m}function st(h,m){return h|m}function Yt(h){var m=l();return this.bitwiseTo(h,st,m),m}function Rt(h,m){return h^m}function hi(h){var m=l();return this.bitwiseTo(h,Rt,m),m}function se(h,m){return h&~m}function Ve(h){var m=l();return this.bitwiseTo(h,se,m),m}function be(){for(var h=l(),m=0;m<this.t;++m)h[m]=this.DM&~this[m];return h.t=this.t,h.s=~this.s,h}function Ie(h){var m=l();return h<0?this.rShiftTo(-h,m):this.lShiftTo(h,m),m}function Ke(h){var m=l();return h<0?this.lShiftTo(-h,m):this.rShiftTo(h,m),m}function Qe(h){if(h==0)return-1;var m=0;return h&65535||(h>>=16,m+=16),h&255||(h>>=8,m+=8),h&15||(h>>=4,m+=4),h&3||(h>>=2,m+=2),h&1||++m,m}function Nt(){for(var h=0;h<this.t;++h)if(this[h]!=0)return h*this.DB+Qe(this[h]);return this.s<0?this.t*this.DB:-1}function Si(h){for(var m=0;h!=0;)h&=h-1,++m;return m}function Qi(){for(var h=0,m=this.s&this.DM,v=0;v<this.t;++v)h+=Si(this[v]^m);return h}function ri(h){var m=Math.floor(h/this.DB);return m>=this.t?this.s!=0:(this[m]&1<<h%this.DB)!=0}function $n(h,m){var v=a.ONE.shiftLeft(h);return this.bitwiseTo(v,m,v),v}function vr(h){return this.changeBit(h,st)}function Lc(h){return this.changeBit(h,se)}function Oc(h){return this.changeBit(h,Rt)}function Zr(h,m){for(var v=0,S=0,C=Math.min(h.t,this.t);v<C;)S+=this[v]+h[v],m[v++]=S&this.DM,S>>=this.DB;if(h.t<this.t){for(S+=h.s;v<this.t;)S+=this[v],m[v++]=S&this.DM,S>>=this.DB;S+=this.s}else{for(S+=this.s;v<h.t;)S+=h[v],m[v++]=S&this.DM,S>>=this.DB;S+=h.s}m.s=S<0?-1:0,S>0?m[v++]=S:S<-1&&(m[v++]=this.DV+S),m.t=v,m.clamp()}function qo(h){var m=l();return this.addTo(h,m),m}function Nc(h){var m=l();return this.subTo(h,m),m}function Bc(h){var m=l();return this.multiplyTo(h,m),m}function Zo(){var h=l();return this.squareTo(h),h}function Fc(h){var m=l();return this.divRemTo(h,m,null),m}function Ko(h){var m=l();return this.divRemTo(h,null,m),m}function Uc(h){var m=l(),v=l();return this.divRemTo(h,m,v),new Array(m,v)}function kc(h){this[this.t]=this.am(0,h-1,this,0,0,this.t),++this.t,this.clamp()}function Cu(h,m){if(h!=0){for(;this.t<=m;)this[this.t++]=0;for(this[m]+=h;this[m]>=this.DV;)this[m]-=this.DV,++m>=this.t&&(this[this.t++]=0),++this[m]}}function $s(){}function zc(h){return h}function Y(h,m,v){h.multiplyTo(m,v)}function le(h,m){h.squareTo(m)}$s.prototype.convert=zc,$s.prototype.revert=zc,$s.prototype.mulTo=Y,$s.prototype.sqrTo=le;function ge(h){return this.exp(h,new $s)}function _e(h,m,v){var S=Math.min(this.t+h.t,m);for(v.s=0,v.t=S;S>0;)v[--S]=0;var C;for(C=v.t-this.t;S<C;++S)v[S+this.t]=this.am(0,h[S],v,S,0,this.t);for(C=Math.min(h.t,m);S<C;++S)this.am(0,h[S],v,S,0,m-S);v.clamp()}function ce(h,m,v){--m;var S=v.t=this.t+h.t-m;for(v.s=0;--S>=0;)v[S]=0;for(S=Math.max(m-this.t,0);S<h.t;++S)v[this.t+S-m]=this.am(m-S,h[S],v,0,0,this.t+S-m);v.clamp(),v.drShiftTo(1,v)}function Fe(h){this.r2=l(),this.q3=l(),a.ONE.dlShiftTo(2*h.t,this.r2),this.mu=this.r2.divide(h),this.m=h}function qe(h){if(h.s<0||h.t>2*this.m.t)return h.mod(this.m);if(h.compareTo(this.m)<0)return h;var m=l();return h.copyTo(m),this.reduce(m),m}function dt(h){return h}function ct(h){for(h.drShiftTo(this.m.t-1,this.r2),h.t>this.m.t+1&&(h.t=this.m.t+1,h.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);h.compareTo(this.r2)<0;)h.dAddOffset(1,this.m.t+1);for(h.subTo(this.r2,h);h.compareTo(this.m)>=0;)h.subTo(this.m,h)}function Ct(h,m){h.squareTo(m),this.reduce(m)}function It(h,m,v){h.multiplyTo(m,v),this.reduce(v)}Fe.prototype.convert=qe,Fe.prototype.revert=dt,Fe.prototype.reduce=ct,Fe.prototype.mulTo=It,Fe.prototype.sqrTo=Ct;function ft(h,m){var v=h.bitLength(),S,C=I(1),F;if(v<=0)return C;v<18?S=1:v<48?S=3:v<144?S=4:v<768?S=5:S=6,v<8?F=new Ge(m):m.isEven()?F=new Fe(m):F=new rt(m);var H=new Array,K=3,$=S-1,ue=(1<<S)-1;if(H[1]=F.convert(this),S>1){var Pe=l();for(F.sqrTo(H[1],Pe);K<=ue;)H[K]=l(),F.mulTo(Pe,H[K-2],H[K]),K+=2}var Me=h.t-1,Xe,St=!0,Vt=l(),Wt;for(v=j(h[Me])-1;Me>=0;){for(v>=$?Xe=h[Me]>>v-$&ue:(Xe=(h[Me]&(1<<v+1)-1)<<$-v,Me>0&&(Xe|=h[Me-1]>>this.DB+v-$)),K=S;!(Xe&1);)Xe>>=1,--K;if((v-=K)<0&&(v+=this.DB,--Me),St)H[Xe].copyTo(C),St=!1;else{for(;K>1;)F.sqrTo(C,Vt),F.sqrTo(Vt,C),K-=2;K>0?F.sqrTo(C,Vt):(Wt=C,C=Vt,Vt=Wt),F.mulTo(Vt,H[Xe],C)}for(;Me>=0&&!(h[Me]&1<<v);)F.sqrTo(C,Vt),Wt=C,C=Vt,Vt=Wt,--v<0&&(v=this.DB-1,--Me)}return F.revert(C)}function Zt(h){var m=this.s<0?this.negate():this.clone(),v=h.s<0?h.negate():h.clone();if(m.compareTo(v)<0){var S=m;m=v,v=S}var C=m.getLowestSetBit(),F=v.getLowestSetBit();if(F<0)return m;for(C<F&&(F=C),F>0&&(m.rShiftTo(F,m),v.rShiftTo(F,v));m.signum()>0;)(C=m.getLowestSetBit())>0&&m.rShiftTo(C,m),(C=v.getLowestSetBit())>0&&v.rShiftTo(C,v),m.compareTo(v)>=0?(m.subTo(v,m),m.rShiftTo(1,m)):(v.subTo(m,v),v.rShiftTo(1,v));return F>0&&v.lShiftTo(F,v),v}function pi(h){if(h<=0)return 0;var m=this.DV%h,v=this.s<0?h-1:0;if(this.t>0)if(m==0)v=this[0]%h;else for(var S=this.t-1;S>=0;--S)v=(m*v+this[S])%h;return v}function ui(h){var m=h.isEven();if(this.isEven()&&m||h.signum()==0)return a.ZERO;for(var v=h.clone(),S=this.clone(),C=I(1),F=I(0),H=I(0),K=I(1);v.signum()!=0;){for(;v.isEven();)v.rShiftTo(1,v),m?((!C.isEven()||!F.isEven())&&(C.addTo(this,C),F.subTo(h,F)),C.rShiftTo(1,C)):F.isEven()||F.subTo(h,F),F.rShiftTo(1,F);for(;S.isEven();)S.rShiftTo(1,S),m?((!H.isEven()||!K.isEven())&&(H.addTo(this,H),K.subTo(h,K)),H.rShiftTo(1,H)):K.isEven()||K.subTo(h,K),K.rShiftTo(1,K);v.compareTo(S)>=0?(v.subTo(S,v),m&&C.subTo(H,C),F.subTo(K,F)):(S.subTo(v,S),m&&H.subTo(C,H),K.subTo(F,K))}if(S.compareTo(a.ONE)!=0)return a.ZERO;if(K.compareTo(h)>=0)return K.subtract(h);if(K.signum()<0)K.addTo(h,K);else return K;return K.signum()<0?K.add(h):K}var oi=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ii=(1<<26)/oi[oi.length-1];function z(h){var m,v=this.abs();if(v.t==1&&v[0]<=oi[oi.length-1]){for(m=0;m<oi.length;++m)if(v[0]==oi[m])return!0;return!1}if(v.isEven())return!1;for(m=1;m<oi.length;){for(var S=oi[m],C=m+1;C<oi.length&&S<ii;)S*=oi[C++];for(S=v.modInt(S);m<C;)if(S%oi[m++]==0)return!1}return v.millerRabin(h)}function te(h){var m=this.subtract(a.ONE),v=m.getLowestSetBit();if(v<=0)return!1;var S=m.shiftRight(v);h=h+1>>1,h>oi.length&&(h=oi.length);for(var C=l(),F=0;F<h;++F){C.fromInt(oi[Math.floor(Math.random()*oi.length)]);var H=C.modPow(S,this);if(H.compareTo(a.ONE)!=0&&H.compareTo(m)!=0){for(var K=1;K++<v&&H.compareTo(m)!=0;)if(H=H.modPowInt(2,this),H.compareTo(a.ONE)==0)return!1;if(H.compareTo(m)!=0)return!1}}return!0}a.prototype.chunkSize=de,a.prototype.toRadix=Re,a.prototype.fromRadix=Ce,a.prototype.fromNumber=ut,a.prototype.bitwiseTo=ot,a.prototype.changeBit=$n,a.prototype.addTo=Zr,a.prototype.dMultiply=kc,a.prototype.dAddOffset=Cu,a.prototype.multiplyLowerTo=_e,a.prototype.multiplyUpperTo=ce,a.prototype.modInt=pi,a.prototype.millerRabin=te,a.prototype.clone=wt,a.prototype.intValue=et,a.prototype.byteValue=Z,a.prototype.shortValue=V,a.prototype.signum=Ae,a.prototype.toByteArray=je,a.prototype.equals=tt,a.prototype.min=Ht,a.prototype.max=Ue,a.prototype.and=At,a.prototype.or=Yt,a.prototype.xor=hi,a.prototype.andNot=Ve,a.prototype.not=be,a.prototype.shiftLeft=Ie,a.prototype.shiftRight=Ke,a.prototype.getLowestSetBit=Nt,a.prototype.bitCount=Qi,a.prototype.testBit=ri,a.prototype.setBit=vr,a.prototype.clearBit=Lc,a.prototype.flipBit=Oc,a.prototype.add=qo,a.prototype.subtract=Nc,a.prototype.multiply=Bc,a.prototype.divide=Fc,a.prototype.remainder=Ko,a.prototype.divideAndRemainder=Uc,a.prototype.modPow=ft,a.prototype.modInverse=ui,a.prototype.pow=ge,a.prototype.gcd=Zt,a.prototype.isProbablePrime=z,a.prototype.square=Zo;var W=a;W.prototype.IsNegative=function(){return this.compareTo(W.ZERO)==-1},W.op_Equality=function(h,m){return h.compareTo(m)==0},W.op_Inequality=function(h,m){return h.compareTo(m)!=0},W.op_GreaterThan=function(h,m){return h.compareTo(m)>0},W.op_LessThan=function(h,m){return h.compareTo(m)<0},W.op_Addition=function(h,m){return new W(h,void 0,void 0).add(new W(m,void 0,void 0))},W.op_Subtraction=function(h,m){return new W(h,void 0,void 0).subtract(new W(m,void 0,void 0))},W.Int128Mul=function(h,m){return new W(h,void 0,void 0).multiply(new W(m,void 0,void 0))},W.op_Division=function(h,m){return h.divide(m)},W.prototype.ToDouble=function(){return parseFloat(this.toString())};var ne=function(h,m){var v;if(typeof Object.getOwnPropertyNames>"u"){for(v in m.prototype)(typeof h.prototype[v]>"u"||h.prototype[v]===Object.prototype[v])&&(h.prototype[v]=m.prototype[v]);for(v in m)typeof h[v]>"u"&&(h[v]=m[v]);h.$baseCtor=m}else{for(var S=Object.getOwnPropertyNames(m.prototype),C=0;C<S.length;C++)typeof Object.getOwnPropertyDescriptor(h.prototype,S[C])>"u"&&Object.defineProperty(h.prototype,S[C],Object.getOwnPropertyDescriptor(m.prototype,S[C]));for(v in m)typeof h[v]>"u"&&(h[v]=m[v]);h.$baseCtor=m}};e.Path=function(){return[]},e.Path.prototype.push=Array.prototype.push,e.Paths=function(){return[]},e.Paths.prototype.push=Array.prototype.push,e.DoublePoint=function(){var h=arguments;this.X=0,this.Y=0,h.length===1?(this.X=h[0].X,this.Y=h[0].Y):h.length===2&&(this.X=h[0],this.Y=h[1])},e.DoublePoint0=function(){this.X=0,this.Y=0},e.DoublePoint0.prototype=e.DoublePoint.prototype,e.DoublePoint1=function(h){this.X=h.X,this.Y=h.Y},e.DoublePoint1.prototype=e.DoublePoint.prototype,e.DoublePoint2=function(h,m){this.X=h,this.Y=m},e.DoublePoint2.prototype=e.DoublePoint.prototype,e.PolyNode=function(){this.m_Parent=null,this.m_polygon=new e.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},e.PolyNode.prototype.IsHoleNode=function(){for(var h=!0,m=this.m_Parent;m!==null;)h=!h,m=m.m_Parent;return h},e.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},e.PolyNode.prototype.Contour=function(){return this.m_polygon},e.PolyNode.prototype.AddChild=function(h){var m=this.m_Childs.length;this.m_Childs.push(h),h.m_Parent=this,h.m_Index=m},e.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},e.PolyNode.prototype.GetNextSiblingUp=function(){return this.m_Parent===null?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},e.PolyNode.prototype.Childs=function(){return this.m_Childs},e.PolyNode.prototype.Parent=function(){return this.m_Parent},e.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},e.PolyTree=function(){this.m_AllPolys=[],e.PolyNode.call(this)},e.PolyTree.prototype.Clear=function(){for(var h=0,m=this.m_AllPolys.length;h<m;h++)this.m_AllPolys[h]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},e.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},e.PolyTree.prototype.Total=function(){var h=this.m_AllPolys.length;return h>0&&this.m_Childs[0]!==this.m_AllPolys[0]&&h--,h},ne(e.PolyTree,e.PolyNode),e.Math_Abs_Int64=e.Math_Abs_Int32=e.Math_Abs_Double=function(h){return Math.abs(h)},e.Math_Max_Int32_Int32=function(h,m){return Math.max(h,m)},s.msie||s.opera||s.safari?e.Cast_Int32=function(h){return h|0}:e.Cast_Int32=function(h){return~~h},typeof Number.toInteger>"u"&&(Number.toInteger=null),s.chrome?e.Cast_Int64=function(h){return h<-2147483648||h>2147483647?h<0?Math.ceil(h):Math.floor(h):~~h}:s.firefox&&typeof Number.toInteger=="function"?e.Cast_Int64=function(h){return Number.toInteger(h)}:s.msie7||s.msie8?e.Cast_Int64=function(h){return parseInt(h,10)}:s.msie?e.Cast_Int64=function(h){return h<-2147483648||h>2147483647?h<0?Math.ceil(h):Math.floor(h):h|0}:e.Cast_Int64=function(h){return h<0?Math.ceil(h):Math.floor(h)},e.Clear=function(h){h.length=0},e.PI=3.141592653589793,e.PI2=2*3.141592653589793,e.IntPoint=function(){var h=arguments,m=h.length;if(this.X=0,this.Y=0,e.use_xyz)if(this.Z=0,m===3)this.X=h[0],this.Y=h[1],this.Z=h[2];else if(m===2)this.X=h[0],this.Y=h[1],this.Z=0;else if(m===1)if(h[0]instanceof e.DoublePoint){var v=h[0];this.X=e.Clipper.Round(v.X),this.Y=e.Clipper.Round(v.Y),this.Z=0}else{var S=h[0];typeof S.Z>"u"&&(S.Z=0),this.X=S.X,this.Y=S.Y,this.Z=S.Z}else this.X=0,this.Y=0,this.Z=0;else if(m===2)this.X=h[0],this.Y=h[1];else if(m===1)if(h[0]instanceof e.DoublePoint){var v=h[0];this.X=e.Clipper.Round(v.X),this.Y=e.Clipper.Round(v.Y)}else{var S=h[0];this.X=S.X,this.Y=S.Y}else this.X=0,this.Y=0},e.IntPoint.op_Equality=function(h,m){return h.X===m.X&&h.Y===m.Y},e.IntPoint.op_Inequality=function(h,m){return h.X!==m.X||h.Y!==m.Y},e.IntPoint0=function(){this.X=0,this.Y=0,e.use_xyz&&(this.Z=0)},e.IntPoint0.prototype=e.IntPoint.prototype,e.IntPoint1=function(h){this.X=h.X,this.Y=h.Y,e.use_xyz&&(typeof h.Z>"u"?this.Z=0:this.Z=h.Z)},e.IntPoint1.prototype=e.IntPoint.prototype,e.IntPoint1dp=function(h){this.X=e.Clipper.Round(h.X),this.Y=e.Clipper.Round(h.Y),e.use_xyz&&(this.Z=0)},e.IntPoint1dp.prototype=e.IntPoint.prototype,e.IntPoint2=function(h,m,v){this.X=h,this.Y=m,e.use_xyz&&(typeof v>"u"?this.Z=0:this.Z=v)},e.IntPoint2.prototype=e.IntPoint.prototype,e.IntRect=function(){var h=arguments,m=h.length;if(m===4)this.left=h[0],this.top=h[1],this.right=h[2],this.bottom=h[3];else if(m===1){var v=h[0];this.left=v.left,this.top=v.top,this.right=v.right,this.bottom=v.bottom}else this.left=0,this.top=0,this.right=0,this.bottom=0},e.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},e.IntRect0.prototype=e.IntRect.prototype,e.IntRect1=function(h){this.left=h.left,this.top=h.top,this.right=h.right,this.bottom=h.bottom},e.IntRect1.prototype=e.IntRect.prototype,e.IntRect4=function(h,m,v,S){this.left=h,this.top=m,this.right=v,this.bottom=S},e.IntRect4.prototype=e.IntRect.prototype,e.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},e.PolyType={ptSubject:0,ptClip:1},e.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},e.JoinType={jtSquare:0,jtRound:1,jtMiter:2},e.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},e.EdgeSide={esLeft:0,esRight:1},e.Direction={dRightToLeft:0,dLeftToRight:1},e.TEdge=function(){this.Bot=new e.IntPoint0,this.Curr=new e.IntPoint0,this.Top=new e.IntPoint0,this.Delta=new e.IntPoint0,this.Dx=0,this.PolyTyp=e.PolyType.ptSubject,this.Side=e.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},e.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new e.IntPoint0},e.MyIntersectNodeSort=function(){},e.MyIntersectNodeSort.Compare=function(h,m){var v=m.Pt.Y-h.Pt.Y;return v>0?1:v<0?-1:0},e.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},e.Scanbeam=function(){this.Y=0,this.Next=null},e.Maxima=function(){this.X=0,this.Next=null,this.Prev=null},e.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},e.OutPt=function(){this.Idx=0,this.Pt=new e.IntPoint0,this.Next=null,this.Prev=null},e.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new e.IntPoint0},e.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_Scanbeam=null,this.m_PolyOuts=null,this.m_ActiveEdges=null},e.ClipperBase.horizontal=-9007199254740992,e.ClipperBase.Skip=-2,e.ClipperBase.Unassigned=-1,e.ClipperBase.tolerance=1e-20,e.ClipperBase.loRange=47453132,e.ClipperBase.hiRange=0xfffffffffffff,e.ClipperBase.near_zero=function(h){return h>-e.ClipperBase.tolerance&&h<e.ClipperBase.tolerance},e.ClipperBase.IsHorizontal=function(h){return h.Delta.Y===0},e.ClipperBase.prototype.PointIsVertex=function(h,m){var v=m;do{if(e.IntPoint.op_Equality(v.Pt,h))return!0;v=v.Next}while(v!==m);return!1},e.ClipperBase.prototype.PointOnLineSegment=function(h,m,v,S){return S?h.X===m.X&&h.Y===m.Y||h.X===v.X&&h.Y===v.Y||h.X>m.X==h.X<v.X&&h.Y>m.Y==h.Y<v.Y&&W.op_Equality(W.Int128Mul(h.X-m.X,v.Y-m.Y),W.Int128Mul(v.X-m.X,h.Y-m.Y)):h.X===m.X&&h.Y===m.Y||h.X===v.X&&h.Y===v.Y||h.X>m.X==h.X<v.X&&h.Y>m.Y==h.Y<v.Y&&(h.X-m.X)*(v.Y-m.Y)===(v.X-m.X)*(h.Y-m.Y)},e.ClipperBase.prototype.PointOnPolygon=function(h,m,v){for(var S=m;;){if(this.PointOnLineSegment(h,S.Pt,S.Next.Pt,v))return!0;if(S=S.Next,S===m)break}return!1},e.ClipperBase.prototype.SlopesEqual=e.ClipperBase.SlopesEqual=function(){var h=arguments,m=h.length,v,S,C,F,H,K,$;return m===3?(v=h[0],S=h[1],$=h[2],$?W.op_Equality(W.Int128Mul(v.Delta.Y,S.Delta.X),W.Int128Mul(v.Delta.X,S.Delta.Y)):e.Cast_Int64(v.Delta.Y*S.Delta.X)===e.Cast_Int64(v.Delta.X*S.Delta.Y)):m===4?(C=h[0],F=h[1],H=h[2],$=h[3],$?W.op_Equality(W.Int128Mul(C.Y-F.Y,F.X-H.X),W.Int128Mul(C.X-F.X,F.Y-H.Y)):e.Cast_Int64((C.Y-F.Y)*(F.X-H.X))-e.Cast_Int64((C.X-F.X)*(F.Y-H.Y))===0):(C=h[0],F=h[1],H=h[2],K=h[3],$=h[4],$?W.op_Equality(W.Int128Mul(C.Y-F.Y,H.X-K.X),W.Int128Mul(C.X-F.X,H.Y-K.Y)):e.Cast_Int64((C.Y-F.Y)*(H.X-K.X))-e.Cast_Int64((C.X-F.X)*(H.Y-K.Y))===0)},e.ClipperBase.SlopesEqual3=function(h,m,v){return v?W.op_Equality(W.Int128Mul(h.Delta.Y,m.Delta.X),W.Int128Mul(h.Delta.X,m.Delta.Y)):e.Cast_Int64(h.Delta.Y*m.Delta.X)===e.Cast_Int64(h.Delta.X*m.Delta.Y)},e.ClipperBase.SlopesEqual4=function(h,m,v,S){return S?W.op_Equality(W.Int128Mul(h.Y-m.Y,m.X-v.X),W.Int128Mul(h.X-m.X,m.Y-v.Y)):e.Cast_Int64((h.Y-m.Y)*(m.X-v.X))-e.Cast_Int64((h.X-m.X)*(m.Y-v.Y))===0},e.ClipperBase.SlopesEqual5=function(h,m,v,S,C){return C?W.op_Equality(W.Int128Mul(h.Y-m.Y,v.X-S.X),W.Int128Mul(h.X-m.X,v.Y-S.Y)):e.Cast_Int64((h.Y-m.Y)*(v.X-S.X))-e.Cast_Int64((h.X-m.X)*(v.Y-S.Y))===0},e.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var h=0,m=this.m_edges.length;h<m;++h){for(var v=0,S=this.m_edges[h].length;v<S;++v)this.m_edges[h][v]=null;e.Clear(this.m_edges[h])}e.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},e.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;this.m_MinimaList!==null;){var h=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=h}this.m_CurrentLM=null},e.ClipperBase.prototype.RangeTest=function(h,m){m.Value?(h.X>e.ClipperBase.hiRange||h.Y>e.ClipperBase.hiRange||-h.X>e.ClipperBase.hiRange||-h.Y>e.ClipperBase.hiRange)&&e.Error("Coordinate outside allowed range in RangeTest()."):(h.X>e.ClipperBase.loRange||h.Y>e.ClipperBase.loRange||-h.X>e.ClipperBase.loRange||-h.Y>e.ClipperBase.loRange)&&(m.Value=!0,this.RangeTest(h,m))},e.ClipperBase.prototype.InitEdge=function(h,m,v,S){h.Next=m,h.Prev=v,h.Curr.X=S.X,h.Curr.Y=S.Y,e.use_xyz&&(h.Curr.Z=S.Z),h.OutIdx=-1},e.ClipperBase.prototype.InitEdge2=function(h,m){h.Curr.Y>=h.Next.Curr.Y?(h.Bot.X=h.Curr.X,h.Bot.Y=h.Curr.Y,e.use_xyz&&(h.Bot.Z=h.Curr.Z),h.Top.X=h.Next.Curr.X,h.Top.Y=h.Next.Curr.Y,e.use_xyz&&(h.Top.Z=h.Next.Curr.Z)):(h.Top.X=h.Curr.X,h.Top.Y=h.Curr.Y,e.use_xyz&&(h.Top.Z=h.Curr.Z),h.Bot.X=h.Next.Curr.X,h.Bot.Y=h.Next.Curr.Y,e.use_xyz&&(h.Bot.Z=h.Next.Curr.Z)),this.SetDx(h),h.PolyTyp=m},e.ClipperBase.prototype.FindNextLocMin=function(h){for(var m;;){for(;e.IntPoint.op_Inequality(h.Bot,h.Prev.Bot)||e.IntPoint.op_Equality(h.Curr,h.Top);)h=h.Next;if(h.Dx!==e.ClipperBase.horizontal&&h.Prev.Dx!==e.ClipperBase.horizontal)break;for(;h.Prev.Dx===e.ClipperBase.horizontal;)h=h.Prev;for(m=h;h.Dx===e.ClipperBase.horizontal;)h=h.Next;if(h.Top.Y!==h.Prev.Bot.Y){m.Prev.Bot.X<h.Bot.X&&(h=m);break}}return h},e.ClipperBase.prototype.ProcessBound=function(h,m){var v,S=h,C;if(S.OutIdx===e.ClipperBase.Skip){if(h=S,m){for(;h.Top.Y===h.Next.Bot.Y;)h=h.Next;for(;h!==S&&h.Dx===e.ClipperBase.horizontal;)h=h.Prev}else{for(;h.Top.Y===h.Prev.Bot.Y;)h=h.Prev;for(;h!==S&&h.Dx===e.ClipperBase.horizontal;)h=h.Next}if(h===S)m?S=h.Next:S=h.Prev;else{m?h=S.Next:h=S.Prev;var F=new e.LocalMinima;F.Next=null,F.Y=h.Bot.Y,F.LeftBound=null,F.RightBound=h,h.WindDelta=0,S=this.ProcessBound(h,m),this.InsertLocalMinima(F)}return S}if(h.Dx===e.ClipperBase.horizontal&&(m?v=h.Prev:v=h.Next,v.Dx===e.ClipperBase.horizontal?v.Bot.X!==h.Bot.X&&v.Top.X!==h.Bot.X&&this.ReverseHorizontal(h):v.Bot.X!==h.Bot.X&&this.ReverseHorizontal(h)),v=h,m){for(;S.Top.Y===S.Next.Bot.Y&&S.Next.OutIdx!==e.ClipperBase.Skip;)S=S.Next;if(S.Dx===e.ClipperBase.horizontal&&S.Next.OutIdx!==e.ClipperBase.Skip){for(C=S;C.Prev.Dx===e.ClipperBase.horizontal;)C=C.Prev;C.Prev.Top.X>S.Next.Top.X&&(S=C.Prev)}for(;h!==S;)h.NextInLML=h.Next,h.Dx===e.ClipperBase.horizontal&&h!==v&&h.Bot.X!==h.Prev.Top.X&&this.ReverseHorizontal(h),h=h.Next;h.Dx===e.ClipperBase.horizontal&&h!==v&&h.Bot.X!==h.Prev.Top.X&&this.ReverseHorizontal(h),S=S.Next}else{for(;S.Top.Y===S.Prev.Bot.Y&&S.Prev.OutIdx!==e.ClipperBase.Skip;)S=S.Prev;if(S.Dx===e.ClipperBase.horizontal&&S.Prev.OutIdx!==e.ClipperBase.Skip){for(C=S;C.Next.Dx===e.ClipperBase.horizontal;)C=C.Next;(C.Next.Top.X===S.Prev.Top.X||C.Next.Top.X>S.Prev.Top.X)&&(S=C.Next)}for(;h!==S;)h.NextInLML=h.Prev,h.Dx===e.ClipperBase.horizontal&&h!==v&&h.Bot.X!==h.Next.Top.X&&this.ReverseHorizontal(h),h=h.Prev;h.Dx===e.ClipperBase.horizontal&&h!==v&&h.Bot.X!==h.Next.Top.X&&this.ReverseHorizontal(h),S=S.Prev}return S},e.ClipperBase.prototype.AddPath=function(h,m,v){e.use_lines?!v&&m===e.PolyType.ptClip&&e.Error("AddPath: Open paths must be subject."):v||e.Error("AddPath: Open paths have been disabled.");var S=h.length-1;if(v)for(;S>0&&e.IntPoint.op_Equality(h[S],h[0]);)--S;for(;S>0&&e.IntPoint.op_Equality(h[S],h[S-1]);)--S;if(v&&S<2||!v&&S<1)return!1;for(var C=new Array,F=0;F<=S;F++)C.push(new e.TEdge);var H=!0;C[1].Curr.X=h[1].X,C[1].Curr.Y=h[1].Y,e.use_xyz&&(C[1].Curr.Z=h[1].Z);var K={Value:this.m_UseFullRange};this.RangeTest(h[0],K),this.m_UseFullRange=K.Value,K.Value=this.m_UseFullRange,this.RangeTest(h[S],K),this.m_UseFullRange=K.Value,this.InitEdge(C[0],C[1],C[S],h[0]),this.InitEdge(C[S],C[0],C[S-1],h[S]);for(var F=S-1;F>=1;--F)K.Value=this.m_UseFullRange,this.RangeTest(h[F],K),this.m_UseFullRange=K.Value,this.InitEdge(C[F],C[F+1],C[F-1],h[F]);for(var $=C[0],ue=$,Pe=$;;){if(ue.Curr===ue.Next.Curr&&(v||ue.Next!==$)){if(ue===ue.Next)break;ue===$&&($=ue.Next),ue=this.RemoveEdge(ue),Pe=ue;continue}if(ue.Prev===ue.Next)break;if(v&&e.ClipperBase.SlopesEqual4(ue.Prev.Curr,ue.Curr,ue.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(ue.Prev.Curr,ue.Curr,ue.Next.Curr))){ue===$&&($=ue.Next),ue=this.RemoveEdge(ue),ue=ue.Prev,Pe=ue;continue}if(ue=ue.Next,ue===Pe||!v&&ue.Next===$)break}if(!v&&ue===ue.Next||v&&ue.Prev===ue.Next)return!1;v||(this.m_HasOpenPaths=!0,$.Prev.OutIdx=e.ClipperBase.Skip),ue=$;do this.InitEdge2(ue,m),ue=ue.Next,H&&ue.Curr.Y!==$.Curr.Y&&(H=!1);while(ue!==$);if(H){if(v)return!1;ue.Prev.OutIdx=e.ClipperBase.Skip;var Me=new e.LocalMinima;for(Me.Next=null,Me.Y=ue.Bot.Y,Me.LeftBound=null,Me.RightBound=ue,Me.RightBound.Side=e.EdgeSide.esRight,Me.RightBound.WindDelta=0;ue.Bot.X!==ue.Prev.Top.X&&this.ReverseHorizontal(ue),ue.Next.OutIdx!==e.ClipperBase.Skip;)ue.NextInLML=ue.Next,ue=ue.Next;return this.InsertLocalMinima(Me),this.m_edges.push(C),!0}this.m_edges.push(C);var Xe,St=null;for(e.IntPoint.op_Equality(ue.Prev.Bot,ue.Prev.Top)&&(ue=ue.Next);ue=this.FindNextLocMin(ue),ue!==St;){St===null&&(St=ue);var Me=new e.LocalMinima;Me.Next=null,Me.Y=ue.Bot.Y,ue.Dx<ue.Prev.Dx?(Me.LeftBound=ue.Prev,Me.RightBound=ue,Xe=!1):(Me.LeftBound=ue,Me.RightBound=ue.Prev,Xe=!0),Me.LeftBound.Side=e.EdgeSide.esLeft,Me.RightBound.Side=e.EdgeSide.esRight,v?Me.LeftBound.Next===Me.RightBound?Me.LeftBound.WindDelta=-1:Me.LeftBound.WindDelta=1:Me.LeftBound.WindDelta=0,Me.RightBound.WindDelta=-Me.LeftBound.WindDelta,ue=this.ProcessBound(Me.LeftBound,Xe),ue.OutIdx===e.ClipperBase.Skip&&(ue=this.ProcessBound(ue,Xe));var Vt=this.ProcessBound(Me.RightBound,!Xe);Vt.OutIdx===e.ClipperBase.Skip&&(Vt=this.ProcessBound(Vt,!Xe)),Me.LeftBound.OutIdx===e.ClipperBase.Skip?Me.LeftBound=null:Me.RightBound.OutIdx===e.ClipperBase.Skip&&(Me.RightBound=null),this.InsertLocalMinima(Me),Xe||(ue=Vt)}return!0},e.ClipperBase.prototype.AddPaths=function(h,m,v){for(var S=!1,C=0,F=h.length;C<F;++C)this.AddPath(h[C],m,v)&&(S=!0);return S},e.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(h,m,v){return e.IntPoint.op_Equality(h,v)||e.IntPoint.op_Equality(h,m)||e.IntPoint.op_Equality(v,m)?!1:h.X!==v.X?m.X>h.X==m.X<v.X:m.Y>h.Y==m.Y<v.Y},e.ClipperBase.prototype.RemoveEdge=function(h){h.Prev.Next=h.Next,h.Next.Prev=h.Prev;var m=h.Next;return h.Prev=null,m},e.ClipperBase.prototype.SetDx=function(h){h.Delta.X=h.Top.X-h.Bot.X,h.Delta.Y=h.Top.Y-h.Bot.Y,h.Delta.Y===0?h.Dx=e.ClipperBase.horizontal:h.Dx=h.Delta.X/h.Delta.Y},e.ClipperBase.prototype.InsertLocalMinima=function(h){if(this.m_MinimaList===null)this.m_MinimaList=h;else if(h.Y>=this.m_MinimaList.Y)h.Next=this.m_MinimaList,this.m_MinimaList=h;else{for(var m=this.m_MinimaList;m.Next!==null&&h.Y<m.Next.Y;)m=m.Next;h.Next=m.Next,m.Next=h}},e.ClipperBase.prototype.PopLocalMinima=function(h,m){return m.v=this.m_CurrentLM,this.m_CurrentLM!==null&&this.m_CurrentLM.Y===h?(this.m_CurrentLM=this.m_CurrentLM.Next,!0):!1},e.ClipperBase.prototype.ReverseHorizontal=function(h){var m=h.Top.X;h.Top.X=h.Bot.X,h.Bot.X=m,e.use_xyz&&(m=h.Top.Z,h.Top.Z=h.Bot.Z,h.Bot.Z=m)},e.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,this.m_CurrentLM!==null){this.m_Scanbeam=null;for(var h=this.m_MinimaList;h!==null;){this.InsertScanbeam(h.Y);var m=h.LeftBound;m!==null&&(m.Curr.X=m.Bot.X,m.Curr.Y=m.Bot.Y,e.use_xyz&&(m.Curr.Z=m.Bot.Z),m.OutIdx=e.ClipperBase.Unassigned),m=h.RightBound,m!==null&&(m.Curr.X=m.Bot.X,m.Curr.Y=m.Bot.Y,e.use_xyz&&(m.Curr.Z=m.Bot.Z),m.OutIdx=e.ClipperBase.Unassigned),h=h.Next}this.m_ActiveEdges=null}},e.ClipperBase.prototype.InsertScanbeam=function(h){if(this.m_Scanbeam===null)this.m_Scanbeam=new e.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=h;else if(h>this.m_Scanbeam.Y){var m=new e.Scanbeam;m.Y=h,m.Next=this.m_Scanbeam,this.m_Scanbeam=m}else{for(var v=this.m_Scanbeam;v.Next!==null&&h<=v.Next.Y;)v=v.Next;if(h===v.Y)return;var S=new e.Scanbeam;S.Y=h,S.Next=v.Next,v.Next=S}},e.ClipperBase.prototype.PopScanbeam=function(h){return this.m_Scanbeam===null?(h.v=0,!1):(h.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},e.ClipperBase.prototype.LocalMinimaPending=function(){return this.m_CurrentLM!==null},e.ClipperBase.prototype.CreateOutRec=function(){var h=new e.OutRec;return h.Idx=e.ClipperBase.Unassigned,h.IsHole=!1,h.IsOpen=!1,h.FirstLeft=null,h.Pts=null,h.BottomPt=null,h.PolyNode=null,this.m_PolyOuts.push(h),h.Idx=this.m_PolyOuts.length-1,h},e.ClipperBase.prototype.DisposeOutRec=function(h){var m=this.m_PolyOuts[h];m.Pts=null,m=null,this.m_PolyOuts[h]=null},e.ClipperBase.prototype.UpdateEdgeIntoAEL=function(h){h.NextInLML===null&&e.Error("UpdateEdgeIntoAEL: invalid call");var m=h.PrevInAEL,v=h.NextInAEL;return h.NextInLML.OutIdx=h.OutIdx,m!==null?m.NextInAEL=h.NextInLML:this.m_ActiveEdges=h.NextInLML,v!==null&&(v.PrevInAEL=h.NextInLML),h.NextInLML.Side=h.Side,h.NextInLML.WindDelta=h.WindDelta,h.NextInLML.WindCnt=h.WindCnt,h.NextInLML.WindCnt2=h.WindCnt2,h=h.NextInLML,h.Curr.X=h.Bot.X,h.Curr.Y=h.Bot.Y,h.PrevInAEL=m,h.NextInAEL=v,e.ClipperBase.IsHorizontal(h)||this.InsertScanbeam(h.Top.Y),h},e.ClipperBase.prototype.SwapPositionsInAEL=function(h,m){if(!(h.NextInAEL===h.PrevInAEL||m.NextInAEL===m.PrevInAEL)){if(h.NextInAEL===m){var v=m.NextInAEL;v!==null&&(v.PrevInAEL=h);var S=h.PrevInAEL;S!==null&&(S.NextInAEL=m),m.PrevInAEL=S,m.NextInAEL=h,h.PrevInAEL=m,h.NextInAEL=v}else if(m.NextInAEL===h){var C=h.NextInAEL;C!==null&&(C.PrevInAEL=m);var F=m.PrevInAEL;F!==null&&(F.NextInAEL=h),h.PrevInAEL=F,h.NextInAEL=m,m.PrevInAEL=h,m.NextInAEL=C}else{var H=h.NextInAEL,K=h.PrevInAEL;h.NextInAEL=m.NextInAEL,h.NextInAEL!==null&&(h.NextInAEL.PrevInAEL=h),h.PrevInAEL=m.PrevInAEL,h.PrevInAEL!==null&&(h.PrevInAEL.NextInAEL=h),m.NextInAEL=H,m.NextInAEL!==null&&(m.NextInAEL.PrevInAEL=m),m.PrevInAEL=K,m.PrevInAEL!==null&&(m.PrevInAEL.NextInAEL=m)}h.PrevInAEL===null?this.m_ActiveEdges=h:m.PrevInAEL===null&&(this.m_ActiveEdges=m)}},e.ClipperBase.prototype.DeleteFromAEL=function(h){var m=h.PrevInAEL,v=h.NextInAEL;m===null&&v===null&&h!==this.m_ActiveEdges||(m!==null?m.NextInAEL=v:this.m_ActiveEdges=v,v!==null&&(v.PrevInAEL=m),h.NextInAEL=null,h.PrevInAEL=null)},e.Clipper=function(h){typeof h>"u"&&(h=0),this.m_PolyOuts=null,this.m_ClipType=e.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=e.PolyFillType.pftEvenOdd,this.m_SubjFillType=e.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,e.ClipperBase.call(this),this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=e.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=(1&h)!==0,this.StrictlySimple=(2&h)!==0,this.PreserveCollinear=(4&h)!==0,e.use_xyz&&(this.ZFillFunction=null)},e.Clipper.ioReverseSolution=1,e.Clipper.ioStrictlySimple=2,e.Clipper.ioPreserveCollinear=4,e.Clipper.prototype.Clear=function(){this.m_edges.length!==0&&(this.DisposeAllPolyPts(),e.ClipperBase.prototype.Clear.call(this))},e.Clipper.prototype.InsertMaxima=function(h){var m=new e.Maxima;if(m.X=h,this.m_Maxima===null)this.m_Maxima=m,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(h<this.m_Maxima.X)m.Next=this.m_Maxima,m.Prev=null,this.m_Maxima=m;else{for(var v=this.m_Maxima;v.Next!==null&&h>=v.Next.X;)v=v.Next;if(h===v.X)return;m.Next=v.Next,m.Prev=v,v.Next!==null&&(v.Next.Prev=m),v.Next=m}},e.Clipper.prototype.Execute=function(){var h=arguments,m=h.length,v=h[1]instanceof e.PolyTree;if(m===4&&!v){var S=h[0],C=h[1],F=h[2],H=h[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&e.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,e.Clear(C),this.m_SubjFillType=F,this.m_ClipFillType=H,this.m_ClipType=S,this.m_UsingPolyTree=!1;try{var K=this.ExecuteInternal();K&&this.BuildResult(C)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return K}else if(m===4&&v){var S=h[0],$=h[1],F=h[2],H=h[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=F,this.m_ClipFillType=H,this.m_ClipType=S,this.m_UsingPolyTree=!0;try{var K=this.ExecuteInternal();K&&this.BuildResult2($)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return K}else if(m===2&&!v){var S=h[0],C=h[1];return this.Execute(S,C,e.PolyFillType.pftEvenOdd,e.PolyFillType.pftEvenOdd)}else if(m===2&&v){var S=h[0],$=h[1];return this.Execute(S,$,e.PolyFillType.pftEvenOdd,e.PolyFillType.pftEvenOdd)}},e.Clipper.prototype.FixHoleLinkage=function(h){if(!(h.FirstLeft===null||h.IsHole!==h.FirstLeft.IsHole&&h.FirstLeft.Pts!==null)){for(var m=h.FirstLeft;m!==null&&(m.IsHole===h.IsHole||m.Pts===null);)m=m.FirstLeft;h.FirstLeft=m}},e.Clipper.prototype.ExecuteInternal=function(){try{this.Reset(),this.m_SortedEdges=null,this.m_Maxima=null;var h={},m={};if(!this.PopScanbeam(h))return!1;for(this.InsertLocalMinimaIntoAEL(h.v);this.PopScanbeam(m)||this.LocalMinimaPending();){if(this.ProcessHorizontals(),this.m_GhostJoins.length=0,!this.ProcessIntersections(m.v))return!1;this.ProcessEdgesAtTopOfScanbeam(m.v),h.v=m.v,this.InsertLocalMinimaIntoAEL(h.v)}var v,S,C;for(S=0,C=this.m_PolyOuts.length;S<C;S++)v=this.m_PolyOuts[S],!(v.Pts===null||v.IsOpen)&&(v.IsHole^this.ReverseSolution)==this.Area$1(v)>0&&this.ReversePolyPtLinks(v.Pts);for(this.JoinCommonEdges(),S=0,C=this.m_PolyOuts.length;S<C;S++)v=this.m_PolyOuts[S],v.Pts!==null&&(v.IsOpen?this.FixupOutPolyline(v):this.FixupOutPolygon(v));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},e.Clipper.prototype.DisposeAllPolyPts=function(){for(var h=0,m=this.m_PolyOuts.length;h<m;++h)this.DisposeOutRec(h);e.Clear(this.m_PolyOuts)},e.Clipper.prototype.AddJoin=function(h,m,v){var S=new e.Join;S.OutPt1=h,S.OutPt2=m,S.OffPt.X=v.X,S.OffPt.Y=v.Y,e.use_xyz&&(S.OffPt.Z=v.Z),this.m_Joins.push(S)},e.Clipper.prototype.AddGhostJoin=function(h,m){var v=new e.Join;v.OutPt1=h,v.OffPt.X=m.X,v.OffPt.Y=m.Y,e.use_xyz&&(v.OffPt.Z=m.Z),this.m_GhostJoins.push(v)},e.Clipper.prototype.SetZ=function(h,m,v){if(this.ZFillFunction!==null){if(h.Z!==0||this.ZFillFunction===null)return;e.IntPoint.op_Equality(h,m.Bot)?h.Z=m.Bot.Z:e.IntPoint.op_Equality(h,m.Top)?h.Z=m.Top.Z:e.IntPoint.op_Equality(h,v.Bot)?h.Z=v.Bot.Z:e.IntPoint.op_Equality(h,v.Top)?h.Z=v.Top.Z:this.ZFillFunction(m.Bot,m.Top,v.Bot,v.Top,h)}},e.Clipper.prototype.InsertLocalMinimaIntoAEL=function(h){for(var m={},v,S;this.PopLocalMinima(h,m);){v=m.v.LeftBound,S=m.v.RightBound;var C=null;if(v===null?(this.InsertEdgeIntoAEL(S,null),this.SetWindingCount(S),this.IsContributing(S)&&(C=this.AddOutPt(S,S.Bot))):S===null?(this.InsertEdgeIntoAEL(v,null),this.SetWindingCount(v),this.IsContributing(v)&&(C=this.AddOutPt(v,v.Bot)),this.InsertScanbeam(v.Top.Y)):(this.InsertEdgeIntoAEL(v,null),this.InsertEdgeIntoAEL(S,v),this.SetWindingCount(v),S.WindCnt=v.WindCnt,S.WindCnt2=v.WindCnt2,this.IsContributing(v)&&(C=this.AddLocalMinPoly(v,S,v.Bot)),this.InsertScanbeam(v.Top.Y)),S!==null&&(e.ClipperBase.IsHorizontal(S)?(S.NextInLML!==null&&this.InsertScanbeam(S.NextInLML.Top.Y),this.AddEdgeToSEL(S)):this.InsertScanbeam(S.Top.Y)),!(v===null||S===null)){if(C!==null&&e.ClipperBase.IsHorizontal(S)&&this.m_GhostJoins.length>0&&S.WindDelta!==0)for(var F=0,H=this.m_GhostJoins.length;F<H;F++){var K=this.m_GhostJoins[F];this.HorzSegmentsOverlap(K.OutPt1.Pt.X,K.OffPt.X,S.Bot.X,S.Top.X)&&this.AddJoin(K.OutPt1,C,K.OffPt)}if(v.OutIdx>=0&&v.PrevInAEL!==null&&v.PrevInAEL.Curr.X===v.Bot.X&&v.PrevInAEL.OutIdx>=0&&e.ClipperBase.SlopesEqual5(v.PrevInAEL.Curr,v.PrevInAEL.Top,v.Curr,v.Top,this.m_UseFullRange)&&v.WindDelta!==0&&v.PrevInAEL.WindDelta!==0){var $=this.AddOutPt(v.PrevInAEL,v.Bot);this.AddJoin(C,$,v.Top)}if(v.NextInAEL!==S){if(S.OutIdx>=0&&S.PrevInAEL.OutIdx>=0&&e.ClipperBase.SlopesEqual5(S.PrevInAEL.Curr,S.PrevInAEL.Top,S.Curr,S.Top,this.m_UseFullRange)&&S.WindDelta!==0&&S.PrevInAEL.WindDelta!==0){var $=this.AddOutPt(S.PrevInAEL,S.Bot);this.AddJoin(C,$,S.Top)}var ue=v.NextInAEL;if(ue!==null)for(;ue!==S;)this.IntersectEdges(S,ue,v.Curr),ue=ue.NextInAEL}}}},e.Clipper.prototype.InsertEdgeIntoAEL=function(h,m){if(this.m_ActiveEdges===null)h.PrevInAEL=null,h.NextInAEL=null,this.m_ActiveEdges=h;else if(m===null&&this.E2InsertsBeforeE1(this.m_ActiveEdges,h))h.PrevInAEL=null,h.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=h,this.m_ActiveEdges=h;else{for(m===null&&(m=this.m_ActiveEdges);m.NextInAEL!==null&&!this.E2InsertsBeforeE1(m.NextInAEL,h);)m=m.NextInAEL;h.NextInAEL=m.NextInAEL,m.NextInAEL!==null&&(m.NextInAEL.PrevInAEL=h),h.PrevInAEL=m,m.NextInAEL=h}},e.Clipper.prototype.E2InsertsBeforeE1=function(h,m){return m.Curr.X===h.Curr.X?m.Top.Y>h.Top.Y?m.Top.X<e.Clipper.TopX(h,m.Top.Y):h.Top.X>e.Clipper.TopX(m,h.Top.Y):m.Curr.X<h.Curr.X},e.Clipper.prototype.IsEvenOddFillType=function(h){return h.PolyTyp===e.PolyType.ptSubject?this.m_SubjFillType===e.PolyFillType.pftEvenOdd:this.m_ClipFillType===e.PolyFillType.pftEvenOdd},e.Clipper.prototype.IsEvenOddAltFillType=function(h){return h.PolyTyp===e.PolyType.ptSubject?this.m_ClipFillType===e.PolyFillType.pftEvenOdd:this.m_SubjFillType===e.PolyFillType.pftEvenOdd},e.Clipper.prototype.IsContributing=function(h){var m,v;switch(h.PolyTyp===e.PolyType.ptSubject?(m=this.m_SubjFillType,v=this.m_ClipFillType):(m=this.m_ClipFillType,v=this.m_SubjFillType),m){case e.PolyFillType.pftEvenOdd:if(h.WindDelta===0&&h.WindCnt!==1)return!1;break;case e.PolyFillType.pftNonZero:if(Math.abs(h.WindCnt)!==1)return!1;break;case e.PolyFillType.pftPositive:if(h.WindCnt!==1)return!1;break;default:if(h.WindCnt!==-1)return!1;break}switch(this.m_ClipType){case e.ClipType.ctIntersection:switch(v){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return h.WindCnt2!==0;case e.PolyFillType.pftPositive:return h.WindCnt2>0;default:return h.WindCnt2<0}case e.ClipType.ctUnion:switch(v){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return h.WindCnt2===0;case e.PolyFillType.pftPositive:return h.WindCnt2<=0;default:return h.WindCnt2>=0}case e.ClipType.ctDifference:if(h.PolyTyp===e.PolyType.ptSubject)switch(v){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return h.WindCnt2===0;case e.PolyFillType.pftPositive:return h.WindCnt2<=0;default:return h.WindCnt2>=0}else switch(v){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return h.WindCnt2!==0;case e.PolyFillType.pftPositive:return h.WindCnt2>0;default:return h.WindCnt2<0}case e.ClipType.ctXor:if(h.WindDelta===0)switch(v){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return h.WindCnt2===0;case e.PolyFillType.pftPositive:return h.WindCnt2<=0;default:return h.WindCnt2>=0}else return!0}return!0},e.Clipper.prototype.SetWindingCount=function(h){for(var m=h.PrevInAEL;m!==null&&(m.PolyTyp!==h.PolyTyp||m.WindDelta===0);)m=m.PrevInAEL;if(m===null){var v=h.PolyTyp===e.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType;h.WindDelta===0?h.WindCnt=v===e.PolyFillType.pftNegative?-1:1:h.WindCnt=h.WindDelta,h.WindCnt2=0,m=this.m_ActiveEdges}else if(h.WindDelta===0&&this.m_ClipType!==e.ClipType.ctUnion)h.WindCnt=1,h.WindCnt2=m.WindCnt2,m=m.NextInAEL;else if(this.IsEvenOddFillType(h)){if(h.WindDelta===0){for(var S=!0,C=m.PrevInAEL;C!==null;)C.PolyTyp===m.PolyTyp&&C.WindDelta!==0&&(S=!S),C=C.PrevInAEL;h.WindCnt=S?0:1}else h.WindCnt=h.WindDelta;h.WindCnt2=m.WindCnt2,m=m.NextInAEL}else m.WindCnt*m.WindDelta<0?Math.abs(m.WindCnt)>1?m.WindDelta*h.WindDelta<0?h.WindCnt=m.WindCnt:h.WindCnt=m.WindCnt+h.WindDelta:h.WindCnt=h.WindDelta===0?1:h.WindDelta:h.WindDelta===0?h.WindCnt=m.WindCnt<0?m.WindCnt-1:m.WindCnt+1:m.WindDelta*h.WindDelta<0?h.WindCnt=m.WindCnt:h.WindCnt=m.WindCnt+h.WindDelta,h.WindCnt2=m.WindCnt2,m=m.NextInAEL;if(this.IsEvenOddAltFillType(h))for(;m!==h;)m.WindDelta!==0&&(h.WindCnt2=h.WindCnt2===0?1:0),m=m.NextInAEL;else for(;m!==h;)h.WindCnt2+=m.WindDelta,m=m.NextInAEL},e.Clipper.prototype.AddEdgeToSEL=function(h){this.m_SortedEdges===null?(this.m_SortedEdges=h,h.PrevInSEL=null,h.NextInSEL=null):(h.NextInSEL=this.m_SortedEdges,h.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=h,this.m_SortedEdges=h)},e.Clipper.prototype.PopEdgeFromSEL=function(h){if(h.v=this.m_SortedEdges,h.v===null)return!1;var m=h.v;return this.m_SortedEdges=h.v.NextInSEL,this.m_SortedEdges!==null&&(this.m_SortedEdges.PrevInSEL=null),m.NextInSEL=null,m.PrevInSEL=null,!0},e.Clipper.prototype.CopyAELToSEL=function(){var h=this.m_ActiveEdges;for(this.m_SortedEdges=h;h!==null;)h.PrevInSEL=h.PrevInAEL,h.NextInSEL=h.NextInAEL,h=h.NextInAEL},e.Clipper.prototype.SwapPositionsInSEL=function(h,m){if(!(h.NextInSEL===null&&h.PrevInSEL===null)&&!(m.NextInSEL===null&&m.PrevInSEL===null)){if(h.NextInSEL===m){var v=m.NextInSEL;v!==null&&(v.PrevInSEL=h);var S=h.PrevInSEL;S!==null&&(S.NextInSEL=m),m.PrevInSEL=S,m.NextInSEL=h,h.PrevInSEL=m,h.NextInSEL=v}else if(m.NextInSEL===h){var v=h.NextInSEL;v!==null&&(v.PrevInSEL=m);var S=m.PrevInSEL;S!==null&&(S.NextInSEL=h),h.PrevInSEL=S,h.NextInSEL=m,m.PrevInSEL=h,m.NextInSEL=v}else{var v=h.NextInSEL,S=h.PrevInSEL;h.NextInSEL=m.NextInSEL,h.NextInSEL!==null&&(h.NextInSEL.PrevInSEL=h),h.PrevInSEL=m.PrevInSEL,h.PrevInSEL!==null&&(h.PrevInSEL.NextInSEL=h),m.NextInSEL=v,m.NextInSEL!==null&&(m.NextInSEL.PrevInSEL=m),m.PrevInSEL=S,m.PrevInSEL!==null&&(m.PrevInSEL.NextInSEL=m)}h.PrevInSEL===null?this.m_SortedEdges=h:m.PrevInSEL===null&&(this.m_SortedEdges=m)}},e.Clipper.prototype.AddLocalMaxPoly=function(h,m,v){this.AddOutPt(h,v),m.WindDelta===0&&this.AddOutPt(m,v),h.OutIdx===m.OutIdx?(h.OutIdx=-1,m.OutIdx=-1):h.OutIdx<m.OutIdx?this.AppendPolygon(h,m):this.AppendPolygon(m,h)},e.Clipper.prototype.AddLocalMinPoly=function(h,m,v){var S,C,F;if(e.ClipperBase.IsHorizontal(m)||h.Dx>m.Dx?(S=this.AddOutPt(h,v),m.OutIdx=h.OutIdx,h.Side=e.EdgeSide.esLeft,m.Side=e.EdgeSide.esRight,C=h,C.PrevInAEL===m?F=m.PrevInAEL:F=C.PrevInAEL):(S=this.AddOutPt(m,v),h.OutIdx=m.OutIdx,h.Side=e.EdgeSide.esRight,m.Side=e.EdgeSide.esLeft,C=m,C.PrevInAEL===h?F=h.PrevInAEL:F=C.PrevInAEL),F!==null&&F.OutIdx>=0&&F.Top.Y<v.Y&&C.Top.Y<v.Y){var H=e.Clipper.TopX(F,v.Y),K=e.Clipper.TopX(C,v.Y);if(H===K&&C.WindDelta!==0&&F.WindDelta!==0&&e.ClipperBase.SlopesEqual5(new e.IntPoint2(H,v.Y),F.Top,new e.IntPoint2(K,v.Y),C.Top,this.m_UseFullRange)){var $=this.AddOutPt(F,v);this.AddJoin(S,$,C.Top)}}return S},e.Clipper.prototype.AddOutPt=function(h,m){if(h.OutIdx<0){var v=this.CreateOutRec();v.IsOpen=h.WindDelta===0;var S=new e.OutPt;return v.Pts=S,S.Idx=v.Idx,S.Pt.X=m.X,S.Pt.Y=m.Y,e.use_xyz&&(S.Pt.Z=m.Z),S.Next=S,S.Prev=S,v.IsOpen||this.SetHoleState(h,v),h.OutIdx=v.Idx,S}else{var v=this.m_PolyOuts[h.OutIdx],C=v.Pts,F=h.Side===e.EdgeSide.esLeft;if(F&&e.IntPoint.op_Equality(m,C.Pt))return C;if(!F&&e.IntPoint.op_Equality(m,C.Prev.Pt))return C.Prev;var S=new e.OutPt;return S.Idx=v.Idx,S.Pt.X=m.X,S.Pt.Y=m.Y,e.use_xyz&&(S.Pt.Z=m.Z),S.Next=C,S.Prev=C.Prev,S.Prev.Next=S,C.Prev=S,F&&(v.Pts=S),S}},e.Clipper.prototype.GetLastOutPt=function(h){var m=this.m_PolyOuts[h.OutIdx];return h.Side===e.EdgeSide.esLeft?m.Pts:m.Pts.Prev},e.Clipper.prototype.SwapPoints=function(h,m){var v=new e.IntPoint1(h.Value);h.Value.X=m.Value.X,h.Value.Y=m.Value.Y,e.use_xyz&&(h.Value.Z=m.Value.Z),m.Value.X=v.X,m.Value.Y=v.Y,e.use_xyz&&(m.Value.Z=v.Z)},e.Clipper.prototype.HorzSegmentsOverlap=function(h,m,v,S){var C;return h>m&&(C=h,h=m,m=C),v>S&&(C=v,v=S,S=C),h<S&&v<m},e.Clipper.prototype.SetHoleState=function(h,m){for(var v=h.PrevInAEL,S=null;v!==null;)v.OutIdx>=0&&v.WindDelta!==0&&(S===null?S=v:S.OutIdx===v.OutIdx&&(S=null)),v=v.PrevInAEL;S===null?(m.FirstLeft=null,m.IsHole=!1):(m.FirstLeft=this.m_PolyOuts[S.OutIdx],m.IsHole=!m.FirstLeft.IsHole)},e.Clipper.prototype.GetDx=function(h,m){return h.Y===m.Y?e.ClipperBase.horizontal:(m.X-h.X)/(m.Y-h.Y)},e.Clipper.prototype.FirstIsBottomPt=function(h,m){for(var v=h.Prev;e.IntPoint.op_Equality(v.Pt,h.Pt)&&v!==h;)v=v.Prev;var S=Math.abs(this.GetDx(h.Pt,v.Pt));for(v=h.Next;e.IntPoint.op_Equality(v.Pt,h.Pt)&&v!==h;)v=v.Next;var C=Math.abs(this.GetDx(h.Pt,v.Pt));for(v=m.Prev;e.IntPoint.op_Equality(v.Pt,m.Pt)&&v!==m;)v=v.Prev;var F=Math.abs(this.GetDx(m.Pt,v.Pt));for(v=m.Next;e.IntPoint.op_Equality(v.Pt,m.Pt)&&v!==m;)v=v.Next;var H=Math.abs(this.GetDx(m.Pt,v.Pt));return Math.max(S,C)===Math.max(F,H)&&Math.min(S,C)===Math.min(F,H)?this.Area(h)>0:S>=F&&S>=H||C>=F&&C>=H},e.Clipper.prototype.GetBottomPt=function(h){for(var m=null,v=h.Next;v!==h;)v.Pt.Y>h.Pt.Y?(h=v,m=null):v.Pt.Y===h.Pt.Y&&v.Pt.X<=h.Pt.X&&(v.Pt.X<h.Pt.X?(m=null,h=v):v.Next!==h&&v.Prev!==h&&(m=v)),v=v.Next;if(m!==null)for(;m!==v;)for(this.FirstIsBottomPt(v,m)||(h=m),m=m.Next;e.IntPoint.op_Inequality(m.Pt,h.Pt);)m=m.Next;return h},e.Clipper.prototype.GetLowermostRec=function(h,m){h.BottomPt===null&&(h.BottomPt=this.GetBottomPt(h.Pts)),m.BottomPt===null&&(m.BottomPt=this.GetBottomPt(m.Pts));var v=h.BottomPt,S=m.BottomPt;return v.Pt.Y>S.Pt.Y?h:v.Pt.Y<S.Pt.Y?m:v.Pt.X<S.Pt.X?h:v.Pt.X>S.Pt.X||v.Next===v?m:S.Next===S||this.FirstIsBottomPt(v,S)?h:m},e.Clipper.prototype.OutRec1RightOfOutRec2=function(h,m){do if(h=h.FirstLeft,h===m)return!0;while(h!==null);return!1},e.Clipper.prototype.GetOutRec=function(h){for(var m=this.m_PolyOuts[h];m!==this.m_PolyOuts[m.Idx];)m=this.m_PolyOuts[m.Idx];return m},e.Clipper.prototype.AppendPolygon=function(h,m){var v=this.m_PolyOuts[h.OutIdx],S=this.m_PolyOuts[m.OutIdx],C;this.OutRec1RightOfOutRec2(v,S)?C=S:this.OutRec1RightOfOutRec2(S,v)?C=v:C=this.GetLowermostRec(v,S);var F=v.Pts,H=F.Prev,K=S.Pts,$=K.Prev;h.Side===e.EdgeSide.esLeft?m.Side===e.EdgeSide.esLeft?(this.ReversePolyPtLinks(K),K.Next=F,F.Prev=K,H.Next=$,$.Prev=H,v.Pts=$):($.Next=F,F.Prev=$,K.Prev=H,H.Next=K,v.Pts=K):m.Side===e.EdgeSide.esRight?(this.ReversePolyPtLinks(K),H.Next=$,$.Prev=H,K.Next=F,F.Prev=K):(H.Next=K,K.Prev=H,F.Prev=$,$.Next=F),v.BottomPt=null,C===S&&(S.FirstLeft!==v&&(v.FirstLeft=S.FirstLeft),v.IsHole=S.IsHole),S.Pts=null,S.BottomPt=null,S.FirstLeft=v;var ue=h.OutIdx,Pe=m.OutIdx;h.OutIdx=-1,m.OutIdx=-1;for(var Me=this.m_ActiveEdges;Me!==null;){if(Me.OutIdx===Pe){Me.OutIdx=ue,Me.Side=h.Side;break}Me=Me.NextInAEL}S.Idx=v.Idx},e.Clipper.prototype.ReversePolyPtLinks=function(h){if(h!==null){var m,v;m=h;do v=m.Next,m.Next=m.Prev,m.Prev=v,m=v;while(m!==h)}},e.Clipper.SwapSides=function(h,m){var v=h.Side;h.Side=m.Side,m.Side=v},e.Clipper.SwapPolyIndexes=function(h,m){var v=h.OutIdx;h.OutIdx=m.OutIdx,m.OutIdx=v},e.Clipper.prototype.IntersectEdges=function(h,m,v){var S=h.OutIdx>=0,C=m.OutIdx>=0;if(e.use_xyz&&this.SetZ(v,h,m),e.use_lines&&(h.WindDelta===0||m.WindDelta===0)){if(h.WindDelta===0&&m.WindDelta===0)return;h.PolyTyp===m.PolyTyp&&h.WindDelta!==m.WindDelta&&this.m_ClipType===e.ClipType.ctUnion?h.WindDelta===0?C&&(this.AddOutPt(h,v),S&&(h.OutIdx=-1)):S&&(this.AddOutPt(m,v),C&&(m.OutIdx=-1)):h.PolyTyp!==m.PolyTyp&&(h.WindDelta===0&&Math.abs(m.WindCnt)===1&&(this.m_ClipType!==e.ClipType.ctUnion||m.WindCnt2===0)?(this.AddOutPt(h,v),S&&(h.OutIdx=-1)):m.WindDelta===0&&Math.abs(h.WindCnt)===1&&(this.m_ClipType!==e.ClipType.ctUnion||h.WindCnt2===0)&&(this.AddOutPt(m,v),C&&(m.OutIdx=-1)));return}if(h.PolyTyp===m.PolyTyp)if(this.IsEvenOddFillType(h)){var F=h.WindCnt;h.WindCnt=m.WindCnt,m.WindCnt=F}else h.WindCnt+m.WindDelta===0?h.WindCnt=-h.WindCnt:h.WindCnt+=m.WindDelta,m.WindCnt-h.WindDelta===0?m.WindCnt=-m.WindCnt:m.WindCnt-=h.WindDelta;else this.IsEvenOddFillType(m)?h.WindCnt2=h.WindCnt2===0?1:0:h.WindCnt2+=m.WindDelta,this.IsEvenOddFillType(h)?m.WindCnt2=m.WindCnt2===0?1:0:m.WindCnt2-=h.WindDelta;var H,K,$,ue;h.PolyTyp===e.PolyType.ptSubject?(H=this.m_SubjFillType,$=this.m_ClipFillType):(H=this.m_ClipFillType,$=this.m_SubjFillType),m.PolyTyp===e.PolyType.ptSubject?(K=this.m_SubjFillType,ue=this.m_ClipFillType):(K=this.m_ClipFillType,ue=this.m_SubjFillType);var Pe,Me;switch(H){case e.PolyFillType.pftPositive:Pe=h.WindCnt;break;case e.PolyFillType.pftNegative:Pe=-h.WindCnt;break;default:Pe=Math.abs(h.WindCnt);break}switch(K){case e.PolyFillType.pftPositive:Me=m.WindCnt;break;case e.PolyFillType.pftNegative:Me=-m.WindCnt;break;default:Me=Math.abs(m.WindCnt);break}if(S&&C)Pe!==0&&Pe!==1||Me!==0&&Me!==1||h.PolyTyp!==m.PolyTyp&&this.m_ClipType!==e.ClipType.ctXor?this.AddLocalMaxPoly(h,m,v):(this.AddOutPt(h,v),this.AddOutPt(m,v),e.Clipper.SwapSides(h,m),e.Clipper.SwapPolyIndexes(h,m));else if(S)(Me===0||Me===1)&&(this.AddOutPt(h,v),e.Clipper.SwapSides(h,m),e.Clipper.SwapPolyIndexes(h,m));else if(C)(Pe===0||Pe===1)&&(this.AddOutPt(m,v),e.Clipper.SwapSides(h,m),e.Clipper.SwapPolyIndexes(h,m));else if((Pe===0||Pe===1)&&(Me===0||Me===1)){var Xe,St;switch($){case e.PolyFillType.pftPositive:Xe=h.WindCnt2;break;case e.PolyFillType.pftNegative:Xe=-h.WindCnt2;break;default:Xe=Math.abs(h.WindCnt2);break}switch(ue){case e.PolyFillType.pftPositive:St=m.WindCnt2;break;case e.PolyFillType.pftNegative:St=-m.WindCnt2;break;default:St=Math.abs(m.WindCnt2);break}if(h.PolyTyp!==m.PolyTyp)this.AddLocalMinPoly(h,m,v);else if(Pe===1&&Me===1)switch(this.m_ClipType){case e.ClipType.ctIntersection:Xe>0&&St>0&&this.AddLocalMinPoly(h,m,v);break;case e.ClipType.ctUnion:Xe<=0&&St<=0&&this.AddLocalMinPoly(h,m,v);break;case e.ClipType.ctDifference:(h.PolyTyp===e.PolyType.ptClip&&Xe>0&&St>0||h.PolyTyp===e.PolyType.ptSubject&&Xe<=0&&St<=0)&&this.AddLocalMinPoly(h,m,v);break;case e.ClipType.ctXor:this.AddLocalMinPoly(h,m,v);break}else e.Clipper.SwapSides(h,m)}},e.Clipper.prototype.DeleteFromSEL=function(h){var m=h.PrevInSEL,v=h.NextInSEL;m===null&&v===null&&h!==this.m_SortedEdges||(m!==null?m.NextInSEL=v:this.m_SortedEdges=v,v!==null&&(v.PrevInSEL=m),h.NextInSEL=null,h.PrevInSEL=null)},e.Clipper.prototype.ProcessHorizontals=function(){for(var h={};this.PopEdgeFromSEL(h);)this.ProcessHorizontal(h.v)},e.Clipper.prototype.GetHorzDirection=function(h,m){h.Bot.X<h.Top.X?(m.Left=h.Bot.X,m.Right=h.Top.X,m.Dir=e.Direction.dLeftToRight):(m.Left=h.Top.X,m.Right=h.Bot.X,m.Dir=e.Direction.dRightToLeft)},e.Clipper.prototype.ProcessHorizontal=function(h){var m={Dir:null,Left:null,Right:null};this.GetHorzDirection(h,m);for(var v=m.Dir,S=m.Left,C=m.Right,F=h.WindDelta===0,H=h,K=null;H.NextInLML!==null&&e.ClipperBase.IsHorizontal(H.NextInLML);)H=H.NextInLML;H.NextInLML===null&&(K=this.GetMaximaPair(H));var $=this.m_Maxima;if($!==null)if(v===e.Direction.dLeftToRight){for(;$!==null&&$.X<=h.Bot.X;)$=$.Next;$!==null&&$.X>=H.Top.X&&($=null)}else{for(;$.Next!==null&&$.Next.X<h.Bot.X;)$=$.Next;$.X<=H.Top.X&&($=null)}for(var ue=null;;){for(var Pe=h===H,Me=this.GetNextInAEL(h,v);Me!==null;){if($!==null)if(v===e.Direction.dLeftToRight)for(;$!==null&&$.X<Me.Curr.X;)h.OutIdx>=0&&!F&&this.AddOutPt(h,new e.IntPoint2($.X,h.Bot.Y)),$=$.Next;else for(;$!==null&&$.X>Me.Curr.X;)h.OutIdx>=0&&!F&&this.AddOutPt(h,new e.IntPoint2($.X,h.Bot.Y)),$=$.Prev;if(v===e.Direction.dLeftToRight&&Me.Curr.X>C||v===e.Direction.dRightToLeft&&Me.Curr.X<S||Me.Curr.X===h.Top.X&&h.NextInLML!==null&&Me.Dx<h.NextInLML.Dx)break;if(h.OutIdx>=0&&!F){e.use_xyz&&(v===e.Direction.dLeftToRight?this.SetZ(Me.Curr,h,Me):this.SetZ(Me.Curr,Me,h)),ue=this.AddOutPt(h,Me.Curr);for(var Xe=this.m_SortedEdges;Xe!==null;){if(Xe.OutIdx>=0&&this.HorzSegmentsOverlap(h.Bot.X,h.Top.X,Xe.Bot.X,Xe.Top.X)){var St=this.GetLastOutPt(Xe);this.AddJoin(St,ue,Xe.Top)}Xe=Xe.NextInSEL}this.AddGhostJoin(ue,h.Bot)}if(Me===K&&Pe){h.OutIdx>=0&&this.AddLocalMaxPoly(h,K,h.Top),this.DeleteFromAEL(h),this.DeleteFromAEL(K);return}if(v===e.Direction.dLeftToRight){var Vt=new e.IntPoint2(Me.Curr.X,h.Curr.Y);this.IntersectEdges(h,Me,Vt)}else{var Vt=new e.IntPoint2(Me.Curr.X,h.Curr.Y);this.IntersectEdges(Me,h,Vt)}var Wt=this.GetNextInAEL(Me,v);this.SwapPositionsInAEL(h,Me),Me=Wt}if(h.NextInLML===null||!e.ClipperBase.IsHorizontal(h.NextInLML))break;h=this.UpdateEdgeIntoAEL(h),h.OutIdx>=0&&this.AddOutPt(h,h.Bot),m={Dir:v,Left:S,Right:C},this.GetHorzDirection(h,m),v=m.Dir,S=m.Left,C=m.Right}if(h.OutIdx>=0&&ue===null){ue=this.GetLastOutPt(h);for(var Xe=this.m_SortedEdges;Xe!==null;){if(Xe.OutIdx>=0&&this.HorzSegmentsOverlap(h.Bot.X,h.Top.X,Xe.Bot.X,Xe.Top.X)){var St=this.GetLastOutPt(Xe);this.AddJoin(St,ue,Xe.Top)}Xe=Xe.NextInSEL}this.AddGhostJoin(ue,h.Top)}if(h.NextInLML!==null)if(h.OutIdx>=0){if(ue=this.AddOutPt(h,h.Top),h=this.UpdateEdgeIntoAEL(h),h.WindDelta===0)return;var vi=h.PrevInAEL,Wt=h.NextInAEL;if(vi!==null&&vi.Curr.X===h.Bot.X&&vi.Curr.Y===h.Bot.Y&&vi.WindDelta===0&&vi.OutIdx>=0&&vi.Curr.Y>vi.Top.Y&&e.ClipperBase.SlopesEqual3(h,vi,this.m_UseFullRange)){var St=this.AddOutPt(vi,h.Bot);this.AddJoin(ue,St,h.Top)}else if(Wt!==null&&Wt.Curr.X===h.Bot.X&&Wt.Curr.Y===h.Bot.Y&&Wt.WindDelta!==0&&Wt.OutIdx>=0&&Wt.Curr.Y>Wt.Top.Y&&e.ClipperBase.SlopesEqual3(h,Wt,this.m_UseFullRange)){var St=this.AddOutPt(Wt,h.Bot);this.AddJoin(ue,St,h.Top)}}else h=this.UpdateEdgeIntoAEL(h);else h.OutIdx>=0&&this.AddOutPt(h,h.Top),this.DeleteFromAEL(h)},e.Clipper.prototype.GetNextInAEL=function(h,m){return m===e.Direction.dLeftToRight?h.NextInAEL:h.PrevInAEL},e.Clipper.prototype.IsMinima=function(h){return h!==null&&h.Prev.NextInLML!==h&&h.Next.NextInLML!==h},e.Clipper.prototype.IsMaxima=function(h,m){return h!==null&&h.Top.Y===m&&h.NextInLML===null},e.Clipper.prototype.IsIntermediate=function(h,m){return h.Top.Y===m&&h.NextInLML!==null},e.Clipper.prototype.GetMaximaPair=function(h){return e.IntPoint.op_Equality(h.Next.Top,h.Top)&&h.Next.NextInLML===null?h.Next:e.IntPoint.op_Equality(h.Prev.Top,h.Top)&&h.Prev.NextInLML===null?h.Prev:null},e.Clipper.prototype.GetMaximaPairEx=function(h){var m=this.GetMaximaPair(h);return m===null||m.OutIdx===e.ClipperBase.Skip||m.NextInAEL===m.PrevInAEL&&!e.ClipperBase.IsHorizontal(m)?null:m},e.Clipper.prototype.ProcessIntersections=function(h){if(this.m_ActiveEdges===null)return!0;try{if(this.BuildIntersectList(h),this.m_IntersectList.length===0)return!0;if(this.m_IntersectList.length===1||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch{this.m_SortedEdges=null,this.m_IntersectList.length=0,e.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},e.Clipper.prototype.BuildIntersectList=function(h){if(this.m_ActiveEdges!==null){var m=this.m_ActiveEdges;for(this.m_SortedEdges=m;m!==null;)m.PrevInSEL=m.PrevInAEL,m.NextInSEL=m.NextInAEL,m.Curr.X=e.Clipper.TopX(m,h),m=m.NextInAEL;for(var v=!0;v&&this.m_SortedEdges!==null;){for(v=!1,m=this.m_SortedEdges;m.NextInSEL!==null;){var S=m.NextInSEL,C=new e.IntPoint0;if(m.Curr.X>S.Curr.X){this.IntersectPoint(m,S,C),C.Y<h&&(C=new e.IntPoint2(e.Clipper.TopX(m,h),h));var F=new e.IntersectNode;F.Edge1=m,F.Edge2=S,F.Pt.X=C.X,F.Pt.Y=C.Y,e.use_xyz&&(F.Pt.Z=C.Z),this.m_IntersectList.push(F),this.SwapPositionsInSEL(m,S),v=!0}else m=S}if(m.PrevInSEL!==null)m.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}},e.Clipper.prototype.EdgesAdjacent=function(h){return h.Edge1.NextInSEL===h.Edge2||h.Edge1.PrevInSEL===h.Edge2},e.Clipper.IntersectNodeSort=function(h,m){return m.Pt.Y-h.Pt.Y},e.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var h=this.m_IntersectList.length,m=0;m<h;m++){if(!this.EdgesAdjacent(this.m_IntersectList[m])){for(var v=m+1;v<h&&!this.EdgesAdjacent(this.m_IntersectList[v]);)v++;if(v===h)return!1;var S=this.m_IntersectList[m];this.m_IntersectList[m]=this.m_IntersectList[v],this.m_IntersectList[v]=S}this.SwapPositionsInSEL(this.m_IntersectList[m].Edge1,this.m_IntersectList[m].Edge2)}return!0},e.Clipper.prototype.ProcessIntersectList=function(){for(var h=0,m=this.m_IntersectList.length;h<m;h++){var v=this.m_IntersectList[h];this.IntersectEdges(v.Edge1,v.Edge2,v.Pt),this.SwapPositionsInAEL(v.Edge1,v.Edge2)}this.m_IntersectList.length=0};var ae=function(h){return h<0?Math.ceil(h-.5):Math.round(h)},ie=function(h){return h<0?Math.ceil(h-.5):Math.floor(h+.5)},Se=function(h){return h<0?-Math.round(Math.abs(h)):Math.round(h)},we=function(h){return h<0?(h-=.5,h<-2147483648?Math.ceil(h):h|0):(h+=.5,h>2147483647?Math.floor(h):h|0)};s.msie?e.Clipper.Round=ae:s.chromium?e.Clipper.Round=Se:s.safari?e.Clipper.Round=we:e.Clipper.Round=ie,e.Clipper.TopX=function(h,m){return m===h.Top.Y?h.Top.X:h.Bot.X+e.Clipper.Round(h.Dx*(m-h.Bot.Y))},e.Clipper.prototype.IntersectPoint=function(h,m,v){v.X=0,v.Y=0;var S,C;if(h.Dx===m.Dx){v.Y=h.Curr.Y,v.X=e.Clipper.TopX(h,v.Y);return}if(h.Delta.X===0)v.X=h.Bot.X,e.ClipperBase.IsHorizontal(m)?v.Y=m.Bot.Y:(C=m.Bot.Y-m.Bot.X/m.Dx,v.Y=e.Clipper.Round(v.X/m.Dx+C));else if(m.Delta.X===0)v.X=m.Bot.X,e.ClipperBase.IsHorizontal(h)?v.Y=h.Bot.Y:(S=h.Bot.Y-h.Bot.X/h.Dx,v.Y=e.Clipper.Round(v.X/h.Dx+S));else{S=h.Bot.X-h.Bot.Y*h.Dx,C=m.Bot.X-m.Bot.Y*m.Dx;var F=(C-S)/(h.Dx-m.Dx);v.Y=e.Clipper.Round(F),Math.abs(h.Dx)<Math.abs(m.Dx)?v.X=e.Clipper.Round(h.Dx*F+S):v.X=e.Clipper.Round(m.Dx*F+C)}if(v.Y<h.Top.Y||v.Y<m.Top.Y){if(h.Top.Y>m.Top.Y)return v.Y=h.Top.Y,v.X=e.Clipper.TopX(m,h.Top.Y),v.X<h.Top.X;v.Y=m.Top.Y,Math.abs(h.Dx)<Math.abs(m.Dx)?v.X=e.Clipper.TopX(h,v.Y):v.X=e.Clipper.TopX(m,v.Y)}v.Y>h.Curr.Y&&(v.Y=h.Curr.Y,Math.abs(h.Dx)>Math.abs(m.Dx)?v.X=e.Clipper.TopX(m,v.Y):v.X=e.Clipper.TopX(h,v.Y))},e.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(h){for(var m=this.m_ActiveEdges;m!==null;){var v=this.IsMaxima(m,h);if(v){var S=this.GetMaximaPairEx(m);v=S===null||!e.ClipperBase.IsHorizontal(S)}if(v){this.StrictlySimple&&this.InsertMaxima(m.Top.X);var C=m.PrevInAEL;this.DoMaxima(m),C===null?m=this.m_ActiveEdges:m=C.NextInAEL}else{if(this.IsIntermediate(m,h)&&e.ClipperBase.IsHorizontal(m.NextInLML)?(m=this.UpdateEdgeIntoAEL(m),m.OutIdx>=0&&this.AddOutPt(m,m.Bot),this.AddEdgeToSEL(m)):(m.Curr.X=e.Clipper.TopX(m,h),m.Curr.Y=h),e.use_xyz&&(m.Top.Y===h?m.Curr.Z=m.Top.Z:m.Bot.Y===h?m.Curr.Z=m.Bot.Z:m.Curr.Z=0),this.StrictlySimple){var C=m.PrevInAEL;if(m.OutIdx>=0&&m.WindDelta!==0&&C!==null&&C.OutIdx>=0&&C.Curr.X===m.Curr.X&&C.WindDelta!==0){var F=new e.IntPoint1(m.Curr);e.use_xyz&&this.SetZ(F,C,m);var H=this.AddOutPt(C,F),K=this.AddOutPt(m,F);this.AddJoin(H,K,F)}}m=m.NextInAEL}}for(this.ProcessHorizontals(),this.m_Maxima=null,m=this.m_ActiveEdges;m!==null;){if(this.IsIntermediate(m,h)){var H=null;m.OutIdx>=0&&(H=this.AddOutPt(m,m.Top)),m=this.UpdateEdgeIntoAEL(m);var C=m.PrevInAEL,$=m.NextInAEL;if(C!==null&&C.Curr.X===m.Bot.X&&C.Curr.Y===m.Bot.Y&&H!==null&&C.OutIdx>=0&&C.Curr.Y===C.Top.Y&&e.ClipperBase.SlopesEqual5(m.Curr,m.Top,C.Curr,C.Top,this.m_UseFullRange)&&m.WindDelta!==0&&C.WindDelta!==0){var K=this.AddOutPt(ePrev2,m.Bot);this.AddJoin(H,K,m.Top)}else if($!==null&&$.Curr.X===m.Bot.X&&$.Curr.Y===m.Bot.Y&&H!==null&&$.OutIdx>=0&&$.Curr.Y===$.Top.Y&&e.ClipperBase.SlopesEqual5(m.Curr,m.Top,$.Curr,$.Top,this.m_UseFullRange)&&m.WindDelta!==0&&$.WindDelta!==0){var K=this.AddOutPt($,m.Bot);this.AddJoin(H,K,m.Top)}}m=m.NextInAEL}},e.Clipper.prototype.DoMaxima=function(h){var m=this.GetMaximaPairEx(h);if(m===null){h.OutIdx>=0&&this.AddOutPt(h,h.Top),this.DeleteFromAEL(h);return}for(var v=h.NextInAEL;v!==null&&v!==m;)this.IntersectEdges(h,v,h.Top),this.SwapPositionsInAEL(h,v),v=h.NextInAEL;h.OutIdx===-1&&m.OutIdx===-1?(this.DeleteFromAEL(h),this.DeleteFromAEL(m)):h.OutIdx>=0&&m.OutIdx>=0?(h.OutIdx>=0&&this.AddLocalMaxPoly(h,m,h.Top),this.DeleteFromAEL(h),this.DeleteFromAEL(m)):e.use_lines&&h.WindDelta===0?(h.OutIdx>=0&&(this.AddOutPt(h,h.Top),h.OutIdx=e.ClipperBase.Unassigned),this.DeleteFromAEL(h),m.OutIdx>=0&&(this.AddOutPt(m,h.Top),m.OutIdx=e.ClipperBase.Unassigned),this.DeleteFromAEL(m)):e.Error("DoMaxima error")},e.Clipper.ReversePaths=function(h){for(var m=0,v=h.length;m<v;m++)h[m].reverse()},e.Clipper.Orientation=function(h){return e.Clipper.Area(h)>=0},e.Clipper.prototype.PointCount=function(h){if(h===null)return 0;var m=0,v=h;do m++,v=v.Next;while(v!==h);return m},e.Clipper.prototype.BuildResult=function(h){e.Clear(h);for(var m=0,v=this.m_PolyOuts.length;m<v;m++){var S=this.m_PolyOuts[m];if(S.Pts!==null){var C=S.Pts.Prev,F=this.PointCount(C);if(!(F<2)){for(var H=new Array(F),K=0;K<F;K++)H[K]=C.Pt,C=C.Prev;h.push(H)}}}},e.Clipper.prototype.BuildResult2=function(h){h.Clear();for(var m=0,v=this.m_PolyOuts.length;m<v;m++){var S=this.m_PolyOuts[m],C=this.PointCount(S.Pts);if(!(S.IsOpen&&C<2||!S.IsOpen&&C<3)){this.FixHoleLinkage(S);var F=new e.PolyNode;h.m_AllPolys.push(F),S.PolyNode=F,F.m_polygon.length=C;for(var H=S.Pts.Prev,K=0;K<C;K++)F.m_polygon[K]=H.Pt,H=H.Prev}}for(var m=0,v=this.m_PolyOuts.length;m<v;m++){var S=this.m_PolyOuts[m];S.PolyNode!==null&&(S.IsOpen?(S.PolyNode.IsOpen=!0,h.AddChild(S.PolyNode)):S.FirstLeft!==null&&S.FirstLeft.PolyNode!==null?S.FirstLeft.PolyNode.AddChild(S.PolyNode):h.AddChild(S.PolyNode))}},e.Clipper.prototype.FixupOutPolyline=function(h){for(var m=h.Pts,v=m.Prev;m!==v;)if(m=m.Next,e.IntPoint.op_Equality(m.Pt,m.Prev.Pt)){m===v&&(v=m.Prev);var S=m.Prev;S.Next=m.Next,m.Next.Prev=S,m=S}m===m.Prev&&(h.Pts=null)},e.Clipper.prototype.FixupOutPolygon=function(h){var m=null;h.BottomPt=null;for(var v=h.Pts,S=this.PreserveCollinear||this.StrictlySimple;;){if(v.Prev===v||v.Prev===v.Next){h.Pts=null;return}if(e.IntPoint.op_Equality(v.Pt,v.Next.Pt)||e.IntPoint.op_Equality(v.Pt,v.Prev.Pt)||e.ClipperBase.SlopesEqual4(v.Prev.Pt,v.Pt,v.Next.Pt,this.m_UseFullRange)&&(!S||!this.Pt2IsBetweenPt1AndPt3(v.Prev.Pt,v.Pt,v.Next.Pt)))m=null,v.Prev.Next=v.Next,v.Next.Prev=v.Prev,v=v.Prev;else{if(v===m)break;m===null&&(m=v),v=v.Next}}h.Pts=v},e.Clipper.prototype.DupOutPt=function(h,m){var v=new e.OutPt;return v.Pt.X=h.Pt.X,v.Pt.Y=h.Pt.Y,e.use_xyz&&(v.Pt.Z=h.Pt.Z),v.Idx=h.Idx,m?(v.Next=h.Next,v.Prev=h,h.Next.Prev=v,h.Next=v):(v.Prev=h.Prev,v.Next=h,h.Prev.Next=v,h.Prev=v),v},e.Clipper.prototype.GetOverlap=function(h,m,v,S,C){return h<m?v<S?(C.Left=Math.max(h,v),C.Right=Math.min(m,S)):(C.Left=Math.max(h,S),C.Right=Math.min(m,v)):v<S?(C.Left=Math.max(m,v),C.Right=Math.min(h,S)):(C.Left=Math.max(m,S),C.Right=Math.min(h,v)),C.Left<C.Right},e.Clipper.prototype.JoinHorz=function(h,m,v,S,C,F){var H=h.Pt.X>m.Pt.X?e.Direction.dRightToLeft:e.Direction.dLeftToRight,K=v.Pt.X>S.Pt.X?e.Direction.dRightToLeft:e.Direction.dLeftToRight;if(H===K)return!1;if(H===e.Direction.dLeftToRight){for(;h.Next.Pt.X<=C.X&&h.Next.Pt.X>=h.Pt.X&&h.Next.Pt.Y===C.Y;)h=h.Next;F&&h.Pt.X!==C.X&&(h=h.Next),m=this.DupOutPt(h,!F),e.IntPoint.op_Inequality(m.Pt,C)&&(h=m,h.Pt.X=C.X,h.Pt.Y=C.Y,e.use_xyz&&(h.Pt.Z=C.Z),m=this.DupOutPt(h,!F))}else{for(;h.Next.Pt.X>=C.X&&h.Next.Pt.X<=h.Pt.X&&h.Next.Pt.Y===C.Y;)h=h.Next;!F&&h.Pt.X!==C.X&&(h=h.Next),m=this.DupOutPt(h,F),e.IntPoint.op_Inequality(m.Pt,C)&&(h=m,h.Pt.X=C.X,h.Pt.Y=C.Y,e.use_xyz&&(h.Pt.Z=C.Z),m=this.DupOutPt(h,F))}if(K===e.Direction.dLeftToRight){for(;v.Next.Pt.X<=C.X&&v.Next.Pt.X>=v.Pt.X&&v.Next.Pt.Y===C.Y;)v=v.Next;F&&v.Pt.X!==C.X&&(v=v.Next),S=this.DupOutPt(v,!F),e.IntPoint.op_Inequality(S.Pt,C)&&(v=S,v.Pt.X=C.X,v.Pt.Y=C.Y,e.use_xyz&&(v.Pt.Z=C.Z),S=this.DupOutPt(v,!F))}else{for(;v.Next.Pt.X>=C.X&&v.Next.Pt.X<=v.Pt.X&&v.Next.Pt.Y===C.Y;)v=v.Next;!F&&v.Pt.X!==C.X&&(v=v.Next),S=this.DupOutPt(v,F),e.IntPoint.op_Inequality(S.Pt,C)&&(v=S,v.Pt.X=C.X,v.Pt.Y=C.Y,e.use_xyz&&(v.Pt.Z=C.Z),S=this.DupOutPt(v,F))}return H===e.Direction.dLeftToRight===F?(h.Prev=v,v.Next=h,m.Next=S,S.Prev=m):(h.Next=v,v.Prev=h,m.Prev=S,S.Next=m),!0},e.Clipper.prototype.JoinPoints=function(h,m,v){var S=h.OutPt1,C=new e.OutPt,F=h.OutPt2,H=new e.OutPt,K=h.OutPt1.Pt.Y===h.OffPt.Y;if(K&&e.IntPoint.op_Equality(h.OffPt,h.OutPt1.Pt)&&e.IntPoint.op_Equality(h.OffPt,h.OutPt2.Pt)){if(m!==v)return!1;for(C=h.OutPt1.Next;C!==S&&e.IntPoint.op_Equality(C.Pt,h.OffPt);)C=C.Next;var $=C.Pt.Y>h.OffPt.Y;for(H=h.OutPt2.Next;H!==F&&e.IntPoint.op_Equality(H.Pt,h.OffPt);)H=H.Next;var ue=H.Pt.Y>h.OffPt.Y;return $===ue?!1:$?(C=this.DupOutPt(S,!1),H=this.DupOutPt(F,!0),S.Prev=F,F.Next=S,C.Next=H,H.Prev=C,h.OutPt1=S,h.OutPt2=C,!0):(C=this.DupOutPt(S,!0),H=this.DupOutPt(F,!1),S.Next=F,F.Prev=S,C.Prev=H,H.Next=C,h.OutPt1=S,h.OutPt2=C,!0)}else if(K){for(C=S;S.Prev.Pt.Y===S.Pt.Y&&S.Prev!==C&&S.Prev!==F;)S=S.Prev;for(;C.Next.Pt.Y===C.Pt.Y&&C.Next!==S&&C.Next!==F;)C=C.Next;if(C.Next===S||C.Next===F)return!1;for(H=F;F.Prev.Pt.Y===F.Pt.Y&&F.Prev!==H&&F.Prev!==C;)F=F.Prev;for(;H.Next.Pt.Y===H.Pt.Y&&H.Next!==F&&H.Next!==S;)H=H.Next;if(H.Next===F||H.Next===S)return!1;var Pe={Left:null,Right:null};if(!this.GetOverlap(S.Pt.X,C.Pt.X,F.Pt.X,H.Pt.X,Pe))return!1;var Me=Pe.Left,Xe=Pe.Right,St=new e.IntPoint0,Vt;return S.Pt.X>=Me&&S.Pt.X<=Xe?(St.X=S.Pt.X,St.Y=S.Pt.Y,e.use_xyz&&(St.Z=S.Pt.Z),Vt=S.Pt.X>C.Pt.X):F.Pt.X>=Me&&F.Pt.X<=Xe?(St.X=F.Pt.X,St.Y=F.Pt.Y,e.use_xyz&&(St.Z=F.Pt.Z),Vt=F.Pt.X>H.Pt.X):C.Pt.X>=Me&&C.Pt.X<=Xe?(St.X=C.Pt.X,St.Y=C.Pt.Y,e.use_xyz&&(St.Z=C.Pt.Z),Vt=C.Pt.X>S.Pt.X):(St.X=H.Pt.X,St.Y=H.Pt.Y,e.use_xyz&&(St.Z=H.Pt.Z),Vt=H.Pt.X>F.Pt.X),h.OutPt1=S,h.OutPt2=F,this.JoinHorz(S,C,F,H,St,Vt)}else{for(C=S.Next;e.IntPoint.op_Equality(C.Pt,S.Pt)&&C!==S;)C=C.Next;var Wt=C.Pt.Y>S.Pt.Y||!e.ClipperBase.SlopesEqual4(S.Pt,C.Pt,h.OffPt,this.m_UseFullRange);if(Wt){for(C=S.Prev;e.IntPoint.op_Equality(C.Pt,S.Pt)&&C!==S;)C=C.Prev;if(C.Pt.Y>S.Pt.Y||!e.ClipperBase.SlopesEqual4(S.Pt,C.Pt,h.OffPt,this.m_UseFullRange))return!1}for(H=F.Next;e.IntPoint.op_Equality(H.Pt,F.Pt)&&H!==F;)H=H.Next;var vi=H.Pt.Y>F.Pt.Y||!e.ClipperBase.SlopesEqual4(F.Pt,H.Pt,h.OffPt,this.m_UseFullRange);if(vi){for(H=F.Prev;e.IntPoint.op_Equality(H.Pt,F.Pt)&&H!==F;)H=H.Prev;if(H.Pt.Y>F.Pt.Y||!e.ClipperBase.SlopesEqual4(F.Pt,H.Pt,h.OffPt,this.m_UseFullRange))return!1}return C===S||H===F||C===H||m===v&&Wt===vi?!1:Wt?(C=this.DupOutPt(S,!1),H=this.DupOutPt(F,!0),S.Prev=F,F.Next=S,C.Next=H,H.Prev=C,h.OutPt1=S,h.OutPt2=C,!0):(C=this.DupOutPt(S,!0),H=this.DupOutPt(F,!1),S.Next=F,F.Prev=S,C.Prev=H,H.Next=C,h.OutPt1=S,h.OutPt2=C,!0)}},e.Clipper.GetBounds=function(h){for(var m=0,v=h.length;m<v&&h[m].length===0;)m++;if(m===v)return new e.IntRect(0,0,0,0);var S=new e.IntRect;for(S.left=h[m][0].X,S.right=S.left,S.top=h[m][0].Y,S.bottom=S.top;m<v;m++)for(var C=0,F=h[m].length;C<F;C++)h[m][C].X<S.left?S.left=h[m][C].X:h[m][C].X>S.right&&(S.right=h[m][C].X),h[m][C].Y<S.top?S.top=h[m][C].Y:h[m][C].Y>S.bottom&&(S.bottom=h[m][C].Y);return S},e.Clipper.prototype.GetBounds2=function(h){var m=h,v=new e.IntRect;for(v.left=h.Pt.X,v.right=h.Pt.X,v.top=h.Pt.Y,v.bottom=h.Pt.Y,h=h.Next;h!==m;)h.Pt.X<v.left&&(v.left=h.Pt.X),h.Pt.X>v.right&&(v.right=h.Pt.X),h.Pt.Y<v.top&&(v.top=h.Pt.Y),h.Pt.Y>v.bottom&&(v.bottom=h.Pt.Y),h=h.Next;return v},e.Clipper.PointInPolygon=function(h,m){var v=0,S=m.length;if(S<3)return 0;for(var C=m[0],F=1;F<=S;++F){var H=F===S?m[0]:m[F];if(H.Y===h.Y&&(H.X===h.X||C.Y===h.Y&&H.X>h.X==C.X<h.X))return-1;if(C.Y<h.Y!=H.Y<h.Y){if(C.X>=h.X)if(H.X>h.X)v=1-v;else{var K=(C.X-h.X)*(H.Y-h.Y)-(H.X-h.X)*(C.Y-h.Y);if(K===0)return-1;K>0==H.Y>C.Y&&(v=1-v)}else if(H.X>h.X){var K=(C.X-h.X)*(H.Y-h.Y)-(H.X-h.X)*(C.Y-h.Y);if(K===0)return-1;K>0==H.Y>C.Y&&(v=1-v)}}C=H}return v},e.Clipper.prototype.PointInPolygon=function(h,m){var v=0,S=m,C=h.X,F=h.Y,H=m.Pt.X,K=m.Pt.Y;do{m=m.Next;var $=m.Pt.X,ue=m.Pt.Y;if(ue===F&&($===C||K===F&&$>C==H<C))return-1;if(K<F!=ue<F){if(H>=C)if($>C)v=1-v;else{var Pe=(H-C)*(ue-F)-($-C)*(K-F);if(Pe===0)return-1;Pe>0==ue>K&&(v=1-v)}else if($>C){var Pe=(H-C)*(ue-F)-($-C)*(K-F);if(Pe===0)return-1;Pe>0==ue>K&&(v=1-v)}}H=$,K=ue}while(S!==m);return v},e.Clipper.prototype.Poly2ContainsPoly1=function(h,m){var v=h;do{var S=this.PointInPolygon(v.Pt,m);if(S>=0)return S>0;v=v.Next}while(v!==h);return!0},e.Clipper.prototype.FixupFirstLefts1=function(h,m){for(var v,S,C=0,F=this.m_PolyOuts.length;C<F;C++)v=this.m_PolyOuts[C],S=e.Clipper.ParseFirstLeft(v.FirstLeft),v.Pts!==null&&S===h&&this.Poly2ContainsPoly1(v.Pts,m.Pts)&&(v.FirstLeft=m)},e.Clipper.prototype.FixupFirstLefts2=function(h,m){for(var v=m.FirstLeft,S,C,F=0,H=this.m_PolyOuts.length;F<H;F++)S=this.m_PolyOuts[F],!(S.Pts===null||S===m||S===h)&&(C=e.Clipper.ParseFirstLeft(S.FirstLeft),!(C!==v&&C!==h&&C!==m)&&(this.Poly2ContainsPoly1(S.Pts,h.Pts)?S.FirstLeft=h:this.Poly2ContainsPoly1(S.Pts,m.Pts)?S.FirstLeft=m:(S.FirstLeft===h||S.FirstLeft===m)&&(S.FirstLeft=v)))},e.Clipper.prototype.FixupFirstLefts3=function(h,m){for(var v,S,C=0,F=this.m_PolyOuts.length;C<F;C++)v=this.m_PolyOuts[C],S=e.Clipper.ParseFirstLeft(v.FirstLeft),v.Pts!==null&&S===h&&(v.FirstLeft=m)},e.Clipper.ParseFirstLeft=function(h){for(;h!==null&&h.Pts===null;)h=h.FirstLeft;return h},e.Clipper.prototype.JoinCommonEdges=function(){for(var h=0,m=this.m_Joins.length;h<m;h++){var v=this.m_Joins[h],S=this.GetOutRec(v.OutPt1.Idx),C=this.GetOutRec(v.OutPt2.Idx);if(!(S.Pts===null||C.Pts===null)&&!(S.IsOpen||C.IsOpen)){var F;S===C?F=S:this.OutRec1RightOfOutRec2(S,C)?F=C:this.OutRec1RightOfOutRec2(C,S)?F=S:F=this.GetLowermostRec(S,C),this.JoinPoints(v,S,C)&&(S===C?(S.Pts=v.OutPt1,S.BottomPt=null,C=this.CreateOutRec(),C.Pts=v.OutPt2,this.UpdateOutPtIdxs(C),this.Poly2ContainsPoly1(C.Pts,S.Pts)?(C.IsHole=!S.IsHole,C.FirstLeft=S,this.m_UsingPolyTree&&this.FixupFirstLefts2(C,S),(C.IsHole^this.ReverseSolution)==this.Area$1(C)>0&&this.ReversePolyPtLinks(C.Pts)):this.Poly2ContainsPoly1(S.Pts,C.Pts)?(C.IsHole=S.IsHole,S.IsHole=!C.IsHole,C.FirstLeft=S.FirstLeft,S.FirstLeft=C,this.m_UsingPolyTree&&this.FixupFirstLefts2(S,C),(S.IsHole^this.ReverseSolution)==this.Area$1(S)>0&&this.ReversePolyPtLinks(S.Pts)):(C.IsHole=S.IsHole,C.FirstLeft=S.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(S,C))):(C.Pts=null,C.BottomPt=null,C.Idx=S.Idx,S.IsHole=F.IsHole,F===C&&(S.FirstLeft=C.FirstLeft),C.FirstLeft=S,this.m_UsingPolyTree&&this.FixupFirstLefts3(C,S)))}}},e.Clipper.prototype.UpdateOutPtIdxs=function(h){var m=h.Pts;do m.Idx=h.Idx,m=m.Prev;while(m!==h.Pts)},e.Clipper.prototype.DoSimplePolygons=function(){for(var h=0;h<this.m_PolyOuts.length;){var m=this.m_PolyOuts[h++],v=m.Pts;if(!(v===null||m.IsOpen))do{for(var S=v.Next;S!==m.Pts;){if(e.IntPoint.op_Equality(v.Pt,S.Pt)&&S.Next!==v&&S.Prev!==v){var C=v.Prev,F=S.Prev;v.Prev=F,F.Next=v,S.Prev=C,C.Next=S,m.Pts=v;var H=this.CreateOutRec();H.Pts=S,this.UpdateOutPtIdxs(H),this.Poly2ContainsPoly1(H.Pts,m.Pts)?(H.IsHole=!m.IsHole,H.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(H,m)):this.Poly2ContainsPoly1(m.Pts,H.Pts)?(H.IsHole=m.IsHole,m.IsHole=!H.IsHole,H.FirstLeft=m.FirstLeft,m.FirstLeft=H,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,H)):(H.IsHole=m.IsHole,H.FirstLeft=m.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(m,H)),S=v}S=S.Next}v=v.Next}while(v!==m.Pts)}},e.Clipper.Area=function(h){if(!Array.isArray(h))return 0;var m=h.length;if(m<3)return 0;for(var v=0,S=0,C=m-1;S<m;++S)v+=(h[C].X+h[S].X)*(h[C].Y-h[S].Y),C=S;return-v*.5},e.Clipper.prototype.Area=function(h){var m=h;if(h===null)return 0;var v=0;do v=v+(h.Prev.Pt.X+h.Pt.X)*(h.Prev.Pt.Y-h.Pt.Y),h=h.Next;while(h!==m);return v*.5},e.Clipper.prototype.Area$1=function(h){return this.Area(h.Pts)},e.Clipper.SimplifyPolygon=function(h,m){var v=new Array,S=new e.Clipper(0);return S.StrictlySimple=!0,S.AddPath(h,e.PolyType.ptSubject,!0),S.Execute(e.ClipType.ctUnion,v,m,m),v},e.Clipper.SimplifyPolygons=function(h,m){typeof m>"u"&&(m=e.PolyFillType.pftEvenOdd);var v=new Array,S=new e.Clipper(0);return S.StrictlySimple=!0,S.AddPaths(h,e.PolyType.ptSubject,!0),S.Execute(e.ClipType.ctUnion,v,m,m),v},e.Clipper.DistanceSqrd=function(h,m){var v=h.X-m.X,S=h.Y-m.Y;return v*v+S*S},e.Clipper.DistanceFromLineSqrd=function(h,m,v){var S=m.Y-v.Y,C=v.X-m.X,F=S*m.X+C*m.Y;return F=S*h.X+C*h.Y-F,F*F/(S*S+C*C)},e.Clipper.SlopesNearCollinear=function(h,m,v,S){return Math.abs(h.X-m.X)>Math.abs(h.Y-m.Y)?h.X>m.X==h.X<v.X?e.Clipper.DistanceFromLineSqrd(h,m,v)<S:m.X>h.X==m.X<v.X?e.Clipper.DistanceFromLineSqrd(m,h,v)<S:e.Clipper.DistanceFromLineSqrd(v,h,m)<S:h.Y>m.Y==h.Y<v.Y?e.Clipper.DistanceFromLineSqrd(h,m,v)<S:m.Y>h.Y==m.Y<v.Y?e.Clipper.DistanceFromLineSqrd(m,h,v)<S:e.Clipper.DistanceFromLineSqrd(v,h,m)<S},e.Clipper.PointsAreClose=function(h,m,v){var S=h.X-m.X,C=h.Y-m.Y;return S*S+C*C<=v},e.Clipper.ExcludeOp=function(h){var m=h.Prev;return m.Next=h.Next,h.Next.Prev=m,m.Idx=0,m},e.Clipper.CleanPolygon=function(h,m){typeof m>"u"&&(m=1.415);var v=h.length;if(v===0)return new Array;for(var S=new Array(v),C=0;C<v;++C)S[C]=new e.OutPt;for(var C=0;C<v;++C)S[C].Pt=h[C],S[C].Next=S[(C+1)%v],S[C].Next.Prev=S[C],S[C].Idx=0;for(var F=m*m,H=S[0];H.Idx===0&&H.Next!==H.Prev;)e.Clipper.PointsAreClose(H.Pt,H.Prev.Pt,F)?(H=e.Clipper.ExcludeOp(H),v--):e.Clipper.PointsAreClose(H.Prev.Pt,H.Next.Pt,F)?(e.Clipper.ExcludeOp(H.Next),H=e.Clipper.ExcludeOp(H),v-=2):e.Clipper.SlopesNearCollinear(H.Prev.Pt,H.Pt,H.Next.Pt,F)?(H=e.Clipper.ExcludeOp(H),v--):(H.Idx=1,H=H.Next);v<3&&(v=0);for(var K=new Array(v),C=0;C<v;++C)K[C]=new e.IntPoint1(H.Pt),H=H.Next;return S=null,K},e.Clipper.CleanPolygons=function(h,m){for(var v=new Array(h.length),S=0,C=h.length;S<C;S++)v[S]=e.Clipper.CleanPolygon(h[S],m);return v},e.Clipper.Minkowski=function(h,m,v,S){var C=S?1:0,F=h.length,H=m.length,K=new Array;if(v)for(var $=0;$<H;$++){for(var ue=new Array(F),Pe=0,Me=h.length,Xe=h[Pe];Pe<Me;Pe++,Xe=h[Pe])ue[Pe]=new e.IntPoint2(m[$].X+Xe.X,m[$].Y+Xe.Y);K.push(ue)}else for(var $=0;$<H;$++){for(var ue=new Array(F),Pe=0,Me=h.length,Xe=h[Pe];Pe<Me;Pe++,Xe=h[Pe])ue[Pe]=new e.IntPoint2(m[$].X-Xe.X,m[$].Y-Xe.Y);K.push(ue)}for(var St=new Array,$=0;$<H-1+C;$++)for(var Pe=0;Pe<F;Pe++){var Vt=new Array;Vt.push(K[$%H][Pe%F]),Vt.push(K[($+1)%H][Pe%F]),Vt.push(K[($+1)%H][(Pe+1)%F]),Vt.push(K[$%H][(Pe+1)%F]),e.Clipper.Orientation(Vt)||Vt.reverse(),St.push(Vt)}return St},e.Clipper.MinkowskiSum=function(h,m,v){if(m[0]instanceof Array){for(var C=m,H=new e.Paths,F=new e.Clipper,K=0;K<C.length;++K){var $=e.Clipper.Minkowski(h,C[K],!0,v);if(F.AddPaths($,e.PolyType.ptSubject,!0),v){var S=e.Clipper.TranslatePath(C[K],h[0]);F.AddPath(S,e.PolyType.ptClip,!0)}}return F.Execute(e.ClipType.ctUnion,H,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero),H}else{var S=m,C=e.Clipper.Minkowski(h,S,!0,v),F=new e.Clipper;return F.AddPaths(C,e.PolyType.ptSubject,!0),F.Execute(e.ClipType.ctUnion,C,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero),C}},e.Clipper.TranslatePath=function(h,m){for(var v=new e.Path,S=0;S<h.length;S++)v.push(new e.IntPoint2(h[S].X+m.X,h[S].Y+m.Y));return v},e.Clipper.MinkowskiDiff=function(h,m){var v=e.Clipper.Minkowski(h,m,!1,!0),S=new e.Clipper;return S.AddPaths(v,e.PolyType.ptSubject,!0),S.Execute(e.ClipType.ctUnion,v,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero),v},e.Clipper.PolyTreeToPaths=function(h){var m=new Array;return e.Clipper.AddPolyNodeToPaths(h,e.Clipper.NodeType.ntAny,m),m},e.Clipper.AddPolyNodeToPaths=function(h,m,v){var S=!0;switch(m){case e.Clipper.NodeType.ntOpen:return;case e.Clipper.NodeType.ntClosed:S=!h.IsOpen;break}h.m_polygon.length>0&&S&&v.push(h.m_polygon);for(var C=0,F=h.Childs(),H=F.length,K=F[C];C<H;C++,K=F[C])e.Clipper.AddPolyNodeToPaths(K,m,v)},e.Clipper.OpenPathsFromPolyTree=function(h){for(var m=new e.Paths,v=0,S=h.ChildCount();v<S;v++)h.Childs()[v].IsOpen&&m.push(h.Childs()[v].m_polygon);return m},e.Clipper.ClosedPathsFromPolyTree=function(h){var m=new e.Paths;return e.Clipper.AddPolyNodeToPaths(h,e.Clipper.NodeType.ntClosed,m),m},ne(e.Clipper,e.ClipperBase),e.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},e.ClipperOffset=function(h,m){typeof h>"u"&&(h=2),typeof m>"u"&&(m=e.ClipperOffset.def_arc_tolerance),this.m_destPolys=new e.Paths,this.m_srcPoly=new e.Path,this.m_destPoly=new e.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new e.IntPoint0,this.m_polyNodes=new e.PolyNode,this.MiterLimit=h,this.ArcTolerance=m,this.m_lowest.X=-1},e.ClipperOffset.two_pi=6.28318530717959,e.ClipperOffset.def_arc_tolerance=.25,e.ClipperOffset.prototype.Clear=function(){e.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},e.ClipperOffset.Round=e.Clipper.Round,e.ClipperOffset.prototype.AddPath=function(h,m,v){var S=h.length-1;if(!(S<0)){var C=new e.PolyNode;if(C.m_jointype=m,C.m_endtype=v,v===e.EndType.etClosedLine||v===e.EndType.etClosedPolygon)for(;S>0&&e.IntPoint.op_Equality(h[0],h[S]);)S--;C.m_polygon.push(h[0]);for(var F=0,H=0,K=1;K<=S;K++)e.IntPoint.op_Inequality(C.m_polygon[F],h[K])&&(F++,C.m_polygon.push(h[K]),(h[K].Y>C.m_polygon[H].Y||h[K].Y===C.m_polygon[H].Y&&h[K].X<C.m_polygon[H].X)&&(H=F));if(!(v===e.EndType.etClosedPolygon&&F<2)&&(this.m_polyNodes.AddChild(C),v===e.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new e.IntPoint2(this.m_polyNodes.ChildCount()-1,H);else{var $=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(C.m_polygon[H].Y>$.Y||C.m_polygon[H].Y===$.Y&&C.m_polygon[H].X<$.X)&&(this.m_lowest=new e.IntPoint2(this.m_polyNodes.ChildCount()-1,H))}}},e.ClipperOffset.prototype.AddPaths=function(h,m,v){for(var S=0,C=h.length;S<C;S++)this.AddPath(h[S],m,v)},e.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!e.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var h=0;h<this.m_polyNodes.ChildCount();h++){var m=this.m_polyNodes.Childs()[h];(m.m_endtype===e.EndType.etClosedPolygon||m.m_endtype===e.EndType.etClosedLine&&e.Clipper.Orientation(m.m_polygon))&&m.m_polygon.reverse()}else for(var h=0;h<this.m_polyNodes.ChildCount();h++){var m=this.m_polyNodes.Childs()[h];m.m_endtype===e.EndType.etClosedLine&&!e.Clipper.Orientation(m.m_polygon)&&m.m_polygon.reverse()}},e.ClipperOffset.GetUnitNormal=function(h,m){var v=m.X-h.X,S=m.Y-h.Y;if(v===0&&S===0)return new e.DoublePoint2(0,0);var C=1/Math.sqrt(v*v+S*S);return v*=C,S*=C,new e.DoublePoint2(S,-v)},e.ClipperOffset.prototype.DoOffset=function(h){if(this.m_destPolys=new Array,this.m_delta=h,e.ClipperBase.near_zero(h)){for(var m=0;m<this.m_polyNodes.ChildCount();m++){var v=this.m_polyNodes.Childs()[m];v.m_endtype===e.EndType.etClosedPolygon&&this.m_destPolys.push(v.m_polygon)}return}this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5;var S;this.ArcTolerance<=0?S=e.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(h)*e.ClipperOffset.def_arc_tolerance?S=Math.abs(h)*e.ClipperOffset.def_arc_tolerance:S=this.ArcTolerance;var C=3.14159265358979/Math.acos(1-S/Math.abs(h));this.m_sin=Math.sin(e.ClipperOffset.two_pi/C),this.m_cos=Math.cos(e.ClipperOffset.two_pi/C),this.m_StepsPerRad=C/e.ClipperOffset.two_pi,h<0&&(this.m_sin=-this.m_sin);for(var m=0;m<this.m_polyNodes.ChildCount();m++){var v=this.m_polyNodes.Childs()[m];this.m_srcPoly=v.m_polygon;var F=this.m_srcPoly.length;if(!(F===0||h<=0&&(F<3||v.m_endtype!==e.EndType.etClosedPolygon))){if(this.m_destPoly=new Array,F===1){if(v.m_jointype===e.JoinType.jtRound)for(var H=1,K=0,$=1;$<=C;$++){this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[0].X+H*h),e.ClipperOffset.Round(this.m_srcPoly[0].Y+K*h)));var ue=H;H=H*this.m_cos-this.m_sin*K,K=ue*this.m_sin+K*this.m_cos}else for(var H=-1,K=-1,$=0;$<4;++$)this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[0].X+H*h),e.ClipperOffset.Round(this.m_srcPoly[0].Y+K*h))),H<0?H=1:K<0?K=1:H=-1;this.m_destPolys.push(this.m_destPoly);continue}this.m_normals.length=0;for(var $=0;$<F-1;$++)this.m_normals.push(e.ClipperOffset.GetUnitNormal(this.m_srcPoly[$],this.m_srcPoly[$+1]));if(v.m_endtype===e.EndType.etClosedLine||v.m_endtype===e.EndType.etClosedPolygon?this.m_normals.push(e.ClipperOffset.GetUnitNormal(this.m_srcPoly[F-1],this.m_srcPoly[0])):this.m_normals.push(new e.DoublePoint1(this.m_normals[F-2])),v.m_endtype===e.EndType.etClosedPolygon){for(var Pe=F-1,$=0;$<F;$++)Pe=this.OffsetPoint($,Pe,v.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(v.m_endtype===e.EndType.etClosedLine){for(var Pe=F-1,$=0;$<F;$++)Pe=this.OffsetPoint($,Pe,v.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;for(var Me=this.m_normals[F-1],$=F-1;$>0;$--)this.m_normals[$]=new e.DoublePoint2(-this.m_normals[$-1].X,-this.m_normals[$-1].Y);this.m_normals[0]=new e.DoublePoint2(-Me.X,-Me.Y),Pe=0;for(var $=F-1;$>=0;$--)Pe=this.OffsetPoint($,Pe,v.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{for(var Pe=0,$=1;$<F-1;++$)Pe=this.OffsetPoint($,Pe,v.m_jointype);var Xe;if(v.m_endtype===e.EndType.etOpenButt){var $=F-1;Xe=new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[$].X+this.m_normals[$].X*h),e.ClipperOffset.Round(this.m_srcPoly[$].Y+this.m_normals[$].Y*h)),this.m_destPoly.push(Xe),Xe=new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[$].X-this.m_normals[$].X*h),e.ClipperOffset.Round(this.m_srcPoly[$].Y-this.m_normals[$].Y*h)),this.m_destPoly.push(Xe)}else{var $=F-1;Pe=F-2,this.m_sinA=0,this.m_normals[$]=new e.DoublePoint2(-this.m_normals[$].X,-this.m_normals[$].Y),v.m_endtype===e.EndType.etOpenSquare?this.DoSquare($,Pe):this.DoRound($,Pe)}for(var $=F-1;$>0;$--)this.m_normals[$]=new e.DoublePoint2(-this.m_normals[$-1].X,-this.m_normals[$-1].Y);this.m_normals[0]=new e.DoublePoint2(-this.m_normals[1].X,-this.m_normals[1].Y),Pe=F-1;for(var $=Pe-1;$>0;--$)Pe=this.OffsetPoint($,Pe,v.m_jointype);v.m_endtype===e.EndType.etOpenButt?(Xe=new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*h),e.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*h)),this.m_destPoly.push(Xe),Xe=new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*h),e.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*h)),this.m_destPoly.push(Xe)):(Pe=1,this.m_sinA=0,v.m_endtype===e.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}}},e.ClipperOffset.prototype.Execute=function(){var h=arguments,m=h[0]instanceof e.PolyTree;if(m){var v=h[0],S=h[1];v.Clear(),this.FixOrientations(),this.DoOffset(S);var C=new e.Clipper(0);if(C.AddPaths(this.m_destPolys,e.PolyType.ptSubject,!0),S>0)C.Execute(e.ClipType.ctUnion,v,e.PolyFillType.pftPositive,e.PolyFillType.pftPositive);else{var F=e.Clipper.GetBounds(this.m_destPolys),H=new e.Path;if(H.push(new e.IntPoint2(F.left-10,F.bottom+10)),H.push(new e.IntPoint2(F.right+10,F.bottom+10)),H.push(new e.IntPoint2(F.right+10,F.top-10)),H.push(new e.IntPoint2(F.left-10,F.top-10)),C.AddPath(H,e.PolyType.ptSubject,!0),C.ReverseSolution=!0,C.Execute(e.ClipType.ctUnion,v,e.PolyFillType.pftNegative,e.PolyFillType.pftNegative),v.ChildCount()===1&&v.Childs()[0].ChildCount()>0){var K=v.Childs()[0];v.Childs()[0]=K.Childs()[0],v.Childs()[0].m_Parent=v;for(var $=1;$<K.ChildCount();$++)v.AddChild(K.Childs()[$])}else v.Clear()}}else{var v=h[0],S=h[1];e.Clear(v),this.FixOrientations(),this.DoOffset(S);var C=new e.Clipper(0);if(C.AddPaths(this.m_destPolys,e.PolyType.ptSubject,!0),S>0)C.Execute(e.ClipType.ctUnion,v,e.PolyFillType.pftPositive,e.PolyFillType.pftPositive);else{var F=e.Clipper.GetBounds(this.m_destPolys),H=new e.Path;H.push(new e.IntPoint2(F.left-10,F.bottom+10)),H.push(new e.IntPoint2(F.right+10,F.bottom+10)),H.push(new e.IntPoint2(F.right+10,F.top-10)),H.push(new e.IntPoint2(F.left-10,F.top-10)),C.AddPath(H,e.PolyType.ptSubject,!0),C.ReverseSolution=!0,C.Execute(e.ClipType.ctUnion,v,e.PolyFillType.pftNegative,e.PolyFillType.pftNegative),v.length>0&&v.splice(0,1)}}},e.ClipperOffset.prototype.OffsetPoint=function(h,m,v){if(this.m_sinA=this.m_normals[m].X*this.m_normals[h].Y-this.m_normals[h].X*this.m_normals[m].Y,Math.abs(this.m_sinA*this.m_delta)<1){var S=this.m_normals[m].X*this.m_normals[h].X+this.m_normals[h].Y*this.m_normals[m].Y;if(S>0)return this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[m].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[m].Y*this.m_delta))),m}else this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1);if(this.m_sinA*this.m_delta<0)this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[m].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[m].Y*this.m_delta))),this.m_destPoly.push(new e.IntPoint1(this.m_srcPoly[h])),this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[h].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[h].Y*this.m_delta)));else switch(v){case e.JoinType.jtMiter:{var C=1+(this.m_normals[h].X*this.m_normals[m].X+this.m_normals[h].Y*this.m_normals[m].Y);C>=this.m_miterLim?this.DoMiter(h,m,C):this.DoSquare(h,m);break}case e.JoinType.jtSquare:this.DoSquare(h,m);break;case e.JoinType.jtRound:this.DoRound(h,m);break}return m=h,m},e.ClipperOffset.prototype.DoSquare=function(h,m){var v=Math.tan(Math.atan2(this.m_sinA,this.m_normals[m].X*this.m_normals[h].X+this.m_normals[m].Y*this.m_normals[h].Y)/4);this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_delta*(this.m_normals[m].X-this.m_normals[m].Y*v)),e.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_delta*(this.m_normals[m].Y+this.m_normals[m].X*v)))),this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_delta*(this.m_normals[h].X+this.m_normals[h].Y*v)),e.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_delta*(this.m_normals[h].Y-this.m_normals[h].X*v))))},e.ClipperOffset.prototype.DoMiter=function(h,m,v){var S=this.m_delta/v;this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[h].X+(this.m_normals[m].X+this.m_normals[h].X)*S),e.ClipperOffset.Round(this.m_srcPoly[h].Y+(this.m_normals[m].Y+this.m_normals[h].Y)*S)))},e.ClipperOffset.prototype.DoRound=function(h,m){for(var v=Math.atan2(this.m_sinA,this.m_normals[m].X*this.m_normals[h].X+this.m_normals[m].Y*this.m_normals[h].Y),S=Math.max(e.Cast_Int32(e.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(v))),1),C=this.m_normals[m].X,F=this.m_normals[m].Y,H,K=0;K<S;++K)this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[h].X+C*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[h].Y+F*this.m_delta))),H=C,C=C*this.m_cos-this.m_sin*F,F=H*this.m_sin+F*this.m_cos;this.m_destPoly.push(new e.IntPoint2(e.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[h].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[h].Y*this.m_delta)))},e.Error=function(h){try{throw new Error(h)}catch(m){alert(m.message)}},e.JS={},e.JS.AreaOfPolygon=function(h,m){return m||(m=1),e.Clipper.Area(h)/(m*m)},e.JS.AreaOfPolygons=function(h,m){m||(m=1);for(var v=0,S=0;S<h.length;S++)v+=e.Clipper.Area(h[S]);return v/(m*m)},e.JS.BoundsOfPath=function(h,m){return e.JS.BoundsOfPaths([h],m)},e.JS.BoundsOfPaths=function(h,m){m||(m=1);var v=e.Clipper.GetBounds(h);return v.left/=m,v.bottom/=m,v.right/=m,v.top/=m,v},e.JS.Clean=function(S,m){if(!(S instanceof Array))return[];var v=S[0]instanceof Array,S=e.JS.Clone(S);if(typeof m!="number"||m===null)return e.Error("Delta is not a number in Clean()."),S;if(S.length===0||S.length===1&&S[0].length===0||m<0)return S;v||(S=[S]);for(var C=S.length,F,H,K,$,ue,Pe,Me,Xe=[],St=0;St<C;St++)if(H=S[St],F=H.length,F!==0){if(F<3){K=H,Xe.push(K);continue}for(K=H,$=m*m,ue=H[0],Pe=1,Me=1;Me<F;Me++)(H[Me].X-ue.X)*(H[Me].X-ue.X)+(H[Me].Y-ue.Y)*(H[Me].Y-ue.Y)<=$||(K[Pe]=H[Me],ue=H[Me],Pe++);ue=H[Pe-1],(H[0].X-ue.X)*(H[0].X-ue.X)+(H[0].Y-ue.Y)*(H[0].Y-ue.Y)<=$&&Pe--,Pe<F&&K.splice(Pe,F-Pe),K.length&&Xe.push(K)}return!v&&Xe.length?Xe=Xe[0]:!v&&Xe.length===0?Xe=[]:v&&Xe.length===0&&(Xe=[[]]),Xe},e.JS.Clone=function(h){if(!(h instanceof Array))return[];if(h.length===0)return[];if(h.length===1&&h[0].length===0)return[[]];var m=h[0]instanceof Array;m||(h=[h]);var v=h.length,S,C,F,H,K=new Array(v);for(C=0;C<v;C++){for(S=h[C].length,H=new Array(S),F=0;F<S;F++)H[F]={X:h[C][F].X,Y:h[C][F].Y};K[C]=H}return m||(K=K[0]),K},e.JS.Lighten=function(h,m){if(!(h instanceof Array))return[];if(typeof m!="number"||m===null)return e.Error("Tolerance is not a number in Lighten()."),e.JS.Clone(h);if(h.length===0||h.length===1&&h[0].length===0||m<0)return e.JS.Clone(h);var v=h[0]instanceof Array;v||(h=[h]);var S,C,F,H,K,$,ue,Pe,Me,Xe,St,Vt,Wt,vi,xn,Ss,Hc,gV=h.length,_V=m*m,Gc=[];for(S=0;S<gV;S++)if(F=h[S],$=F.length,$!==0){for(H=0;H<1e6;H++){for(K=[],$=F.length,F[$-1].X!==F[0].X||F[$-1].Y!==F[0].Y?(Vt=1,F.push({X:F[0].X,Y:F[0].Y}),$=F.length):Vt=0,St=[],C=0;C<$-2;C++)ue=F[C],Me=F[C+1],Pe=F[C+2],Ss=ue.X,Hc=ue.Y,Wt=Pe.X-Ss,vi=Pe.Y-Hc,(Wt!==0||vi!==0)&&(xn=((Me.X-Ss)*Wt+(Me.Y-Hc)*vi)/(Wt*Wt+vi*vi),xn>1?(Ss=Pe.X,Hc=Pe.Y):xn>0&&(Ss+=Wt*xn,Hc+=vi*xn)),Wt=Me.X-Ss,vi=Me.Y-Hc,Xe=Wt*Wt+vi*vi,Xe<=_V&&(St[C+1]=1,C++);for(K.push({X:F[0].X,Y:F[0].Y}),C=1;C<$-1;C++)St[C]||K.push({X:F[C].X,Y:F[C].Y});if(K.push({X:F[$-1].X,Y:F[$-1].Y}),Vt&&F.pop(),St.length)F=K;else break}$=K.length,K[$-1].X===K[0].X&&K[$-1].Y===K[0].Y&&K.pop(),K.length>2&&Gc.push(K)}return v||(Gc=Gc[0]),typeof Gc>"u"&&(Gc=[]),Gc},e.JS.PerimeterOfPath=function(h,m,v){if(typeof h>"u")return 0;var S=Math.sqrt,C=0,F,H,K=0,$=0,ue=0,Pe=0,Me=h.length;if(Me<2)return 0;for(m&&(h[Me]=h[0],Me++);--Me;)F=h[Me],K=F.X,$=F.Y,H=h[Me-1],ue=H.X,Pe=H.Y,C+=S((K-ue)*(K-ue)+($-Pe)*($-Pe));return m&&h.pop(),C/v},e.JS.PerimeterOfPaths=function(h,m,v){v||(v=1);for(var S=0,C=0;C<h.length;C++)S+=e.JS.PerimeterOfPath(h[C],m,v);return S},e.JS.ScaleDownPath=function(h,m){var v,S;for(m||(m=1),v=h.length;v--;)S=h[v],S.X=S.X/m,S.Y=S.Y/m},e.JS.ScaleDownPaths=function(h,m){var v,S,C;for(m||(m=1),v=h.length;v--;)for(S=h[v].length;S--;)C=h[v][S],C.X=C.X/m,C.Y=C.Y/m},e.JS.ScaleUpPath=function(h,m){var v,S,C=Math.round;for(m||(m=1),v=h.length;v--;)S=h[v],S.X=C(S.X*m),S.Y=C(S.Y*m)},e.JS.ScaleUpPaths=function(h,m){var v,S,C,F=Math.round;for(m||(m=1),v=h.length;v--;)for(S=h[v].length;S--;)C=h[v][S],C.X=F(C.X*m),C.Y=F(C.Y*m)},e.ExPolygons=function(){return[]},e.ExPolygon=function(){this.outer=null,this.holes=null},e.JS.AddOuterPolyNodeToExPolygons=function(h,m){var v=new e.ExPolygon;v.outer=h.Contour();var S=h.Childs(),C=S.length;v.holes=new Array(C);var F,H,K,$,ue,Pe;for(K=0;K<C;K++)for(F=S[K],v.holes[K]=F.Contour(),$=0,ue=F.Childs(),Pe=ue.length;$<Pe;$++)H=ue[$],e.JS.AddOuterPolyNodeToExPolygons(H,m);m.push(v)},e.JS.ExPolygonsToPaths=function(h){var m,v,S,C,F=new e.Paths;for(m=0,S=h.length;m<S;m++)for(F.push(h[m].outer),v=0,C=h[m].holes.length;v<C;v++)F.push(h[m].holes[v]);return F},e.JS.PolyTreeToExPolygons=function(h){var m=new e.ExPolygons,v,S,C,F;for(S=0,C=h.Childs(),F=C.length;S<F;S++)v=C[S],e.JS.AddOuterPolyNodeToExPolygons(v,m);return m}})()})(u1);var iG=u1.exports;Object.defineProperty(Em,"__esModule",{value:!0}),Em.setErrorCallback=void 0;var nG=function(){function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),rG=iG,di=sG(rG);function sG(n){return n&&n.__esModule?n:{default:n}}function f1(n){if(Array.isArray(n)){for(var e=0,t=Array(n.length);e<n.length;e++)t[e]=n[e];return t}else return Array.from(n)}function oG(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _y=void 0;Em.setErrorCallback=function(e){_y=e},di.default.Error=function(n){_y&&_y(n)};var Tm=new di.default.Clipper,bu=new di.default.ClipperOffset,aG=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;oG(this,n),this.paths=e,i&&(this.paths=this.paths.map(cG)),r&&(this.paths=this.paths.map(p1)),s&&(this.paths=this.paths.map(m1)),this.closed=t}return nG(n,[{key:"_clip",value:function(t){var i=new di.default.PolyTree;Tm.Clear(),Tm.AddPaths(this.paths,di.default.PolyType.ptSubject,this.closed);for(var r=arguments.length,s=Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];for(var a=0;a<s.length;a++){var l=s[a];Tm.AddPaths(l.paths,di.default.PolyType.ptClip,l.closed)}Tm.Execute(t,i);var c=di.default.Clipper.PolyTreeToPaths(i);return new n(c,this.closed)}},{key:"union",value:function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return this._clip.apply(this,[di.default.ClipType.ctUnion].concat(i))}},{key:"difference",value:function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return this._clip.apply(this,[di.default.ClipType.ctDifference].concat(i))}},{key:"intersect",value:function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return this._clip.apply(this,[di.default.ClipType.ctIntersection].concat(i))}},{key:"xor",value:function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return this._clip.apply(this,[di.default.ClipType.ctXor].concat(i))}},{key:"offset",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=i.jointType,s=r===void 0?"jtSquare":r,o=i.endType,a=o===void 0?"etClosedPolygon":o,l=i.miterLimit,c=l===void 0?2:l,u=i.roundPrecision,d=u===void 0?.25:u;bu.Clear(),bu.ArcTolerance=d,bu.MiterLimit=c;var p=new di.default.Paths;return bu.AddPaths(this.paths,di.default.JoinType[s],di.default.EndType[a]),bu.Execute(p,t),new n(p,!0)}},{key:"scaleUp",value:function(t){return di.default.JS.ScaleUpPaths(this.paths,t),this}},{key:"scaleDown",value:function(t){return di.default.JS.ScaleDownPaths(this.paths,t),this}},{key:"firstPoint",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.paths.length!==0){var i=this.paths[0],r=i[0];return t?vy(r):r}}},{key:"lastPoint",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.paths.length!==0){var i=this.paths[this.paths.length-1],r=this.closed?i[0]:i[i.length-1];return t?vy(r):r}}},{key:"areas",value:function(){var t=this,i=this.paths.map(function(r,s){return t.area(s)});return i}},{key:"area",value:function(t){var i=this.paths[t],r=di.default.Clipper.Area(i);return r}},{key:"totalArea",value:function(){return this.areas().reduce(function(t,i){return t+i},0)}},{key:"perimeter",value:function(t){var i=this.paths[t],r=di.default.JS.PerimeterOfPath(i,this.closed,1);return r}},{key:"perimeters",value:function(){var t=this;return this.paths.map(function(i){return di.default.JS.PerimeterOfPath(i,t.closed,1)})}},{key:"totalPerimeter",value:function(){var t=di.default.JS.PerimeterOfPaths(this.paths,this.closed);return t}},{key:"reverse",value:function(){return di.default.Clipper.ReversePaths(this.paths),this}},{key:"thresholdArea",value:function(t){for(var i=[].concat(f1(this.paths)),r=0;r<i.length;r++){var s=i[r],o=Math.abs(di.default.Clipper.Area(s));if(o<t){var a=this.paths.indexOf(s);this.paths.splice(a,1)}}return this}},{key:"join",value:function(t){var i;return(i=this.paths).splice.apply(i,[this.paths.length,0].concat(f1(t.paths))),this}},{key:"clone",value:function(){return new n(di.default.JS.Clone(this.paths),this.closed)}},{key:"shapeBounds",value:function(){return di.default.JS.BoundsOfPaths(this.paths)}},{key:"pathBounds",value:function(t){var i=this.paths[t];return di.default.JS.BoundsOfPath(i)}},{key:"clean",value:function(t){return new n(di.default.Clipper.CleanPolygons(this.paths,t),this.closed)}},{key:"orientation",value:function(t){var i=this.paths[t];return di.default.Clipper.Orientation(i)}},{key:"pointInShape",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;i&&(t=yy(t)),r&&(t=by(t));for(var s=0;s<this.paths.length;s++){var o=this.pointInPath(s,t),a=this.orientation(s);if(!o&&a||o&&!a)return!1}return!0}},{key:"pointInPath",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;r&&(i=yy(i)),s&&(i=by(i));var o=this.paths[t],a={X:Math.round(i.X),Y:Math.round(i.Y)};return di.default.Clipper.PointInPolygon(a,o)>0}},{key:"fixOrientation",value:function(){return this.closed?(this.totalArea()<0&&this.reverse(),this):this}},{key:"simplify",value:function(t){if(this.closed){var i=di.default.Clipper.SimplifyPolygons(this.paths,di.default.PolyFillType[t]);return new n(i,!0)}else return this}},{key:"separateShapes",value:function(){var t=[];if(this.closed){for(var c=new WeakMap,u=[],d=[],p=0;p<this.paths.length;p++){var g=this.paths[p],_=this.orientation(p);if(_){var x=this.area(p);c.set(g,x),u.push(g)}else d.push(g)}u.sort(function(A,D){return c.get(A)-c.get(D)});var b=!0,y=!1,M=void 0;try{for(var E=u[Symbol.iterator](),w;!(b=(w=E.next()).done);b=!0){for(var I=w.value,B=[I],N=this.paths.indexOf(I),L=[].concat(d),P=0;P<L.length;P++){var R=L[P],U=this.pointInPath(N,R[0]);if(U){B.push(R);var j=d.indexOf(R);d.splice(j,1)}}t.push(new n(B,!0))}}catch(A){y=!0,M=A}finally{try{!b&&E.return&&E.return()}finally{if(y)throw M}}}else{var i=!0,r=!1,s=void 0;try{for(var o=this.paths[Symbol.iterator](),a;!(i=(a=o.next()).done);i=!0){var l=a.value;t.push(new n([l],!1))}}catch(A){r=!0,s=A}finally{try{!i&&o.return&&o.return()}finally{if(r)throw s}}}return t}},{key:"round",value:function(){return new n(this.paths.map(p1),this.closed)}},{key:"removeDuplicates",value:function(){return new n(this.paths.map(m1),this.closed)}},{key:"mapToLower",value:function(){return this.paths.map(lG)}}]),n}(),d1=Em.default=aG;function lG(n){return n.map(vy)}function vy(n){var e=n.X,t=n.Y;return{x:e,y:t}}function cG(n){return n.map(yy)}function yy(n){var e=n.x,t=n.y;return{X:e,Y:t}}function p1(n){return n.map(by)}function by(n){var e=n.X,t=n.Y;return{X:Math.round(e),Y:Math.round(t)}}function m1(n){return n.filter(hG)}function hG(n,e,t){if(e===0)return!0;var i=t[e-1];return!(n.X===i.X&&n.Y===i.Y)}var g1={exports:{}},_1=uG,v1=+(Math.pow(2,27)+1);function uG(n,e,t){var i=n*e,r=v1*n,s=r-n,o=r-s,a=n-o,l=v1*e,c=l-e,u=l-c,d=e-u,p=i-o*u,g=p-a*u,_=g-o*d,x=a*d-_;return t?(t[0]=x,t[1]=i,t):[x,i]}var fG=pG;function dG(n,e){var t=n+e,i=t-n,r=t-i,s=e-i,o=n-r,a=o+s;return a?[a,t]:[t]}function pG(n,e){var t=n.length|0,i=e.length|0;if(t===1&&i===1)return dG(n[0],e[0]);var r=t+i,s=new Array(r),o=0,a=0,l=0,c=Math.abs,u=n[a],d=c(u),p=e[l],g=c(p),_,x;d<g?(x=u,a+=1,a<t&&(u=n[a],d=c(u))):(x=p,l+=1,l<i&&(p=e[l],g=c(p))),a<t&&d<g||l>=i?(_=u,a+=1,a<t&&(u=n[a],d=c(u))):(_=p,l+=1,l<i&&(p=e[l],g=c(p)));for(var b=_+x,y=b-_,M=x-y,E=M,w=b,I,B,N,L,P;a<t&&l<i;)d<g?(_=u,a+=1,a<t&&(u=n[a],d=c(u))):(_=p,l+=1,l<i&&(p=e[l],g=c(p))),x=E,b=_+x,y=b-_,M=x-y,M&&(s[o++]=M),I=w+b,B=I-w,N=I-B,L=b-B,P=w-N,E=P+L,w=I;for(;a<t;)_=u,x=E,b=_+x,y=b-_,M=x-y,M&&(s[o++]=M),I=w+b,B=I-w,N=I-B,L=b-B,P=w-N,E=P+L,w=I,a+=1,a<t&&(u=n[a]);for(;l<i;)_=p,x=E,b=_+x,y=b-_,M=x-y,M&&(s[o++]=M),I=w+b,B=I-w,N=I-B,L=b-B,P=w-N,E=P+L,w=I,l+=1,l<i&&(p=e[l]);return E&&(s[o++]=E),w&&(s[o++]=w),o||(s[o++]=0),s.length=o,s}var mG=gG;function gG(n,e,t){var i=n+e,r=i-n,s=i-r,o=e-r,a=n-s;return t?(t[0]=a+o,t[1]=i,t):[a+o,i]}var xy=_1,_G=mG,vG=yG;function yG(n,e){var t=n.length;if(t===1){var i=xy(n[0],e);return i[0]?i:[i[1]]}var r=new Array(2*t),s=[.1,.1],o=[.1,.1],a=0;xy(n[0],e,s),s[0]&&(r[a++]=s[0]);for(var l=1;l<t;++l){xy(n[l],e,o);var c=s[1];_G(c,o[0],s),s[0]&&(r[a++]=s[0]);var u=o[1],d=s[1],p=u+d,g=p-u,_=d-g;s[1]=p,_&&(r[a++]=_)}return s[1]&&(r[a++]=s[1]),a===0&&(r[a++]=0),r.length=a,r}var bG=wG;function xG(n,e){var t=n+e,i=t-n,r=t-i,s=e-i,o=n-r,a=o+s;return a?[a,t]:[t]}function wG(n,e){var t=n.length|0,i=e.length|0;if(t===1&&i===1)return xG(n[0],-e[0]);var r=t+i,s=new Array(r),o=0,a=0,l=0,c=Math.abs,u=n[a],d=c(u),p=-e[l],g=c(p),_,x;d<g?(x=u,a+=1,a<t&&(u=n[a],d=c(u))):(x=p,l+=1,l<i&&(p=-e[l],g=c(p))),a<t&&d<g||l>=i?(_=u,a+=1,a<t&&(u=n[a],d=c(u))):(_=p,l+=1,l<i&&(p=-e[l],g=c(p)));for(var b=_+x,y=b-_,M=x-y,E=M,w=b,I,B,N,L,P;a<t&&l<i;)d<g?(_=u,a+=1,a<t&&(u=n[a],d=c(u))):(_=p,l+=1,l<i&&(p=-e[l],g=c(p))),x=E,b=_+x,y=b-_,M=x-y,M&&(s[o++]=M),I=w+b,B=I-w,N=I-B,L=b-B,P=w-N,E=P+L,w=I;for(;a<t;)_=u,x=E,b=_+x,y=b-_,M=x-y,M&&(s[o++]=M),I=w+b,B=I-w,N=I-B,L=b-B,P=w-N,E=P+L,w=I,a+=1,a<t&&(u=n[a]);for(;l<i;)_=p,x=E,b=_+x,y=b-_,M=x-y,M&&(s[o++]=M),I=w+b,B=I-w,N=I-B,L=b-B,P=w-N,E=P+L,w=I,l+=1,l<i&&(p=-e[l]);return E&&(s[o++]=E),w&&(s[o++]=w),o||(s[o++]=0),s.length=o,s}(function(n){var e=_1,t=fG,i=vG,r=bG,s=5,o=11102230246251565e-32,a=(3+16*o)*o,l=(7+56*o)*o;function c(E,w,I,B){return function(L,P,R){var U=E(E(w(P[1],R[0]),w(-R[1],P[0])),E(w(L[1],P[0]),w(-P[1],L[0]))),j=E(w(L[1],R[0]),w(-R[1],L[0])),A=B(U,j);return A[A.length-1]}}function u(E,w,I,B){return function(L,P,R,U){var j=E(E(I(E(w(R[1],U[0]),w(-U[1],R[0])),P[2]),E(I(E(w(P[1],U[0]),w(-U[1],P[0])),-R[2]),I(E(w(P[1],R[0]),w(-R[1],P[0])),U[2]))),E(I(E(w(P[1],U[0]),w(-U[1],P[0])),L[2]),E(I(E(w(L[1],U[0]),w(-U[1],L[0])),-P[2]),I(E(w(L[1],P[0]),w(-P[1],L[0])),U[2])))),A=E(E(I(E(w(R[1],U[0]),w(-U[1],R[0])),L[2]),E(I(E(w(L[1],U[0]),w(-U[1],L[0])),-R[2]),I(E(w(L[1],R[0]),w(-R[1],L[0])),U[2]))),E(I(E(w(P[1],R[0]),w(-R[1],P[0])),L[2]),E(I(E(w(L[1],R[0]),w(-R[1],L[0])),-P[2]),I(E(w(L[1],P[0]),w(-P[1],L[0])),R[2])))),D=B(j,A);return D[D.length-1]}}function d(E,w,I,B){return function(L,P,R,U,j){var A=E(E(E(I(E(I(E(w(U[1],j[0]),w(-j[1],U[0])),R[2]),E(I(E(w(R[1],j[0]),w(-j[1],R[0])),-U[2]),I(E(w(R[1],U[0]),w(-U[1],R[0])),j[2]))),P[3]),E(I(E(I(E(w(U[1],j[0]),w(-j[1],U[0])),P[2]),E(I(E(w(P[1],j[0]),w(-j[1],P[0])),-U[2]),I(E(w(P[1],U[0]),w(-U[1],P[0])),j[2]))),-R[3]),I(E(I(E(w(R[1],j[0]),w(-j[1],R[0])),P[2]),E(I(E(w(P[1],j[0]),w(-j[1],P[0])),-R[2]),I(E(w(P[1],R[0]),w(-R[1],P[0])),j[2]))),U[3]))),E(I(E(I(E(w(R[1],U[0]),w(-U[1],R[0])),P[2]),E(I(E(w(P[1],U[0]),w(-U[1],P[0])),-R[2]),I(E(w(P[1],R[0]),w(-R[1],P[0])),U[2]))),-j[3]),E(I(E(I(E(w(U[1],j[0]),w(-j[1],U[0])),P[2]),E(I(E(w(P[1],j[0]),w(-j[1],P[0])),-U[2]),I(E(w(P[1],U[0]),w(-U[1],P[0])),j[2]))),L[3]),I(E(I(E(w(U[1],j[0]),w(-j[1],U[0])),L[2]),E(I(E(w(L[1],j[0]),w(-j[1],L[0])),-U[2]),I(E(w(L[1],U[0]),w(-U[1],L[0])),j[2]))),-P[3])))),E(E(I(E(I(E(w(P[1],j[0]),w(-j[1],P[0])),L[2]),E(I(E(w(L[1],j[0]),w(-j[1],L[0])),-P[2]),I(E(w(L[1],P[0]),w(-P[1],L[0])),j[2]))),U[3]),E(I(E(I(E(w(P[1],U[0]),w(-U[1],P[0])),L[2]),E(I(E(w(L[1],U[0]),w(-U[1],L[0])),-P[2]),I(E(w(L[1],P[0]),w(-P[1],L[0])),U[2]))),-j[3]),I(E(I(E(w(R[1],U[0]),w(-U[1],R[0])),P[2]),E(I(E(w(P[1],U[0]),w(-U[1],P[0])),-R[2]),I(E(w(P[1],R[0]),w(-R[1],P[0])),U[2]))),L[3]))),E(I(E(I(E(w(R[1],U[0]),w(-U[1],R[0])),L[2]),E(I(E(w(L[1],U[0]),w(-U[1],L[0])),-R[2]),I(E(w(L[1],R[0]),w(-R[1],L[0])),U[2]))),-P[3]),E(I(E(I(E(w(P[1],U[0]),w(-U[1],P[0])),L[2]),E(I(E(w(L[1],U[0]),w(-U[1],L[0])),-P[2]),I(E(w(L[1],P[0]),w(-P[1],L[0])),U[2]))),R[3]),I(E(I(E(w(P[1],R[0]),w(-R[1],P[0])),L[2]),E(I(E(w(L[1],R[0]),w(-R[1],L[0])),-P[2]),I(E(w(L[1],P[0]),w(-P[1],L[0])),R[2]))),-U[3]))))),D=E(E(E(I(E(I(E(w(U[1],j[0]),w(-j[1],U[0])),R[2]),E(I(E(w(R[1],j[0]),w(-j[1],R[0])),-U[2]),I(E(w(R[1],U[0]),w(-U[1],R[0])),j[2]))),L[3]),I(E(I(E(w(U[1],j[0]),w(-j[1],U[0])),L[2]),E(I(E(w(L[1],j[0]),w(-j[1],L[0])),-U[2]),I(E(w(L[1],U[0]),w(-U[1],L[0])),j[2]))),-R[3])),E(I(E(I(E(w(R[1],j[0]),w(-j[1],R[0])),L[2]),E(I(E(w(L[1],j[0]),w(-j[1],L[0])),-R[2]),I(E(w(L[1],R[0]),w(-R[1],L[0])),j[2]))),U[3]),I(E(I(E(w(R[1],U[0]),w(-U[1],R[0])),L[2]),E(I(E(w(L[1],U[0]),w(-U[1],L[0])),-R[2]),I(E(w(L[1],R[0]),w(-R[1],L[0])),U[2]))),-j[3]))),E(E(I(E(I(E(w(R[1],j[0]),w(-j[1],R[0])),P[2]),E(I(E(w(P[1],j[0]),w(-j[1],P[0])),-R[2]),I(E(w(P[1],R[0]),w(-R[1],P[0])),j[2]))),L[3]),I(E(I(E(w(R[1],j[0]),w(-j[1],R[0])),L[2]),E(I(E(w(L[1],j[0]),w(-j[1],L[0])),-R[2]),I(E(w(L[1],R[0]),w(-R[1],L[0])),j[2]))),-P[3])),E(I(E(I(E(w(P[1],j[0]),w(-j[1],P[0])),L[2]),E(I(E(w(L[1],j[0]),w(-j[1],L[0])),-P[2]),I(E(w(L[1],P[0]),w(-P[1],L[0])),j[2]))),R[3]),I(E(I(E(w(P[1],R[0]),w(-R[1],P[0])),L[2]),E(I(E(w(L[1],R[0]),w(-R[1],L[0])),-P[2]),I(E(w(L[1],P[0]),w(-P[1],L[0])),R[2]))),-j[3])))),k=B(A,D);return k[k.length-1]}}function p(E){var w=E===3?c:E===4?u:d;return w(t,e,i,r)}var g=p(3),_=p(4),x=[function(){return 0},function(){return 0},function(w,I){return I[0]-w[0]},function(w,I,B){var N=(w[1]-B[1])*(I[0]-B[0]),L=(w[0]-B[0])*(I[1]-B[1]),P=N-L,R;if(N>0){if(L<=0)return P;R=N+L}else if(N<0){if(L>=0)return P;R=-(N+L)}else return P;var U=a*R;return P>=U||P<=-U?P:g(w,I,B)},function(w,I,B,N){var L=w[0]-N[0],P=I[0]-N[0],R=B[0]-N[0],U=w[1]-N[1],j=I[1]-N[1],A=B[1]-N[1],D=w[2]-N[2],k=I[2]-N[2],G=B[2]-N[2],ee=P*A,J=R*j,re=R*U,oe=L*A,me=L*j,Le=P*U,Ge=D*(ee-J)+k*(re-oe)+G*(me-Le),pe=(Math.abs(ee)+Math.abs(J))*Math.abs(D)+(Math.abs(re)+Math.abs(oe))*Math.abs(k)+(Math.abs(me)+Math.abs(Le))*Math.abs(G),Te=l*pe;return Ge>Te||-Ge>Te?Ge:_(w,I,B,N)}];function b(E){var w=x[E.length];return w||(w=x[E.length]=p(E.length)),w.apply(void 0,E)}function y(E,w,I,B,N,L,P){return function(U,j,A,D,k){switch(arguments.length){case 0:case 1:return 0;case 2:return B(U,j);case 3:return N(U,j,A);case 4:return L(U,j,A,D);case 5:return P(U,j,A,D,k)}for(var G=new Array(arguments.length),ee=0;ee<arguments.length;++ee)G[ee]=arguments[ee];return E(G)}}function M(){for(;x.length<=s;)x.push(p(x.length));n.exports=y.apply(void 0,[b].concat(x));for(var E=0;E<=s;++E)n.exports[E]=x[E]}M()})(g1);var SG=g1.exports,EG=TG,y1=SG[3];function TG(n){var e=n.length;if(e<3){for(var c=new Array(e),t=0;t<e;++t)c[t]=t;return e===2&&n[0][0]===n[1][0]&&n[0][1]===n[1][1]?[0]:c}for(var i=new Array(e),t=0;t<e;++t)i[t]=t;i.sort(function(g,_){var x=n[g][0]-n[_][0];return x||n[g][1]-n[_][1]});for(var r=[i[0],i[1]],s=[i[0],i[1]],t=2;t<e;++t){for(var o=i[t],a=n[o],l=r.length;l>1&&y1(n[r[l-2]],n[r[l-1]],a)<=0;)l-=1,r.pop();for(r.push(o),l=s.length;l>1&&y1(n[s[l-2]],n[s[l-1]],a)>=0;)l-=1,s.pop();s.push(o)}for(var c=new Array(s.length+r.length-2),u=0,t=0,d=r.length;t<d;++t)c[u++]=r[t];for(var p=s.length-2;p>0;--p)c[u++]=s[p];return c}const AG=n0(EG),Am={edgeLines:[],init(){Zs.prototype.loadTileset=function(n,e,t){this.metaData={buildings:[]};let i=this._statistics,r=new Zp(this,e,n.root,t);O(t)&&(t.children.push(r),r._depth=t._depth+1);var s=[];for(s.push(r);s.length>0;){var o=s.pop();++i.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&o.refine===Za.ADD;var a=o._header.children;if(O(a))for(var l=a.length,c=0;c<l;++c){var u=a[c],d=new Zp(this,e,u,o);o.children.push(d),d._depth=o._depth+1,s.push(d)}}return MG(this,r),this._readyPromise.resolve(this),this.state=Ln.READY,r}},drawEdgeLine(n,e){const{buildings:t,names:i,excludeNames:r}=e,s=[],o=[];t.forEach(({name:c,boundingBox:u})=>{i.includes(c)?s.push(u):O(r)?r.includes(c)&&o.push(u):o.push(u)});const a=CG(s,o),l=new Io({positions:a,color:new ve(e.color),width:e.linewidth,dashed:e.dashed});l.enabledPick=!1,n.scene.primitives.addObject(l),Am.edgeLines.push(l)},removeEdgeLine(n){Am.edgeLines.forEach(e=>{n.scene.primitives.removeObject(e)}),Am.edgeLines.length=0}};function MG(n,e){const t=n.metaData.buildings;e.children.forEach(i=>{if(!i.extras)return;const{buildingId:r,buildingName:s}=i.extras;if(s==="")return;const{max:o,center:a}=i.boundingVolume;t.push({id:r,name:s,position:[a.x,a.y,o.z],sphere:i.boundingSphere.clone(),boundingBox:i.boundingVolume.clone()})})}function CG(n,e){const t=[];let i=Number.MAX_VALUE,r;for(r=0;r<n.length;r++){const{min:p,max:g}=n[r];i=Math.min(i,p.z),t.push([p.x,p.y],[g.x,p.y],[g.x,g.y],[p.x,g.y])}const s=AG(t),o=[];for(r=0;r<s.length;r++){const p=t[s[r]];o.push(...p,i)}if(!e||e.length===0){const p=t[s[0]];return o.push(p[0],p[1],i),o}const a=[];for(r=0;r<o.length;r+=3)a.push({X:o[r],Y:o[r+1]});let l=new d1([a]),c;for(let p=0;p<e.length;p++){const{min:g,max:_}=e[p],x=(_.x-g.x)*.1,b=(_.y-g.y)*.1;c=new d1([[{X:g.x-x,Y:g.y-b},{X:_.x+x,Y:g.y-b},{X:_.x+x,Y:_.y+b},{X:g.x-x,Y:_.y+b}]]),l=l.difference(c)}const u=l.paths[0],d=[];for(let p=0;p<u.length;p++){const g=u[p];d.push(g.X,g.Y,i)}return d.push(u[0].X,u[0].Y,i),d}const b1=new xe;function x1(n){let e=[],t=[];const{primitive:i,info:r,pickColor:s}=n,o=i._properties,{x:a,y:l,z:c}=r.boundingVolume.center;if(o.length>1){const u=i._pickIds;for(let d=0;d<o.length;d++){const{componentKey:p,boundingVolume:g}=o[d],{x:_,y:x,z:b}=g.center;if(Math.abs(a-_)<.01&&Math.abs(l-x)<.01){const{color:y}=u[d];t.push({componentKey:p,color:y.toArray(),position:[_,x,b]})}}t.sort((d,p)=>p.position[2]-d.position[2])}else t=[{componentKey:r.componentKey,color:s.toArray()}];return t.forEach(u=>{e.push(u.color),delete u.position,delete u.color}),[e,t]}class IG extends a1{constructor(t){super();f(this,"viewer");f(this,"_enableCtrlSelect",!0);f(this,"_enableBuildingSelect",!1);f(this,"enableHighlight",!0);f(this,"_pointerDown",!1);f(this,"_pointerCoord",new xe);f(this,"_mouseMoveSelectColor");f(this,"_mouseDownSelectColor",[]);f(this,"_pickBuildingResult",[]);f(this,"_highlightColorMap",{});f(this,"_pointerdownListener");f(this,"_pointermoveListener");f(this,"_pointerupListener");f(this,"_enabled",!1);this.viewer=t,this._bindEvents()}resetState(){this._enableCtrlSelect=!1,this._enableBuildingSelect=!1}get enableCtrlSelect(){return this._enableCtrlSelect}set enableCtrlSelect(t){t&&this.resetState(),this._enableCtrlSelect=t,!this._enableBuildingSelect&&!this._enableCtrlSelect?this.enabled=!1:this.enabled=!0}set enableBuildingSelect(t){if(this._enableBuildingSelect===t)return;t&&this.resetState(),this._enableBuildingSelect=t,this._mouseMoveSelectColor=[],this._mouseDownSelectColor=[],this._pickBuildingResult=[];const{selectOutlinePass:i,selectFillColorPass:r}=this.viewer.scene.effectComposerCollection;i.clearSelectColorId(),r.clearSelectColorId(),!this._enableBuildingSelect&&!this._enableCtrlSelect?this.enabled=!1:this.enabled=!0}get enableBuildingSelect(){return this._enableBuildingSelect}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.viewer.pickEffect=!t}_bindEvents(){if(this.viewer.scene.mode===Pt.SCENE2D)return;this.viewer.pickEffect=!1;const t=this.viewer.input.pointer,{selectOutlinePass:i}=this.viewer.scene.effectComposerCollection;t.addEventListener(si.POINTER_DOWN,this._pointerdownListener=r=>{const s=r[0];this._pointerCoord.fromArray(s.screenCoord),this._pointerDown=!0}),t.addEventListener(si.POINTER_MOVE,this._pointermoveListener=r=>{if(this._pointerDown)return;const[s,o]=r[0].screenCoord,a=Math.round(1*Ot.devicePixelRatio);let l=this.viewer.scene.pickObject(b1.set(s,o),a,a);l&&l.primitive&&l.model?this._mouseMoveSelectColor=l.pickColor.toArray():this._mouseMoveSelectColor=[],this.enableHighlight&&PG(i,this._mouseMoveSelectColor)}),t.addEventListener(si.POINTER_UP,this._pointerupListener=r=>{if(!this._enableBuildingSelect&&!this._enableCtrlSelect)return;this._pointerDown=!1;const s=r[0];if(s.button!==bv.Primary)return;const[o,a]=s.screenCoord;if(Math.abs(o-this._pointerCoord.x)>0||Math.abs(a-this._pointerCoord.y)>0)return;const l=Math.round(1*Ot.devicePixelRatio);let c=this.viewer.scene.pickObject(b1.set(o,a),l,l);if(c&&c.primitive&&c.model){if(this._enableBuildingSelect){if(s.ctrlKey){let[u,d]=x1(c),[p,g]=[this._pickBuildingResult.findIndex((_,x)=>_.componentKey===d[0].componentKey),this._pickBuildingResult.findIndex((_,x)=>_.componentKey===d.at(-1).componentKey)];g===-1&&p===-1?(this._mouseDownSelectColor.push(...u),this._pickBuildingResult.push(...d)):(this._mouseDownSelectColor.splice(p,g-p+1),this._pickBuildingResult.splice(p,g-p+1)),this.enableHighlight&&this._setSelectFillColor(),this.fire("pickObject",this._pickBuildingResult);return}[this._mouseDownSelectColor,this._pickBuildingResult]=x1(c)}else if(this.enableCtrlSelect){const{info:u,pickColor:d}=c;if(!s.ctrlKey)this._mouseDownSelectColor=[d.toArray()],this._pickBuildingResult=[{componentKey:u.componentKey,model:c.model}];else{const p=d.toArray(),g=NT(this._mouseDownSelectColor.flat(1),p,4);g!==-1?(this._mouseDownSelectColor.splice(g/4,1),this._pickBuildingResult.splice(g/4,1),this._mouseMoveSelectColor=[],i.selectColor=this._mouseDownSelectColor):(this._mouseDownSelectColor.push(p),this._pickBuildingResult.push({componentKey:u.componentKey,model:c.model}))}}this.enableHighlight&&this._setSelectFillColor(),this.fire("pickObject",this._pickBuildingResult);return}this._mouseDownSelectColor=[],this._pickBuildingResult=[],this.enableHighlight&&this._setSelectFillColor()})}setHighlightColor(t,i=.6){const{selectOutlinePass:r,selectFillColorPass:s}=this.viewer.scene.effectComposerCollection,o=new ve(t);r.highlightColor.set(o.r,o.g,o.b,i),s.highlightColor.set(o.r,o.g,o.b,i),this.viewer.scene.requestRender()}setComponentHighlight(t,i){let r=this._highlightColorMap[t.id];O(r)||(r=[],this._highlightColorMap[t.id]=r);const s=Array.isArray(i)?i:[i];for(let o=0;o<s.length;o++){const a=t.componentMap.get(s[o]);if(!O(a))continue;const{instanceId:l,command:c}=a,u=c.pickIds[l].color;r.push(u.toArray())}this._setSelectFillColor()}restoreComponentHighlight(t,i){let r=this._highlightColorMap[t.id];if(!O(r))return;const s=Array.isArray(i)?i:[i];for(let o=0;o<s.length;o++){const a=t.componentMap.get(s[o]);if(!O(a))continue;const{instanceId:l,command:c}=a,u=c.pickIds[l].color;r=r.filter(d=>!OT(d,u.toArray()))}this._setSelectFillColor()}clearComponentHighlight(){this._highlightColorMap={},this._setSelectFillColor()}_setSelectFillColor(){let t=[];for(const i in this._highlightColorMap)t=t.concat(this._highlightColorMap[i]);t=t.concat(this._mouseDownSelectColor),this.viewer.scene.effectComposerCollection.selectFillColorPass.selectColor=t}destroy(){const{pointer:t}=this.viewer.input;return t.removeEventListener(si.POINTER_DOWN,this._pointerdownListener),t.removeEventListener(si.POINTER_MOVE,this._pointermoveListener),t.removeEventListener(si.POINTER_UP,this._pointerupListener),ht(this)}}function PG(n,e){n.clearSelectColorId();for(let t=0;t<e.length;t+=4)n.selectColor.push([e[t],e[t+1],e[t+2],e[t+3]])}class RG{constructor({id:e=Oo(),color:t=new Xn(30932),width:i=3}={}){f(this,"enabled",!0);f(this,"_complete",!1);f(this,"owner");f(this,"id",Oo());f(this,"visible",!0);f(this,"type",cm.Line);f(this,"color",new Xn(30932));f(this,"width",3);f(this,"polyline");f(this,"positions",[]);f(this,"selectPosition",[]);f(this,"depthTest",!1);this.id=e,this.color=t,this.width=i}attach(e){this.owner=e}getData(){return{id:this.id,positions:[...this.polyline.positions],color:this.color.getHex(),width:this.width,type:this.type}}onLeftUp(){}onLeftClick(e){const{worldPosition:t}=e;!this.enabled||!O(t)||this._complete===!0||(this.positions.push(...t.toArray()),this.positions.length===6&&(this._complete=!0,this.selectPosition=[],this.updatePolyline(),this.owner.complete()))}onRightClick(e){this._complete=!0,this.selectPosition=[],this.updatePolyline(),this.owner.complete()}onMouseMove(e){if(!this.enabled||this._complete===!0)return;const{worldPosition:t}=e;this.selectPosition=t.toArray(),this.updatePolyline()}updatePolyline(){if(this.positions.length===0)return;if(!O(this.polyline)){this.polyline=new Io({positions:[...this.positions,...this.selectPosition],color:this.color,width:this.width,depthTest:this.depthTest});return}if(this.selectPosition.length===0&&this.positions.length===3){this.polyline.destroy(),this.polyline=void 0;return}let e=[...this.positions,...this.selectPosition,this.positions[0],this.positions[1],this.positions[2]];this.polyline.positions=e}update(e){var t;!this.enabled||!this.visible||e.passes.pick||(t=this.polyline)==null||t.update(e)}isDestroyed(){return!1}destroy(){var e;return(e=this.polyline)==null||e.destroy(),ht(this)}}function wy(n,e){n.clearSelectColorId();for(const t of e)n.selectColor.push(We.fromRgba(t).toArray())}function DG(n,e){n.clearSelectColorId();for(const t of e)n.selectColor.push(We.fromRgba(t).toArray())}class w1{constructor(e){f(this,"eventHandler");f(this,"enabled",!0);f(this,"_enabledDBClick",!1);f(this,"_enabledSelect",!0);f(this,"_enabledMultiSelect",!1);f(this,"pickPixelSize",3);f(this,"mouseMoveSelectColorId",new Set);f(this,"mouseDownSelectColorId",new Set);f(this,"mouseMultiSelectObjects",new Map);f(this,"onClickCallback",e=>{});f(this,"dbClickCallback",()=>{});f(this,"update");this.scene=e,this.selectFillColorPass.depthFailedColor=We.fromCssColorString("#ed580e80"),this.eventHandler=new Yn(e.canvas),this.eventHandler.setInputAction(this.onMouseClick.bind(this),vt.LEFT_CLICK),this.eventHandler.setInputAction(this.onDblClick.bind(this),vt.LEFT_DOUBLE_CLICK),this.eventHandler.setInputAction(this.onMouseMove.bind(this),vt.MOUSE_MOVE),this.eventHandler.setInputAction(this.onMouseCtrlClick.bind(this),vt.LEFT_CLICK,Wr.CTRL)}get enabledMultiSelect(){return this._enabledMultiSelect}set enabledMultiSelect(e){this._enabledMultiSelect=e,this.mouseMultiSelectObjects.clear(),this.resetColor()}get enabledSelect(){return this._enabledSelect}set enabledSelect(e){this._enabledSelect=e,this.resetColor()}get enabledDBClick(){return this._enabledDBClick}set enabledDBClick(e){this._enabledDBClick=e}get selectFillColorPass(){return this.scene.effectComposerCollection.selectFillColorPass}get selectOutlinePass(){return this.scene.effectComposerCollection.selectOutlinePass}resetColor(){this.mouseDownSelectColorId.clear(),wy(this.selectFillColorPass,this.mouseDownSelectColorId)}onDblClick(e){if(!this.enabled||!this._enabledDBClick)return;const t=Math.round(this.pickPixelSize*Ot.devicePixelRatio);let i=this.scene.pickObject(e.position,t,t);if(i){if(i.dataSource instanceof jr){const r=new Set,{dataSource:s,primitive:o,properties:a}=i;if(r.add(a.componentKey),a&&a.spaceId){const l=a.spaceId,c=s._spaceId2ComponentKey.get(l);if(c.size>0)for(const u of c){let d=o._instanceIds.indexOf(u);d>-1&&r.add(o._instanceIds[d])}}this.dbClickCallback({pickObject:i,componentKeys:r,movement:e})}i.model instanceof Zs&&this.dbClickCallback({pickObject:i,movement:e})}}onMouseCtrlClick(e){if(!this.enabled||!this._enabledMultiSelect){this.mouseMultiSelectObjects.clear();return}const t=Math.round(this.pickPixelSize*Ot.devicePixelRatio);let i=this.scene.pickObject(e.position,t,t);if(O(i)&&i.dataSource instanceof jr){const r=i.pickColor.toRgba();this.mouseDownSelectColorId.has(r)?(this.mouseDownSelectColorId.delete(r),this.mouseMultiSelectObjects.delete(i.id)):(this.mouseDownSelectColorId.add(r),this.mouseMultiSelectObjects.set(i.id,i)),this.onClickCallback(i),this.scene.requestRender()}else this.mouseDownSelectColorId.clear();wy(this.selectFillColorPass,this.mouseDownSelectColorId)}onMouseMove(e){if(!this.enabled||!this._enabledSelect)return;const t=Math.round(this.pickPixelSize*Ot.devicePixelRatio);let i=this.scene.pickObject(e.endPosition,t,t);if(O(i)&&O(i.primitive.getPickColor)){this.scene.requestRender();const{dataSource:r,primitive:s,properties:o}=i,a=i.pickColor.toRgba();if(this.mouseMoveSelectColorId.clear(),this.mouseMoveSelectColorId.add(a),o&&o.spaceId){const l=o.spaceId,c=r._spaceId2ComponentKey.get(l);if(c.size>0)for(const u of c){let d=s._instanceIds.indexOf(u);d>-1&&this.mouseMoveSelectColorId.add(s._pickIds[d].color.toRgba())}}}else this.mouseMoveSelectColorId.clear();DG(this.selectOutlinePass,this.mouseMoveSelectColorId)}onMouseClick(e){if(!this.enabled||!this._enabledSelect)return;const t=Math.round(this.pickPixelSize*Ot.devicePixelRatio);let i=this.scene.pickObject(e.position,t,t);if(O(i)&&i.dataSource instanceof jr){const{dataSource:r,primitive:s,properties:o}=i,a=i.pickColor.toRgba();this.mouseDownSelectColorId.clear(),this.mouseDownSelectColorId.add(a);const l=o.spaceId;if(l){const c=r._spaceId2ComponentKey.get(l);if(c.size>0)for(const u of c){let d=s._instanceIds.indexOf(u);d>-1&&this.mouseDownSelectColorId.add(s._pickIds[d].color.toRgba())}}this.onClickCallback(i),this.scene.requestRender()}else if(O(i)&&i.model instanceof Zs){let r=i.primitive.getPickColor(i);this.mouseDownSelectColorId.clear(),this.mouseDownSelectColorId.add(r.toRgba())}else this.mouseDownSelectColorId.clear();wy(this.selectFillColorPass,this.mouseDownSelectColorId)}setComponentHighLight(e,t){const{primitive:i}=e;if(!i._instanceIds.includes(t))return;let r=i.getGeometryInstanceAttributes(t).pickId.color;this.mouseDownSelectColorId.add(r.toRgba())}setComponentsHighLight(e,t,i){let r=e.floorMap.get(t);if(r)for(const s of i)this.setComponentHighLight(r,s)}isDestroyed(){return!1}destroy(){return this.mouseDownSelectColorId.clear(),this.eventHandler.destroy(),ht(this)}}function S1(n){const e=new w1(n.scene);return Object.defineProperties(n,{mapSelectEvent:{get:()=>e}}),e}class LG{constructor(e,t){f(this,"collection");f(this,"drawHelper");f(this,"_selectId",{buildingId:"",floorId:""});this.viewer=e,this.collection=t.collection,e.extend(S1),this.drawHelper=new yM(e.scene,e.pluginCollection),this.drawHelper.intersectDrawPlane=!1,this.drawHelper.completeEvent.addEventListener(i=>{this.drawHelper.enabled=!1;let{positions:r}=i.getData(),s=[];for(let o=0;o<r.length;o+=3)s.push(r[o],r[o+1])})}startMerge(){const{viewer:e}=this;e.mapSelectEvent.enabled=!0,e.mapSelectEvent.enabledMultiSelect=!0,e.mapSelectEvent.enabledSelect=!1}endMerge(){const{viewer:e}=this;Array.from(e.mapSelectEvent.mouseMultiSelectObjects.values())}startSplit(e,t){this._selectId.buildingId=e,this._selectId.floorId=t;const{viewer:i,drawHelper:r}=this;i.mapSelectEvent.enabled=!1;const s=this.collection.getDataSource(e);s._originalExtrudeHeight=s.extrudeHeight,s.updateExtrudeHeight(jr.minimumExtrudeHeight),r.enabled=!0,r.unExecute();let o=new mu({});o.depthTest=!1,r.execute(o)}endSplit({polygon:e,color:t,componentKey:i}){this._selectId}}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */function OG(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(s=c[0]&2?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,r=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],r=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var Ho=function(){function n(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return n}();function NG(n,e){return n>e?1:n<e?-1:0}function Go(n,e,t){for(var i=new Ho(null,null),r=i,s=i;;){var o=t(n,e.key);if(o<0){if(e.left===null)break;if(t(n,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}s.left=e,s=e,e=e.left}else if(o>0){if(e.right===null)break;if(t(n,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}r.right=e,r=e,e=e.right}else break}return r.right=e.left,s.left=e.right,e.left=i.right,e.right=i.left,e}function Sy(n,e,t,i){var r=new Ho(n,e);if(t===null)return r.left=r.right=null,r;t=Go(n,t,i);var s=i(n,t.key);return s<0?(r.left=t.left,r.right=t,t.left=null):s>=0&&(r.right=t.right,r.left=t,t.right=null),r}function E1(n,e,t){var i=null,r=null;if(e){e=Go(n,e,t);var s=t(e.key,n);s===0?(i=e.left,r=e.right):s<0?(r=e.right,e.right=null,i=e):(i=e.left,e.left=null,r=e)}return{left:i,right:r}}function BG(n,e,t){return e===null?n:(n===null||(e=Go(n.key,e,t),e.left=n),e)}function Ey(n,e,t,i,r){if(n){i(""+e+(t?" ":" ")+r(n)+`
`);var s=e+(t?"    ":"   ");n.left&&Ey(n.left,s,!1,i,r),n.right&&Ey(n.right,s,!0,i,r)}}var Ty=function(){function n(e){e===void 0&&(e=NG),this._root=null,this._size=0,this._comparator=e}return n.prototype.insert=function(e,t){return this._size++,this._root=Sy(e,t,this._root,this._comparator)},n.prototype.add=function(e,t){var i=new Ho(e,t);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var r=this._comparator,s=Go(e,this._root,r),o=r(e,s.key);return o===0?this._root=s:(o<0?(i.left=s.left,i.right=s,s.left=null):o>0&&(i.right=s.right,i.left=s,s.right=null),this._size++,this._root=i),this._root},n.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},n.prototype._remove=function(e,t,i){var r;if(t===null)return null;t=Go(e,t,i);var s=i(e,t.key);return s===0?(t.left===null?r=t.right:(r=Go(e,t.left,i),r.right=t.right),this._size--,r):t},n.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Go(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},n.prototype.findStatic=function(e){for(var t=this._root,i=this._comparator;t;){var r=i(e,t.key);if(r===0)return t;r<0?t=t.left:t=t.right}return null},n.prototype.find=function(e){return this._root&&(this._root=Go(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},n.prototype.contains=function(e){for(var t=this._root,i=this._comparator;t;){var r=i(e,t.key);if(r===0)return!0;r<0?t=t.left:t=t.right}return!1},n.prototype.forEach=function(e,t){for(var i=this._root,r=[],s=!1;!s;)i!==null?(r.push(i),i=i.left):r.length!==0?(i=r.pop(),e.call(t,i),i=i.right):s=!0;return this},n.prototype.range=function(e,t,i,r){for(var s=[],o=this._comparator,a=this._root,l;s.length!==0||a;)if(a)s.push(a),a=a.left;else{if(a=s.pop(),l=o(a.key,t),l>0)break;if(o(a.key,e)>=0&&i.call(r,a))return this;a=a.right}return this},n.prototype.keys=function(){var e=[];return this.forEach(function(t){var i=t.key;return e.push(i)}),e},n.prototype.values=function(){var e=[];return this.forEach(function(t){var i=t.data;return e.push(i)}),e},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.at=function(e){for(var t=this._root,i=!1,r=0,s=[];!i;)if(t)s.push(t),t=t.left;else if(s.length>0){if(t=s.pop(),r===e)return t;r++,t=t.right}else i=!0;return null},n.prototype.next=function(e){var t=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var r=this._comparator;t;){var s=r(e.key,t.key);if(s===0)break;s<0?(i=t,t=t.left):t=t.right}return i},n.prototype.prev=function(e){var t=this._root,i=null;if(e.left!==null){for(i=e.left;i.right;)i=i.right;return i}for(var r=this._comparator;t;){var s=r(e.key,t.key);if(s===0)break;s<0?t=t.left:(i=t,t=t.right)}return i},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return UG(this._root)},n.prototype.load=function(e,t,i){t===void 0&&(t=[]),i===void 0&&(i=!1);var r=e.length,s=this._comparator;if(i&&Cy(e,t,0,r-1,s),this._root===null)this._root=Ay(e,t,0,r),this._size=r;else{var o=kG(this.toList(),FG(e,t),s);r=this._size+r,this._root=My({head:o},0,r)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){e===void 0&&(e=function(i){return String(i.key)});var t=[];return Ey(this._root,"",!0,function(i){return t.push(i)},e),t.join("")},n.prototype.update=function(e,t,i){var r=this._comparator,s=E1(e,this._root,r),o=s.left,a=s.right;r(e,t)<0?a=Sy(t,i,a,r):o=Sy(t,i,o,r),this._root=BG(o,a,r)},n.prototype.split=function(e){return E1(e,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var e,t,i;return OG(this,function(r){switch(r.label){case 0:e=this._root,t=[],i=!1,r.label=1;case 1:return i?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return r.sent(),e=e.right,[3,5];case 4:i=!0,r.label=5;case 5:return[3,1];case 6:return[2]}})},n}();function Ay(n,e,t,i){var r=i-t;if(r>0){var s=t+Math.floor(r/2),o=n[s],a=e[s],l=new Ho(o,a);return l.left=Ay(n,e,t,s),l.right=Ay(n,e,s+1,i),l}return null}function FG(n,e){for(var t=new Ho(null,null),i=t,r=0;r<n.length;r++)i=i.next=new Ho(n[r],e[r]);return i.next=null,t.next}function UG(n){for(var e=n,t=[],i=!1,r=new Ho(null,null),s=r;!i;)e?(t.push(e),e=e.left):t.length>0?(e=s=s.next=t.pop(),e=e.right):i=!0;return s.next=null,r.next}function My(n,e,t){var i=t-e;if(i>0){var r=e+Math.floor(i/2),s=My(n,e,r),o=n.head;return o.left=s,n.head=n.head.next,o.right=My(n,r+1,t),o}return null}function kG(n,e,t){for(var i=new Ho(null,null),r=i,s=n,o=e;s!==null&&o!==null;)t(s.key,o.key)<0?(r.next=s,s=s.next):(r.next=o,o=o.next),r=r.next;return s!==null?r.next=s:o!==null&&(r.next=o),i.next}function Cy(n,e,t,i,r){if(!(t>=i)){for(var s=n[t+i>>1],o=t-1,a=i+1;;){do o++;while(r(n[o],s)<0);do a--;while(r(n[a],s)>0);if(o>=a)break;var l=n[o];n[o]=n[a],n[a]=l,l=e[o],e[o]=e[a],e[a]=l}Cy(n,e,t,a,r),Cy(n,e,a+1,i,r)}}const Qs=11102230246251565e-32,Fn=134217729,zG=(3+8*Qs)*Qs;function Iy(n,e,t,i,r){let s,o,a,l,c=e[0],u=i[0],d=0,p=0;u>c==u>-c?(s=c,c=e[++d]):(s=u,u=i[++p]);let g=0;if(d<n&&p<t)for(u>c==u>-c?(o=c+s,a=s-(o-c),c=e[++d]):(o=u+s,a=s-(o-u),u=i[++p]),s=o,a!==0&&(r[g++]=a);d<n&&p<t;)u>c==u>-c?(o=s+c,l=o-s,a=s-(o-l)+(c-l),c=e[++d]):(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=i[++p]),s=o,a!==0&&(r[g++]=a);for(;d<n;)o=s+c,l=o-s,a=s-(o-l)+(c-l),c=e[++d],s=o,a!==0&&(r[g++]=a);for(;p<t;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=i[++p],s=o,a!==0&&(r[g++]=a);return(s!==0||g===0)&&(r[g++]=s),g}function HG(n,e){let t=e[0];for(let i=1;i<n;i++)t+=e[i];return t}function xu(n){return new Float64Array(n)}const GG=(3+16*Qs)*Qs,VG=(2+12*Qs)*Qs,WG=(9+64*Qs)*Qs*Qs,Rc=xu(4),T1=xu(8),A1=xu(12),M1=xu(16),Kn=xu(4);function XG(n,e,t,i,r,s,o){let a,l,c,u,d,p,g,_,x,b,y,M,E,w,I,B,N,L;const P=n-r,R=t-r,U=e-s,j=i-s;w=P*j,p=Fn*P,g=p-(p-P),_=P-g,p=Fn*j,x=p-(p-j),b=j-x,I=_*b-(w-g*x-_*x-g*b),B=U*R,p=Fn*U,g=p-(p-U),_=U-g,p=Fn*R,x=p-(p-R),b=R-x,N=_*b-(B-g*x-_*x-g*b),y=I-N,d=I-y,Rc[0]=I-(y+d)+(d-N),M=w+y,d=M-w,E=w-(M-d)+(y-d),y=E-B,d=E-y,Rc[1]=E-(y+d)+(d-B),L=M+y,d=L-M,Rc[2]=M-(L-d)+(y-d),Rc[3]=L;let A=HG(4,Rc),D=VG*o;if(A>=D||-A>=D||(d=n-P,a=n-(P+d)+(d-r),d=t-R,c=t-(R+d)+(d-r),d=e-U,l=e-(U+d)+(d-s),d=i-j,u=i-(j+d)+(d-s),a===0&&l===0&&c===0&&u===0)||(D=WG*o+zG*Math.abs(A),A+=P*u+j*a-(U*c+R*l),A>=D||-A>=D))return A;w=a*j,p=Fn*a,g=p-(p-a),_=a-g,p=Fn*j,x=p-(p-j),b=j-x,I=_*b-(w-g*x-_*x-g*b),B=l*R,p=Fn*l,g=p-(p-l),_=l-g,p=Fn*R,x=p-(p-R),b=R-x,N=_*b-(B-g*x-_*x-g*b),y=I-N,d=I-y,Kn[0]=I-(y+d)+(d-N),M=w+y,d=M-w,E=w-(M-d)+(y-d),y=E-B,d=E-y,Kn[1]=E-(y+d)+(d-B),L=M+y,d=L-M,Kn[2]=M-(L-d)+(y-d),Kn[3]=L;const k=Iy(4,Rc,4,Kn,T1);w=P*u,p=Fn*P,g=p-(p-P),_=P-g,p=Fn*u,x=p-(p-u),b=u-x,I=_*b-(w-g*x-_*x-g*b),B=U*c,p=Fn*U,g=p-(p-U),_=U-g,p=Fn*c,x=p-(p-c),b=c-x,N=_*b-(B-g*x-_*x-g*b),y=I-N,d=I-y,Kn[0]=I-(y+d)+(d-N),M=w+y,d=M-w,E=w-(M-d)+(y-d),y=E-B,d=E-y,Kn[1]=E-(y+d)+(d-B),L=M+y,d=L-M,Kn[2]=M-(L-d)+(y-d),Kn[3]=L;const G=Iy(k,T1,4,Kn,A1);w=a*u,p=Fn*a,g=p-(p-a),_=a-g,p=Fn*u,x=p-(p-u),b=u-x,I=_*b-(w-g*x-_*x-g*b),B=l*c,p=Fn*l,g=p-(p-l),_=l-g,p=Fn*c,x=p-(p-c),b=c-x,N=_*b-(B-g*x-_*x-g*b),y=I-N,d=I-y,Kn[0]=I-(y+d)+(d-N),M=w+y,d=M-w,E=w-(M-d)+(y-d),y=E-B,d=E-y,Kn[1]=E-(y+d)+(d-B),L=M+y,d=L-M,Kn[2]=M-(L-d)+(y-d),Kn[3]=L;const ee=Iy(G,A1,4,Kn,M1);return M1[ee-1]}function YG(n,e,t,i,r,s){const o=(e-s)*(t-r),a=(n-r)*(i-s),l=o-a,c=Math.abs(o+a);return Math.abs(l)>=GG*c?l:-XG(n,e,t,i,r,s,c)}const wu=(n,e)=>n.ll.x<=e.x&&e.x<=n.ur.x&&n.ll.y<=e.y&&e.y<=n.ur.y,Py=(n,e)=>{if(e.ur.x<n.ll.x||n.ur.x<e.ll.x||e.ur.y<n.ll.y||n.ur.y<e.ll.y)return null;const t=n.ll.x<e.ll.x?e.ll.x:n.ll.x,i=n.ur.x<e.ur.x?n.ur.x:e.ur.x,r=n.ll.y<e.ll.y?e.ll.y:n.ll.y,s=n.ur.y<e.ur.y?n.ur.y:e.ur.y;return{ll:{x:t,y:r},ur:{x:i,y:s}}};let Vo=Number.EPSILON;Vo===void 0&&(Vo=Math.pow(2,-52));const jG=Vo*Vo,C1=(n,e)=>{if(-Vo<n&&n<Vo&&-Vo<e&&e<Vo)return 0;const t=n-e;return t*t<jG*n*e?0:n<e?-1:1};class qG{constructor(){this.reset()}reset(){this.xRounder=new I1,this.yRounder=new I1}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class I1{constructor(){this.tree=new Ty,this.round(0)}round(e){const t=this.tree.add(e),i=this.tree.prev(t);if(i!==null&&C1(t.key,i.key)===0)return this.tree.remove(e),i.key;const r=this.tree.next(t);return r!==null&&C1(t.key,r.key)===0?(this.tree.remove(e),r.key):e}}const Su=new qG,Mm=(n,e)=>n.x*e.y-n.y*e.x,P1=(n,e)=>n.x*e.x+n.y*e.y,R1=(n,e,t)=>{const i=YG(n.x,n.y,e.x,e.y,t.x,t.y);return i>0?-1:i<0?1:0},Cm=n=>Math.sqrt(P1(n,n)),ZG=(n,e,t)=>{const i={x:e.x-n.x,y:e.y-n.y},r={x:t.x-n.x,y:t.y-n.y};return Mm(r,i)/Cm(r)/Cm(i)},KG=(n,e,t)=>{const i={x:e.x-n.x,y:e.y-n.y},r={x:t.x-n.x,y:t.y-n.y};return P1(r,i)/Cm(r)/Cm(i)},D1=(n,e,t)=>e.y===0?null:{x:n.x+e.x/e.y*(t-n.y),y:t},L1=(n,e,t)=>e.x===0?null:{x:t,y:n.y+e.y/e.x*(t-n.x)},QG=(n,e,t,i)=>{if(e.x===0)return L1(t,i,n.x);if(i.x===0)return L1(n,e,t.x);if(e.y===0)return D1(t,i,n.y);if(i.y===0)return D1(n,e,t.y);const r=Mm(e,i);if(r==0)return null;const s={x:t.x-n.x,y:t.y-n.y},o=Mm(s,e)/r,a=Mm(s,i)/r,l=n.x+a*e.x,c=t.x+o*i.x,u=n.y+a*e.y,d=t.y+o*i.y,p=(l+c)/2,g=(u+d)/2;return{x:p,y:g}};class Lr{static compare(e,t){const i=Lr.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Wo.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,r=t.length;i<r;i++){const s=t[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let r=t+1;r<e;r++){const s=this.point.events[r];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}getLeftmostComparator(e){const t=new Map,i=r=>{const s=r.otherSE;t.set(r,{sine:ZG(this.point,e.point,s.point),cosine:KG(this.point,e.point,s.point)})};return(r,s)=>{t.has(r)||i(r),t.has(s)||i(s);const{sine:o,cosine:a}=t.get(r),{sine:l,cosine:c}=t.get(s);return o>=0&&l>=0?a<c?1:a>c?-1:0:o<0&&l<0?a<c?-1:a>c?1:0:l<o?-1:l>o?1:0}}}let $G=0;class Wo{static compare(e,t){const i=e.leftSE.point.x,r=t.leftSE.point.x,s=e.rightSE.point.x,o=t.rightSE.point.x;if(o<i)return 1;if(s<r)return-1;const a=e.leftSE.point.y,l=t.leftSE.point.y,c=e.rightSE.point.y,u=t.rightSE.point.y;if(i<r){if(l<a&&l<c)return 1;if(l>a&&l>c)return-1;const d=e.comparePoint(t.leftSE.point);if(d<0)return 1;if(d>0)return-1;const p=t.comparePoint(e.rightSE.point);return p!==0?p:-1}if(i>r){if(a<l&&a<u)return-1;if(a>l&&a>u)return 1;const d=t.comparePoint(e.leftSE.point);if(d!==0)return d;const p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(a<l)return-1;if(a>l)return 1;if(s<o){const d=t.comparePoint(e.rightSE.point);if(d!==0)return d}if(s>o){const d=e.comparePoint(t.rightSE.point);if(d<0)return 1;if(d>0)return-1}if(s!==o){const d=c-a,p=s-i,g=u-l,_=o-r;if(d>p&&g<_)return 1;if(d<p&&g>_)return-1}return s>o?1:s<o||c<u?-1:c>u?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,r){this.id=++$G,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=r}static fromRing(e,t,i){let r,s,o;const a=Lr.comparePoints(e,t);if(a<0)r=e,s=t,o=1;else if(a>0)r=t,s=e,o=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const l=new Lr(r,!0),c=new Lr(s,!1);return new Wo(l,c,[i],[o])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,i=this.rightSE.point,r=this.vector();if(t.x===i.x)return e.x===t.x?0:e.x<t.x?1:-1;const s=(e.y-t.y)/r.y,o=t.x+s*r.x;if(e.x===o)return 0;const a=(e.x-t.x)/r.x,l=t.y+a*r.y;return e.y===l?0:e.y<l?-1:1}getIntersection(e){const t=this.bbox(),i=e.bbox(),r=Py(t,i);if(r===null)return null;const s=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,l=e.rightSE.point,c=wu(t,a)&&this.comparePoint(a)===0,u=wu(i,s)&&e.comparePoint(s)===0,d=wu(t,l)&&this.comparePoint(l)===0,p=wu(i,o)&&e.comparePoint(o)===0;if(u&&c)return p&&!d?o:!p&&d?l:null;if(u)return d&&s.x===l.x&&s.y===l.y?null:s;if(c)return p&&o.x===a.x&&o.y===a.y?null:a;if(p&&d)return null;if(p)return o;if(d)return l;const g=QG(s,this.vector(),a,e.vector());return g===null||!wu(r,g)?null:Su.round(g.x,g.y)}split(e){const t=[],i=e.events!==void 0,r=new Lr(e,!0),s=new Lr(e,!1),o=this.rightSE;this.replaceRightSE(s),t.push(s),t.push(r);const a=new Wo(r,o,this.rings.slice(),this.windings.slice());return Lr.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Lr.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),s.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const r=Wo.compare(t,i);if(r!==0){if(r>0){const s=t;t=i,i=s}if(t.prev===i){const s=t;t=i,i=s}for(let s=0,o=i.rings.length;s<o;s++){const a=i.rings[s],l=i.windings[s],c=t.rings.indexOf(a);c===-1?(t.rings.push(a),t.windings.push(l)):t.windings[c]+=l}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys;for(let a=0,l=this.rings.length;a<l;a++){const c=this.rings[a],u=this.windings[a],d=t.indexOf(c);d===-1?(t.push(c),i.push(u)):i[d]+=u}const s=[],o=[];for(let a=0,l=t.length;a<l;a++){if(i[a]===0)continue;const c=t[a],u=c.poly;if(o.indexOf(u)===-1)if(c.isExterior)s.push(u);else{o.indexOf(u)===-1&&o.push(u);const d=s.indexOf(c.poly);d!==-1&&s.splice(d,1)}}for(let a=0,l=s.length;a<l;a++){const c=s[a].multiPoly;r.indexOf(c)===-1&&r.push(c)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(qr.type){case"union":{const i=e.length===0,r=t.length===0;this._isInResult=i!==r;break}case"intersection":{let i,r;e.length<t.length?(i=e.length,r=t.length):(i=t.length,r=e.length),this._isInResult=r===qr.numMultiPolys&&i<r;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=r=>r.length===1&&r[0].isSubject;this._isInResult=i(e)!==i(t);break}default:throw new Error(`Unrecognized operation type found ${qr.type}`)}return this._isInResult}}class O1{constructor(e,t,i){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=i,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=Su.round(e[0][0],e[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let s=r;for(let o=1,a=e.length;o<a;o++){if(typeof e[o][0]!="number"||typeof e[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let l=Su.round(e[o][0],e[o][1]);l.x===s.x&&l.y===s.y||(this.segments.push(Wo.fromRing(s,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),s=l)}(r.x!==s.x||r.y!==s.y)&&this.segments.push(Wo.fromRing(s,r,this))}getSweepEvents(){const e=[];for(let t=0,i=this.segments.length;t<i;t++){const r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}class JG{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new O1(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,r=e.length;i<r;i++){const s=new O1(e[i],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,i=this.interiorRings.length;t<i;t++){const r=this.interiorRings[t].getSweepEvents();for(let s=0,o=r.length;s<o;s++)e.push(r[s])}return e}}class N1{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let i=0,r=e.length;i<r;i++){const s=new JG(e[i],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const r=this.polys[t].getSweepEvents();for(let s=0,o=r.length;s<o;s++)e.push(r[s])}return e}}class Im{static factory(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];if(!s.isInResult()||s.ringOut)continue;let o=null,a=s.leftSE,l=s.rightSE;const c=[a],u=a.point,d=[];for(;o=a,a=l,c.push(a),a.point!==u;)for(;;){const p=a.getAvailableLinkedEvents();if(p.length===0){const x=c[0].point,b=c[c.length-1].point;throw new Error(`Unable to complete output ring starting at [${x.x}, ${x.y}]. Last matching segment found ends at [${b.x}, ${b.y}].`)}if(p.length===1){l=p[0].otherSE;break}let g=null;for(let x=0,b=d.length;x<b;x++)if(d[x].point===a.point){g=x;break}if(g!==null){const x=d.splice(g)[0],b=c.splice(x.index);b.unshift(b[0].otherSE),t.push(new Im(b.reverse()));continue}d.push({index:c.length,point:a.point});const _=a.getLeftmostComparator(o);l=p.sort(_)[0].otherSE;break}t.push(new Im(c))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let c=1,u=this.events.length-1;c<u;c++){const d=this.events[c].point,p=this.events[c+1].point;R1(d,e,p)!==0&&(t.push(d),e=d)}if(t.length===1)return null;const i=t[0],r=t[1];R1(i,e,r)===0&&t.shift(),t.push(t[0]);const s=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,l=[];for(let c=o;c!=a;c+=s)l.push([t[c].x,t[c].y]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let r=1,s=this.events.length;r<s;r++){const o=this.events[r];Lr.compare(e,o)>0&&(e=o)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}}class B1{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,i=this.interiorRings.length;t<i;t++){const r=this.interiorRings[t].getGeom();r!==null&&e.push(r)}return e}}class eV{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const r=this.polys[t].getGeom();r!==null&&e.push(r)}return e}_composePolys(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];if(!s.poly)if(s.isExteriorRing())t.push(new B1(s));else{const o=s.enclosingRing();o.poly||t.push(new B1(o)),o.poly.addInterior(s)}}return t}}class tV{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Wo.compare;this.queue=e,this.tree=new Ty(t),this.segments=[]}process(e){const t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),i;const r=e.isLeft?this.tree.add(t):this.tree.find(t);if(!r)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let s=r,o=r,a,l;for(;a===void 0;)s=this.tree.prev(s),s===null?a=null:s.key.consumedBy===void 0&&(a=s.key);for(;l===void 0;)o=this.tree.next(o),o===null?l=null:o.key.consumedBy===void 0&&(l=o.key);if(e.isLeft){let c=null;if(a){const d=a.getIntersection(t);if(d!==null&&(t.isAnEndpoint(d)||(c=d),!a.isAnEndpoint(d))){const p=this._splitSafely(a,d);for(let g=0,_=p.length;g<_;g++)i.push(p[g])}}let u=null;if(l){const d=l.getIntersection(t);if(d!==null&&(t.isAnEndpoint(d)||(u=d),!l.isAnEndpoint(d))){const p=this._splitSafely(l,d);for(let g=0,_=p.length;g<_;g++)i.push(p[g])}}if(c!==null||u!==null){let d=null;c===null?d=u:u===null?d=c:d=Lr.comparePoints(c,u)<=0?c:u,this.queue.remove(t.rightSE),i.push(t.rightSE);const p=t.split(d);for(let g=0,_=p.length;g<_;g++)i.push(p[g])}i.length>0?(this.tree.remove(t),i.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&l){const c=a.getIntersection(l);if(c!==null){if(!a.isAnEndpoint(c)){const u=this._splitSafely(a,c);for(let d=0,p=u.length;d<p;d++)i.push(u[d])}if(!l.isAnEndpoint(c)){const u=this._splitSafely(l,c);for(let d=0,p=u.length;d<p;d++)i.push(u[d])}}}this.tree.remove(t)}return i}_splitSafely(e,t){this.tree.remove(e);const i=e.rightSE;this.queue.remove(i);const r=e.split(t);return r.push(i),e.consumedBy===void 0&&this.tree.add(e),r}}const F1=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,iV=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class nV{run(e,t,i){qr.type=e,Su.reset();const r=[new N1(t,!0)];for(let d=0,p=i.length;d<p;d++)r.push(new N1(i[d],!1));if(qr.numMultiPolys=r.length,qr.type==="difference"){const d=r[0];let p=1;for(;p<r.length;)Py(r[p].bbox,d.bbox)!==null?p++:r.splice(p,1)}if(qr.type==="intersection")for(let d=0,p=r.length;d<p;d++){const g=r[d];for(let _=d+1,x=r.length;_<x;_++)if(Py(g.bbox,r[_].bbox)===null)return[]}const s=new Ty(Lr.compare);for(let d=0,p=r.length;d<p;d++){const g=r[d].getSweepEvents();for(let _=0,x=g.length;_<x;_++)if(s.insert(g[_]),s.size>F1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new tV(s);let a=s.size,l=s.pop();for(;l;){const d=l.key;if(s.size===a){const g=d.segment;throw new Error(`Unable to pop() ${d.isLeft?"left":"right"} SweepEvent [${d.point.x}, ${d.point.y}] from segment #${g.id} [${g.leftSE.point.x}, ${g.leftSE.point.y}] -> [${g.rightSE.point.x}, ${g.rightSE.point.y}] from queue.`)}if(s.size>F1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>iV)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const p=o.process(d);for(let g=0,_=p.length;g<_;g++){const x=p[g];x.consumedBy===void 0&&s.insert(x)}a=s.size,l=s.pop()}Su.reset();const c=Im.factory(o.segments);return new eV(c).getGeom()}}const qr=new nV;var Pm={union:function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return qr.run("union",n,t)},intersection:function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return qr.run("intersection",n,t)},xor:function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return qr.run("xor",n,t)},difference:function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return qr.run("difference",n,t)}};function Eu(n,e){const t=n[0],i=n[1];let r=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s][0],l=e[s][1],c=e[o][0],u=e[o][1];l>i!=u>i&&t<(c-a)*(i-l)/(u-l)+a&&(r=!r)}return r}function rV(n,e,t){const i=n[0],r=n[1],s=e[0],o=e[1],a=t[0],l=t[1],c=i-s,u=r-o,d=a-s,p=l-o,g=c*d+u*p,_=d*d+p*p;let x=-1;_!==0&&(x=g/_);let b,y;x<0?(b=s,y=o):x>1?(b=a,y=l):(b=s+x*d,y=o+x*p);const M=i-b,E=r-y;return Math.sqrt(M*M+E*E)}function Rm(n,e){let t=1/0;for(let i=0,r=e.length-1;i<e.length;r=i++){const s=rV(n,e[r],e[i]);t=Math.min(t,s)}return t}function sV(n){let e=1/0,t=1/0,i=-1/0,r=-1/0;for(const s of n)e=Math.min(e,s[0]),t=Math.min(t,s[1]),i=Math.max(i,s[0]),r=Math.max(r,s[1]);return[e,t,i,r]}function oV(n){let e=0,t=0,i=0;const r=n.length;for(let s=0;s<r;s++){const o=(s+1)%r,a=n[s][0],l=n[s][1],c=n[o][0],u=n[o][1],d=a*u-c*l;e+=d,t+=(a+c)*d,i+=(l+u)*d}return e/=2,e===0?[n[0][0],n[0][1]]:(t/=6*e,i/=6*e,[t,i])}function aV(n){if(n.length<4)return!0;let e=0;const t=n.length;for(let i=0;i<t;i++){const r=n[i],s=n[(i+1)%t],o=n[(i+2)%t],a=(s[0]-r[0])*(o[1]-r[1])-(s[1]-r[1])*(o[0]-r[0]);if(e===0)e=Math.sign(a);else if(e*a<0)return!1}return!0}function lV(n,e,t){if(n.length===0)return[e[0][0],e[0][1]];let i=0,r=0,s=0;for(const o of n){const a=Math.min(Rm(o,e),...t.map(c=>Rm(o,c))),l=Math.pow(a,2);i+=l,r+=o[0]*l,s+=o[1]*l}return i===0?n[0]:[r/i,s/i]}function U1(n,e){if(aV(n)){const w=oV(n);let I=!0;if(e&&e.length>0){for(const B of e)if(Eu(w,B)){I=!1;break}}if(I)return w}const[i,r,s,o]=sV(n),a=s-i,l=o-r,c=50,u=[],d=a/c,p=l/c;for(let w=0;w<=c;w++)for(let I=0;I<=c;I++){const B=i+w*d,N=r+I*p,L=[B,N];if(!Eu(L,n))continue;let P=!1;for(const R of e)if(Eu(L,R)){P=!0;break}P||u.push(L)}if(u.length===0)return[n[0][0],n[0][1]];const g=lV(u,n,e),_=Math.min(a,l)/4,x=20,b=2*_/x,y=2*_/x;let M=g,E=-1/0;for(let w=0;w<=x;w++)for(let I=0;I<=x;I++){const B=g[0]-_+w*b,N=g[1]-_+I*y,L=[B,N];if(!Eu(L,n))continue;let P=!1;for(const A of e)if(Eu(L,A)){P=!0;break}if(P)continue;const R=Math.min(Rm(L,n),...e.map(A=>Rm(L,A))),U=Math.sqrt(Math.pow(L[0]-g[0],2)+Math.pow(L[1]-g[1],2)),j=R*.7-U/_*.3;j>E&&(E=j,M=L)}return M}class cV{constructor({mapDataSource:e}){f(this,"mapDataSource");f(this,"mapJsonStruct");f(this,"_external");f(this,"updateForPass");f(this,"prePassesUpdate");f(this,"preUpdate");this.mapDataSource=e,this.normalizeData()}get data(){return this.mapDataSource.data}normalizeData(e=this.data){this.mapJsonStruct={type:e.type,boundingVolume:e.boundingVolume,transform:e.transform,floors:e.objects.floors.map(t=>({floorId:t.floorId,floorName:t.floorName,geometries:t.geometries.map(i=>({type:i.type,properties:{...i.properties,color:this.mapDataSource._instanceProperties[i.properties.componentKey].color},polygon:this._getShapes(i.arcs,e.arcs)}))}))}}_getShapes(e,t){return e.map(i=>i.map(r=>r.map(s=>t[s])))}mergeShapes(e){for(const t in e)this.mergeShapesByFloor(t,e[t])}mergeShapesByFloor(e,{componentKeys:t,color:i,spaceId:r}){const{mapJsonStruct:s}=this;let o=s.floors.find(l=>l.floorId===e),a=[];o.geometries.forEach(l=>{t.includes(l.properties.componentKey)&&a.push(l.polygon)}),o.geometries=o.geometries.filter(l=>!t.includes(l.properties.componentKey)),o.geometries.push({type:"MultiPolygon",properties:{color:i,spaceId:r},polygon:Pm.union(...a)})}split(e,t,i){let r=this.mapJsonStruct.floors.find(o=>o.floorId===e);const s=[];r.geometries.forEach(o=>{let a=o.type==="MultiPolygon"?o.polygon:o.polygon[0],l=Pm.intersection([t],a);if(l.length===0)return;o.polygon=Pm.difference(a,[t]),o.polygon.length>1&&(o.type="MultiPolygon"),i(l).forEach((u,d)=>{let p=s.filter(g=>g.properties.spaceId===u.spaceId)[0];p?p.polygon=Pm.union(p.polygon,l[d]):s.push({type:o.type,properties:{componentKey:u.componentKey,color:u.color,spaceId:u.spaceId},polygon:JSON.parse(JSON.stringify(l))})})}),r.geometries.push(...s),r.geometries=r.geometries.filter(o=>o.polygon.length>0)}splitShape(e,t,i){}toJson(){const{mapJsonStruct:e}=this;let t=[];return{type:e.type,boundingVolume:e.boundingVolume,transform:e.transform,objects:{floors:e.floors.map(r=>({floorId:r.floorId,floorName:r.floorName,geometries:r.geometries.map(s=>{let o=s.polygon.length;if(o===0)return;let a=[];for(let l=0;l<o;l++){let c=[];for(let u=0;u<s.polygon[l].length;u++)c.push(t.length),t.push(s.polygon[l][u]);a.push(c)}return{type:s.type,properties:s.properties,arcs:[a]}})}))},arcs:t}}getAreas(e){const{floorId:t,internalArea:i,buildingArea:r}=e,s={floorId:t,floorName:"",properties:[]};return this.mapJsonStruct.floors.forEach(o=>{if(o.floorId!==t)return;s.floorName=o.floorName;let a=0;const l=[],c=o.geometries.map(u=>{let d=0;u.polygon.forEach(([_,...x])=>{if(Ry(_)===3){const[b,...y]=_,M=Dm(b);let E=0;y==null||y.forEach(w=>{E+=Dm(w)}),d+=M-E}else{const b=Dm(_);let y=0;x==null||x.forEach(M=>{y+=Dm(M)}),d+=b-y}}),a+=d;const[p,...g]=u.polygon[0];if(Ry(p)===3){const[_,...x]=p;l.push(U1(_,x))}else l.push(U1(p,g));return d});s.properties=c.map((u,d)=>{const p=u/a;return{internalArea:Math.round(p*i*100)/100,buildingArea:Math.round(p*r*100)/100,position:l[d],componentKey:o.geometries[d].properties.componentKey}})}),s}update(e){}isDestroyed(){return!1}destroy(){return ht(this)}}function Dm(n){let e=0;const t=n.length;for(let i=0;i<t;i++){const r=n[i],s=n[(i+1)%t],o=r[0]*s[1]-r[1]*s[0];e+=o}return Math.abs(e)/2}function Ry(n){let e=1;for(let t of n)if(Array.isArray(t)){const i=Ry(t);i+1>e&&(e=i+1)}return e}var Tu=(n=>(n.Distance="distance",n.Area="area",n.Angle="angle",n.Elevation="elevation",n))(Tu||{});const[Dy,Lm]=[new T,new T],[k1,z1]=[new T,new T];function hV(n,e,t){let[i,r]=[e.distanceTo(n),t.distanceTo(n)];i<r?[e,t]=[t,e]:[t,e]=[e,t];const s=Math.min(i,r)*.2;k1.subVectors(e,n).normalize(),z1.subVectors(t,n).normalize();const o=[],a=100;for(let c=0;c<=a;c++){const u=c/a,d=new T().lerpVectors(k1,z1,u).normalize().multiplyScalar(s).add(n);o.push(...d.toArray())}let l=new T(o[a/2*3],o[a/2*3+1],o[a/2*3+2]);return[o,l]}class uV{constructor(e={}){f(this,"enabled",!0);f(this,"visible",!0);f(this,"type",Tu.Angle);f(this,"htmlOverlay");f(this,"owner");f(this,"maxPoints",3);f(this,"_currentIndex",0);f(this,"positions",[new T(0,0,0),new T(0,0,0),new T(0,0,0)]);f(this,"points",new Sm);f(this,"_complete",!1);f(this,"polyLines",new my);f(this,"line");f(this,"angleLine");f(this,"id",Oo());f(this,"_angle",0);f(this,"precision",2);f(this,"name");let{name:t,precision:i}=e;this.name=ye(t,this.type),this.precision=ye(i,this.precision),this.points._translucentMaterial.depthTest=!1,this.points._translucentMaterial.toneMapped=!1,this.createLine(),this.createLabel()}get viewer(){return this.owner.viewer}get complete(){return this._complete}createLine(){let[e,t,i,r]=[3,!1,!1,10];this.line=this.polyLines.add({positions:[0,0,0,0,0,0,0,0,0],color:new ve(3113197),width:e,depthTest:t,vertexColors:!1,dashed:i,dashScale:r}),this.line.visible=!1,this.angleLine=this.polyLines.add({positions:[0,0,0,0,0,0],color:new ve(3113197),width:e,depthTest:t,vertexColors:!1}),this.angleLine.visible=!1}createLabel(){const e=document.createElement("div");e.id=this.id,e.className="measure-Label measure-Label-background angleLabel",e.onclick=t=>{t.stopPropagation(),this.owner.currentSelectInstance=this,this.owner.selectChangeEvent.raiseEvent(this)},e.onmouseenter=t=>{t.stopPropagation(),this.owner.showLabel(!1)},e.onmouseleave=t=>{t.stopPropagation(),this.owner.showLabel(!0)},this.htmlOverlay=new np(e,{position:new T(0,0,0),center:!0}),this.htmlOverlay.show(!1)}show(e){this.htmlOverlay.show(e),this.visible=e}attach(e){this.owner=e,this.viewer.container.appendChild(this.htmlOverlay.domElement)}onLeftUp(){}onLeftClick(e){const{worldPosition:t}=e;if(!this.enabled||!O(t)||this._complete===!0)return;this.owner.currentSelectInstance=this;let i=T.clone(t,this.positions[this._currentIndex]);this.createPoint(i),this._currentIndex++,this._currentIndex>=this.maxPoints&&this.onComplete()}createPoint(e){return this.points.add({id:this.id,pixelSize:10,position:T.clone(e),color:We.fromCssColorString("#ffffff"),outlineColor:We.fromCssColorString("#2F80ED"),outlineWidth:4,disableDepthTestDistance:Number.POSITIVE_INFINITY})}onRightClick(e){this.enabled&&this.reset()}onMouseMove(e){const{worldPosition:t}=e;if(!(!this.enabled||!O(t)||this.complete)){for(let i=this._currentIndex;i<this.maxPoints;i++)this.positions[i]=T.clone(t,this.positions[i]);this._currentIndex>=1&&this.updatePolyline()}}updatePolyline(){let[e,t,i]=this.positions;T.subtract(e,t,Dy),T.subtract(i,t,Lm),Dy.normalize(),Lm.normalize(),this._currentIndex===2&&Lm.lengthSq()>Ne.EPSILON8&&this.updateCurve(),this.line.positions=[e.x,e.y,e.z,t.x,t.y,t.z,i.x,i.y,i.z],this.line.visible=!0}updateCurve(){let[e,t,i]=this.positions,[r,s]=hV(t,e,i);this.angleLine.positions=r,this.angleLine.visible=!0;const o=kn.radToDeg(T.angleBetween(Dy,Lm));this._angle=o,this.htmlOverlay.domElement.textContent=`${this._angle.toFixed(this.precision)}`,this.htmlOverlay.position.lerpVectors(t,s,.5),this.htmlOverlay.show(!0)}update(e){!this.enabled||!this.visible||e.passes.pick||(this.owner.currentSelectInstance===this&&this.points.update(e),this.polyLines.update(e),this.htmlOverlay.update(e))}onComplete(){this._complete=!0,this.owner.complete()}getData(e,t){return{id:this.id,type:this.type,precision:this.precision,angle:this._angle.toFixed(e)}}updateLabels(e=this.precision,t){this.precision=e,this.htmlOverlay.domElement.textContent=`${this._angle.toFixed(e)}`}reset(){this.htmlOverlay.show(!1),this.htmlOverlay.domElement.textContent="",this.positions=[new T(0,0,0),new T(0,0,0),new T(0,0,0)],this.points.removeAll(),this.owner.currentSelectInstance=void 0,this._currentIndex=0,this._complete=!1,this.line.visible=!1,this.angleLine.visible=!1}isDestroyed(){return!1}destroy(){var e;return this.points.destroy(),(e=this.htmlOverlay)==null||e.destroy(),ht(this)}}const Xo={mm:1e3,cm:100,m:1,km:.001};class fV{constructor(e={}){f(this,"enabled",!0);f(this,"owner");f(this,"points",new Sm);f(this,"polyline");f(this,"helperLines",new my);f(this,"startPoint");f(this,"startPosition");f(this,"endPoint");f(this,"endPosition");f(this,"_complete",!1);f(this,"htmlOverlay");f(this,"visible",!0);f(this,"precision",2);f(this,"unit","mm");f(this,"type",Tu.Distance);f(this,"id",Oo());f(this,"name");let{name:t,precision:i,unit:r}=e;this.name=ye(t,this.type),this.precision=ye(i,this.precision),this.unit=ye(r,this.unit);const s=document.createElement("div");s.id=this.id,s.className="measure-Label measure-Label-background distanceLabel",s.onclick=o=>{o.stopPropagation(),this.owner.currentSelectInstance=this,this.owner.selectChangeEvent.raiseEvent(this)},s.onmouseenter=o=>{o.stopPropagation(),this.owner.showLabel(!1)},s.onmouseleave=o=>{o.stopPropagation(),this.owner.showLabel(!0)},this.htmlOverlay=new np(s,{position:new T(0,0,0),center:!0}),this.htmlOverlay.show(!1)}get viewer(){return this.owner.viewer}get complete(){return this._complete}show(e=!0){this.htmlOverlay.show(e),this.visible=e}attach(e){this.owner=e,this.viewer.container.appendChild(this.htmlOverlay.domElement)}createPoint(e){return this.points.add({id:this.id,pixelSize:7,position:T.clone(e),color:We.fromCssColorString("#ff0000"),outlineColor:We.WHITE,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY})}onLeftClick(e){const{worldPosition:t}=e;if(!(!this.enabled||!O(t))){if(!O(this.startPosition)){let i=T.clone(t,new T);this.startPoint=this.createPoint(i),this.startPosition=i,this.endPoint=this.createPoint(t);return}this.owner.currentSelectInstance=this,this.createHelperLines(),this.onComplete()}}onLeftUp(){}onMouseMove(e){const{worldPosition:t}=e;!this.enabled||!O(t)||this.complete||O(this.startPosition)&&(this.endPosition=T.clone(t,this.endPosition),this.endPoint.position=t,this.updatePolyline())}onRightClick(e){this.enabled&&this.reset()}onComplete(){this._complete=!0,this.owner.complete()}reset(){var e;this.startPoint=void 0,this.startPosition=void 0,this.endPoint=void 0,this.endPosition=void 0,this._complete=!1,this.htmlOverlay.show(!1),this.htmlOverlay.domElement.textContent="",this.helperLines.removeAll(),this.points.removeAll(),this.owner.currentSelectInstance=void 0,(e=this.polyline)==null||e.destroy(),this.polyline=void 0}updatePolyline(){if(!O(this.startPosition)||!O(this.endPosition))return;O(this.polyline)||(this.polyline=new Io({positions:[...this.startPosition.toArray(),...this.endPosition.toArray()],color:new ve(14062856),width:3,depthTest:!1})),this.polyline.positions=[...this.startPosition.toArray(),...this.endPosition.toArray()];let e=T.distance(this.startPosition,this.endPosition);this.htmlOverlay.domElement.textContent=(e*Xo[this.unit]).toFixed(this.precision)+this.unit,this.htmlOverlay.position.addVectors(this.startPosition,this.endPosition).multiplyScalar(.5),this.htmlOverlay.show(!0)}createHelperLines(){let{startPosition:e,endPosition:t}=this,i=[[t.x,e.y,e.z],[t.x,t.y,e.z]],[r,s,o,a]=[3,!1,!0,10];this.helperLines.add({positions:[...this.startPosition.toArray(),...i[0]],color:new ve(16711680),width:r,depthTest:s,vertexColors:!0,dashed:o,dashScale:a}),this.helperLines.add({positions:[...i[0],...i[1]],color:new ve(65280),width:r,depthTest:s,vertexColors:!0,dashed:o,dashScale:a}),this.helperLines.add({positions:[...i[1],...this.endPosition.toArray()],color:new ve(255),width:r,depthTest:s,vertexColors:!0,dashed:o,dashScale:a})}getData(e=this.precision,t="mm"){const i=T.distance(this.startPosition,this.endPosition),r=T.subtract(this.endPosition,this.startPosition,new T);return T.abs(r,r),{id:this.id,type:this.type,unit:this.unit,precision:this.precision,distance:parseFloat((i*Xo[t]).toFixed(e)),X:parseFloat((r.x*Xo[t]).toFixed(e)),Y:parseFloat((r.y*Xo[t]).toFixed(e)),Z:parseFloat((r.z*Xo[t]).toFixed(e))}}updateLabels(e=this.precision,t=this.unit){if(this.precision=e,this.unit=t,!O(this.startPosition))return;const i=T.distance(this.startPosition,this.endPosition);this.htmlOverlay.domElement.textContent=(i*Xo[this.unit]).toFixed(this.precision)+this.unit}update(e){var t;!this.enabled||!this.visible||e.passes.pick||(this.points.update(e),(t=this.polyline)==null||t.update(e),this.owner.currentSelectInstance===this&&this.helperLines.update(e),this.htmlOverlay.update(e))}isDestroyed(){return!1}destroy(){var e;return this.points.destroy(),(e=this.polyline)==null||e.destroy(),this.helperLines.destroy(),this.htmlOverlay.destroy(),ht(this)}}class dV{constructor(e={}){f(this,"type",Tu.Elevation);f(this,"enabled",!0);f(this,"visible",!0);f(this,"owner");f(this,"id",Oo());f(this,"unit","m");f(this,"precision",3);f(this,"_complete",!1);f(this,"htmlOverlay");f(this,"pointLabel");f(this,"name");f(this,"positions",[]);f(this,"points",new Sm);f(this,"_imgDom");let{name:t,precision:i}=e;this.name=t??this.type,this.precision=i??this.precision,this.createLabel(),this.createPointLabel()}get viewer(){return this.owner.viewer}show(e){this.htmlOverlay.show(e),this.visible=e}createLabel(){const e=document.createElement("div");e.id=this.id,e.className="measure-Label elevationLabel";let t=document.createElement("div");t.className="elevationLabel-text",t.innerText="",e.appendChild(t);let i=document.createElement("img");i.className="elevationLabel-image",i.src=gn("Assets/UI/icon/elevation.png"),e.appendChild(i),this._imgDom=i,e.onclick=r=>{r.stopPropagation(),this.owner.currentSelectInstance=this,this.owner.selectChangeEvent.raiseEvent(this)},e.onmouseenter=r=>{r.stopPropagation(),this.owner.showLabel(!1)},e.onmouseleave=r=>{r.stopPropagation(),this.owner.showLabel(!0)},this.htmlOverlay=new np(e,{position:new T(0,0,0),center:!0}),this.htmlOverlay.show(!1)}createPointLabel(){}attach(e){this.owner=e,this.viewer.element.appendChild(this.htmlOverlay.domElement)}onLeftClick(e){const{worldPosition:t}=e;!this.enabled||!O(t)||(this.positions[0]=T.clone(t),this.htmlOverlay.domElement.firstChild.textContent=(t.z*Xo[this.unit]).toFixed(this.precision)+this.unit,T.clone(t,this.htmlOverlay.position),this.htmlOverlay.show(!0),this.htmlOverlay.offset.x+=30*Ot.devicePixelRatio-8,this.htmlOverlay.offset.y-=this._imgDom.clientHeight+3,this.onComplete())}onComplete(){this._complete=!0,this.owner.complete()}onLeftUp(){}onMouseMove(e){}onRightClick(e){}reset(){}getData(e,t){let i=this.positions[0];return{id:this.id,type:this.type,unit:this.unit,precision:this.precision,height:parseFloat((i.z*Xo[this.unit]).toFixed(this.precision)+this.unit)}}updateLabels(e,t){}update(e){var t;!this.enabled||!this.visible||e.passes.pick||(this.htmlOverlay.update(e),(t=this.pointLabel)==null||t.update(e))}isDestroyed(){return!1}destroy(){return this.htmlOverlay.destroy(),ht(this)}}const H1=new Lt,G1=new Mi;class pV{constructor(e){f(this,"eventHandler");f(this,"enabled",!0);f(this,"showDepthFailColor",!1);f(this,"doubleClickEventCallback");this.scene=e,this.eventHandler=new Yn(e.canvas),this.eventHandler.setInputAction(this.onMouseClick.bind(this),vt.LEFT_CLICK),this.eventHandler.setInputAction(this.onMouseDoubleClick.bind(this),vt.LEFT_DOUBLE_CLICK)}get overlayRenderPass(){return this.scene.effectComposerCollection.mainEffectComposer.overlayRenderPass}get camera(){return this.scene.camera}onMouseClick(e){if(!this.enabled||!this.showDepthFailColor)return;const{position:t}=e,i=this.scene.pickObject(t);if(!O(i)){this.overlayRenderPass.selectObjects=[],this.overlayRenderPass._clearCallback.forEach(o=>o()),this.overlayRenderPass._clearCallback=[],this.overlayRenderPass.clearBuffer();return}const{primitive:r,instanceId:s}=i;this.overlayRenderPass.executeClearCallback(),this.overlayRenderPass.selectObjects=[],O(r.setOverlayInstanceVisible)&&(this.overlayRenderPass.selectObjects=[r],this.overlayRenderPass._clearCallback.push(r.setOverlayInstanceVisible(!0,s)))}onMouseDoubleClick(e){var o;if(!this.enabled)return;const{position:t}=e,i=this.scene.pickObject(t);if(!O(i))return;const{primitive:{_properties:r},instanceId:s}=i;Lt.clone(r[s].boundingVolume,H1),H1.getBoundingSphere(G1),(o=this.doubleClickEventCallback)==null||o.call(this,G1)}isDestroyed(){return!1}destroy(){return this.eventHandler.destroy(),ht(this)}}function mV(n){const e=new pV(n.scene);return Object.defineProperties(n,{viewerScreenEvent:{get:()=>e}}),e}const V1=BF.version;return console.log("VEngine: ",V1),console.log(": ",window.devicePixelRatio),{MapDataSourceHelper:LG,MapDataSourceCollection:cy,SpriteCollection:JH,SphereGeometry:wU,Object3DCollection:zi,destroyObject:ht,MapShapeEdit:cV,html2canvas:Q0,HTMLTexture:fH,BillboardCollection:PH,Sky:$H,HemisphereLight:DH,DirectionalLight:RH,MapSelectEvent:w1,mapSelectEventMixin:S1,MapDataSource:jr,MeshPhysicalShaderMaterial:OM,Primitive:xs,BoxGeometry:FF,VERSION:V1,THREE:h2,Plugins:{RectSelect:yv,BuildingModel:Am,BuildingSelect:IG,BuildingCompass:tG},PointPrimitive:ti,PointPrimitiveCollection:Sm,PolylineCollection:my,ColorVec4:We,BaseScene:RM,EventType:si,ServerResource:qs,EasingFunction:Qd,defined:O,defaultValue:ye,BoundingBox2D:zs,BoundingBox3D:Lt,Polyline:Io,AxisAlignedBoundingBoxHelper:Pr,EncodedVector3:$d,localforage:r0,JulianDate:ni,Resource:Hi,Pako:NF,FeatureDetection:Ot,MeshBasicShaderMaterial:Fp,Model:Zs,HtmlOverLayCollection:wS,HtmlOverlay:np,BoundingSphere:Mi,Vector2:he,Vector3:T,Vector4:nt,Matrix3:at,Matrix4:fe,Camera:yo,ClipMode:rc,ScreenSpaceEventType:vt,ScreenSpaceEventHandler:Yn,DistanceMeasure3D:fV,AngleMeasure3D:uV,ElevationMeasure3D:dV,Fullscreen:Cr,Viewer:ay,MeasureType:Tu,CameraEventType:li,HeadingPitchRange:jl,VMath:Ne,PolygonDrawHelper:mu,Model3DTileStyle:uH,viewerScreenEventMixin:mV,GeometryInstance:N0,ColorGeometryInstanceAttribute:sc,ExtrudeGeometry:XE,LineDrawHelper:RG}});
//# sourceMappingURL=VEngine.min.js.map
